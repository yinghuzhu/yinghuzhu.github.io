<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>yhzhuçš„éšæ‰‹è®°</title>
  
  
  <link href="https://www.yzhu.name/atom.xml" rel="self"/>
  
  <link href="https://www.yzhu.name/"/>
  <updated>2026-01-11T01:03:18.298Z</updated>
  <id>https://www.yzhu.name/</id>
  
  <author>
    <name>yhzhu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Synchronizing Recurring Outlook Meetings with EspoCRM</title>
    <link href="https://www.yzhu.name/2026/01/10/espocrm/08-outlook-recurring-sync-en/"/>
    <id>https://www.yzhu.name/2026/01/10/espocrm/08-outlook-recurring-sync-en/</id>
    <published>2026-01-10T06:00:00.000Z</published>
    <updated>2026-01-11T01:03:18.298Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ğŸŒ Language</strong>: <strong>English Version</strong> | <a href="/2026/01/05/espocrm/08-outlook-recurring-sync/">ä¸­æ–‡ç‰ˆ</a></p></blockquote><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>If youâ€™re building Outlook Calendar integration with EspoCRM, <strong>recurring meetings will break your standard delta sync logic</strong>. This article presents a production-grade solution using:</p><ul><li><strong>Windowed Expansion</strong>: Only sync instances within <code>[Today - 7d, Today + 90d]</code></li><li><strong>Series Rebuild</strong>: When seriesMaster changes, fetch all instances via the Instances API</li><li><strong>Bootstrap State Machine</strong>: Handle cold-start with explicit initialization scan</li><li><strong>Critical Warning</strong>: Never use <code>iCalUId</code> as a unique key for recurring instances</li></ul><hr><h2 id="The-Problem-Why-Delta-Sync-Fails-for-Recurring-Meetings"><a href="#The-Problem-Why-Delta-Sync-Fails-for-Recurring-Meetings" class="headerlink" title="The Problem: Why Delta Sync Fails for Recurring Meetings"></a>The Problem: Why Delta Sync Fails for Recurring Meetings</h2><p>Most developers assume Microsoft Graphâ€™s Delta Sync API will notify them of every calendar change. This works fine for single events. For recurring meetings, it breaks down.</p><h3 id="Microsoftâ€™s-Data-Model"><a href="#Microsoftâ€™s-Data-Model" class="headerlink" title="Microsoftâ€™s Data Model"></a>Microsoftâ€™s Data Model</h3><p>In Microsoft Graph API, a recurring meeting isnâ€™t a single record. Itâ€™s split into three types:</p><table><thead><tr><th>Type</th><th>Description</th><th>Stored in Outlook</th></tr></thead><tbody><tr><td><strong>seriesMaster</strong></td><td>The template defining recurrence rules (e.g., â€œevery Thursday at 2 PMâ€)</td><td>Physical record</td></tr><tr><td><strong>occurrence</strong></td><td>A specific instance (e.g., â€œJan 8, 2026 at 2 PMâ€)</td><td>Virtual, computed from Master</td></tr><tr><td><strong>exception</strong></td><td>A modified instance (e.g., â€œJust this one, move to 3 PMâ€)</td><td>Physical record</td></tr></tbody></table><h3 id="The-Delta-Sync-Trap"><a href="#The-Delta-Sync-Trap" class="headerlink" title="The Delta Sync Trap"></a>The Delta Sync Trap</h3><p>When you modify a seriesMaster (e.g., change â€œweekly Mondayâ€ to â€œweekly Tuesdayâ€), the Delta API returns only the seriesMaster change. <strong>It does NOT return the 20+ occurrence changes</strong> for future instances.</p><p>Your CRM continues showing meetings on Mondays. Users complain. Debugging reveals no sync errorsâ€”the delta data simply never contained those changes.</p><h3 id="Common-Failure-Patterns"><a href="#Common-Failure-Patterns" class="headerlink" title="Common Failure Patterns"></a>Common Failure Patterns</h3><table><thead><tr><th>Symptom</th><th>Root Cause</th></tr></thead><tbody><tr><td>Missing instances</td><td>Only processed seriesMaster, never expanded occurrences</td></tr><tr><td>Duplicate instances</td><td>Used <code>iCalUId</code> as dedupe key (same for entire series)</td></tr><tr><td>Orphaned instances</td><td>Deleted series in Outlook, only Master removed from CRM</td></tr><tr><td>Time drift</td><td>Expanded in UTC without proper timezone handling</td></tr></tbody></table><hr><h2 id="The-Solution-Windowed-Expansion-Series-Rebuild"><a href="#The-Solution-Windowed-Expansion-Series-Rebuild" class="headerlink" title="The Solution: Windowed Expansion + Series Rebuild"></a>The Solution: Windowed Expansion + Series Rebuild</h2><h3 id="Core-Principle-The-Window"><a href="#Core-Principle-The-Window" class="headerlink" title="Core Principle: The Window"></a>Core Principle: The Window</h3><p><strong>Never sync infinite future.</strong> Define a â€œwindow of interestâ€ such as <code>[Today - 7d, Today + 90d]</code>.</p><p>This makes any recurring seriesâ€”even â€œno end dateâ€ onesâ€”produce a constant, bounded number of instances.</p><pre class="mermaid">gantt    title Window Sliding Over Time    dateFormat  YYYY-MM-DD    axisFormat  %m/%d    section Window (90d)    Initial window  :a1, 2026-01-01, 90d    Slid window     :a2, 2026-02-01, 90d    section Series    Weekly instances :crit, 2026-01-01, 180d</pre><h3 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h3><pre class="mermaid">flowchart TD    Start["Start Sync"] --> GetDelta["Graph API: Delta Sync"]    GetDelta --> Loop{"Process Changes"}    Loop -- "Type=seriesMaster" --> MarkResync["Mark for Rebuild"]    Loop -- "Type=occurrence" --> SyncItem["Sync Instance (No iCalUId Fallback)"]    Loop -- "Type=singleInstance" --> SyncNormal["Standard Sync"]    MarkResync --> TriggerResync["Trigger Series Rebuild"]    subgraph SeriesResync ["Series Rebuild"]        Fetch["Graph API: List Instances (Windowed)"]        Upsert["Bulk Upsert Instances"]        Cleanup["Clean Removed Instances"]    end</pre><hr><h2 id="Implementation-Details"><a href="#Implementation-Details" class="headerlink" title="Implementation Details"></a>Implementation Details</h2><h3 id="1-The-Bootstrap-State-Machine"><a href="#1-The-Bootstrap-State-Machine" class="headerlink" title="1. The Bootstrap State Machine"></a>1. The Bootstrap State Machine</h3><p>Delta Sync is â€œchange-driven,â€ not â€œpresence-driven.â€ Meetings created years ago with no recent changes wonâ€™t appear in delta results. This causes silent missing data on first sync.</p><p><strong>Solution</strong>: Track bootstrap state per user calendar:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutlookCalendarService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">STATUS_PENDING</span> = <span class="string">&#x27;Pending&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">STATUS_COMPLETED</span> = <span class="string">&#x27;Completed&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">syncUserCalendar</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$userId</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$calendar</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCalendar</span>(<span class="variable">$userId</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$calendar</span>-&gt;<span class="title function_ invoke__">getBootstrapStatus</span>() === <span class="built_in">self</span>::<span class="variable constant_">STATUS_PENDING</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">runBootstrapScan</span>(<span class="variable">$calendar</span>);</span><br><span class="line">            <span class="variable">$calendar</span>-&gt;<span class="title function_ invoke__">setBootstrapStatus</span>(<span class="built_in">self</span>::<span class="variable constant_">STATUS_COMPLETED</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;em-&gt;<span class="title function_ invoke__">save</span>(<span class="variable">$calendar</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">runDeltaSync</span>(<span class="variable">$calendar</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">runBootstrapScan</span>(<span class="params">OutlookCalendar <span class="variable">$calendar</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$windowStart</span> = <span class="keyword">new</span> <span class="title class_">\DateTime</span>(<span class="string">&#x27;-7 days&#x27;</span>);</span><br><span class="line">        <span class="variable">$windowEnd</span> = <span class="keyword">new</span> <span class="title class_">\DateTime</span>(<span class="string">&#x27;+90 days&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get ALL seriesMasters in window, not just changed ones</span></span><br><span class="line">        <span class="variable">$masters</span> = <span class="variable language_">$this</span>-&gt;graphClient-&gt;<span class="title function_ invoke__">getCalendarView</span>(</span><br><span class="line">            <span class="variable">$calendar</span>-&gt;<span class="title function_ invoke__">getExternalAccountId</span>(),</span><br><span class="line">            <span class="variable">$windowStart</span>,</span><br><span class="line">            <span class="variable">$windowEnd</span>,</span><br><span class="line">            [<span class="string">&#x27;$filter&#x27;</span> =&gt; <span class="string">&quot;type eq &#x27;seriesMaster&#x27;&quot;</span>]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$masters</span> <span class="keyword">as</span> <span class="variable">$master</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">rebuildSeries</span>(<span class="variable">$master</span>[<span class="string">&#x27;id&#x27;</span>], <span class="variable">$windowStart</span>, <span class="variable">$windowEnd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Series-Rebuild-Strategy"><a href="#2-Series-Rebuild-Strategy" class="headerlink" title="2. Series Rebuild Strategy"></a>2. Series Rebuild Strategy</h3><p>When seriesMaster changes, trigger instance rebuild:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">rebuildSeries</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$masterId</span>, \DateTime <span class="variable">$start</span>, \DateTime <span class="variable">$end</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Fetch all instances in window</span></span><br><span class="line">    <span class="variable">$instances</span> = <span class="variable language_">$this</span>-&gt;graphClient-&gt;<span class="title function_ invoke__">getInstances</span>(<span class="variable">$masterId</span>, <span class="variable">$start</span>, <span class="variable">$end</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$apiInstanceIds</span> = <span class="title function_ invoke__">array_column</span>(<span class="variable">$instances</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get existing CRM instances for this series</span></span><br><span class="line">    <span class="variable">$existing</span> = <span class="variable language_">$this</span>-&gt;em-&gt;<span class="title function_ invoke__">getRepository</span>(<span class="title class_">OutlookEvent</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">findBy</span>([<span class="string">&#x27;seriesMasterId&#x27;</span> =&gt; <span class="variable">$masterId</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$existingIds</span> = <span class="title function_ invoke__">array_map</span>(fn(<span class="variable">$e</span>) =&gt; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getEventId</span>(), <span class="variable">$existing</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Diff: Create new, Update existing, Delete missing</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$instances</span> <span class="keyword">as</span> <span class="variable">$instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">syncInstance</span>(<span class="variable">$instance</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Delete instances that disappeared from API (but within window)</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$existing</span> <span class="keyword">as</span> <span class="variable">$event</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$event</span>-&gt;<span class="title function_ invoke__">getEventId</span>(), <span class="variable">$apiInstanceIds</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$event</span>-&gt;<span class="title function_ invoke__">getStart</span>()-&gt;<span class="title function_ invoke__">between</span>(<span class="variable">$start</span>, <span class="variable">$end</span>)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;em-&gt;<span class="title function_ invoke__">remove</span>(<span class="variable">$event</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-The-iCalUId-Trap-CRITICAL"><a href="#3-The-iCalUId-Trap-CRITICAL" class="headerlink" title="3. The iCalUId Trap (CRITICAL!)"></a>3. The iCalUId Trap (CRITICAL!)</h3><p><strong>RFC 5545 specifies that ALL occurrences in a recurring series share the same UID.</strong></p><p>This means <code>iCalUId</code> is <strong>NOT unique</strong> for recurring instances. Using it for deduplication will merge all your weekly meetings into one record.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// WRONG: This will break recurring meetings</span></span><br><span class="line"><span class="variable">$meeting</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByEventId</span>(<span class="variable">$eventId</span>)</span><br><span class="line">    ?? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByICalUId</span>(<span class="variable">$iCalUId</span>);  <span class="comment">// âŒ DO NOT DO THIS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CORRECT: Never use iCalUId fallback for recurring instances</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$eventType</span> === <span class="string">&#x27;occurrence&#x27;</span> || <span class="variable">$eventType</span> === <span class="string">&#x27;exception&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$meeting</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByEventId</span>(<span class="variable">$eventId</span>);  <span class="comment">// âœ… Use eventId only</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$meeting</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByEventId</span>(<span class="variable">$eventId</span>)</span><br><span class="line">        ?? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByICalUId</span>(<span class="variable">$iCalUId</span>);  <span class="comment">// âœ… OK for single events</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Complete-Sync-Sequence"><a href="#4-Complete-Sync-Sequence" class="headerlink" title="4. Complete Sync Sequence"></a>4. Complete Sync Sequence</h3><pre class="mermaid">sequenceDiagram  participant S as Scheduler/Job  participant SS as SyncService  participant DB as Database  participant P as Provider(Outlook/Google)  participant W as WindowExpander  S->>SS: Trigger user sync  SS->>DB: Check bootstrapStatus  alt Status is Pending (Cold Start)    SS->>W: Force Windowed Scan (-7d..+90d)    W->>P: List all instances in window    W->>DB: Initialize Series & Instances    SS->>DB: Update bootstrapStatus = Completed  else Status is Completed (Incremental)    SS->>P: Fetch delta (token/page)    alt Series master changed      SS->>W: Mark series for rebuild      W->>P: List instances (window: -7d..+90d)      W->>DB: Upsert created/updated      W->>DB: Delete window-missing    else Occurrence/Exception changed      SS->>DB: Upsert occurrence (no iCalUId fallback)    end  end  SS-->>S: Report metrics</pre><h3 id="5-Quota-Management"><a href="#5-Quota-Management" class="headerlink" title="5. Quota Management"></a>5. Quota Management</h3><p>Recurring series generate massive record counts. One user with 10 weekly meetings &#x3D; ~120 instances per quarter.</p><p><strong>Protect against API throttling:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncLimits</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="variable constant_">MAX_INSTANCES_PER_RUN</span> = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="variable constant_">MAX_SERIES_REBUILD_PER_RUN</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$instancesProcessed</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$seriesRebuilt</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shouldProcessMoreInstances</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;instancesProcessed &lt; <span class="built_in">self</span>::<span class="variable constant_">MAX_INSTANCES_PER_RUN</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shouldRebuildMoreSeries</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;seriesRebuilt &lt; <span class="built_in">self</span>::<span class="variable constant_">MAX_SERIES_REBUILD_PER_RUN</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">recordInstance</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instancesProcessed++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">recordSeriesRebuild</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;seriesRebuilt++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="Production-Checklist"><a href="#Production-Checklist" class="headerlink" title="Production Checklist"></a>Production Checklist</h2><p>Before deploying to production, verify:</p><ul><li><input disabled type="checkbox"> <strong>DST Handling</strong>: Create a weekly meeting spanning DST transition (March&#x2F;November). Verify times donâ€™t drift</li><li><input disabled type="checkbox"> <strong>Exception Preservation</strong>: Modify one instanceâ€™s time, then change series subject. Verify the modified instance keeps its time</li><li><input disabled type="checkbox"> <strong>Deletion Sync</strong>: Delete one future instance in Outlook. Confirm CRM removes it. Delete entire series. Confirm all instances are removed</li><li><input disabled type="checkbox"> <strong>Long-running Series</strong>: Create a monthly meeting for 2 years. Verify only ~90 days are synced</li><li><input disabled type="checkbox"> <strong>All-day Events</strong>: Create all-day recurring event. Verify it doesnâ€™t span two days due to timezone conversion</li><li><input disabled type="checkbox"> <strong>Token Recovery</strong>: Simulate delta token expiration. Verify system falls back to full sync</li><li><input disabled type="checkbox"> <strong>Logging</strong>: All sync operations log (seriesMasterId, instanceId, operation) for debugging</li></ul><hr><h2 id="Comparison-Outlook-vs-Google-Calendar"><a href="#Comparison-Outlook-vs-Google-Calendar" class="headerlink" title="Comparison: Outlook vs Google Calendar"></a>Comparison: Outlook vs Google Calendar</h2><table><thead><tr><th>Aspect</th><th>Microsoft Graph (Outlook)</th><th>Google Calendar API</th></tr></thead><tbody><tr><td><strong>Recurring Model</strong></td><td>Master + Exception (occurrences are virtual)</td><td>Event + Recurrence (can expand with singleEvents&#x3D;true)</td></tr><tr><td><strong>Delta Behavior</strong></td><td>Master change returns only Master</td><td>Master change can return all affected instances</td></tr><tr><td><strong>ID Reference</strong></td><td><code>seriesMasterId</code></td><td><code>recurringEventId</code></td></tr><tr><td><strong>Deletion</strong></td><td>Physical delete or status change</td><td>Often <code>status: cancelled</code></td></tr><tr><td><strong>Complexity</strong></td><td>â­â­â­â­â­</td><td>â­â­â­</td></tr></tbody></table><p>Googleâ€™s <code>singleEvents=true</code> parameter makes expansion easier, but the windowed approach remains necessary for performance.</p><hr><h2 id="Key-Takeaways"><a href="#Key-Takeaways" class="headerlink" title="Key Takeaways"></a>Key Takeaways</h2><ol><li><strong>Never trust Delta Sync alone</strong> for recurring meetings. Use delta as a signal, not as truth.</li><li><strong>Windowed expansion is essential</strong>. Infinite series must be bounded to a constant number of instances.</li><li><strong>iCalUId is half-truth</strong>. Same for all occurrencesâ€”dangerous as a unique key.</li><li><strong>Bootstrap state matters</strong>. Explicit initialization scan prevents â€œcold startâ€ data gaps.</li><li><strong>Log everything</strong>. When debugging sync issues, youâ€™ll need the history.</li></ol><hr><h2 id="Data-Model-Reference"><a href="#Data-Model-Reference" class="headerlink" title="Data Model Reference"></a>Data Model Reference</h2><pre class="mermaid">erDiagram    OUTLOOK_CALENDAR_USER ||--o{ OUTLOOK_CALENDAR_SERIES : tracks    OUTLOOK_CALENDAR_USER ||--o{ OUTLOOK_CALENDAR_EVENT : owns    INTERNAL_EVENT ||--o{ OUTLOOK_CALENDAR_EVENT : linked-by    OUTLOOK_CALENDAR_USER {        string id PK        string deltaToken        string bootstrapStatus    }    OUTLOOK_CALENDAR_SERIES {        string id PK        string seriesMasterEventId        boolean resyncRequested    }    OUTLOOK_CALENDAR_EVENT {        string id PK        string eventId "Immutable Outlook ID"        string iCalUId "Shared by Series - NOT unique!"        string eventType "occurrence/master/exception"        string seriesMasterEventId        datetime windowStart        datetime windowEnd    }    INTERNAL_EVENT {        string id PK        string subject        datetime start        datetime end    }</pre><hr><h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><ul><li><a href="https://learn.microsoft.com/en-us/graph/delta-query-events">Microsoft Graph Delta Query Documentation</a></li><li><a href="https://learn.microsoft.com/en-us/graph/delta-query-events">Get incremental changes to events in a calendar view</a></li><li><a href="https://learn.microsoft.com/en-us/graph/best-practices-concept">Best practices for working with Microsoft Graph</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc5545">RFC 5545: iCalendar Specification</a></li></ul><hr>]]></content>
    
    
    <summary type="html">Recurring meetings break standard delta sync logic. Learn how to synchronize Outlook recurring events with EspoCRM using windowed expansion and series rebuild strategiesâ€”a production-grade solution for Microsoft Graph API integration.</summary>
    
    
    
    <category term="Integration" scheme="https://www.yzhu.name/categories/Integration/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="Microsoft Graph API" scheme="https://www.yzhu.name/tags/Microsoft-Graph-API/"/>
    
    <category term="Outlook Integration" scheme="https://www.yzhu.name/tags/Outlook-Integration/"/>
    
    <category term="Recurring Events" scheme="https://www.yzhu.name/tags/Recurring-Events/"/>
    
    <category term="Delta Sync" scheme="https://www.yzhu.name/tags/Delta-Sync/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRM ä¸ Outlook å¾ªç¯ä¼šè®®åŒæ­¥å®è·µï¼šçª—å£åŒ–å±•å¼€ + ç³»åˆ—é‡å»ºæ–¹æ¡ˆ</title>
    <link href="https://www.yzhu.name/2026/01/05/espocrm/08-outlook-recurring-sync/"/>
    <id>https://www.yzhu.name/2026/01/05/espocrm/08-outlook-recurring-sync/</id>
    <published>2026-01-05T14:00:00.000Z</published>
    <updated>2026-01-05T14:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ğŸŒ Language</strong>: <a href="/2026/01/10/espocrm/08-outlook-recurring-sync-en/">English Version</a> | <strong>ä¸­æ–‡ç‰ˆ</strong></p></blockquote><blockquote><p><strong>å‰æçŸ¥è¯†</strong>ï¼šé˜…è¯»æœ¬æ–‡å‰ï¼Œå‡è®¾æ‚¨å·²äº†è§£ <a href="https://learn.microsoft.com/en-us/graph/overview">Microsoft Graph API</a> çš„åŸºç¡€æ¦‚å¿µï¼Œå¹¶ç†Ÿæ‚‰ EspoCRM çš„ <a href="https://docs.espocrm.com/extensions/outlook-integration/">Outlook Integration</a> æ‰©å±•ã€‚</p></blockquote><p><strong>TL;DR (å¤ªé•¿ä¸çœ‹ç‰ˆ)</strong></p><ul><li><strong>å¢é‡åŒæ­¥ä¸å¯ä¿¡</strong>ï¼šå¯¹äºå¾ªç¯ä¼šè®®ï¼ŒDelta Sync ç»å¸¸åªè¿”å› Master å˜æ›´ï¼Œå¿…é¡»æ‰‹åŠ¨å±•å¼€å®ä¾‹ã€‚</li><li><strong>çª—å£åŒ–æ˜¯å”¯ä¸€è§£</strong>ï¼šä¸è¦è¯•å›¾åŒæ­¥æ— é™çš„æœªæ¥ï¼Œåªç»´æŠ¤ <code>[-7d, +90d]</code> çš„æ»‘åŠ¨çª—å£ã€‚</li><li><strong>iCalUId æœ‰å‘</strong>ï¼šåŒä¸€ä¸ªç³»åˆ—çš„æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ª iCalUIdï¼Œä¸¥ç¦ç›´æ¥ç”¨ä½œå”¯ä¸€é”®å»é‡ã€‚</li><li><strong>Quota å¿…é¡»è®¾</strong>ï¼šGraph API æœ‰ä¸¥æ ¼çš„ 429 é™åˆ¶ï¼Œå¿…é¡»é™åˆ¶æ¯æ¬¡ Job å¤„ç†çš„å®ä¾‹æ•°é‡ã€‚</li></ul><p>åœ¨ CRM ä¸šåŠ¡ç³»ç»Ÿä¸ Outlook&#x2F;Google æ‰˜ç®¡ç³»ç»Ÿçš„è·¨ç³»ç»ŸåŒæ­¥ä¸­ï¼Œâ€œå¾ªç¯ä¼šè®®â€ï¼ˆRecurring Meetingsï¼‰å¾€å¾€æ˜¯æœ€å¤§çš„æ‹¦è·¯è™ã€‚å¾ˆå¤šç³»ç»Ÿé€‰æ‹©ç›´æ¥å¿½ç•¥å®ƒï¼Œæˆ–è€…åªåŒæ­¥ç¬¬ä¸€æ¡ã€‚</p><p>ä½†å¯¹äºä¸šåŠ¡äººå‘˜ï¼Œå‘¨ä¼šã€æœˆåº¦æ±‡æŠ¥æ˜¯æ—¥ç¨‹ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœ CRM é‡Œçœ‹ä¸åˆ°è¿™äº›ä¼šè®®ï¼Œæ—¥å†é›†æˆçš„ä»·å€¼å°±æ‰“äº†ä¸€åŠæŠ˜æ‰£ã€‚æœ¬æ–‡å°†åˆ†äº«æˆ‘ä»¬åœ¨ EspoCRM ä¸­å®ç° Outlook å¾ªç¯ä¼šè®®åŒå‘åŒæ­¥çš„å¡«å‘ä¹‹è·¯ã€‚</p><h2 id="ä¸ºä»€ä¹ˆå¾ªç¯ä¼šè®®è¿™ä¹ˆéš¾ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå¾ªç¯ä¼šè®®è¿™ä¹ˆéš¾ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå¾ªç¯ä¼šè®®è¿™ä¹ˆéš¾ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå¾ªç¯ä¼šè®®è¿™ä¹ˆéš¾ï¼Ÿ</h2><h3 id="Microsoft-Graph-çš„æ•°æ®æ¨¡å‹"><a href="#Microsoft-Graph-çš„æ•°æ®æ¨¡å‹" class="headerlink" title="Microsoft Graph çš„æ•°æ®æ¨¡å‹"></a>Microsoft Graph çš„æ•°æ®æ¨¡å‹</h3><p>åœ¨ Microsoft Graph API ä¸­ï¼Œå¾ªç¯ä¼šè®®å¹¶ä¸æ˜¯ç®€å•çš„â€œä¸€æ¡è®°å½•â€ã€‚å®ƒè¢«æ‹†åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><ol><li><strong>seriesMaster</strong>ï¼šå¾ªç¯ç³»åˆ—çš„â€œæ¯ä½“â€æˆ–â€œæ¨¡æ¿â€ã€‚å®ƒå®šä¹‰äº†è§„åˆ™ï¼ˆä¾‹å¦‚ï¼šæ¯å‘¨å››ä¸‹åˆ 2 ç‚¹ï¼Œæ— é™å¾ªç¯ï¼‰ï¼Œä½†å®ƒæœ¬èº«é€šå¸¸<strong>ä¸ä½œä¸º</strong>ä¸€ä¸ªå…·ä½“çš„æ—¶é—´å ç”¨æ˜¾ç¤ºåœ¨æ—¥å†ä¸Šã€‚</li><li><strong>occurrence</strong>ï¼šå¾ªç¯ç³»åˆ—ä¸­çš„æŸä¸€æ¬¡å…·ä½“å®ä¾‹ï¼ˆä¾‹å¦‚ï¼š2026å¹´1æœˆ8æ—¥çš„å‘¨ä¼šï¼‰ã€‚å®ƒæ˜¯æ ¹æ® Master åŠ¨æ€è®¡ç®—å‡ºæ¥çš„â€œè™šæ‹Ÿâ€å¯¹è±¡ã€‚</li><li><strong>exception</strong>ï¼šå½“æŸä¸€æ¬¡å®ä¾‹è¢«ä¿®æ”¹ï¼ˆæ¯”å¦‚æ”¹äº†æ—¶é—´ã€åœ°ç‚¹æˆ–ä¸»é¢˜ï¼‰åï¼Œå®ƒå°±å˜æˆäº† Exceptionï¼Œç‰©ç†ä¸Šç‹¬ç«‹å­˜å‚¨ã€‚</li></ol><h3 id="åŒæ­¥çš„é™·é˜±ï¼šä¸ºä½•æ ‡å‡†-Delta-Sync-ä¼šå¤±æ•ˆï¼Ÿ"><a href="#åŒæ­¥çš„é™·é˜±ï¼šä¸ºä½•æ ‡å‡†-Delta-Sync-ä¼šå¤±æ•ˆï¼Ÿ" class="headerlink" title="åŒæ­¥çš„é™·é˜±ï¼šä¸ºä½•æ ‡å‡† Delta Sync ä¼šå¤±æ•ˆï¼Ÿ"></a>åŒæ­¥çš„é™·é˜±ï¼šä¸ºä½•æ ‡å‡† Delta Sync ä¼šå¤±æ•ˆï¼Ÿ</h3><p>å½“æˆ‘ä»¬å¤©çœŸåœ°ä½¿ç”¨ Graph API çš„ Delta æ¥å£ï¼ˆå¢é‡åŒæ­¥ï¼‰æ—¶ï¼Œé€šå¸¸ä¼šé­é‡â€œé™é»˜å¤±è´¥â€ï¼š</p><ul><li><strong>â€œéšèº«â€çš„å®ä¾‹</strong>ï¼šä½ ä¿®æ”¹äº†ç³»åˆ—çš„ä¸»è§„åˆ™ï¼ˆæ¯”å¦‚ä»â€œæ¯å‘¨ä¸€â€æ”¹ä¸ºâ€œæ¯å‘¨äºŒâ€ï¼‰ï¼ŒDelta æ¥å£åªä¼šå‘Šè¯‰ä½  seriesMaster å˜äº†ã€‚å®ƒ<strong>ä¸ä¼š</strong>æŠŠæœªæ¥åŠå¹´çš„ 24 ä¸ª occurrence å˜æ›´äº‹ä»¶æ¨é€ç»™ä½ ã€‚å¦‚æœä½ åªä¾èµ– Delta æ•°æ®æ›´æ–°æ•°æ®åº“ï¼Œä½ çš„ CRM æ—¥å†é‡Œï¼Œä¼šè®®è¿˜åœç•™åœ¨å‘¨ä¸€ã€‚</li><li><strong>æ— é™æ•°æ®çš„é»‘æ´</strong>ï¼šå¦‚æœä½ è¯•å›¾å±•å¼€ä¸€ä¸ª â€œNo End Dateâ€ï¼ˆæ— é™å¾ªç¯ï¼‰çš„ä¼šè®®ï¼Œä½ ä¼šå¾—åˆ°æ— é™çš„æ•°æ®ï¼Œç¬é—´æ’‘çˆ†æ•°æ®åº“ã€‚</li><li><strong>iCalUId çš„è¯±æƒ‘ä¸èƒŒå›</strong>ï¼šè¿™å¯èƒ½æ˜¯æœ€å¤§çš„å‘ã€‚å¾ˆå¤šå¼€å‘è€…ä¼šæƒ¯æ€§è®¤ä¸º <code>iCalUId</code> æ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œä½†åœ¨ RFC 5545 æ ‡å‡†é‡Œï¼Œ<strong>åŒä¸€ä¸ªç³»åˆ—çš„æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ª <code>iCalUId</code></strong>ï¼EspoCRM é»˜è®¤é€»è¾‘å–œæ¬¢ç”¨ <code>iCalUId</code> æ¥åšå»é‡ï¼ˆFallbackï¼‰ï¼Œè¿™ä¼šå¯¼è‡´æ‰€æœ‰å‘¨ä¼šéƒ½è¢«åˆå¹¶æˆåŒä¸€æ¡è®°å½•â€”â€”ç¾éš¾ã€‚</li></ul><h3 id="å¸¸è§å¤±è´¥æ¨¡å¼"><a href="#å¸¸è§å¤±è´¥æ¨¡å¼" class="headerlink" title="å¸¸è§å¤±è´¥æ¨¡å¼"></a>å¸¸è§å¤±è´¥æ¨¡å¼</h3><p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œå¦‚æœä½ çœ‹åˆ°ä»¥ä¸‹ç°è±¡ï¼Œé€šå¸¸å°±æ˜¯å¾ªç¯é€»è¾‘å‡ºäº†é—®é¢˜ï¼š</p><ul><li><strong>å®ä¾‹ç¼ºå¤±</strong>ï¼šåªå¤„ç†äº†â€œä¸»æ¡£â€ä½†æ²¡æœ‰å±•å¼€ï¼›æˆ–è€…ç³»åˆ—å¤§æ”¹åæ²¡æœ‰è§¦å‘é‡å»ºã€‚</li><li><strong>å®ä¾‹é‡å¤</strong>ï¼šé”™è¯¯åœ°ä½¿ç”¨äº† <code>iCalUId</code> ä½œä¸ºå”¯ä¸€é”®ï¼›æˆ–è€…é‡å»ºæ—¶æ²¡æœ‰å…ˆæ¸…ç†æ—§æ•°æ®ã€‚</li><li><strong>åˆ é™¤ä¸åŒæ­¥</strong>ï¼šç”¨æˆ·åœ¨ Outlook åˆ é™¤äº†æ•´ä¸ªç³»åˆ—ï¼ŒCRM é‡Œå´åªåˆ é™¤äº† Masterï¼Œç•™ä¸‹ä¸€å †â€œå­¤å„¿â€å®ä¾‹ã€‚</li><li><strong>æ—¶åŒºé”™ä½</strong>ï¼šæŒ‰ UTC å±•å¼€å¯¼è‡´æœ¬åœ°æ—¶æ®µæ¼‚ç§»ï¼›All-day äº‹ä»¶åœ¨è·¨æ—¶åŒºæ—¶å‡ºç° +&#x2F;- 1 å¤©çš„è¯¯å·®ã€‚</li></ul><hr><h2 id="è§£å†³æ–¹æ¡ˆï¼šçª—å£åŒ–å±•å¼€-ç³»åˆ—é‡å»º"><a href="#è§£å†³æ–¹æ¡ˆï¼šçª—å£åŒ–å±•å¼€-ç³»åˆ—é‡å»º" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼šçª—å£åŒ–å±•å¼€ + ç³»åˆ—é‡å»º"></a>è§£å†³æ–¹æ¡ˆï¼šçª—å£åŒ–å±•å¼€ + ç³»åˆ—é‡å»º</h2><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬åˆ¶å®šäº†**â€œçª—å£åŒ–ï¼ˆWindowedï¼‰â€<strong>å’Œ</strong>â€œç³»åˆ—é‡å»ºï¼ˆSeries Resyncï¼‰â€**çš„ç­–ç•¥ã€‚</p><h3 id="æ ¸å¿ƒåŸåˆ™ï¼šçª—å£åŒ–-Windowed"><a href="#æ ¸å¿ƒåŸåˆ™ï¼šçª—å£åŒ–-Windowed" class="headerlink" title="æ ¸å¿ƒåŸåˆ™ï¼šçª—å£åŒ– (Windowed)"></a>æ ¸å¿ƒåŸåˆ™ï¼šçª—å£åŒ– (Windowed)</h3><p>æˆ‘ä»¬æ— æ³•ä¹Ÿä¸åº”è¯¥åŒæ­¥â€œæ— é™â€çš„æœªæ¥ã€‚</p><p><strong>â€œçª—å£åŒ–â€<strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå®šä¹‰ä¸€ä¸ª</strong>â€œå…³æ³¨çª—å£â€</strong>ï¼ˆä¾‹å¦‚ <code>[Today - 7å¤©, Today + 90å¤©]</code>ï¼‰ã€‚</p><ul><li>æˆ‘ä»¬åªå…³å¿ƒè½åœ¨è¿™ä¸ªçª—å£å†…çš„æ—¶é—´ç‰‡ã€‚</li><li>æ¯å¤©å¤œé—´ä»»åŠ¡ä¼šâ€œæ»‘åŠ¨â€è¿™ä¸ªçª—å£ï¼ŒæŠŠæ–°è¿›å…¥çª—å£æœŸï¼ˆç¬¬ 91 å¤©ï¼‰çš„ä¼šè®®å®ä¾‹å®ä¾‹åŒ–å­˜å…¥æ•°æ®åº“ã€‚</li><li>å¯¹äºçª—å£å¤–çš„å†å²æ•°æ®ï¼Œæˆ‘ä»¬ä¿æŒåŸæ ·æˆ–å½’æ¡£ï¼›å¯¹äºå¤ªè¿œçš„æœªæ¥ï¼Œæš‚ä¸å¤„ç†ã€‚</li></ul><p>è¿™æ ·ï¼Œæ— è®ºä¼šè®®æ˜¯â€œæœªæ¥ 10 å¹´â€è¿˜æ˜¯â€œæ— é™å¾ªç¯â€ï¼Œå¯¹ç³»ç»Ÿçš„è´Ÿè½½éƒ½æ˜¯å¯æ§çš„ï¼ˆå¸¸æ•°çº§ï¼‰ã€‚</p><h4 id="ç›´è§‚ç†è§£ï¼šçª—å£æ»‘åŠ¨"><a href="#ç›´è§‚ç†è§£ï¼šçª—å£æ»‘åŠ¨" class="headerlink" title="ç›´è§‚ç†è§£ï¼šçª—å£æ»‘åŠ¨"></a>ç›´è§‚ç†è§£ï¼šçª—å£æ»‘åŠ¨</h4><p>ä¸ºäº†é˜²æ­¢æŠŠâ€œçª—å£â€è¯¯è§£ä¸º UI ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³è±¡ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ï¼š</span><br><span class="line">  ä»Šå¤©æ˜¯ 1æœˆ1æ—¥ï¼Œçª—å£èŒƒå›´æ˜¯ [1æœˆ1æ—¥, 4æœˆ1æ—¥] (+90å¤©)ã€‚</span><br><span class="line">  ç³»ç»Ÿä¼šå®ä¾‹åŒ–ï¼š</span><br><span class="line">  - 1æœˆ1æ—¥ ä¼šè®®</span><br><span class="line">  - 1æœˆ8æ—¥ ä¼šè®®</span><br><span class="line">  ...</span><br><span class="line">  - 3æœˆ26æ—¥ ä¼šè®®</span><br><span class="line"></span><br><span class="line">ç­‰åˆ° 2æœˆ1æ—¥ï¼Œç³»ç»Ÿè‡ªåŠ¨â€œæ»‘åŠ¨â€çª—å£ï¼š</span><br><span class="line">  æ–°çª—å£èŒƒå›´æ˜¯ [2æœˆ1æ—¥, 5æœˆ1æ—¥]ã€‚</span><br><span class="line">  ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š</span><br><span class="line">  1. å¿½ç•¥ 1æœˆä»½çš„å†å²ä¼šè®®ï¼ˆå·²å½’æ¡£æˆ–ä¿æŒç°çŠ¶ï¼‰ã€‚</span><br><span class="line">  2. è¡¥é½ 4æœˆ1æ—¥ è‡³ 5æœˆ1æ—¥ æ–°è¿›å…¥èŒƒå›´çš„ä¼šè®®å®ä¾‹ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h3><pre class="mermaid">flowchart TD    Start["å¼€å§‹åŒæ­¥"] --> GetDelta["Graph API: Delta Sync"]    GetDelta --> Loop{"éå†å˜æ›´é¡¹"}    Loop -- "Type=seriesMaster" --> MarkResync["æ ‡è®°ä¸º'å¾…é‡å»º'"]    Loop -- "Type=occurrence" --> SyncItem["åŒæ­¥å•ä¸ªå®ä¾‹ (ç¦ç”¨ iCalUId Fallback)"]    Loop -- "Type=singleInstance" --> SyncNormal["æ ‡å‡†åŒæ­¥é€»è¾‘"]    MarkResync --> TriggerResync["è§¦å‘ç³»åˆ—é‡å»ºæµç¨‹"]    subgraph SeriesResync ["ç³»åˆ—é‡å»º (Series Resync)"]        Fetch["Graph API: List Instances (Windowed)"]        Upsert["æ‰¹é‡æ›´æ–°/åˆ›å»ºå®ä¾‹"]        Cleanup["æ¸…ç†çª—å£å†…å·²æ¶ˆå¤±çš„å®ä¾‹"]    end</pre><hr><h2 id="å®Œæ•´åŒæ­¥æµç¨‹"><a href="#å®Œæ•´åŒæ­¥æµç¨‹" class="headerlink" title="å®Œæ•´åŒæ­¥æµç¨‹"></a>å®Œæ•´åŒæ­¥æµç¨‹</h2><h3 id="æ ¸å¿ƒæ•°æ®æ¨¡å‹"><a href="#æ ¸å¿ƒæ•°æ®æ¨¡å‹" class="headerlink" title="æ ¸å¿ƒæ•°æ®æ¨¡å‹"></a>æ ¸å¿ƒæ•°æ®æ¨¡å‹</h3><p>ä¸åŒç³»ç»Ÿçš„ç‰©ç†è¡¨ç»“æ„è™½æœ‰å·®å¼‚ï¼Œä½†â€œç³»åˆ—&#x3D;é…ç½®ã€å®ä¾‹&#x3D;äº‹å®â€çš„äºŒå…ƒæ¨¡å‹æ˜¯é€šç”¨çš„ã€‚åœ¨ EspoCRM çš„å·¥ç¨‹å®è·µä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰©å±•å®ä½“æ¥æ¡¥æ¥è¿™ä¸€æ¨¡å‹ã€‚</p><p>ä»¥ Outlook é›†æˆä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¡¥æ¥å®ä½“ <code>OutlookCalendarEvent</code> æ¥å­˜å‚¨å¤–éƒ¨çŠ¶æ€ï¼Œå¹¶ä¸å†…éƒ¨å®ä½“ <code>Meeting</code> (Internal Event) å»ºç«‹æ˜ å°„ã€‚</p><pre class="mermaid">erDiagram  OUTLOOK_CALENDAR_USER ||--o{ OUTLOOK_CALENDAR_SERIES : "tracks"  OUTLOOK_CALENDAR_USER ||--o{ OUTLOOK_CALENDAR_EVENT : "owns"  INTERNAL_EVENT ||--o{ OUTLOOK_CALENDAR_EVENT : "linked-by"  OUTLOOK_CALENDAR_USER {    string id PK    string deltaToken  }  OUTLOOK_CALENDAR_SERIES {    string id PK    string seriesMasterEventId    boolean resyncRequested  }  OUTLOOK_CALENDAR_EVENT {    string id PK    string eventId "Outlook ID (Immutable)"    string iCalUId "Shared by Series"    string eventType "occurrence/master/exception"    string seriesMasterEventId    string otherMeta "Other Sync Meta"  }</pre><ul><li><strong>OUTLOOK_CALENDAR_SERIES</strong>: å¯¹åº” <code>seriesMaster</code>ï¼Œåªè´Ÿè´£è®°å½•ç³»åˆ—çš„å…ƒæ•°æ®ï¼ˆå¦‚ Sync Stateï¼‰ã€‚</li><li><strong>OUTLOOK_CALENDAR_EVENT</strong>: å¯¹åº” <code>occurrence</code> æˆ– <code>exception</code>ï¼Œå­˜å‚¨å…·ä½“çš„ä¼šè®®å®ä¾‹ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ <code>eventId</code> ä¸ Outlook ä¸¥æ ¼ç»‘å®šã€‚</li><li><strong>INTERNAL_EVENT</strong>: EspoCRM åŸç”Ÿçš„ <code>Meeting</code> å®ä½“ï¼Œç”¨æˆ·åœ¨ç•Œé¢ä¸Šå®é™…çœ‹åˆ°çš„æ•°æ®ã€‚</li></ul><h3 id="âš ï¸-è­¦æƒ•-iCalUId-çš„é™·é˜±"><a href="#âš ï¸-è­¦æƒ•-iCalUId-çš„é™·é˜±" class="headerlink" title="âš ï¸ è­¦æƒ• iCalUId çš„é™·é˜±"></a>âš ï¸ è­¦æƒ• iCalUId çš„é™·é˜±</h3><blockquote><p><strong>WARNING &#x2F; è­¦å‘Šï¼š</strong> è¿™æ˜¯ 99% çš„å¼€å‘è€…éƒ½ä¼šè¸©çš„å‘ï¼Œè¯·åŠ¡å¿…åå¤é˜…è¯»æœ¬èŠ‚ï¼</p></blockquote><p><strong>RFC 5545 æ ‡å‡†è§„å®šï¼š</strong> å¯¹äº Recurring Eventï¼Œæ•´ä¸ªç³»åˆ—çš„æ‰€æœ‰å®ä¾‹ï¼ˆOccurrenceï¼‰å…±äº«åŒä¸€ä¸ª <code>UID</code> (<code>iCalUId</code>)ã€‚</p><p>EspoCRM çš„é»˜è®¤é€»è¾‘é€šå¸¸æ˜¯ï¼šå¦‚æœç”¨ <code>(calendarId, eventId)</code> æ‰¾ä¸åˆ°è®°å½•ï¼Œå°±å°è¯•ç”¨ <code>iCalUId</code> å…œåº•æŸ¥æ‰¾ã€‚è¿™å¯¹äºæ™®é€šä¼šè®®æ˜¯å¾ˆå¥½çš„å®¹é”™ï¼Œä½†å¯¹äºå¾ªç¯ä¼šè®®æ˜¯<strong>è‡´å‘½</strong>çš„ã€‚è¿™ä¼šå¯¼è‡´ä½ åŒæ­¥ä¸‹æ¥çš„ 10 ä¸ªå‘¨ä¼šï¼Œå…¨éƒ¨è¢«å…³è”åˆ°äº†æ•°æ®åº“é‡Œçš„åŒä¸€æ¡è®°å½•ä¸Šã€‚</p><p><strong>ä¿®æ­£é€»è¾‘</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç é€»è¾‘</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$eventType</span> === <span class="string">&#x27;occurrence&#x27;</span> || <span class="variable">$eventType</span> === <span class="string">&#x27;exception&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸¥ç¦ä½¿ç”¨ iCalUId æŸ¥æ‰¾æ—§è®°å½•ï¼</span></span><br><span class="line">    <span class="comment">// å¿…é¡»ä¸¥æ ¼åŒ¹é… eventId (Outlook ID)</span></span><br><span class="line">    <span class="variable">$meeting</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByEventId</span>(<span class="variable">$eventId</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ™®é€šä¼šè®®å¯ä»¥ä½¿ç”¨ iCalUId ä½œä¸ºå…œåº•</span></span><br><span class="line">    <span class="variable">$meeting</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByEventId</span>(<span class="variable">$eventId</span>) ?? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findByICalUId</span>(<span class="variable">$iCalUId</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç³»åˆ—é‡å»º-Series-Resync"><a href="#ç³»åˆ—é‡å»º-Series-Resync" class="headerlink" title="ç³»åˆ—é‡å»º (Series Resync)"></a>ç³»åˆ—é‡å»º (Series Resync)</h3><p>å½“æ£€æµ‹åˆ° Master å˜æ›´æ—¶ï¼Œæˆ‘ä»¬ä¸ç›´æ¥å¤„ç† Masterï¼Œè€Œæ˜¯è§¦å‘ä¸€ä¸ªå­ä»»åŠ¡ï¼š</p><ol><li><strong>è°ƒç”¨ Instances æ¥å£</strong>ï¼š<code>/me/events/{masterId}/instances?startDateTime=...&amp;endDateTime=...</code></li><li><strong>è®¾å®šçª—å£</strong>ï¼šé€šå¸¸å– <code>[ä»Šå¤© - 7å¤©, ä»Šå¤© + 90å¤©]</code>ã€‚</li><li><strong>å…¨é‡æ¯”å¯¹</strong>ï¼š<ul><li>API è¿”å›äº†ä½† DB æ²¡æœ‰ -&gt; <strong>åˆ›å»º</strong>ã€‚</li><li>API è¿”å›äº†ä¸” DB ä¹Ÿæœ‰ -&gt; <strong>æ›´æ–°</strong>ã€‚</li><li>DB æœ‰ä½† API æ²¡è¿”å›ï¼ˆä¸”åœ¨çª—å£å†…ï¼‰ -&gt; <strong>åˆ é™¤</strong>ï¼ˆè¯´æ˜è¯¥æ¬¡å®ä¾‹è¢«å–æ¶ˆäº†ï¼Œæˆ–è€…è§„åˆ™å˜æ›´å¯¼è‡´è¯¥æ—¥æœŸä¸å†æœ‰ä¼šè®®ï¼‰ã€‚</li></ul></li></ol><p>è¿™ä¸€æ­¥ä¿è¯äº†æ— è®º Master è§„åˆ™æ€ä¹ˆå˜ï¼ŒCRM é‡Œçš„å®ä¾‹æ°¸è¿œä¸ Outlook&#x2F;Google çš„è§†å›¾ä¿æŒä¸€è‡´ã€‚</p><h3 id="è§£å†³â€œå†·å¯åŠ¨â€é—®é¢˜ï¼šçŠ¶æ€æœºé©±åŠ¨çš„åˆå§‹åŒ–"><a href="#è§£å†³â€œå†·å¯åŠ¨â€é—®é¢˜ï¼šçŠ¶æ€æœºé©±åŠ¨çš„åˆå§‹åŒ–" class="headerlink" title="è§£å†³â€œå†·å¯åŠ¨â€é—®é¢˜ï¼šçŠ¶æ€æœºé©±åŠ¨çš„åˆå§‹åŒ–"></a>è§£å†³â€œå†·å¯åŠ¨â€é—®é¢˜ï¼šçŠ¶æ€æœºé©±åŠ¨çš„åˆå§‹åŒ–</h3><p>åœ¨å®é™…è¿è¡Œä¸­ï¼Œå¦‚æœä»…ä¾èµ– Delta Sync è§¦å‘ç³»åˆ—é‡å»ºï¼Œä¼šé‡åˆ°â€œå†·å¯åŠ¨â€é—®é¢˜ï¼šå­˜é‡ç”¨æˆ·çš„å†å²ä¼šè®®æ— æ³•åŒæ­¥ã€‚</p><blockquote><p><strong>èƒŒæ™¯çŸ¥è¯†ï¼šDelta Sync çš„å±€é™æ€§</strong></p><p>å¾®è½¯ Graph API çš„ Delta Sync æ˜¯â€œ<strong>å˜åŒ–é©±åŠ¨</strong>â€çš„ï¼Œè€Œéâ€œå­˜åœ¨é©±åŠ¨â€ã€‚å®ƒåªè¿”å›åœ¨æŒ‡å®šæ—¶é—´çª—å£å†…<strong>å‘ç”Ÿäº†å˜æ›´</strong>çš„æ•°æ®ã€‚</p><ul><li>å¦‚æœä½ ä¿®æ”¹äº†ä¸€ä¸ªç³»åˆ—çš„ä¸»é¢˜ï¼ŒDelta ä¼šè¿”å›ä¸€æ¡ <code>seriesMaster</code> å˜æ›´è®°å½• -&gt; è§¦å‘æˆ‘ä»¬çš„é‡å»ºé€»è¾‘ã€‚</li><li>ä½†å¦‚æœä¸€ä¸ªä¼šè®®æ˜¯ 3 å¹´å‰åˆ›å»ºçš„ï¼Œä¸”æœ€è¿‘æ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œé‚£ä¹ˆ Delta æ¥å£ä¼šè®¤ä¸ºå®ƒâ€œå²æœˆé™å¥½â€ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸ä¼šè¿”å›ä»»ä½•æ•°æ®ã€‚</li><li>è¿™å°±å¯¼è‡´äº†â€œ<strong>é™é»˜ç¼ºå¤±</strong>â€ï¼šç³»ç»Ÿè®¤ä¸ºåŒæ­¥å®Œæˆäº†ï¼Œä½†æ—¥å†ä¸Šç©ºç©ºå¦‚ä¹Ÿï¼Œåªæœ‰æœ€è¿‘æ–°å»ºçš„ä¼šè®®è¢«åŒæ­¥äº†ã€‚</li></ul></blockquote><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†**â€œåˆå§‹åŒ–çŠ¶æ€æœºâ€**æœºåˆ¶ï¼Œå°†åŒæ­¥æµç¨‹åˆ†ä¸ºâ€œåˆå§‹åŒ–ï¼ˆBootstrapï¼‰â€å’Œâ€œå¢é‡ï¼ˆIncrementalï¼‰â€ä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>å¼•å…¥çŠ¶æ€ä½</strong>ï¼šåœ¨ç”¨æˆ·æ—¥å†é…ç½®ä¸­å¢åŠ  <code>bootstrapStatus</code> å­—æ®µ (<code>Pending</code> &#x2F; <code>Completed</code>)ã€‚</li><li><strong>å¼ºåˆ¶æ‰«æ</strong>ï¼šæ¯æ¬¡åŒæ­¥ä»»åŠ¡å¯åŠ¨æ—¶ï¼Œå…ˆæ£€æŸ¥è¯¥çŠ¶æ€ã€‚<ul><li>å¦‚æœæ˜¯ <code>Pending</code>ï¼šå¿½ç•¥ Delta Tokenï¼Œç›´æ¥æ‰§è¡Œ <code>[-7d, +90d]</code> çš„å…¨é‡çª—å£æ‰«æï¼Œå°†æ‰€æœ‰å‘ç°çš„ Series Master çº³å…¥ç®¡ç†ï¼Œå¹¶åœ¨å®Œæˆåå°†çŠ¶æ€ç½®ä¸º <code>Completed</code>ã€‚</li><li>å¦‚æœæ˜¯ <code>Completed</code>ï¼šæ‰è¿›å…¥å¸¸è§„çš„ Delta Sync æµç¨‹ã€‚</li></ul></li></ol><p>è¿™ä¸ªæœºåˆ¶ç¡®ä¿äº†æ— è®ºä¼šè®®æ˜¯ 5 å¹´å‰åˆ›å»ºçš„è¿˜æ˜¯æ˜¨å¤©åˆ›å»ºçš„ï¼Œéƒ½èƒ½åœ¨é¦–æ¬¡åŒæ­¥æ—¶è¢«æ­£ç¡®æ•è·ï¼Œå½»åº•è§£å†³äº†â€œå†·å¯åŠ¨â€é—®é¢˜ã€‚</p><h4 id="å…¶ä»–ç³»ç»Ÿå¯¹æ¯”ï¼šGoogle-Calendar-çš„åšæ³•"><a href="#å…¶ä»–ç³»ç»Ÿå¯¹æ¯”ï¼šGoogle-Calendar-çš„åšæ³•" class="headerlink" title="å…¶ä»–ç³»ç»Ÿå¯¹æ¯”ï¼šGoogle Calendar çš„åšæ³•"></a>å…¶ä»–ç³»ç»Ÿå¯¹æ¯”ï¼šGoogle Calendar çš„åšæ³•</h4><p>Google Calendar API åœ¨è¿™æ–¹é¢è¡¨ç°å¾—æ›´ä¸ºâ€œå‹å¥½â€ä¸€äº›ï¼Œä½†ä¹Ÿå­˜åœ¨ç±»ä¼¼æŒ‘æˆ˜ï¼š</p><ul><li><strong>Google Calendar</strong>: æ”¯æŒ <code>syncToken</code> (ç±»ä¼¼ Delta Token)ã€‚å½“ Token å¤±æ•ˆæˆ–é¦–æ¬¡åŒæ­¥ï¼ˆä¸å¸¦ Tokenï¼‰æ—¶ï¼ŒGoogle é»˜è®¤è¡Œä¸ºæ˜¯æ‰§è¡Œä¸€æ¬¡ <strong>Full Sync</strong>ï¼ˆå…¨é‡åˆ—è¡¨ï¼‰ï¼Œä¼šè¿”å›æ‰€æœ‰æ´»è·ƒçš„äº‹ä»¶ï¼ŒåŒ…æ‹¬å­˜é‡çš„å¾ªç¯ä¼šè®®ã€‚<ul><li><strong>ä¼˜åŠ¿</strong>ï¼šå†·å¯åŠ¨æ—¶ä¸å®¹æ˜“æ¼æ•°æ®ï¼Œå› ä¸ºå®ƒå€¾å‘äºâ€œå…ˆç»™ä½ å…¨é‡ï¼Œå†ç»™ä½ å¢é‡â€ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šå¦‚æœç”¨æˆ·æ—¥å†æ•°æ®é‡å·¨å¤§ï¼Œé¦–æ¬¡å…¨é‡åŒæ­¥ä¼šéå¸¸æ…¢ä¸”å®¹æ˜“è¶…æ—¶ï¼Œä¾ç„¶éœ€è¦åˆ†é¡µå’Œçª—å£æ§åˆ¶ã€‚</li></ul></li><li><strong>Outlook (Graph API)</strong>: è®¾è®¡ç†å¿µæ›´åå‘â€œæŒ‰éœ€è·å–â€ã€‚å³ä½¿ä¸å¸¦ Tokenï¼Œ<code>calendarView/delta</code> ä¹Ÿä¸»è¦å…³æ³¨â€œè§†å›¾å†…çš„å˜åŒ–â€ã€‚å¦‚æœä¸æ˜¾å¼åœ°è¿›è¡Œä¸€æ¬¡â€œæ—  Token çš„å…¨é‡ Windowed Listâ€ï¼Œå¾ˆå®¹æ˜“åªæ‹¿åˆ°â€œæœ€è¿‘æ´»è·ƒâ€çš„æ•°æ®ã€‚</li></ul><p>å› æ­¤ï¼Œ<strong>â€œæ˜¾å¼çš„åˆå§‹åŒ–æ‰«æâ€</strong>ï¼ˆExplicit Bootstrap Scanï¼‰æ˜¯è·¨æ—¥å†ç³»ç»ŸåŒæ­¥ä¸­é€šç”¨çš„æœ€ä½³å®è·µï¼Œä¸ä»…é€‚ç”¨äº Outlookï¼Œå¯¹äºä¿è¯ Google Calendar æ•°æ®çš„ä¸€è‡´æ€§ä¹ŸåŒæ ·é‡è¦ã€‚</p><h3 id="3-5-å®Œæ•´æµç¨‹æ—¶åºå›¾"><a href="#3-5-å®Œæ•´æµç¨‹æ—¶åºå›¾" class="headerlink" title="3.5 å®Œæ•´æµç¨‹æ—¶åºå›¾"></a>3.5 å®Œæ•´æµç¨‹æ—¶åºå›¾</h3><pre class="mermaid">sequenceDiagram  participant S as Scheduler/Job  participant SS as SyncService  participant DB as Database  participant P as Provider(Outlook/Google)  participant W as WindowExpander  S->>SS: Trigger user sync  SS->>DB: Check bootstrapStatus    alt Status is Pending (Cold Start)    SS->>W: Force Windowed Scan (-7d..+90d)    W->>P: List all instances in window    W->>DB: Initialize Series & Instances    SS->>DB: Update bootstrapStatus = Completed  else Status is Completed (Incremental)    SS->>P: Fetch delta (token/page)    alt Series master changed      SS->>W: Mark series for rebuild      W->>P: List instances (window: -7d .. +90d)      W->>DB: Upsert created/updated      W->>DB: Delete window-missing    else Occurrence/Exception changed      SS->>DB: Upsert occurrence (no iCalUId fallback)    end  end  SS-->>S: Report metrics</pre><hr><h2 id="Outlook-vs-Googleï¼šæ ¸å¿ƒå·®å¼‚å¯¹æ¯”"><a href="#Outlook-vs-Googleï¼šæ ¸å¿ƒå·®å¼‚å¯¹æ¯”" class="headerlink" title="Outlook vs Googleï¼šæ ¸å¿ƒå·®å¼‚å¯¹æ¯”"></a>Outlook vs Googleï¼šæ ¸å¿ƒå·®å¼‚å¯¹æ¯”</h2><p>è™½ç„¶åŸç†ç›¸ä¼¼ï¼Œä½† Google Calendar å’Œ Microsoft Outlook åœ¨å®ç°ç»†èŠ‚ä¸Šæœ‰æ˜¾è‘—å·®å¼‚ã€‚</p><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Microsoft Graph (Outlook)</th><th align="left">Google Calendar API</th></tr></thead><tbody><tr><td align="left"><strong>å¾ªç¯æ¨¡å‹</strong></td><td align="left"><strong>Master + Exception åˆ†ç¦»æ¨¡å‹</strong><br>Master æ˜¯ä¸€æ¡è®°å½•ï¼ŒException æ˜¯ç‹¬ç«‹è®°å½•ã€‚Occurrence æ˜¯è™šæ‹Ÿè®¡ç®—çš„ã€‚</td><td align="left"><strong>Event + Recurrence</strong><br>æ”¯æŒ <code>singleEvents=true</code> å‚æ•°ï¼ŒAPI ç›´æ¥å¸®ä½ å±•å¼€æˆæ‰å¹³çš„å®ä¾‹åˆ—è¡¨ã€‚</td></tr><tr><td align="left"><strong>å¢é‡åŒæ­¥ (Delta)</strong></td><td align="left"><strong>Master å˜æ›´é€šå¸¸åªè¿”å› Master</strong><br>éœ€è¦å®¢æˆ·ç«¯è‡ªå·±å» fetch instancesã€‚</td><td align="left"><strong>å¯é€‰æ‹©</strong><br>å¦‚æœ <code>singleEvents=true</code>ï¼ŒMaster å˜æ›´ä¼šç›´æ¥è¿”å›æ‰€æœ‰å—å½±å“çš„å®ä¾‹å˜æ›´ã€‚</td></tr><tr><td align="left"><strong>ID å…³è”</strong></td><td align="left"><code>seriesMasterId</code> å…³è”å®ä¾‹</td><td align="left"><code>recurringEventId</code> å…³è”åŸäº‹ä»¶</td></tr><tr><td align="left"><strong>åˆ é™¤é€»è¾‘</strong></td><td align="left">ç‰©ç†åˆ é™¤æˆ–å³æ—¶çŠ¶æ€å˜æ›´</td><td align="left">ç»å¸¸é€šè¿‡ <code>status: cancelled</code> æ ‡è®°é€»è¾‘åˆ é™¤</td></tr><tr><td align="left"><strong>å¤æ‚åº¦</strong></td><td align="left">â­â­â­â­â­ (éœ€æ‰‹åŠ¨è®¡ç®—&#x2F;å±•å¼€)</td><td align="left">â­â­â­ (API å¯å¸®å¿™å±•å¼€)</td></tr></tbody></table><hr><h2 id="ç”Ÿäº§çº§å·¥ç¨‹å®è·µ"><a href="#ç”Ÿäº§çº§å·¥ç¨‹å®è·µ" class="headerlink" title="ç”Ÿäº§çº§å·¥ç¨‹å®è·µ"></a>ç”Ÿäº§çº§å·¥ç¨‹å®è·µ</h2><h3 id="é…é¢ä¸æµæ§-Quota"><a href="#é…é¢ä¸æµæ§-Quota" class="headerlink" title="é…é¢ä¸æµæ§ (Quota)"></a>é…é¢ä¸æµæ§ (Quota)</h3><p>å¾ªç¯ä¼šè®®ä¼šäº§ç”Ÿå¤§é‡è®°å½•ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰ 10 ä¸ªå‘¨ä¼šï¼ŒåŒæ­¥æœªæ¥ 3 ä¸ªæœˆï¼Œç¬é—´å°±ä¼šäº§ç”Ÿ 120 æ¡è®°å½•ã€‚</p><ul><li><strong>Max Instances Per Run</strong>ï¼šæ¯æ¬¡ Job æœ€å¤šå¤„ç† <strong>200 ä¸ªå®ä¾‹</strong>ï¼Œè¶…å‡ºçš„ç•™åˆ°ä¸‹æ¬¡ã€‚è¿™ä¸ä»…æ˜¯æ€§èƒ½é—®é¢˜ï¼Œæ›´æ˜¯é˜²æ­¢è§¦å‘å¾®è½¯ Graph API çš„ <strong>429 (Too Many Requests)</strong> é™åˆ¶çš„å…³é”®ã€‚</li><li><strong>Max Series Resync</strong>ï¼šæ¯æ¬¡ Job æœ€å¤šé‡å»º <strong>5 ä¸ªç³»åˆ—</strong>ï¼Œé¿å…çªå‘æµé‡å‹å®ç³»ç»Ÿã€‚</li></ul><h3 id="ä»¤ç‰Œå¤±æ•ˆä¸åˆ†é¡µ"><a href="#ä»¤ç‰Œå¤±æ•ˆä¸åˆ†é¡µ" class="headerlink" title="ä»¤ç‰Œå¤±æ•ˆä¸åˆ†é¡µ"></a>ä»¤ç‰Œå¤±æ•ˆä¸åˆ†é¡µ</h3><p>Graph API çš„ Delta Token æ˜¯æœ‰æœ‰æ•ˆæœŸçš„ã€‚</p><ul><li><strong>Token å¤±æ•ˆ</strong>ï¼šå¿…é¡»å…·å¤‡â€œæ•è·å¤±æ•ˆå¼‚å¸¸ -&gt; è‡ªåŠ¨åˆ‡æ¢åˆ°å…¨é‡åŒæ­¥â€çš„å…œåº•æœºåˆ¶ã€‚</li><li><strong>åˆ†é¡µå¤„ç†</strong>ï¼šå¿…é¡»å®Œæ•´è¿­ä»£å®Œæ‰€æœ‰ <code>nextLink</code> åï¼Œæ‰èƒ½ä¿å­˜æœ€åçš„ <code>deltaLink</code>ã€‚</li></ul><h3 id="æ—¶åŒºä¸-DST-çš„å™©æ¢¦"><a href="#æ—¶åŒºä¸-DST-çš„å™©æ¢¦" class="headerlink" title="æ—¶åŒºä¸ DST çš„å™©æ¢¦"></a>æ—¶åŒºä¸ DST çš„å™©æ¢¦</h3><ul><li><strong>å­˜å‚¨</strong>ï¼šå»ºè®®åŒæ—¶å­˜å‚¨â€œæœ¬åœ°æ—¶æ®µâ€+â€œæ—¶åŒº IDâ€ã€‚</li><li><strong>DST</strong>ï¼šå¤ä»¤æ—¶åˆ‡æ¢ä¼šå¯¼è‡´ UTC æ—¶é—´å¹³ç§»ï¼Œå¦‚æœåªå­˜ UTCï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¼šè®®åœ¨æœ¬åœ°æ—¶é—´æ˜¾ç¤ºé”™ä½ï¼ˆæ¯”å¦‚å·® 1 å°æ—¶ï¼‰ã€‚åœ¨å±•å¼€å®ä¾‹æ—¶ï¼ŒåŠ¡å¿…ä½¿ç”¨æ­£ç¡®çš„æ—¶åŒºåº“ï¼ˆå¦‚ PHP çš„ <code>DateTimeZone</code>ï¼‰ã€‚</li><li><strong>å…¨å¤©äº‹ä»¶ (All-day Events)</strong>ï¼šå…¨å¤©äº‹ä»¶é€šå¸¸æ²¡æœ‰æ—¶åŒºæ¦‚å¿µï¼ˆæˆ–è€…è¯´æ˜¯â€œæµ®åŠ¨æ—¶é—´â€ï¼‰ï¼Œåœ¨è·¨ç³»ç»ŸåŒæ­¥æ—¶ï¼Œåº”å¿½ç•¥æ—¶åŒºåç§»ï¼Œä¸¥æ ¼æŒ‰ç…§ <code>YYYY-MM-DD</code> å¤„ç†ã€‚å¦åˆ™å¾ˆå®¹æ˜“å› ä¸ºæ—¶åŒºè½¬æ¢å¯¼è‡´äº‹ä»¶å˜æˆè·¨è¶Šä¸¤å¤©çš„äº‹ä»¶ï¼ˆä¾‹å¦‚ä» <code>00:00 - 24:00</code> å˜æˆå‰ä¸€å¤©çš„ <code>23:00</code> åˆ°å½“å¤©çš„ <code>23:00</code>ï¼‰ã€‚</li></ul><h3 id="æµ‹è¯•æ¸…å•"><a href="#æµ‹è¯•æ¸…å•" class="headerlink" title="æµ‹è¯•æ¸…å•"></a>æµ‹è¯•æ¸…å•</h3><p>ä¸Šçº¿å‰ï¼Œè¯·åŠ¡å¿…è¦†ç›–ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li><strong>DST è·¨è¶Š</strong>ï¼šåˆ›å»ºä¸€ä¸ªè·¨è¶Šå¤ä»¤æ—¶åˆ‡æ¢æ—¥ï¼ˆå¦‚ 3 æœˆæˆ– 11 æœˆï¼‰çš„å‘¨ä¼šï¼Œæ£€æŸ¥æ—¶é—´æ˜¯å¦æ­£ç¡®ã€‚</li><li><strong>ä¾‹å¤–å¤„ç†</strong>ï¼šä¿®æ”¹æŸä¸€ä¸ªå®ä¾‹çš„æ—¶é—´ï¼Œç„¶åä¿®æ”¹æ•´ä¸ªç³»åˆ—çš„ä¸»é¢˜ï¼Œæ£€æŸ¥è¯¥å®ä¾‹æ˜¯å¦ä¿æŒäº†ç‰¹å®šçš„æ—¶é—´ä¿®æ”¹ã€‚</li><li><strong>åˆ é™¤æµ‹è¯•</strong>ï¼šåœ¨ Outlook åˆ é™¤æœªæ¥ä¸€ä¸ªå®ä¾‹ï¼Œæ£€æŸ¥ CRM æ˜¯å¦åŒæ­¥åˆ é™¤ï¼›åˆ é™¤æ•´ä¸ªç³»åˆ—ï¼Œæ£€æŸ¥ CRM æ˜¯å¦æ¸…ç†å¹²å‡€ã€‚</li><li><strong>é•¿å‘¨æœŸ</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ¯æœˆçš„ä¼šè®®ï¼ŒæŒç»­ 2 å¹´ï¼Œæ£€æŸ¥çª—å£åŒ–é€»è¾‘æ˜¯å¦åªåŒæ­¥äº†æœ€è¿‘ 3 ä¸ªæœˆã€‚</li></ol><hr><h2 id="æ€»ç»“ä¸æœ€ä½³å®è·µ"><a href="#æ€»ç»“ä¸æœ€ä½³å®è·µ" class="headerlink" title="æ€»ç»“ä¸æœ€ä½³å®è·µ"></a>æ€»ç»“ä¸æœ€ä½³å®è·µ</h2><p>Outlook&#x2F;Gmail å¾ªç¯ä¼šè®®åŒæ­¥çš„æ ¸å¿ƒåœ¨äº**â€œæ‰¿è®¤å·®å¼‚ï¼Œä¸­é—´è½¬æ¢â€**ã€‚</p><ol><li><strong>ä¸è¦æŠŠ â€œå¢é‡&#x3D;äº‹å®â€å½“å‡è®¾</strong>ï¼šå¯¹äºå¾ªç¯ä¼šè®®ï¼Œå¢é‡åªæ˜¯ä¸€ä¸ªä¿¡å·ï¼Œå¿…é¡»é…åˆ <strong>çª—å£åŒ–å›æŸ¥</strong>ã€‚</li><li><strong>ç»Ÿä¸€è¯­ä¹‰</strong>ï¼šåœ¨å†…éƒ¨æ¨¡å‹ä¸­ï¼ŒæŠŠ Series å½“ä½œé…ç½®ï¼ŒæŠŠ Occurrence å½“ä½œäº‹å®ã€‚</li><li><strong>é˜²å®ˆæ€§ç¼–ç¨‹</strong>ï¼šiCalUId åªèƒ½ä¿¡ä¸€åŠï¼ŒQuota å¿…é¡»è®¾ä¸Šé™ï¼Œæ—¥å¿—å¿…é¡»å¯è¿½æº¯ã€‚</li></ol><p>é€šè¿‡â€œçª—å£åŒ–å±•å¼€ + ç³»åˆ—é‡å»ºâ€çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸåœ¨ EspoCRM ä¸­è§£å†³äº†è¿™ä¸€éš¾é¢˜ï¼Œä¸ºç”¨æˆ·æä¾›äº†ç¨³å®šä¸€è‡´çš„æ—¥å†è§†å›¾ã€‚å¸Œæœ›è¿™å¥—æ–¹æ¡ˆå¯¹ä½ çš„å·¥ç¨‹å®è·µä¹Ÿæœ‰æ‰€å¯å‘ã€‚</p><p><strong>ç›¸å…³èµ„æº</strong>ï¼š</p><ul><li><a href="https://learn.microsoft.com/en-us/graph/api/resources/event?view=graph-rest-1.0">Microsoft Graph API Documentation</a></li><li><a href="https://docs.espocrm.com/">EspoCRM Documentation</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc5545">RFC 5545: Internet Calendaring and Scheduling Core Object Specification</a></li></ul>]]></content>
    
    
    <summary type="html">Outlook ä¸ Gmail/Google Calendar çš„å¾ªç¯ä¼šè®®æ˜¯é›†æˆä¸­çš„â€œæ·±æ°´åŒºâ€ã€‚æœ¬æ–‡ä»‹ç» EspoCRM å¦‚ä½•é€šè¿‡â€œçª—å£åŒ–å±•å¼€â€å’Œâ€œç³»åˆ—é‡å»ºâ€ç­–ç•¥ï¼Œè§£å†³ Microsoft Graph API å¢é‡åŒæ­¥å¤±æ•ˆã€iCalUId é‡å¤ç­‰æ ¸å¿ƒéš¾é¢˜ï¼Œæä¾›ç”Ÿäº§çº§å·¥ç¨‹å®è·µæ–¹æ¡ˆã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="Outlook" scheme="https://www.yzhu.name/tags/Outlook/"/>
    
    <category term="Graph API" scheme="https://www.yzhu.name/tags/Graph-API/"/>
    
    <category term="Recurring Meetings" scheme="https://www.yzhu.name/tags/Recurring-Meetings/"/>
    
    <category term="Sync" scheme="https://www.yzhu.name/tags/Sync/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRMå®šåˆ¶ç¯‡è‡ªå®šä¹‰Jobå¼€å‘â€”â€”åˆ°æœŸæé†’é€šç”¨æ¨¡æ¿ï¼ˆæ‰¹é‡ + å»é‡ + å‘ä¿¡ï¼‰</title>
    <link href="https://www.yzhu.name/2025/12/28/espocrm/05-custom-job-development/"/>
    <id>https://www.yzhu.name/2025/12/28/espocrm/05-custom-job-development/</id>
    <published>2025-12-28T01:25:00.000Z</published>
    <updated>2025-12-28T01:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨ç‰ˆæœ¬ï¼šEspoCRM 9.2.2+</p></blockquote><p>å¾ˆå¤š CRM éœ€æ±‚éœ€è¦â€œå®šæ—¶è§¦å‘â€ï¼šåˆ°æœŸæé†’ã€æ—¥æŠ¥ç”Ÿæˆã€æ•°æ®åŒæ­¥ã€æ•°æ®è´¨é‡å·¡æ£€ã€‚è‡ªå®šä¹‰ Job æ˜¯æ­£ç¡®å§¿åŠ¿ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li>å®ç° <code>JobDataLess</code> æ¥å£ç”¨äºæ— å‚æ•°å®šæ—¶ä»»åŠ¡</li><li>ç”¨ä¾èµ–æ³¨å…¥è·å– EntityManagerã€EmailSenderã€Log ç­‰æœåŠ¡</li><li>æ‰¹é‡æŸ¥è¯¢ï¼ˆBATCH_SIZEï¼‰é¿å…å†…å­˜æº¢å‡º</li><li>å»é‡æœºåˆ¶é˜²æ­¢é‡å¤å‘é€æé†’</li><li>Admin ç•Œé¢é…ç½® Cron è¡¨è¾¾å¼</li></ul><hr><h2 id="1-åœºæ™¯ï¼šå®šæ—¶ä»»åŠ¡çš„ä¸šåŠ¡ä»·å€¼"><a href="#1-åœºæ™¯ï¼šå®šæ—¶ä»»åŠ¡çš„ä¸šåŠ¡ä»·å€¼" class="headerlink" title="1. åœºæ™¯ï¼šå®šæ—¶ä»»åŠ¡çš„ä¸šåŠ¡ä»·å€¼"></a>1. åœºæ™¯ï¼šå®šæ—¶ä»»åŠ¡çš„ä¸šåŠ¡ä»·å€¼</h2><p>å¾ˆå¤š CRM éœ€æ±‚éœ€è¦â€å®šæ—¶è§¦å‘â€ï¼š</p><ul><li>è®°å½•åˆ°æœŸå‰ N å¤©å‘é€æé†’</li><li>æ¯æ—¥ç”Ÿæˆé”€å”®æŠ¥è¡¨</li><li>å®šæœŸåŒæ­¥å¤–éƒ¨æ•°æ®</li><li>æ¸…ç†è¿‡æœŸæ•°æ®</li></ul><p>è¿™ç±»éœ€æ±‚ä¸é€‚åˆç”¨ Hookï¼Œå› ä¸º Hook æ˜¯åŒæ­¥çš„ã€å“åº”å¼çš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯<strong>è‡ªå®šä¹‰ Job</strong>ã€‚</p><h2 id="2-JobDataLess-æ¥å£ä¸ä¾èµ–æ³¨å…¥"><a href="#2-JobDataLess-æ¥å£ä¸ä¾èµ–æ³¨å…¥" class="headerlink" title="2. JobDataLess æ¥å£ä¸ä¾èµ–æ³¨å…¥"></a>2. JobDataLess æ¥å£ä¸ä¾èµ–æ³¨å…¥</h2><p>EspoCRM æä¾›äº† <code>JobDataLess</code> æ¥å£ç”¨äºæ— å‚æ•°çš„å®šæ—¶ä»»åŠ¡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">MyModule</span>\<span class="title class_">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Job</span>\<span class="title">JobDataLess</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">ORM</span>\<span class="title">EntityManager</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Utils</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExpirationReminder</span> <span class="keyword">implements</span> <span class="title">JobDataLess</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> EntityManager <span class="variable">$entityManager</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> Log <span class="variable">$log</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;ExpirationReminder started&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å³å°†åˆ°æœŸçš„è®°å½•</span></span><br><span class="line">        <span class="comment">// å‘é€æé†’é‚®ä»¶</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;ExpirationReminder completed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-é€šç”¨æ¡ˆä¾‹ï¼šåˆ°æœŸæé†’ï¼ˆä¸ç»‘å®šå…·ä½“é¡¹ç›®ï¼‰"><a href="#3-é€šç”¨æ¡ˆä¾‹ï¼šåˆ°æœŸæé†’ï¼ˆä¸ç»‘å®šå…·ä½“é¡¹ç›®ï¼‰" class="headerlink" title="3. é€šç”¨æ¡ˆä¾‹ï¼šåˆ°æœŸæé†’ï¼ˆä¸ç»‘å®šå…·ä½“é¡¹ç›®ï¼‰"></a>3. é€šç”¨æ¡ˆä¾‹ï¼šåˆ°æœŸæé†’ï¼ˆä¸ç»‘å®šå…·ä½“é¡¹ç›®ï¼‰</h2><h3 id="3-1-ä¸šåŠ¡éœ€æ±‚ï¼ˆæŠ½è±¡åŒ–ï¼‰"><a href="#3-1-ä¸šåŠ¡éœ€æ±‚ï¼ˆæŠ½è±¡åŒ–ï¼‰" class="headerlink" title="3.1 ä¸šåŠ¡éœ€æ±‚ï¼ˆæŠ½è±¡åŒ–ï¼‰"></a>3.1 ä¸šåŠ¡éœ€æ±‚ï¼ˆæŠ½è±¡åŒ–ï¼‰</h3><ul><li>è®°å½•åˆ°æœŸå‰ 90&#x2F;60&#x2F;30&#x2F;10&#x2F;3&#x2F;1 å¤©å‘é€æé†’</li><li>æé†’å‘é€ç»™è´Ÿè´£äºº + ç›¸å…³ç”¨æˆ·</li><li>é¿å…é‡å¤å‘é€ï¼ˆå»é‡æœºåˆ¶ï¼‰</li></ul><h3 id="3-2-æ‰¹é‡æŸ¥è¯¢ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰"><a href="#3-2-æ‰¹é‡æŸ¥è¯¢ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰" class="headerlink" title="3.2 æ‰¹é‡æŸ¥è¯¢ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰"></a>3.2 æ‰¹é‡æŸ¥è¯¢ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="variable constant_">BATCH_SIZE</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨ ORM æŸ¥è¯¢ï¼Œé¿å…æ‰‹å†™ SQL ç»‘æ­»è¡¨ç»“æ„/å­—æ®µåã€‚</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œå‡è®¾ä½ çš„è‡ªå®šä¹‰å®ä½“ç±»å‹æ˜¯ CExpiringItemï¼Œå­—æ®µ endDate æ˜¯ date ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> \Espo\ORM\Entity[]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">findItemsExpiringOnDate</span>(<span class="params">\DateTimeInterface <span class="variable">$targetDate</span>, <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;entityManager</span><br><span class="line">        -&gt;<span class="title function_ invoke__">getRDBRepository</span>(<span class="string">&#x27;CExpiringItem&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">where</span>([</span><br><span class="line">            <span class="string">&#x27;endDate&#x27;</span> =&gt; <span class="variable">$targetDate</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;deleted&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">        ])</span><br><span class="line">        -&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ASC&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">limit</span>(<span class="variable">$offset</span>, <span class="built_in">self</span>::<span class="variable constant_">BATCH_SIZE</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-å»é‡æœºåˆ¶ï¼ˆé˜²æ­¢é‡å¤æé†’ï¼‰"><a href="#3-3-å»é‡æœºåˆ¶ï¼ˆé˜²æ­¢é‡å¤æé†’ï¼‰" class="headerlink" title="3.3 å»é‡æœºåˆ¶ï¼ˆé˜²æ­¢é‡å¤æé†’ï¼‰"></a>3.3 å»é‡æœºåˆ¶ï¼ˆé˜²æ­¢é‡å¤æé†’ï¼‰</h3><p>åŸåˆ™ï¼šä¸è¦ç›´æ¥æ‰‹å†™ <code>CREATE TABLE</code>ã€‚ç”¨å…ƒæ•°æ®å®šä¹‰ä¸€ä¸ªâ€œæé†’å‘é€æ—¥å¿—å®ä½“â€ï¼Œè®©ç³»ç»Ÿåœ¨ rebuild æ—¶åˆ›å»ºè¡¨ç»“æ„ä¸ç´¢å¼•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å»é‡çš„æœ¬è´¨ï¼šåŒä¸€è®°å½• + åŒä¸€æ¥æ”¶äºº + åŒä¸€æé†’ç±»å‹ + åŒä¸€å¤©ï¼Œåªå…è®¸å†™å…¥ä¸€æ¬¡æ—¥å¿—ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isReminderAlreadySent</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$itemId</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$userId</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$reminderType</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    \DateTimeInterface <span class="variable">$reminderDate</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;entityManager</span><br><span class="line">        -&gt;<span class="title function_ invoke__">getRDBRepository</span>(<span class="string">&#x27;CExpirationReminderLog&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">where</span>([</span><br><span class="line">            <span class="string">&#x27;itemId&#x27;</span> =&gt; <span class="variable">$itemId</span>,</span><br><span class="line">            <span class="string">&#x27;userId&#x27;</span> =&gt; <span class="variable">$userId</span>,</span><br><span class="line">            <span class="string">&#x27;reminderType&#x27;</span> =&gt; <span class="variable">$reminderType</span>,</span><br><span class="line">            <span class="string">&#x27;reminderDate&#x27;</span> =&gt; <span class="variable">$reminderDate</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;deleted&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">        ])</span><br><span class="line">        -&gt;<span class="title function_ invoke__">count</span>() &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ entityDefsï¼ˆç¤ºæ„ï¼Œå…¬å¼€ç‰ˆï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;itemId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;varchar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;len&quot;</span><span class="punctuation">:</span> <span class="number">36</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;varchar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;len&quot;</span><span class="punctuation">:</span> <span class="number">36</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reminderType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;varchar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;len&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reminderDate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;checkUnique&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;unique&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;columns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;itemId&quot;</span><span class="punctuation">,</span> <span class="string">&quot;userId&quot;</span><span class="punctuation">,</span> <span class="string">&quot;reminderType&quot;</span><span class="punctuation">,</span> <span class="string">&quot;reminderDate&quot;</span><span class="punctuation">,</span> <span class="string">&quot;deleted&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reminderDate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;columns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;reminderDate&quot;</span><span class="punctuation">,</span> <span class="string">&quot;deleted&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å†™å…¥å‘é€æ—¥å¿—ï¼ˆæˆåŠŸå‘é€åç«‹åˆ»å†™ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">writeReminderLog</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$itemId</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$userId</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">string</span> <span class="variable">$reminderType</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    \DateTimeInterface <span class="variable">$reminderDate</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="variable">$logEntity</span> = <span class="variable language_">$this</span>-&gt;entityManager-&gt;<span class="title function_ invoke__">getNewEntity</span>(<span class="string">&#x27;CExpirationReminderLog&#x27;</span>);</span><br><span class="line">    <span class="variable">$logEntity</span>-&gt;<span class="title function_ invoke__">set</span>([</span><br><span class="line">        <span class="string">&#x27;itemId&#x27;</span> =&gt; <span class="variable">$itemId</span>,</span><br><span class="line">        <span class="string">&#x27;userId&#x27;</span> =&gt; <span class="variable">$userId</span>,</span><br><span class="line">        <span class="string">&#x27;reminderType&#x27;</span> =&gt; <span class="variable">$reminderType</span>,</span><br><span class="line">        <span class="string">&#x27;reminderDate&#x27;</span> =&gt; <span class="variable">$reminderDate</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d&#x27;</span>),</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;entityManager-&gt;<span class="title function_ invoke__">saveEntity</span>(<span class="variable">$logEntity</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-é‚®ä»¶å‘é€"><a href="#3-4-é‚®ä»¶å‘é€" class="headerlink" title="3.4 é‚®ä»¶å‘é€"></a>3.4 é‚®ä»¶å‘é€</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Mail</span>\<span class="title">EmailSender</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Entities</span>\<span class="title">Email</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ„é€ å‡½æ•°æ³¨å…¥ EmailSender</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> EntityManager <span class="variable">$entityManager</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> EmailSender <span class="variable">$emailSender</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> Log <span class="variable">$log</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€é‚®ä»¶</span></span><br><span class="line"><span class="variable">$emailEntity</span> = <span class="variable language_">$this</span>-&gt;entityManager-&gt;<span class="title function_ invoke__">getNewEntity</span>(<span class="title class_">Email</span>::<span class="variable constant_">ENTITY_TYPE</span>);</span><br><span class="line"><span class="variable">$emailEntity</span>-&gt;<span class="title function_ invoke__">setSubject</span>(<span class="string">&#x27;Item Expiring Soon&#x27;</span>);</span><br><span class="line"><span class="variable">$emailEntity</span>-&gt;<span class="title function_ invoke__">setBody</span>(<span class="variable">$body</span>);</span><br><span class="line"><span class="variable">$emailEntity</span>-&gt;<span class="title function_ invoke__">addToAddress</span>(<span class="variable">$userEmail</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;emailSender-&gt;<span class="title function_ invoke__">create</span>()-&gt;<span class="title function_ invoke__">send</span>(<span class="variable">$emailEntity</span>);</span><br></pre></td></tr></table></figure><h2 id="4-Job-çš„æ³¨å†Œä¸è°ƒåº¦"><a href="#4-Job-çš„æ³¨å†Œä¸è°ƒåº¦" class="headerlink" title="4. Job çš„æ³¨å†Œä¸è°ƒåº¦"></a>4. Job çš„æ³¨å†Œä¸è°ƒåº¦</h2><p><strong>æ–¹å¼ä¸€ï¼šClassFinder è‡ªåŠ¨å‘ç°</strong></p><p>å°† Job ç±»æ”¾åœ¨ <code>custom/Espo/Custom/Jobs/</code> æˆ– <code>custom/Espo/Modules/{Module}/Jobs/</code> ç›®å½•ä¸‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘ç°ã€‚</p><p><strong>æ–¹å¼äºŒï¼šmetadata é…ç½®</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;ExpirationReminder&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;isSystem&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scheduling&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0 9,15 * * *&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>åœ¨ Admin ç•Œé¢é…ç½®</strong>ï¼š</p><ol><li>è¿›å…¥ Admin â†’ Scheduled Jobs</li><li>åˆ›å»ºæ–°ä»»åŠ¡ï¼Œé€‰æ‹© Jobï¼šExpiration Reminder</li><li>è®¾ç½® Cron è¡¨è¾¾å¼ï¼š<code>0 9,15 * * *</code>ï¼ˆæ¯å¤© 9:00 å’Œ 15:00 æ‰§è¡Œï¼‰</li><li>è®¾ç½®ä¸º Active</li></ol><h2 id="5-ç›‘æ§ä¸æ’éšœ"><a href="#5-ç›‘æ§ä¸æ’éšœ" class="headerlink" title="5. ç›‘æ§ä¸æ’éšœ"></a>5. ç›‘æ§ä¸æ’éšœ</h2><p><strong>å…³é”®æ—¥å¿—</strong>ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ExpirationReminder started with reminder days: [90,60,30,10,3,1]</span><br><span class="line">[INFO] Processing item: ITEM-123 (ID: xxx) expiring on 2025-03-15</span><br><span class="line">[INFO] Sending reminder to recipient@example.com</span><br><span class="line">[SUCCESS] Successfully sent reminder email</span><br><span class="line">[ERROR] Failed to send email - SMTP timeout</span><br></pre></td></tr></table></figure><p><strong>éªŒè¯å»ºè®®</strong>ï¼š</p><ul><li>åœ¨åå°ç»™ Job åšä¸€ä¸ªåˆ—è¡¨è§†å›¾ï¼ŒæŒ‰ createdAt æœ€è¿‘ 7 å¤©è¿‡æ»¤</li><li>ç”¨æ—¥å¿—å®šä½â€œå¼€å§‹&#x2F;å¤„ç†&#x2F;å‘é€æˆåŠŸ&#x2F;å‘é€å¤±è´¥â€çš„é“¾è·¯æ˜¯å¦å®Œæ•´</li></ul><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ul><li><strong>JobDataLess</strong> æ˜¯å®ç°è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡çš„æ ‡å‡†æ¥å£ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥</strong> è®©ä»£ç æ›´å¹²å‡€ã€æ˜“æµ‹è¯•ã€‚</li><li><strong>æ‰¹é‡å¤„ç†</strong> (BATCH_SIZE) æ˜¯å¤„ç†å¤§é‡æ•°æ®çš„å¿…ä¿®è¯¾ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚</li><li><strong>å»é‡æœºåˆ¶</strong> (Idempotency) æ˜¯å®šæ—¶ä»»åŠ¡ç¨³å®šæ€§çš„æ ¸å¿ƒï¼Œé˜²æ­¢ç”¨æˆ·è¢«éªšæ‰°ã€‚</li><li><strong>å¯è§‚æµ‹æ€§</strong> (Logging) æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æ•‘å‘½ç¨»è‰ï¼Œæ²¡æœ‰æ—¥å¿—çš„ä»»åŠ¡æ˜¯â€œé»‘ç›’â€ã€‚</li></ul><hr>]]></content>
    
    
    <summary type="html">å¾ˆå¤š CRM éœ€æ±‚éœ€è¦â€œå®šæ—¶è§¦å‘â€ï¼šåˆ°æœŸæé†’ã€æ—¥æŠ¥ç”Ÿæˆã€æ•°æ®åŒæ­¥ã€æ•°æ®è´¨é‡å·¡æ£€ã€‚è‡ªå®šä¹‰ Job æ˜¯æ­£ç¡®å§¿åŠ¿ã€‚æœ¬æ–‡ä»¥é€šç”¨â€œåˆ°æœŸæé†’â€ä¸ºä¾‹å®ç° JobDataLess å®šæ—¶ä»»åŠ¡ï¼šä¾èµ–æ³¨å…¥ã€æ‰¹é‡æŸ¥è¯¢ã€å»é‡æ—¥å¿—ã€é‚®ä»¶å‘é€ã€‚ç»™å‡ºè°ƒåº¦é…ç½®ã€ç›‘æ§æ’éšœä¸å‘ä¿¡è¦ç‚¹ï¼Œé€‚ç”¨äºåŒæ­¥/å·¡æ£€/é€šçŸ¥ç±»ä»»åŠ¡ã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="job" scheme="https://www.yzhu.name/tags/job/"/>
    
    <category term="automation" scheme="https://www.yzhu.name/tags/automation/"/>
    
    <category term="scheduled-task" scheme="https://www.yzhu.name/tags/scheduled-task/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRMå®šåˆ¶ç¯‡Dynamic Logic + BeforeSave Hook â€”â€”å‰åç«¯åŒä¿é™©</title>
    <link href="https://www.yzhu.name/2025/12/21/espocrm/04-validation-dynamic-logic-hook/"/>
    <id>https://www.yzhu.name/2025/12/21/espocrm/04-validation-dynamic-logic-hook/</id>
    <published>2025-12-21T01:20:00.000Z</published>
    <updated>2025-12-21T01:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨ç‰ˆæœ¬ï¼šEspoCRM 9.2.2+</p></blockquote><p>åªåšå‰ç«¯ required çš„å›¢é˜Ÿï¼Œè¿Ÿæ—©ä¼šè¢«â€è„æ•°æ®â€åå™¬ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li>Dynamic Logic è´Ÿè´£ä½“éªŒï¼šç”¨æˆ·å½“åœºçŸ¥é“â€å¿…é¡»å¡«â€</li><li>BeforeSave Hook è´Ÿè´£åº•çº¿ï¼šä»»ä½•å…¥å£éƒ½æ— æ³•ç»•è¿‡</li><li>é”™è¯¯æ¶ˆæ¯ç”¨å¯ç¿»è¯‘ key ç®¡ç†ï¼Œé»˜è®¤è‹±æ–‡è¾“å‡ºä¾¿äºæ’éšœ</li><li>æµ‹è¯•å¿…é¡»è¦†ç›– UI + API + è¾¹ç•Œåˆ‡æ¢</li></ul><hr><h2 id="1-åœºæ™¯ï¼šä¸ºä»€ä¹ˆâ€åªåšå‰ç«¯å¿…å¡«â€æ˜¯è‡ªæ¬ºæ¬ºäºº"><a href="#1-åœºæ™¯ï¼šä¸ºä»€ä¹ˆâ€åªåšå‰ç«¯å¿…å¡«â€æ˜¯è‡ªæ¬ºæ¬ºäºº" class="headerlink" title="1. åœºæ™¯ï¼šä¸ºä»€ä¹ˆâ€åªåšå‰ç«¯å¿…å¡«â€æ˜¯è‡ªæ¬ºæ¬ºäºº"></a>1. åœºæ™¯ï¼šä¸ºä»€ä¹ˆâ€åªåšå‰ç«¯å¿…å¡«â€æ˜¯è‡ªæ¬ºæ¬ºäºº</h2><p>å½“ä¸šåŠ¡è§„å®šâ€é˜¶æ®µ &#x3D; Final Rejected æ—¶å¿…é¡»å¡«å†™æ‹’ç»åŸå› â€ï¼Œå¾ˆå¤šäººç¬¬ä¸€ååº”æ˜¯ï¼šåœ¨å‰ç«¯æŠŠå­—æ®µè®¾æˆ requiredã€‚</p><p>é—®é¢˜åœ¨äºï¼šå‰ç«¯ä¸æ˜¯å”¯ä¸€å…¥å£ã€‚</p><ul><li>API PATCH&#x2F;POST</li><li>æ‰¹é‡æ›´æ–°</li><li>å¯¼å…¥</li><li>è‡ªåŠ¨åŒ–è„šæœ¬</li></ul><p>è¿™äº›è·¯å¾„éƒ½å¯èƒ½ç»•è¿‡å‰ç«¯ã€‚ä½ æœ€ç»ˆä¼šå¾—åˆ°ä¸€å †â€Final Rejected ä½†æ— æ‹’ç»åŸå› â€çš„è„æ•°æ®ï¼ŒæŠ¥è¡¨å’Œå¤ç›˜å®Œå…¨å¤±çœŸã€‚</p><p>ç»“è®ºï¼š<strong>ä½“éªŒé å‰ç«¯ï¼Œåº•çº¿é åç«¯</strong>ã€‚</p><h2 id="2-æ¶æ„ï¼šåŒå±‚æ ¡éªŒ"><a href="#2-æ¶æ„ï¼šåŒå±‚æ ¡éªŒ" class="headerlink" title="2. æ¶æ„ï¼šåŒå±‚æ ¡éªŒ"></a>2. æ¶æ„ï¼šåŒå±‚æ ¡éªŒ</h2><pre class="mermaid">flowchart TD  A[ç”¨æˆ·åœ¨UIåˆ‡æ¢ stage] --> B[Dynamic Logic: required]  B -->|å®æ—¶æç¤º| C[ç”¨æˆ·å¡«å†™å­—æ®µ]  C --> D[ä¿å­˜]  D --> E[BeforeSave Hook]  E -->|ok| F[å†™å…¥æ•°æ®åº“]  E -->|invalid| G[HTTP 400 Bad Request]</pre><h2 id="3-å‰ç«¯ï¼šDynamic-Logicï¼ˆå®æ—¶å¿…å¡«ï¼‰"><a href="#3-å‰ç«¯ï¼šDynamic-Logicï¼ˆå®æ—¶å¿…å¡«ï¼‰" class="headerlink" title="3. å‰ç«¯ï¼šDynamic Logicï¼ˆå®æ—¶å¿…å¡«ï¼‰"></a>3. å‰ç«¯ï¼šDynamic Logicï¼ˆå®æ—¶å¿…å¡«ï¼‰</h2><p>Dynamic Logic çš„ä»·å€¼ï¼šè®©ç”¨æˆ·â€å½“åœºçŸ¥é“è¦å¡«ä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯ä¿å­˜æ—¶æ‰è¢«æ‰“å›ã€‚</p><p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼ˆå…¬å¼€ç‰ˆå ä½å­—æ®µåï¼‰ï¼š</p><ul><li>å­—æ®µï¼š<code>rejectionReason</code></li><li>æ¡ä»¶ï¼š<code>stage == &quot;Final Rejected&quot;</code></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dynamicLogic&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;conditionGroup&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;equals&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;attribute&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stage&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Final Rejected&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="4-åç«¯ï¼šBeforeSave-Hookï¼ˆå¼ºåˆ¶æ ¡éªŒï¼Œé˜²ç»•è¿‡ï¼‰"><a href="#4-åç«¯ï¼šBeforeSave-Hookï¼ˆå¼ºåˆ¶æ ¡éªŒï¼Œé˜²ç»•è¿‡ï¼‰" class="headerlink" title="4. åç«¯ï¼šBeforeSave Hookï¼ˆå¼ºåˆ¶æ ¡éªŒï¼Œé˜²ç»•è¿‡ï¼‰"></a>4. åç«¯ï¼šBeforeSave Hookï¼ˆå¼ºåˆ¶æ ¡éªŒï¼Œé˜²ç»•è¿‡ï¼‰</h2><p>Hook çš„ä»·å€¼ï¼šæ— è®ºä»å“ªé‡Œä¿å­˜ï¼Œè§„åˆ™éƒ½å¿…é¡»æˆç«‹ã€‚</p><p><strong>åŸåˆ™</strong>ï¼š</p><ul><li>åªåšè½»é€»è¾‘åˆ¤æ–­</li><li>æŠ›å‡ºæ˜ç¡®é”™è¯¯</li><li>ä¸åš HTTPã€é‚®ä»¶ã€å¤æ‚è®¡ç®—</li></ul><p><strong>è¡Œä¸ºå®šä¹‰</strong>ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if stage == &quot;Final Rejected&quot; and rejectionReason is empty:</span><br><span class="line">  throw BadRequest(&quot;Rejection reason is required when stage is set to Final Rejected&quot;)</span><br></pre></td></tr></table></figure><p><strong>ä»£ç éª¨æ¶</strong>ï¼ˆå…¬å¼€ç‰ˆï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">YourModule</span>\<span class="title class_">Hooks</span>\<span class="title class_">Opportunity</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">ORM</span>\<span class="title">Entity</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Exceptions</span>\<span class="title">BadRequest</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeforeSave</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">beforeSave</span>(<span class="params">Entity <span class="variable">$entity</span>, <span class="keyword">array</span> <span class="variable">$options</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;stage&#x27;</span>) === <span class="string">&#x27;Final Rejected&#x27;</span></span><br><span class="line">            &amp;&amp; !<span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;rejectionReason&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequest</span>(</span><br><span class="line">                <span class="string">&quot;Rejection reason is required when stage is set to Final Rejected&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-æµ‹è¯•çŸ©é˜µï¼ˆåˆ«åªç‚¹-UIï¼‰"><a href="#5-æµ‹è¯•çŸ©é˜µï¼ˆåˆ«åªç‚¹-UIï¼‰" class="headerlink" title="5. æµ‹è¯•çŸ©é˜µï¼ˆåˆ«åªç‚¹ UIï¼‰"></a>5. æµ‹è¯•çŸ©é˜µï¼ˆåˆ«åªç‚¹ UIï¼‰</h2><p>æœ€å°‘è¦è¦†ç›– 3 ç±»å…¥å£ï¼š</p><table><thead><tr><th align="left">å…¥å£</th><th align="left">æµ‹è¯•å†…å®¹</th><th align="left">æœŸæœ›ç»“æœ</th></tr></thead><tbody><tr><td align="left">UI</td><td align="left">åˆ‡æ¢ stage â†’ ä¿å­˜</td><td align="left">å®æ—¶æç¤º + æ‹’ç»ä¿å­˜</td></tr><tr><td align="left">API</td><td align="left"><code>PATCH /api/v1/Opportunity/{id}</code></td><td align="left">HTTP 400 + é”™è¯¯ä¿¡æ¯</td></tr><tr><td align="left">è¾¹ç•Œ</td><td align="left">ä» Final Rejected åˆ‡å›å…¶å®ƒ stage</td><td align="left">å…è®¸æ¸…ç©ºåŸå› </td></tr></tbody></table><p><strong>API æµ‹è¯•ç¤ºä¾‹</strong>ï¼ˆå…¬å¼€ç‰ˆå ä½ç¬¦ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X PATCH <span class="string">&quot;https://crm.example.com/api/v1/Opportunity/OPP_ID&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;ACCESS_TOKEN&gt;&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;stage&quot;:&quot;Final Rejected&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœŸæœ›: HTTP 400</span></span><br><span class="line"><span class="comment"># å“åº”: &#123;&quot;error&quot;:&quot;Rejection reason is required...&quot;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ul><li>ä¸è¦ç›¸ä¿¡å‰ç«¯è¾“å…¥ï¼šè¿™æ˜¯å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§çš„ç¬¬ä¸€åŸåˆ™ã€‚</li><li>Dynamic Logic æ˜¯â€œé˜²å‘†â€ï¼ŒBeforeSave Hook æ˜¯â€œé˜²æ¼â€ã€‚</li><li>éšç€ç³»ç»Ÿå¤æ‚åº¦å¢åŠ ï¼ˆå¼•å…¥ API é›†æˆã€æ•°æ®å¯¼å…¥ï¼‰ï¼Œè¿™ç§â€œåŒå±‚æ ¡éªŒâ€æ¨¡å¼å°†æˆä¸ºç»´æŠ¤æ•°æ®è´¨é‡çš„åŸºçŸ³ã€‚</li><li>å»ºè®®ï¼šä»ä»Šå¤©å¼€å§‹ï¼Œæ£€æŸ¥ä½ æ‰€æœ‰çš„ required å­—æ®µï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦åœ¨åç«¯ä¹Ÿæœ‰åŒæ ·çš„å®ˆæŠ¤ã€‚</li></ul><hr>]]></content>
    
    
    <summary type="html">åªåšå‰ç«¯ required çš„å›¢é˜Ÿï¼Œè¿Ÿæ—©ä¼šè¢«â€œè„æ•°æ®â€åå™¬ã€‚æœ¬æ–‡ç»™å‡ºå‰åç«¯åŒä¿é™©æ–¹æ¡ˆï¼šDynamic Logic è´Ÿè´£äº¤äº’ä½“éªŒï¼ˆå®æ—¶æç¤ºï¼‰ï¼ŒBeforeSave Hook å®ˆä½æ‰€æœ‰å…¥å£åº•çº¿ï¼ˆAPI/å¯¼å…¥/è„šæœ¬æ— æ³•ç»•è¿‡ï¼‰ã€‚è¦†ç›–é”™è¯¯æ¶ˆæ¯ç­–ç•¥ã€æµ‹è¯•çŸ©é˜µä¸â€œåäººå‡è®¾â€ï¼Œé¿å…è„æ•°æ®è¿›å…¥ç³»ç»Ÿã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="validation" scheme="https://www.yzhu.name/tags/validation/"/>
    
    <category term="dynamic-logic" scheme="https://www.yzhu.name/tags/dynamic-logic/"/>
    
    <category term="hook" scheme="https://www.yzhu.name/tags/hook/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRMå®šåˆ¶ç¯‡çº¯é…ç½®å¤šå¯¹å¤šâ€”â€”ä¸å†™ SQLï¼Œè®© rebuild è‡ªåŠ¨å»ºè¡¨</title>
    <link href="https://www.yzhu.name/2025/12/06/espocrm/03-metadata-driven-many-to-many/"/>
    <id>https://www.yzhu.name/2025/12/06/espocrm/03-metadata-driven-many-to-many/</id>
    <published>2025-12-06T01:10:00.000Z</published>
    <updated>2025-12-06T01:10:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨ç‰ˆæœ¬ï¼šEspoCRM 9.2.2+</p></blockquote><p>ä½ ä»¥ä¸ºå¤šå¯¹å¤šå¿…é¡»å»ºä¸­é—´è¡¨ï¼Ÿåœ¨ EspoCRM é‡Œï¼Œæ‰‹å†™ SQL å¾€å¾€æ˜¯ä½ è‡ªå·±ç»™è‡ªå·±åŸ‹é›·ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li><code>entityDefs.links</code> + <code>relationName</code> å†³å®šå…³ç³»ä¸ä¸­é—´è¡¨</li><li><code>scopes</code> å†³å®šå®ä½“èƒ½ä¸èƒ½è¢«ç®¡ç†ä¸é…ç½®</li><li><code>clientDefs + layouts</code> å†³å®šç”¨æˆ·ç•Œé¢â€çœ‹ä¸çœ‹å¾—åˆ°ã€ç”¨ä¸ç”¨å¾—èµ·æ¥â€</li><li><code>rebuild</code> æ˜¯è®©ç³»ç»ŸæŠŠå…ƒæ•°æ®å˜æˆçœŸå®ç»“æ„çš„å¼€å…³</li></ul><hr><h2 id="1-åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå¯¹å¤š"><a href="#1-åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå¯¹å¤š" class="headerlink" title="1. åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå¯¹å¤š"></a>1. åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå¯¹å¤š</h2><p>å¾ˆå¤š CRM åœºæ™¯éƒ½éœ€è¦å¤šå¯¹å¤šå…³ç³»ï¼š</p><ul><li>ä¸€ä¸ªè®°å½•å…³è”å¤šä¸ªæ ‡ç­¾ã€å¤šä¸ªåˆ†ç±»</li><li>ä¸€ä¸ªé¡¹ç›®å…³è”å¤šä¸ªè”ç³»äººã€å¤šä¸ªèµ„æº</li><li>ä¸€ä¸ªå·¥å•å…³è”å¤šä¸ªå‚ä¸äººã€å¤šä¸ªé™„ä»¶</li></ul><p>å¾ˆå¤šäººç¬¬ä¸€ååº”æ˜¯ï¼šå»ºä¸­é—´è¡¨ã€å†™è¿ç§» SQLã€‚è¿™åœ¨ EspoCRM é‡Œå¾€å¾€æ˜¯<strong>æœ€å·®</strong>çš„é€‰æ‹©â€”â€”ä½ ä¼šç»•è¿‡ç³»ç»Ÿçš„å…ƒæ•°æ®æœºåˆ¶ï¼Œå‡çº§æ—¶ç—›è‹¦æŒ‡æ•°çˆ†ç‚¸ã€‚</p><p>æˆ‘ä»¬æ¨èçš„è·¯çº¿ï¼š<strong>åªå†™é…ç½®</strong> â†’ <code>rebuild</code> â†’ EspoCRM è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ã€‚</p><h2 id="2-ç›®æ ‡ï¼šç”¨ä¸€å¥—æœ€å°é…ç½®æ‰“é€šâ€èƒ½çœ‹è§ã€èƒ½é€‰æ‹©ã€èƒ½ä¿å­˜â€"><a href="#2-ç›®æ ‡ï¼šç”¨ä¸€å¥—æœ€å°é…ç½®æ‰“é€šâ€èƒ½çœ‹è§ã€èƒ½é€‰æ‹©ã€èƒ½ä¿å­˜â€" class="headerlink" title="2. ç›®æ ‡ï¼šç”¨ä¸€å¥—æœ€å°é…ç½®æ‰“é€šâ€èƒ½çœ‹è§ã€èƒ½é€‰æ‹©ã€èƒ½ä¿å­˜â€"></a>2. ç›®æ ‡ï¼šç”¨ä¸€å¥—æœ€å°é…ç½®æ‰“é€šâ€èƒ½çœ‹è§ã€èƒ½é€‰æ‹©ã€èƒ½ä¿å­˜â€</h2><p>å¤šå¯¹å¤šä¸æ˜¯â€æ•°æ®èƒ½å­˜è¿›å»â€å°±å®Œäº‹äº†ã€‚çœŸæ­£èƒ½äº¤ä»˜ç»™ä¸šåŠ¡ç”¨ï¼Œè‡³å°‘è¦æ»¡è¶³ï¼š</p><ul><li>å…³ç³»åœ¨å®ä½“å®šä¹‰é‡Œå­˜åœ¨ï¼ˆåç«¯èƒ½å­˜ï¼‰</li><li>å…³ç³»åœ¨ç•Œé¢ä¸Šå¯è§ï¼ˆå‰ç«¯èƒ½é€‰ï¼‰</li><li>æƒé™ä¸ä½œç”¨åŸŸå¯æ§ï¼ˆACL ä¸å‡ºäº‹ï¼‰</li><li>rebuild åè‡ªåŠ¨ç”Ÿæˆ&#x2F;æ›´æ–°ç»“æ„ï¼ˆå¯å‡çº§ï¼‰</li></ul><h2 id="3-å…³é”®æœºåˆ¶ï¼šrelationName-å†³å®šä¸­é—´è¡¨"><a href="#3-å…³é”®æœºåˆ¶ï¼šrelationName-å†³å®šä¸­é—´è¡¨" class="headerlink" title="3. å…³é”®æœºåˆ¶ï¼šrelationName å†³å®šä¸­é—´è¡¨"></a>3. å…³é”®æœºåˆ¶ï¼šrelationName å†³å®šä¸­é—´è¡¨</h2><p>ä½ å¯ä»¥æŠŠ EspoCRM çš„è‡ªåŠ¨å»ºè¡¨ç†è§£ä¸ºï¼š<br><strong>entityDefs é‡Œå£°æ˜äº†å…³ç³» â†’ rebuild ç”Ÿæˆå®é™…è¡¨ç»“æ„</strong>ã€‚</p><pre class="mermaid">flowchart TD  A[entityDefs: fields + links] --> B[rebuild]  B --> C[(ä¸»è¡¨è‡ªåŠ¨åˆ›å»º/æ›´æ–°)]  B --> D[(ä¸­é—´è¡¨æŒ‰ relationName è‡ªåŠ¨åˆ›å»º)]  B --> E[å‰ç«¯å…ƒæ•°æ®ç¼“å­˜æ›´æ–°]</pre><p>åœ¨ links ä¸­ç»™åŒä¸€æ®µå…³ç³»è®¾ç½®åŒä¸€ä¸ª <code>relationName</code>ï¼Œå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼š</p><ul><li>è¿™æ˜¯åŒä¸€ä¸ªå…³è”ï¼ˆæ­£åä¸¤ä¾§ä¸€è‡´ï¼‰</li><li>ä¸­é—´è¡¨åº”æŒ‰è¿™ä¸ªåå­—ç”Ÿæˆï¼ˆå†…éƒ¨æ˜ å°„ï¼‰</li></ul><h2 id="4-é…ç½®æœ€å°é—­ç¯ï¼ˆç¤ºä¾‹ï¼šEntityA-â†”-EntityBï¼‰"><a href="#4-é…ç½®æœ€å°é—­ç¯ï¼ˆç¤ºä¾‹ï¼šEntityA-â†”-EntityBï¼‰" class="headerlink" title="4. é…ç½®æœ€å°é—­ç¯ï¼ˆç¤ºä¾‹ï¼šEntityA â†” EntityBï¼‰"></a>4. é…ç½®æœ€å°é—­ç¯ï¼ˆç¤ºä¾‹ï¼šEntityA â†” EntityBï¼‰</h2><p>ç”¨ä¸­æ€§å®ä½“åæ¼”ç¤ºï¼š</p><ul><li><code>CItem</code>ï¼šæ¡ç›®</li><li><code>CTag</code>ï¼šæ ‡ç­¾</li></ul><h3 id="4-1-å®šä¹‰å®ä½“ï¼ˆentityDefsï¼‰"><a href="#4-1-å®šä¹‰å®ä½“ï¼ˆentityDefsï¼‰" class="headerlink" title="4.1 å®šä¹‰å®ä½“ï¼ˆentityDefsï¼‰"></a>4.1 å®šä¹‰å®ä½“ï¼ˆentityDefsï¼‰</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;varchar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hasMany&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;entity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CTag&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;foreign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;items&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relationName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cItemTag&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¾§ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;varchar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hasMany&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;entity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CItem&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;foreign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tags&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relationName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cItemTag&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-2-å®šä¹‰ä½œç”¨åŸŸï¼ˆscopesï¼‰"><a href="#4-2-å®šä¹‰ä½œç”¨åŸŸï¼ˆscopesï¼‰" class="headerlink" title="4.2 å®šä¹‰ä½œç”¨åŸŸï¼ˆscopesï¼‰"></a>4.2 å®šä¹‰ä½œç”¨åŸŸï¼ˆscopesï¼‰</h3><p>å¦‚æœ scopes ä¸å®Œæ•´ï¼Œèœå•ä¸æ˜¾ç¤ºã€æƒé™æ— æ³•é…ç½®ã€å¸ƒå±€æ— æ³•ç¼–è¾‘ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;entity&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;layouts&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tab&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;acl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;customizable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;importable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stream&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;disabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Base&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Custom&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isCustom&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-3-è®©å…³ç³»åœ¨-UI-å¯è§ï¼ˆclientDefs-layoutsï¼‰"><a href="#4-3-è®©å…³ç³»åœ¨-UI-å¯è§ï¼ˆclientDefs-layoutsï¼‰" class="headerlink" title="4.3 è®©å…³ç³»åœ¨ UI å¯è§ï¼ˆclientDefs + layoutsï¼‰"></a>4.3 è®©å…³ç³»åœ¨ UI å¯è§ï¼ˆclientDefs + layoutsï¼‰</h3><p>åªå†™ entityDefsï¼Œç”¨æˆ·ä¼šè¯´â€åŠ äº†å…³ç³»ï¼Œä½†é¡µé¢ä¸Šçœ‹ä¸åˆ°â€ã€‚éœ€è¦ä¸¤å±‚ï¼š</p><ul><li><code>clientDefs</code>ï¼šå…³ç³»é¢æ¿å£°æ˜ï¼ˆrelationshipPanelsï¼‰</li><li><code>layouts</code>ï¼šå­—æ®µ&#x2F;é¢æ¿è½ä½ï¼ˆedit&#x2F;detailï¼‰</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;relationships&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;layout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¸ƒå±€ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tags&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Overview&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="5-rebuild-ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#5-rebuild-ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="5. rebuild ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆ"></a>5. rebuild ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆ</h2><ul><li>ç³»ç»Ÿä¸º <code>cItemTag</code> è‡ªåŠ¨ç”Ÿæˆä¸­é—´è¡¨</li><li>ä¸¤ä¾§å®ä½“çš„å…³è”å¯åœ¨ UI é¢æ¿ä¸­ç»´æŠ¤</li><li>ACL ç”Ÿæ•ˆï¼šä¸åŒè§’è‰²çœ‹åˆ°çš„èŒƒå›´å¯æ§</li></ul><h2 id="6-éƒ¨ç½²ä¸éªŒè¯"><a href="#6-éƒ¨ç½²ä¸éªŒè¯" class="headerlink" title="6. éƒ¨ç½²ä¸éªŒè¯"></a>6. éƒ¨ç½²ä¸éªŒè¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€æ–‡ä»¶å¤åˆ¶</span></span><br><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">docker <span class="built_in">cp</span> CItem.json <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Resources/metadata/entityDefs/CItem.json</span><br><span class="line">docker <span class="built_in">cp</span> CTag.json <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Resources/metadata/entityDefs/CTag.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># rebuild</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> php /var/www/html/command.php rebuild</span><br></pre></td></tr></table></figure><p>éªŒè¯æ¸…å•ï¼š</p><ul><li><input disabled type="checkbox"> åå°èƒ½çœ‹åˆ°ä¸¤ä¸ªå®ä½“çš„èœå•å…¥å£</li><li><input disabled type="checkbox"> ç¼–è¾‘é¡µé¢èƒ½é€‰æ‹©å…³è”è®°å½•</li><li><input disabled type="checkbox"> ä¿å­˜åå…³ç³»é¢æ¿èƒ½çœ‹åˆ°å…³è”åˆ—è¡¨</li><li><input disabled type="checkbox"> ä¸åŒè§’è‰²ä¸‹ ACL è¡¨ç°ç¬¦åˆé¢„æœŸ</li></ul><h2 id="7-å¸¸è§å‘"><a href="#7-å¸¸è§å‘" class="headerlink" title="7. å¸¸è§å‘"></a>7. å¸¸è§å‘</h2><ul><li>scopes é…ç½®ç¼ºå¤±å¯¼è‡´â€èœå•ä¸æ˜¾ç¤º&#x2F;æƒé™ä¸å¯é…â€</li><li>layouts æ²¡æ”¾å­—æ®µå¯¼è‡´â€åç«¯æœ‰å…³ç³»ï¼Œå‰ç«¯çœ‹ä¸åˆ°â€</li><li>å¿˜è®° rebuild å¯¼è‡´â€æ”¹äº†é…ç½®ä¸ç”Ÿæ•ˆâ€</li></ul><hr>]]></content>
    
    
    <summary type="html">ä½ ä»¥ä¸ºå¤šå¯¹å¤šå¿…é¡»å»ºä¸­é—´è¡¨ï¼Ÿåœ¨ EspoCRM é‡Œï¼Œæ‰‹å†™ SQL å¾€å¾€æ˜¯ä½ è‡ªå·±ç»™è‡ªå·±åŸ‹é›·ã€‚æœ¬æ–‡æ¼”ç¤ºç”¨çº¯å…ƒæ•°æ®å®šä¹‰å¤šå¯¹å¤šå…³ç³»ï¼šentityDefs çš„ links + relationName é©±åŠ¨ rebuild è‡ªåŠ¨å»ºè¡¨ã€‚åŒæ—¶è¡¥é½ scopes/clientDefs/layoutsï¼Œè®©å…³ç³»åœ¨ UI å¯è§å¯é…å¯ç”¨</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="metadata" scheme="https://www.yzhu.name/tags/metadata/"/>
    
    <category term="many-to-many" scheme="https://www.yzhu.name/tags/many-to-many/"/>
    
    <category term="rebuild" scheme="https://www.yzhu.name/tags/rebuild/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRMå®šåˆ¶ç¯‡å¤–éƒ¨é›†æˆâ€”â€”OutlookåŒå‘åŒæ­¥å®æˆ˜</title>
    <link href="https://www.yzhu.name/2025/11/22/espocrm/02-external-integration/"/>
    <id>https://www.yzhu.name/2025/11/22/espocrm/02-external-integration/</id>
    <published>2025-11-22T01:45:00.000Z</published>
    <updated>2025-11-22T01:45:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨ç‰ˆæœ¬ï¼šEspoCRM 9.2.2+</p></blockquote><p>å¤–éƒ¨é›†æˆçš„éš¾ç‚¹ä¸æ˜¯â€è°ƒé€š APIâ€ï¼Œè€Œæ˜¯â€é•¿æœŸç¨³å®šè¿è¡Œâ€ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li>OAuth 2.0 å®ç° EspoCRM ä¸å¤–éƒ¨ç³»ç»Ÿçš„å®‰å…¨è¿æ¥</li><li>å¢é‡åŒæ­¥ç”¨ deltaLink&#x2F;skipToken æœºåˆ¶ï¼Œé¿å…å…¨é‡æ‹‰å–</li><li>Token å¤±æ•ˆæœ‰æ¢å¤ç­–ç•¥ï¼ŒåŒæ­¥å¤±è´¥ä¸ä¸­æ–­æœåŠ¡</li><li>å…³é”®åˆ¤æ–­æ‰“è‹±æ–‡æ—¥å¿—ï¼Œä¿è¯çº¿ä¸Šå¯å®šä½</li></ul><hr><h2 id="1-é›†æˆåœºæ™¯æ¦‚è¿°"><a href="#1-é›†æˆåœºæ™¯æ¦‚è¿°" class="headerlink" title="1. é›†æˆåœºæ™¯æ¦‚è¿°"></a>1. é›†æˆåœºæ™¯æ¦‚è¿°</h2><h3 id="1-1-å¸¸è§é›†æˆç±»å‹"><a href="#1-1-å¸¸è§é›†æˆç±»å‹" class="headerlink" title="1.1 å¸¸è§é›†æˆç±»å‹"></a>1.1 å¸¸è§é›†æˆç±»å‹</h3><table><thead><tr><th align="left">é›†æˆç±»å‹</th><th align="left">å…¸å‹åœºæ™¯</th><th align="left">åŒæ­¥æ–¹å‘</th></tr></thead><tbody><tr><td align="left">æ—¥å†åŒæ­¥</td><td align="left">Outlook&#x2F;Google Calendar</td><td align="left">åŒå‘</td></tr><tr><td align="left">è”ç³»äººåŒæ­¥</td><td align="left">Outlook&#x2F;Google Contacts</td><td align="left">åŒå‘</td></tr><tr><td align="left">é‚®ä»¶é›†æˆ</td><td align="left">SMTP&#x2F;IMAP</td><td align="left">å•å‘ï¼ˆåˆ° EspoCRMï¼‰</td></tr><tr><td align="left">æ•°æ®åŒæ­¥</td><td align="left">ERP&#x2F;è´¢åŠ¡ç³»ç»Ÿ</td><td align="left">åŒå‘</td></tr><tr><td align="left">Webhook</td><td align="left">ç¬¬ä¸‰æ–¹é€šçŸ¥</td><td align="left">å•å‘ï¼ˆåˆ° EspoCRMï¼‰</td></tr></tbody></table><h3 id="1-2-æ—¥å†åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜"><a href="#1-2-æ—¥å†åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜" class="headerlink" title="1.2 æ—¥å†åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜"></a>1.2 æ—¥å†åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜</h3><ul><li><strong>å¢é‡åŒæ­¥</strong>ï¼šåªæ‹‰å–å˜æ›´æ•°æ®ï¼Œé¿å…å…¨é‡æ‹‰å–çš„æ€§èƒ½å¼€é”€</li><li><strong>Token ç®¡ç†</strong>ï¼šè®¿é—®ä»¤ç‰Œä¼šè¿‡æœŸï¼Œéœ€è¦è‡ªåŠ¨åˆ·æ–°</li><li><strong>é”™è¯¯æ¢å¤</strong>ï¼šç½‘ç»œä¸­æ–­ã€Token å¤±æ•ˆåçš„æ¢å¤æœºåˆ¶</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåŒå‘åŒæ­¥æ—¶çš„å†²çªå¤„ç†</li></ul><hr><h2 id="2-OAuth-è®¤è¯æµç¨‹"><a href="#2-OAuth-è®¤è¯æµç¨‹" class="headerlink" title="2. OAuth è®¤è¯æµç¨‹"></a>2. OAuth è®¤è¯æµç¨‹</h2><h3 id="2-1-OAuth-2-0-åŸºæœ¬æµç¨‹"><a href="#2-1-OAuth-2-0-åŸºæœ¬æµç¨‹" class="headerlink" title="2.1 OAuth 2.0 åŸºæœ¬æµç¨‹"></a>2.1 OAuth 2.0 åŸºæœ¬æµç¨‹</h3><pre class="mermaid">flowchart LR  A[ç”¨æˆ·ç‚¹å‡»è¿æ¥] --> B[è·³è½¬åˆ° Microsoft æˆæƒé¡µ]  B --> C[ç”¨æˆ·åŒæ„æˆæƒ]  C --> D[å›è°ƒåˆ° EspoCRM å¸¦ code]  D --> E[ç”¨ code æ¢ access_token]  E --> F[ä¿å­˜ token åˆ° external_account]  F --> G[å¼€å§‹åŒæ­¥æ•°æ®]</pre><h3 id="2-2-EspoCRM-ä¸­çš„-External-Account-æœºåˆ¶"><a href="#2-2-EspoCRM-ä¸­çš„-External-Account-æœºåˆ¶" class="headerlink" title="2.2 EspoCRM ä¸­çš„ External Account æœºåˆ¶"></a>2.2 EspoCRM ä¸­çš„ External Account æœºåˆ¶</h3><p>EspoCRM æä¾›äº† <code>external_account</code> å®ä½“æ¥å­˜å‚¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„è®¤è¯ä¿¡æ¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;integration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Outlook&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ACCESS_TOKEN&gt;&quot;</span><span class="punctuation">,</span>  <span class="comment">// è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line">  <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;REFRESH_TOKEN&gt;&quot;</span><span class="punctuation">,</span>    <span class="comment">// åˆ·æ–°ä»¤ç‰Œ</span></span><br><span class="line">  <span class="attr">&quot;expiresAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-08-27 10:00:00&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-Token-åˆ·æ–°æœºåˆ¶"><a href="#2-3-Token-åˆ·æ–°æœºåˆ¶" class="headerlink" title="2.3 Token åˆ·æ–°æœºåˆ¶"></a>2.3 Token åˆ·æ–°æœºåˆ¶</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$token</span>-&gt;<span class="title function_ invoke__">isExpired</span>()) &#123;</span><br><span class="line">    <span class="variable">$newToken</span> = <span class="variable language_">$this</span>-&gt;oauthHelper-&gt;<span class="title function_ invoke__">refresh</span>(<span class="variable">$token</span>-&gt;<span class="title function_ invoke__">getRefreshToken</span>());</span><br><span class="line">    <span class="variable">$externalAccount</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;accessToken&#x27;</span>, <span class="variable">$newToken</span>-&gt;access_token);</span><br><span class="line">    <span class="variable">$externalAccount</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;refreshToken&#x27;</span>, <span class="variable">$newToken</span>-&gt;refresh_token);</span><br><span class="line">    <span class="variable">$externalAccount</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;expiresAt&#x27;</span>, <span class="variable">$newToken</span>-&gt;expires_at);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;entityManager-&gt;<span class="title function_ invoke__">saveEntity</span>(<span class="variable">$externalAccount</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="3-å¢é‡åŒæ­¥å®ç°"><a href="#3-å¢é‡åŒæ­¥å®ç°" class="headerlink" title="3. å¢é‡åŒæ­¥å®ç°"></a>3. å¢é‡åŒæ­¥å®ç°</h2><h3 id="3-1-ä¸ºä»€ä¹ˆéœ€è¦å¢é‡åŒæ­¥"><a href="#3-1-ä¸ºä»€ä¹ˆéœ€è¦å¢é‡åŒæ­¥" class="headerlink" title="3.1 ä¸ºä»€ä¹ˆéœ€è¦å¢é‡åŒæ­¥"></a>3.1 ä¸ºä»€ä¹ˆéœ€è¦å¢é‡åŒæ­¥</h3><p>å…¨é‡æ‹‰å–çš„é—®é¢˜ï¼š</p><ul><li>æ¯æ¬¡æ‹‰å–æ‰€æœ‰äº‹ä»¶ï¼Œæ•°æ®é‡å¤§æ—¶æ€§èƒ½å·®</li><li>æµªè´¹ API é…é¢</li><li>åŒæ­¥æ—¶é—´é•¿ï¼Œç”¨æˆ·ä½“éªŒå·®</li></ul><p><strong>å¢é‡åŒæ­¥</strong>ï¼šåªæ‹‰å–æœ‰å˜åŒ–çš„è®°å½•ã€‚</p><h3 id="3-2-Microsoft-Graph-API-çš„-Delta-æœºåˆ¶"><a href="#3-2-Microsoft-Graph-API-çš„-Delta-æœºåˆ¶" class="headerlink" title="3.2 Microsoft Graph API çš„ Delta æœºåˆ¶"></a>3.2 Microsoft Graph API çš„ Delta æœºåˆ¶</h3><pre class="mermaid">stateDiagram-v2    [*] --> åˆå§‹åŒæ­¥    åˆå§‹åŒæ­¥ --> åˆ†é¡µä¸­: æ”¶åˆ°@odata.nextLink    åˆ†é¡µä¸­ --> åˆ†é¡µä¸­: ç»§ç»­ä¸‹ä¸€é¡µ    åˆ†é¡µä¸­ --> å¢é‡åŒæ­¥: æ”¶åˆ°@odata.deltaLink    å¢é‡åŒæ­¥ --> å¢é‡åŒæ­¥: ä½¿ç”¨deltaToken    å¢é‡åŒæ­¥ --> é”™è¯¯æ¢å¤: Tokenè¿‡æœŸ    é”™è¯¯æ¢å¤ --> åˆå§‹åŒæ­¥: é‡æ–°å¼€å§‹</pre><h3 id="3-3-Delta-Token-ç®¡ç†"><a href="#3-3-Delta-Token-ç®¡ç†" class="headerlink" title="3.3 Delta Token ç®¡ç†"></a>3.3 Delta Token ç®¡ç†</h3><p><strong>å“åº”æ ¼å¼</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@odata.context&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AAMkAG...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¼šè®®1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;@removed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deleted&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AAMkAG...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¼šè®®2&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;@odata.nextLink&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://graph.microsoft.com/...?skipToken=xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// æˆ–</span></span><br><span class="line">  <span class="attr">&quot;@odata.deltaLink&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://graph.microsoft.com/...?deltaToken=xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>å­˜å‚¨ç­–ç•¥</strong>ï¼š</p><table><thead><tr><th align="left">Token</th><th align="left">å­˜å‚¨ä½ç½®</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="left">deltaToken</td><td align="left">outlook_calendar_user.delta_token</td><td align="left">ä¸‹æ¬¡å¢é‡åŒæ­¥çš„èµ·ç‚¹</td></tr><tr><td align="left">skipToken</td><td align="left">outlook_calendar_user.skip_token</td><td align="left">åˆ†é¡µç»§ç»­çš„æ ‡è®°</td></tr></tbody></table><h3 id="3-4-åŒæ­¥é€»è¾‘éª¨æ¶"><a href="#3-4-åŒæ­¥é€»è¾‘éª¨æ¶" class="headerlink" title="3.4 åŒæ­¥é€»è¾‘éª¨æ¶"></a>3.4 åŒæ­¥é€»è¾‘éª¨æ¶</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">syncCalendar</span>(<span class="params">OutlookCalendarUser <span class="variable">$calendarUser</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$deltaToken</span> = <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;deltaToken&#x27;</span>);</span><br><span class="line">    <span class="variable">$skipToken</span> = <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;skipToken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$params</span> = [</span><br><span class="line">        <span class="string">&#x27;start&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">\DateTime</span>(<span class="string">&#x27;-1 month&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;end&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">\DateTime</span>(<span class="string">&#x27;+3 months&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;deltaToken&#x27;</span> =&gt; <span class="variable">$deltaToken</span>,</span><br><span class="line">        <span class="string">&#x27;skipToken&#x27;</span> =&gt; <span class="variable">$skipToken</span>,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="variable language_">$this</span>-&gt;graphClient-&gt;<span class="title function_ invoke__">getCalendarView</span>(<span class="variable">$params</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$response</span>-&gt;value <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$item</span>[<span class="string">&#x27;@removed&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">handleDeletedEvent</span>(<span class="variable">$item</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">handleEvent</span>(<span class="variable">$item</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° token</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$response</span>[<span class="string">&#x27;@odata.nextLink&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;skipToken&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">extractSkipToken</span>(<span class="variable">$response</span>));</span><br><span class="line">            <span class="variable">$params</span>[<span class="string">&#x27;skipToken&#x27;</span>] = <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;skipToken&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable">$response</span>[<span class="string">&#x27;@odata.deltaLink&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;deltaToken&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">extractDeltaToken</span>(<span class="variable">$response</span>));</span><br><span class="line">            <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;skipToken&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">// åŒæ­¥å®Œæˆ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="keyword">isset</span>(<span class="variable">$response</span>[<span class="string">&#x27;@odata.nextLink&#x27;</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;entityManager-&gt;<span class="title function_ invoke__">saveEntity</span>(<span class="variable">$calendarUser</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-é”™è¯¯å¤„ç†ä¸æ¢å¤"><a href="#4-é”™è¯¯å¤„ç†ä¸æ¢å¤" class="headerlink" title="4. é”™è¯¯å¤„ç†ä¸æ¢å¤"></a>4. é”™è¯¯å¤„ç†ä¸æ¢å¤</h2><h3 id="4-1-å¸¸è§é”™è¯¯ç±»å‹"><a href="#4-1-å¸¸è§é”™è¯¯ç±»å‹" class="headerlink" title="4.1 å¸¸è§é”™è¯¯ç±»å‹"></a>4.1 å¸¸è§é”™è¯¯ç±»å‹</h3><table><thead><tr><th align="left">é”™è¯¯</th><th align="left">åŸå› </th><th align="left">æ¢å¤ç­–ç•¥</th></tr></thead><tbody><tr><td align="left">401 Unauthorized</td><td align="left">Token è¿‡æœŸ</td><td align="left">ç”¨ refreshToken åˆ·æ–°</td></tr><tr><td align="left">410 Gone</td><td align="left">deltaToken è¿‡æœŸ</td><td align="left">é‡æ–°å¼€å§‹å…¨é‡åŒæ­¥</td></tr><tr><td align="left">429 TooManyRequests</td><td align="left">API é™æµ</td><td align="left">å»¶è¿Ÿé‡è¯•</td></tr><tr><td align="left">500+ æœåŠ¡å™¨é”™è¯¯</td><td align="left">ä¸´æ—¶æ•…éšœ</td><td align="left">å»¶è¿Ÿé‡è¯•</td></tr></tbody></table><h3 id="4-2-é”™è¯¯å¤„ç†æµç¨‹"><a href="#4-2-é”™è¯¯å¤„ç†æµç¨‹" class="headerlink" title="4.2 é”™è¯¯å¤„ç†æµç¨‹"></a>4.2 é”™è¯¯å¤„ç†æµç¨‹</h3><pre class="mermaid">flowchart TD    A[API è¯·æ±‚] --> B{å“åº”çŠ¶æ€}    B -->|æˆåŠŸ| C[å¤„ç†äº‹ä»¶æ•°æ®]    B -->|401| D[åˆ·æ–° Token]    B -->|410| E[æ¸…é™¤ Token]    D --> F[é‡è¯•è¯·æ±‚]    E --> G[é‡æ–°å¼€å§‹å…¨é‡åŒæ­¥]    B -->|429/500| H[å»¶è¿Ÿåé‡è¯•]</pre><h3 id="4-3-ä»£ç ç¤ºä¾‹"><a href="#4-3-ä»£ç ç¤ºä¾‹" class="headerlink" title="4.3 ä»£ç ç¤ºä¾‹"></a>4.3 ä»£ç ç¤ºä¾‹</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$response</span> = <span class="variable language_">$this</span>-&gt;graphClient-&gt;<span class="title function_ invoke__">request</span>(<span class="variable">$url</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getStatusCode</span>() === <span class="number">401</span>) &#123;</span><br><span class="line">    <span class="comment">// Token è¿‡æœŸï¼Œå°è¯•åˆ·æ–°</span></span><br><span class="line">    <span class="variable">$newToken</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">refreshAccessToken</span>(<span class="variable">$calendarUser</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$newToken</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>; <span class="comment">// é‡è¯•</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Token refresh failed&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getStatusCode</span>() === <span class="number">410</span>) &#123;</span><br><span class="line">    <span class="comment">// Delta token è¿‡æœŸï¼Œé‡æ–°å¼€å§‹</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">warning</span>(<span class="string">&#x27;Delta token expired, restarting sync&#x27;</span>);</span><br><span class="line">    <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;deltaToken&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="variable">$calendarUser</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;skipToken&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">syncCalendar</span>(<span class="variable">$calendarUser</span>); <span class="comment">// é€’å½’è°ƒç”¨ï¼Œä½¿ç”¨æ—  token å¼€å§‹</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="5-ç›‘æ§ä¸æ’éšœ"><a href="#5-ç›‘æ§ä¸æ’éšœ" class="headerlink" title="5. ç›‘æ§ä¸æ’éšœ"></a>5. ç›‘æ§ä¸æ’éšœ</h2><h3 id="5-1-å…³é”®æ—¥å¿—"><a href="#5-1-å…³é”®æ—¥å¿—" class="headerlink" title="5.1 å…³é”®æ—¥å¿—"></a>5.1 å…³é”®æ—¥å¿—</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Outlook sync: Processing calendar &#123;calendarName&#125;.</span><br><span class="line">[INFO] Outlook sync: Received deltaToken. Sync completed.</span><br><span class="line">[INFO] Outlook sync: 3 events created, 1 updated, 2 deleted.</span><br><span class="line">[WARNING] Outlook sync: Sync state generation expired, restarting.</span><br><span class="line">[ERROR] Outlook sync: Failed to refresh token for user &#123;userId&#125;.</span><br></pre></td></tr></table></figure><h3 id="5-2-æ•°æ®åº“éªŒè¯"><a href="#5-2-æ•°æ®åº“éªŒè¯" class="headerlink" title="5.2 æ•°æ®åº“éªŒè¯"></a>5.2 æ•°æ®åº“éªŒè¯</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹åŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    u.name,</span><br><span class="line">    cu.last_synced_at,</span><br><span class="line">    cu.delta_token <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> <span class="keyword">as</span> has_delta</span><br><span class="line"><span class="keyword">FROM</span> outlook_calendar_user cu</span><br><span class="line"><span class="keyword">JOIN</span> <span class="keyword">user</span> u <span class="keyword">ON</span> cu.user_id <span class="operator">=</span> u.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹åŒæ­¥ç»Ÿè®¡</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    user_id,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> total_events,</span><br><span class="line">    <span class="built_in">MAX</span>(synced_at) <span class="keyword">as</span> last_sync</span><br><span class="line"><span class="keyword">FROM</span> outlook_calendar_event</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure><h3 id="5-3-åŒæ­¥é…ç½®å‚æ•°"><a href="#5-3-åŒæ­¥é…ç½®å‚æ•°" class="headerlink" title="5.3 åŒæ­¥é…ç½®å‚æ•°"></a>5.3 åŒæ­¥é…ç½®å‚æ•°</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;outlookCalendarSyncPeriod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1 year&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outlookCalendarSyncEndPeriod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3 months&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outlookCalendarSyncMaxPortionSize&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">å‚æ•°</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">syncPeriod</td><td align="left">å‘å‰æ‹‰å–å¤šé•¿æ—¶é—´çš„æ•°æ®</td></tr><tr><td align="left">syncEndPeriod</td><td align="left">å‘åæ‹‰å–å¤šé•¿æ—¶é—´çš„æ•°æ®</td></tr><tr><td align="left">maxPortionSize</td><td align="left">æ¯é¡µè¿”å›å¤šå°‘æ¡è®°å½•</td></tr></tbody></table><hr><h2 id="æœ¬ç¯‡æ€»ç»“"><a href="#æœ¬ç¯‡æ€»ç»“" class="headerlink" title="æœ¬ç¯‡æ€»ç»“"></a>æœ¬ç¯‡æ€»ç»“</h2><ul><li>OAuth 2.0 å®ç° EspoCRM ä¸å¤–éƒ¨ç³»ç»Ÿçš„å®‰å…¨è¿æ¥</li><li>å¢é‡åŒæ­¥ç”¨ deltaLink&#x2F;skipToken æœºåˆ¶ï¼Œé¿å…å…¨é‡æ‹‰å–</li><li>Token å¤±æ•ˆæœ‰æ¢å¤ç­–ç•¥ï¼ŒåŒæ­¥å¤±è´¥ä¸ä¸­æ–­æœåŠ¡</li><li>å…³é”®èŠ‚ç‚¹æ‰“è‹±æ–‡æ—¥å¿—ï¼Œä¿è¯çº¿ä¸Šå¯å®šä½</li></ul>]]></content>
    
    
    <summary type="html">å¤–éƒ¨é›†æˆçš„éš¾ç‚¹ä¸æ˜¯â€œè°ƒé€š APIâ€ï¼Œè€Œæ˜¯â€œé•¿æœŸç¨³å®šè¿è¡Œâ€ã€‚æœ¬æ–‡ä»¥ Outlook/Graph ä¸ºä¾‹ï¼Œè®²æ¸… OAuth æˆæƒæµç¨‹ã€ExternalAccount å­˜å‚¨ã€å¢é‡åŒæ­¥ï¼ˆdeltaLink/skipTokenï¼‰ä¸å¤±è´¥æ¢å¤ç­–ç•¥ã€‚è¦†ç›– token è½®æ¢ã€é”™è¯¯åˆ†ç±»é‡è¯•ã€å¹‚ç­‰è®¾è®¡ä¸è‹±æ–‡æ—¥å¿—ï¼Œè®©é›†æˆé•¿æœŸç¨³å®šè¿è¡Œã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="integration" scheme="https://www.yzhu.name/tags/integration/"/>
    
    <category term="outlook" scheme="https://www.yzhu.name/tags/outlook/"/>
    
    <category term="oauth" scheme="https://www.yzhu.name/tags/oauth/"/>
    
    <category term="sync" scheme="https://www.yzhu.name/tags/sync/"/>
    
  </entry>
  
  <entry>
    <title>EspoCRMå®šåˆ¶ç¯‡æ€»çº²â€”â€”æ‰©å±•ç‚¹é€‰æ‹©ã€æ¨¡å—æ¶æ„ä¸å·¥ç¨‹åŒ–</title>
    <link href="https://www.yzhu.name/2025/11/16/espocrm/01-upgrade-safe-customization-redlines/"/>
    <id>https://www.yzhu.name/2025/11/16/espocrm/01-upgrade-safe-customization-redlines/</id>
    <published>2025-11-16T01:00:00.000Z</published>
    <updated>2025-11-16T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨ç‰ˆæœ¬ï¼šEspoCRM 9.2.2+ï¼ˆå¼€æºç‰ˆï¼‰</p></blockquote><p>ä½ ä»¥ä¸ºâ€èƒ½è·‘èµ·æ¥â€å°±å®Œäº†ï¼ŸçœŸæ­£çš„éš¾ç‚¹ä»ä½ ç¬¬ä¸€æ¬¡å‡çº§å¼€å§‹ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li>ç”¨â€æ‰©å±•ç‚¹é‡‘å­—å¡”â€é€‰æ‹©æœ€å°ä¾µå…¥æ–¹æ¡ˆï¼Œèƒ½é…ç½®å°±ä¸å†™ä»£ç </li><li>ç”¨â€ç›®å½•åˆ†åŒºâ€éš”ç¦»ç®¡ç†å‘˜é…ç½®ä¸å¼€å‘è€…ä»£ç ï¼Œé¿å…ä¸å¯å®¡è®¡æ··ä¹±</li><li>ç”¨â€æ¨¡å—åŒ–æ¶æ„â€æŠŠæ”¹åŠ¨é”åœ¨å¯æ§è¾¹ç•Œå†…</li><li>ç”¨â€æ¸…å•åŒ–éƒ¨ç½²+å›æ»šâ€æŠŠé£é™©é™åˆ°å¯æ§</li></ul><hr><h2 id="1-æ‰©å±•ç‚¹é‡‘å­—å¡”"><a href="#1-æ‰©å±•ç‚¹é‡‘å­—å¡”" class="headerlink" title="1. æ‰©å±•ç‚¹é‡‘å­—å¡”"></a>1. æ‰©å±•ç‚¹é‡‘å­—å¡”</h2><h3 id="1-1-æˆ‘ä»¬è§£å†³çš„ä¸æ˜¯â€èƒ½ä¸èƒ½æ”¹â€ï¼Œè€Œæ˜¯â€èƒ½ä¸èƒ½é•¿æœŸç»´æŠ¤â€"><a href="#1-1-æˆ‘ä»¬è§£å†³çš„ä¸æ˜¯â€èƒ½ä¸èƒ½æ”¹â€ï¼Œè€Œæ˜¯â€èƒ½ä¸èƒ½é•¿æœŸç»´æŠ¤â€" class="headerlink" title="1.1 æˆ‘ä»¬è§£å†³çš„ä¸æ˜¯â€èƒ½ä¸èƒ½æ”¹â€ï¼Œè€Œæ˜¯â€èƒ½ä¸èƒ½é•¿æœŸç»´æŠ¤â€"></a>1.1 æˆ‘ä»¬è§£å†³çš„ä¸æ˜¯â€èƒ½ä¸èƒ½æ”¹â€ï¼Œè€Œæ˜¯â€èƒ½ä¸èƒ½é•¿æœŸç»´æŠ¤â€</h3><p>å¾ˆå¤šå›¢é˜Ÿåš EspoCRM å®šåˆ¶ï¼Œç¬¬ä¸€é˜¶æ®µé â€æ”¹å¾—å¿«â€èµ¢ï¼›ç¬¬äºŒé˜¶æ®µä¼šè¢«â€ä¸å¯å‡çº§ã€ä¸å¯å›æ»šã€ä¸å¯å®šä½é—®é¢˜â€æ‹–å®ã€‚</p><p>è¿™å¥—ç³»åˆ—æ–‡ç« çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼š</p><ul><li>ä¸è®¨è®ºâ€æ”¹æ ¸å¿ƒæ–‡ä»¶æœ€å¿«â€çš„ç©æ³•ï¼Œåªè®¨è®ºâ€å‡çº§åä»å¯æ´»â€çš„åšæ³•</li><li>ä¸æ˜¯å±•ç¤ºæŠ€å·§å †å ï¼Œè€Œæ˜¯ç»™ä¸€å¥—å¯å¤ç”¨çš„å·¥ç¨‹æ¨¡æ¿</li></ul><h3 id="1-2-é€‰æ‹©æ‰©å±•ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆé‡‘å­—å¡”ï¼‰"><a href="#1-2-é€‰æ‹©æ‰©å±•ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆé‡‘å­—å¡”ï¼‰" class="headerlink" title="1.2 é€‰æ‹©æ‰©å±•ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆé‡‘å­—å¡”ï¼‰"></a>1.2 é€‰æ‹©æ‰©å±•ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆé‡‘å­—å¡”ï¼‰</h3><p>æˆ‘ä»¬çš„é»˜è®¤ç­–ç•¥ï¼š<strong>èƒ½ä¸å†™ä»£ç å°±ä¸å†™ä»£ç </strong>ï¼Œèƒ½ç”¨ç³»ç»Ÿæœºåˆ¶å°±ä¸ç”¨è‡ªé€ è½®å­ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. Formula (ä¼˜å…ˆ)      - ç®€å•è®¡ç®—å’Œæ¡ä»¶é€»è¾‘</span><br><span class="line">2. Dynamic Logic        - ç•Œé¢æ˜¾ç¤ºä¸å­—æ®µä¾èµ–</span><br><span class="line">3. Workflow / BPM       - å¤æ‚ä¸šåŠ¡æµç¨‹ï¼ˆè°¨æ…ï¼‰</span><br><span class="line">4. Hook                 - æ•°æ®ä¸€è‡´æ€§ä¿éšœï¼ˆç¦æ­¢å¤æ‚è®¡ç®—/HTTP/å‘ä¿¡ï¼‰</span><br><span class="line">5. Service / Controller - API ä¸å¤æ‚é€»è¾‘ï¼ˆæœ€åæ‰‹æ®µï¼‰</span><br></pre></td></tr></table></figure><p>ä½ ä¼šåœ¨åé¢å‡ ç¯‡é‡Œçœ‹åˆ°åŒä¸€ä¸ªå¥—è·¯åå¤å‡ºç°ï¼š<br>å…ˆç”¨ Dynamic Logic è§£å†³ä½“éªŒï¼Œå†ç”¨ Hook&#x2F;Service è§£å†³â€ç»•è¿‡ä¸ä¸€è‡´æ€§â€ã€‚</p><h3 id="1-3-çº¢çº¿ï¼ˆè¿åå°±æ³¨å®šä¸å¯ç»´æŠ¤ï¼‰"><a href="#1-3-çº¢çº¿ï¼ˆè¿åå°±æ³¨å®šä¸å¯ç»´æŠ¤ï¼‰" class="headerlink" title="1.3 çº¢çº¿ï¼ˆè¿åå°±æ³¨å®šä¸å¯ç»´æŠ¤ï¼‰"></a>1.3 çº¢çº¿ï¼ˆè¿åå°±æ³¨å®šä¸å¯ç»´æŠ¤ï¼‰</h3><ul><li>ä¸ä¿®æ”¹ <code>application/</code> ç›®å½•ä¸‹ä»»ä½•æ–‡ä»¶ï¼ˆé™¤éä½ å‡†å¤‡æ°¸ä¹…è‡ªå·±ç»´æŠ¤ä¸€ä¸ª forkï¼‰</li><li>ä¸åœ¨ä»£ç é‡Œç¡¬ç¼–ç ç¯å¢ƒä¿¡æ¯ï¼ˆåŸŸåã€å®¹å™¨åã€æ•°æ®åº“è¿æ¥ã€å¯†é’¥ï¼‰</li><li>ä¸æŠŠç®¡ç†å‘˜é…ç½®å’Œå¼€å‘è€…ä»£ç æ··åœ¨åŒä¸€å¥—å…ƒæ•°æ®æ–‡ä»¶é‡Œ</li><li>ä¸åœ¨ Hook é‡Œåšé‡é€»è¾‘ï¼ˆå°¤å…¶æ˜¯å‘é‚®ä»¶ã€å¤æ‚è®¡ç®—ã€HTTP è¯·æ±‚ï¼‰</li><li>ä¸ç»•è¿‡ ACLï¼ˆä»»ä½•â€æ–¹ä¾¿è°ƒè¯•çš„åé—¨â€æœ€ç»ˆéƒ½ä¼šå˜æˆå®‰å…¨äº‹æ•…ï¼‰</li></ul><hr><h2 id="2-æ¨¡å—åŒ–æ¶æ„"><a href="#2-æ¨¡å—åŒ–æ¶æ„" class="headerlink" title="2. æ¨¡å—åŒ–æ¶æ„"></a>2. æ¨¡å—åŒ–æ¶æ„</h2><h3 id="2-1-ç›®å½•åˆ†åŒºï¼šå¼€å‘è€…æ¨¡å—-vs-ç®¡ç†å‘˜é…ç½®åŒº"><a href="#2-1-ç›®å½•åˆ†åŒºï¼šå¼€å‘è€…æ¨¡å—-vs-ç®¡ç†å‘˜é…ç½®åŒº" class="headerlink" title="2.1 ç›®å½•åˆ†åŒºï¼šå¼€å‘è€…æ¨¡å— vs ç®¡ç†å‘˜é…ç½®åŒº"></a>2.1 ç›®å½•åˆ†åŒºï¼šå¼€å‘è€…æ¨¡å— vs ç®¡ç†å‘˜é…ç½®åŒº</h3><p>æˆ‘ä»¬æŠŠâ€å¯å‡çº§â€è½åˆ°ç‰©ç†ç»“æ„ä¸Šï¼š</p><ul><li>ç®¡ç†å‘˜ï¼ˆGUIï¼‰äº§ç”Ÿçš„é…ç½®ï¼š<code>custom/Espo/Custom/</code></li><li>å¼€å‘è€…ï¼ˆä»£ç ï¼‰äº¤ä»˜çš„æ¨¡å—ï¼š<code>custom/Espo/Modules/{ModuleName}/</code></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">custom/</span><br><span class="line">â”œâ”€â”€ Espo/Custom/                    # ç®¡ç†å‘˜é…ç½®åŒºï¼ˆGUIï¼‰</span><br><span class="line">â”‚   â””â”€â”€ Resources/metadata/</span><br><span class="line">â””â”€â”€ Espo/Modules/&#123;ModuleName&#125;/      # å¼€å‘è€…æ¨¡å—åŒºï¼ˆä»£ç ï¼‰</span><br><span class="line">    â”œâ”€â”€ Controllers/</span><br><span class="line">    â”œâ”€â”€ Services/</span><br><span class="line">    â”œâ”€â”€ Hooks/</span><br><span class="line">    â”œâ”€â”€ Jobs/</span><br><span class="line">    â””â”€â”€ Resources/</span><br><span class="line">        â”œâ”€â”€ metadata/</span><br><span class="line">        â”œâ”€â”€ routes.json</span><br><span class="line">        â””â”€â”€ i18n/</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆè¿™ä¹ˆè‹›åˆ»ï¼Ÿ</strong><br>å› ä¸ºç®¡ç†å‘˜é…ç½®å¯å˜ã€ä¸å¯å®¡è®¡ï¼Œè€Œå¼€å‘è€…ä»£ç å¿…é¡»å¯å®¡è®¡ã€å¯å›æ»šã€å¯å¤ç°ã€‚æ··åœ¨ä¸€èµ·ï¼Œç­‰äºæŠŠä¸¤ç§ç”Ÿå‘½å‘¨æœŸæºæˆä¸€é”…ç²¥ã€‚</p><h3 id="2-2-å®Œæ•´åç«¯æ¨¡å—ç»“æ„"><a href="#2-2-å®Œæ•´åç«¯æ¨¡å—ç»“æ„" class="headerlink" title="2.2 å®Œæ•´åç«¯æ¨¡å—ç»“æ„"></a>2.2 å®Œæ•´åç«¯æ¨¡å—ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">custom/Espo/Modules/MyModule/</span><br><span class="line">â”œâ”€â”€ Module.php                          # æ¨¡å—å®šä¹‰ç±»</span><br><span class="line">â”œâ”€â”€ composer.json                       # ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Controllers/                        # API æ§åˆ¶å™¨</span><br><span class="line">â”‚   â””â”€â”€ MyEntity.php</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Services/                           # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚</span><br><span class="line">â”‚   â””â”€â”€ MyService.php</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Hooks/                              # æ•°æ®é’©å­</span><br><span class="line">â”‚   â”œâ”€â”€ MyEntity/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ BeforeSave.php</span><br><span class="line">â”‚   â””â”€â”€ AnotherEntity/</span><br><span class="line">â”‚       â””â”€â”€ AfterSave.php</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Jobs/                               # å®šæ—¶ä»»åŠ¡</span><br><span class="line">â”‚   â””â”€â”€ MyScheduledJob.php</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Entities/                           # å®ä½“ç±»ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ MyEntity.php</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ Repositories/                       # æ•°æ®ä»“åº“ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ MyEntityRepository.php</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ Resources/                          # å…ƒæ•°æ®ä¸é…ç½®</span><br><span class="line">    â”œâ”€â”€ metadata/</span><br><span class="line">    â”‚   â”œâ”€â”€ entityDefs/                 # å®ä½“å®šä¹‰</span><br><span class="line">    â”‚   â”œâ”€â”€ clientDefs/                 # å‰ç«¯å®šä¹‰</span><br><span class="line">    â”‚   â”œâ”€â”€ scopes/                     # æƒé™ä½œç”¨åŸŸ</span><br><span class="line">    â”‚   â”œâ”€â”€ app/</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ adminPanel.json        # ç®¡ç†é¢æ¿èœå•</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ config.json            # ç³»ç»Ÿé…ç½®</span><br><span class="line">    â”‚   â””â”€â”€ routes.json                 # API è·¯ç”±</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ layouts/                         # ç•Œé¢å¸ƒå±€</span><br><span class="line">    â”‚   â””â”€â”€ MyEntity/</span><br><span class="line">    â”‚       â”œâ”€â”€ list.json</span><br><span class="line">    â”‚       â”œâ”€â”€ detail.json</span><br><span class="line">    â”‚       â”œâ”€â”€ edit.json</span><br><span class="line">    â”‚       â””â”€â”€ create.json</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€â”€ i18n/                            # è¯­è¨€åŒ…</span><br><span class="line">        â””â”€â”€ en_US/</span><br><span class="line">            â”œâ”€â”€ Global.json</span><br><span class="line">            â””â”€â”€ MyEntity.json</span><br></pre></td></tr></table></figure><h3 id="2-3-å‰ç«¯æ¨¡å—ç»“æ„"><a href="#2-3-å‰ç«¯æ¨¡å—ç»“æ„" class="headerlink" title="2.3 å‰ç«¯æ¨¡å—ç»“æ„"></a>2.3 å‰ç«¯æ¨¡å—ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">client/modules/my-module/</span><br><span class="line">â””â”€â”€ src/</span><br><span class="line">    â”œâ”€â”€ views/                           # è‡ªå®šä¹‰è§†å›¾</span><br><span class="line">    â”‚   â””â”€â”€ my-entity/</span><br><span class="line">    â”‚       â”œâ”€â”€ detail.js</span><br><span class="line">    â”‚       â”œâ”€â”€ edit.js</span><br><span class="line">    â”‚       â””â”€â”€ list.js</span><br><span class="line">    â”œâ”€â”€ fields/                          # è‡ªå®šä¹‰å­—æ®µç±»å‹</span><br><span class="line">    â”‚   â””â”€â”€ my-field-type.js</span><br><span class="line">    â””â”€â”€ templates/                       # Handlebars æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">        â””â”€â”€ my-template.tpl</span><br></pre></td></tr></table></figure><h3 id="2-4-ç®¡ç†å‘˜é…ç½®åŒºï¼ˆå¼€å‘è€…ä¸è¦åŠ¨ï¼‰"><a href="#2-4-ç®¡ç†å‘˜é…ç½®åŒºï¼ˆå¼€å‘è€…ä¸è¦åŠ¨ï¼‰" class="headerlink" title="2.4 ç®¡ç†å‘˜é…ç½®åŒºï¼ˆå¼€å‘è€…ä¸è¦åŠ¨ï¼‰"></a>2.4 ç®¡ç†å‘˜é…ç½®åŒºï¼ˆå¼€å‘è€…ä¸è¦åŠ¨ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">custom/Espo/Custom/</span><br><span class="line">â””â”€â”€ Resources/</span><br><span class="line">    â””â”€â”€ metadata/                        # ç®¡ç†å‘˜é€šè¿‡ GUI æ·»åŠ çš„é…ç½®</span><br><span class="line">        â”œâ”€â”€ entityDefs/</span><br><span class="line">        â”œâ”€â”€ clientDefs/</span><br><span class="line">        â””â”€â”€ scopes/</span><br></pre></td></tr></table></figure><hr><h2 id="3-å„å±‚èŒè´£åˆ†å·¥"><a href="#3-å„å±‚èŒè´£åˆ†å·¥" class="headerlink" title="3. å„å±‚èŒè´£åˆ†å·¥"></a>3. å„å±‚èŒè´£åˆ†å·¥</h2><h3 id="3-1-Controllerï¼šAPI-å…¥å£"><a href="#3-1-Controllerï¼šAPI-å…¥å£" class="headerlink" title="3.1 Controllerï¼šAPI å…¥å£"></a>3.1 Controllerï¼šAPI å…¥å£</h3><p><strong>èŒè´£</strong>ï¼š</p><ul><li>å¤„ç† HTTP è¯·æ±‚</li><li>æƒé™æ£€æŸ¥ï¼ˆACLï¼‰</li><li>è°ƒç”¨ Service å¤„ç†ä¸šåŠ¡é€»è¾‘</li><li>è¿”å› JSON å“åº”</li></ul><p><strong>ç¤ºä¾‹éª¨æ¶</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">MyModule</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Controllers</span>\<span class="title">Record</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Exceptions</span>\<span class="title">BadRequest</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Exceptions</span>\<span class="title">Forbidden</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEntity</span> <span class="keyword">extends</span> <span class="title">Record</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionMyAction</span>(<span class="params"><span class="variable">$params</span>, <span class="variable">$data</span>, <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æƒé™æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getUser</span>()-&gt;<span class="title function_ invoke__">isAdmin</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Forbidden</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‚æ•°éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>-&gt;param)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequest</span>(<span class="string">&quot;param is required&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ Service</span></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getContainer</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;MyService&#x27;</span>)-&gt;<span class="title function_ invoke__">doSomething</span>(<span class="variable">$data</span>-&gt;param);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚"><a href="#3-2-Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚" class="headerlink" title="3.2 Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚"></a>3.2 Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚</h3><p><strong>èŒè´£</strong>ï¼š</p><ul><li>å¤æ‚ä¸šåŠ¡é€»è¾‘</li><li>è·¨å®ä½“æ“ä½œ</li><li>æ•°æ®è®¡ç®—ä¸è½¬æ¢</li><li>è°ƒç”¨å¤–éƒ¨ API</li></ul><p><strong>ç¤ºä¾‹éª¨æ¶</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">MyModule</span>\<span class="title class_">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">ORM</span>\<span class="title">EntityManager</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Utils</span>\<span class="title">Config</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Utils</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> EntityManager <span class="variable">$entityManager</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> Config <span class="variable">$config</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> Log <span class="variable">$log</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$param</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&quot;MyService::doSomething started with param: <span class="subst">&#123;$param&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">processData</span>(<span class="variable">$param</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&quot;MyService::doSomething completed&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$param</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-Hookï¼šæ•°æ®ä¸€è‡´æ€§ä¿éšœ"><a href="#3-3-Hookï¼šæ•°æ®ä¸€è‡´æ€§ä¿éšœ" class="headerlink" title="3.3 Hookï¼šæ•°æ®ä¸€è‡´æ€§ä¿éšœ"></a>3.3 Hookï¼šæ•°æ®ä¸€è‡´æ€§ä¿éšœ</h3><p><strong>èŒè´£</strong>ï¼š</p><ul><li>æ•°æ®ä¿å­˜å‰çš„æ ¡éªŒ&#x2F;è¡¥å……ï¼ˆBeforeSaveï¼‰</li><li>æ•°æ®ä¿å­˜åçš„è”åŠ¨ï¼ˆAfterSaveï¼‰</li><li>æ•°æ®åˆ é™¤å‰çš„æ£€æŸ¥ï¼ˆBeforeDeleteï¼‰</li></ul><p><strong>åŸåˆ™</strong>ï¼š</p><ul><li>åªåšè½»é€»è¾‘åˆ¤æ–­</li><li>ä¸å‘é‚®ä»¶ã€ä¸åš HTTP è¯·æ±‚</li><li>ä¸åšå¤æ‚è®¡ç®—</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">MyModule</span>\<span class="title class_">Hooks</span>\<span class="title class_">MyEntity</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">ORM</span>\<span class="title">Entity</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Exceptions</span>\<span class="title">BadRequest</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeforeSave</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">beforeSave</span>(<span class="params">Entity <span class="variable">$entity</span>, <span class="keyword">array</span> <span class="variable">$options</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;status&#x27;</span>) === <span class="string">&#x27;Closed&#x27;</span> &amp;&amp; !<span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;closedReason&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequest</span>(<span class="string">&quot;closedReason is required&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®è¡¥å……</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">isNew</span>()) &#123;</span><br><span class="line">            <span class="variable">$entity</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;assignedUserId&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getUser</span>()-&gt;id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-Jobï¼šå®šæ—¶åå°ä»»åŠ¡"><a href="#3-4-Jobï¼šå®šæ—¶åå°ä»»åŠ¡" class="headerlink" title="3.4 Jobï¼šå®šæ—¶åå°ä»»åŠ¡"></a>3.4 Jobï¼šå®šæ—¶åå°ä»»åŠ¡</h3><p><strong>èŒè´£</strong>ï¼š</p><ul><li>å®šæ—¶è§¦å‘</li><li>æ‰¹é‡æ•°æ®å¤„ç†</li><li>å‘é€é€šçŸ¥&#x2F;é‚®ä»¶</li><li>å®šæœŸæ•°æ®åŒæ­¥</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Espo</span>\<span class="title class_">Modules</span>\<span class="title class_">MyModule</span>\<span class="title class_">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Job</span>\<span class="title">JobDataLess</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">ORM</span>\<span class="title">EntityManager</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Espo</span>\<span class="title">Core</span>\<span class="title">Utils</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyScheduledJob</span> <span class="keyword">implements</span> <span class="title">JobDataLess</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> EntityManager <span class="variable">$entityManager</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">private</span> Log <span class="variable">$log</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;MyScheduledJob started&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šæ—¶ä»»åŠ¡é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;log-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;MyScheduledJob completed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-rebuild-ä¸-clear-cache"><a href="#4-rebuild-ä¸-clear-cache" class="headerlink" title="4. rebuild ä¸ clear-cache"></a>4. rebuild ä¸ clear-cache</h2><h3 id="4-1-æŠŠâ€ç”Ÿæ•ˆæœºåˆ¶â€å½“æˆå·¥ç¨‹äº‹å®"><a href="#4-1-æŠŠâ€ç”Ÿæ•ˆæœºåˆ¶â€å½“æˆå·¥ç¨‹äº‹å®" class="headerlink" title="4.1 æŠŠâ€ç”Ÿæ•ˆæœºåˆ¶â€å½“æˆå·¥ç¨‹äº‹å®"></a>4.1 æŠŠâ€ç”Ÿæ•ˆæœºåˆ¶â€å½“æˆå·¥ç¨‹äº‹å®</h3><p>ä½ åœ¨ EspoCRM é‡Œæ”¹äº†å…ƒæ•°æ®ã€å‰ç«¯è§†å›¾æ˜ å°„ã€è¯­è¨€åŒ…ã€å¸ƒå±€ä¹‹åï¼Œæœ€å¸¸è§çš„é”™è¯¯ä¸æ˜¯â€å†™é”™ä»£ç â€ï¼Œè€Œæ˜¯â€ä½ ä»¥ä¸ºæ”¹äº†å°±ç”Ÿæ•ˆâ€ã€‚</p><p>å»ºè®®æŠŠä¸‹é¢æ¸…å•å½“ä½œå·¥ç¨‹åˆ¶åº¦ï¼Œè€Œä¸æ˜¯â€è®°å¾—å°±åšâ€ï¼š</p><table><thead><tr><th align="left">æ“ä½œ</th><th align="left">å¿…é¡»</th></tr></thead><tbody><tr><td align="left">æ”¹ metadataï¼ˆentityDefs &#x2F; clientDefs &#x2F; scopes &#x2F; routes &#x2F; appï¼‰</td><td align="left">rebuild</td></tr><tr><td align="left">æ”¹å‰ç«¯è§†å›¾æˆ–æ¨¡æ¿</td><td align="left">clear-cache + æµè§ˆå™¨å¼ºåˆ·</td></tr><tr><td align="left">æ”¹è¯­è¨€åŒ…</td><td align="left">rebuild</td></tr></tbody></table><h3 id="4-2-æ‰§è¡Œæ–¹å¼"><a href="#4-2-æ‰§è¡Œæ–¹å¼" class="headerlink" title="4.2 æ‰§è¡Œæ–¹å¼"></a>4.2 æ‰§è¡Œæ–¹å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> php /var/www/html/command.php rebuild</span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> php /var/www/html/command.php clear-cache</span><br></pre></td></tr></table></figure><hr><h2 id="5-éƒ¨ç½²ä¸å›æ»š"><a href="#5-éƒ¨ç½²ä¸å›æ»š" class="headerlink" title="5. éƒ¨ç½²ä¸å›æ»š"></a>5. éƒ¨ç½²ä¸å›æ»š</h2><h3 id="5-1-å®¹å™¨åŒ–éƒ¨ç½²æ¶æ„è¯´æ˜"><a href="#5-1-å®¹å™¨åŒ–éƒ¨ç½²æ¶æ„è¯´æ˜" class="headerlink" title="5.1 å®¹å™¨åŒ–éƒ¨ç½²æ¶æ„è¯´æ˜"></a>5.1 å®¹å™¨åŒ–éƒ¨ç½²æ¶æ„è¯´æ˜</h3><pre class="mermaid">graph TD    subgraph Client [ç”¨æˆ·å®¢æˆ·ç«¯]        A[Web æµè§ˆå™¨ / ç§»åŠ¨ç«¯]    end    subgraph Docker_Environment [Docker  ç¯å¢ƒ]        direction LR        subgraph EspoCRM_Monolith [EspoCRM æ ¸å¿ƒåº”ç”¨å®¹å™¨ Container]            C[Web Server : Nginx] --> D[PHP-FPM / EspoCRM Code]            D --> E[Cron Scheduler :Background Tasks]        end        Fsys[Filesystem Volume :æŒä¹…åŒ–æŒ‚è½½]    end    subgraph External_Managed_Services [å®¹å™¨å¤–å…¬å…±æ‰˜ç®¡æœåŠ¡]        G[Database :MySQL/ RDS]        H[Cache/Queue :Redis]        J[Identity Provider :Azure AD / LDAP]        K[Email Services :SMTP/IMAP]        L[AWS S3 :ç”¨æˆ·æ–‡ä»¶å­˜å‚¨]    end    A -->|HTTPS/HTTP| C    D -->|SQL| G    D -->|Read/Write Logs| Fsys    D -->|S3 API / Uploaded Files| L    D -.->|API/Protocol| H    D -->|OIDC/SAML| J    D -->|SMTP/IMAP| K    E -->|Background Tasks| D    E -->|Data Access| G    style EspoCRM_Monolith fill:#FFF7E0,stroke:#333    style Docker_Environment fill:#E0FFEE,stroke:#333    style External_Managed_Services fill:#F0E6FF,stroke:#333</pre><table><thead><tr><th align="left">ç»„ä»¶</th><th align="left">éƒ¨ç½²ä½ç½®</th><th align="left">è¿ç»´èŒè´£</th><th align="left">ä¾èµ–å…³ç³»</th><th align="left">å¤‡æ³¨ï¼ˆèµ·æ­¥é˜¶æ®µï¼‰</th></tr></thead><tbody><tr><td align="left">Web Server &#x2F; PHP-FPM &#x2F; EspoCRM Code</td><td align="left">Docker Containerï¼ˆå®¹å™¨å†…éƒ¨ï¼‰</td><td align="left">å¼€å‘å›¢é˜Ÿè´Ÿè´£æ„å»ºå’Œç»´æŠ¤å•ä¸€åº”ç”¨é•œåƒ</td><td align="left">æ¥æ”¶ Client æµé‡ï¼Œè¿æ¥å¤–éƒ¨æœåŠ¡ï¼ˆDB&#x2F;IDP&#x2F;Emailï¼‰</td><td align="left">æ ¸å¿ƒç»„ä»¶ï¼ŒåŒ…å«å…¨éƒ¨å®šåˆ¶ä»£ç </td></tr><tr><td align="left">Cron Scheduler</td><td align="left">Docker Containerï¼ˆå®¹å™¨å†…éƒ¨ï¼‰</td><td align="left">å¼€å‘å›¢é˜Ÿè´Ÿè´£è¿è¡Œ</td><td align="left">ä¾èµ– PHPï¼ˆæ‰§è¡Œä»»åŠ¡ï¼‰ï¼›è®¿é—® Databaseï¼ˆè·å–ä»»åŠ¡æ•°æ®ï¼‰</td><td align="left">æ ¸å¿ƒç»„ä»¶ï¼Œå¿…é¡»å®šæœŸè¿è¡Œ</td></tr><tr><td align="left">Filesystem Volume</td><td align="left">å®¹å™¨å¤–éƒ¨æŒä¹…åŒ–å·ï¼ˆVolumeï¼‰</td><td align="left">è¿ç»´å›¢é˜Ÿè´Ÿè´£ç®¡ç†ä¸å¤‡ä»½</td><td align="left">ä¾› PHP è¯»å†™ä»£ç &#x2F;é…ç½®ä¸ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼ˆ<code>data/upload/</code>ï¼‰</td><td align="left">å…³é”®ä¾èµ–ï¼Œç¡®ä¿ PV å¤‡ä»½</td></tr><tr><td align="left">Databaseï¼ˆMySQL&#x2F;PostgreSQLï¼‰</td><td align="left">å®¹å™¨å¤–å…¬å…±æœåŠ¡ï¼ˆManaged Serviceï¼‰</td><td align="left">å¤–éƒ¨æœåŠ¡å•†ç®¡ç†ï¼ˆå¦‚ RDSï¼‰</td><td align="left">è¢« PHP ä¸ Cron è®¿é—®ï¼Œå­˜å‚¨ä¸šåŠ¡æ•°æ®ä¸å…ƒæ•°æ®</td><td align="left">å¿…é¡»ä¾èµ–</td></tr><tr><td align="left">Identity Providerï¼ˆAzure AD&#x2F;LDAPï¼‰</td><td align="left">å®¹å™¨å¤–å…¬å…±æœåŠ¡</td><td align="left">å¤–éƒ¨æœåŠ¡å•†ç®¡ç†</td><td align="left">è¢« PHP é€šè¿‡ OIDC&#x2F;SAML ç”¨äº SSO</td><td align="left">å¿…é¡»ä¾èµ–</td></tr><tr><td align="left">Email Servicesï¼ˆSMTP&#x2F;IMAPï¼‰</td><td align="left">å®¹å™¨å¤–å…¬å…±æœåŠ¡</td><td align="left">å¤–éƒ¨æœåŠ¡å•†ç®¡ç†</td><td align="left">è¢« PHP ç”¨äºé‚®ä»¶å‘é€ä¸æ¥æ”¶</td><td align="left">å¿…é¡»ä¾èµ–ï¼ˆå®ç°é‚®ä»¶åŠŸèƒ½ï¼‰</td></tr><tr><td align="left">AWS S3</td><td align="left">å®¹å™¨å¤–å…¬å…±æœåŠ¡</td><td align="left">å¤–éƒ¨æœåŠ¡å•†ç®¡ç†</td><td align="left">ç”¨æˆ·æ–‡ä»¶å­˜å‚¨</td><td align="left">å¿…é¡»ä¾èµ–</td></tr><tr><td align="left">Cache &amp; Search Engine</td><td align="left">æš‚æ—¶ä¸ç”¨ï¼ˆä½¿ç”¨å†…éƒ¨å›é€€æœºåˆ¶ï¼‰</td><td align="left">æš‚æ— ç‹¬ç«‹è¿ç»´èŒè´£</td><td align="left">å†…éƒ¨ PHP ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæˆ–æ•°æ®åº“åšç¼“å­˜&#x2F;æœç´¢</td><td align="left">ç°é˜¶æ®µå¯çœç•¥ï¼Œç”¨æˆ·å¢é•¿åå‡çº§</td></tr></tbody></table><h3 id="5-2-é€æ–‡ä»¶æ‹·è´åŸåˆ™"><a href="#5-2-é€æ–‡ä»¶æ‹·è´åŸåˆ™" class="headerlink" title="5.2 é€æ–‡ä»¶æ‹·è´åŸåˆ™"></a>5.2 é€æ–‡ä»¶æ‹·è´åŸåˆ™</h3><p><strong>ç¦æ­¢</strong>ï¼šç›®å½•æ‹·è´ï¼ˆä¸è¦æŠŠæ•´ä¸ª <code>custom/</code> ç›®å½•ä¸€æ¬¡æ€§æ‰”è¿›å®¹å™¨ï¼‰</p><p><strong>æ­£ç¡®</strong>ï¼šé€æ–‡ä»¶æ‹·è´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ… æ­£ç¡®ï¼šé€æ–‡ä»¶æ‹·è´ï¼Œå¯å®¡è®¡</span></span><br><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">docker <span class="built_in">cp</span> Module.php <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Module.php</span><br><span class="line">docker <span class="built_in">cp</span> MyEntity.json <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Resources/metadata/entityDefs/MyEntity.json</span><br><span class="line"><span class="comment"># ... é€ä¸ªæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="5-3-éƒ¨ç½²æ£€æŸ¥æ¸…å•"><a href="#5-3-éƒ¨ç½²æ£€æŸ¥æ¸…å•" class="headerlink" title="5.3 éƒ¨ç½²æ£€æŸ¥æ¸…å•"></a>5.3 éƒ¨ç½²æ£€æŸ¥æ¸…å•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶éƒ¨ç½²</span><br><span class="line">â”œâ”€â”€ [ ] æ‰€æœ‰ .php æ–‡ä»¶å·²æ‹·è´</span><br><span class="line">â”œâ”€â”€ [ ] æ‰€æœ‰ .json å…ƒæ•°æ®æ–‡ä»¶å·²æ‹·è´</span><br><span class="line">â”œâ”€â”€ [ ] æ‰€æœ‰ .js å‰ç«¯æ–‡ä»¶å·²æ‹·è´</span><br><span class="line">â””â”€â”€ [ ] æ‰€æœ‰ .tpl æ¨¡æ¿æ–‡ä»¶å·²æ‹·è´</span><br><span class="line"></span><br><span class="line">ç³»ç»Ÿé‡å»º</span><br><span class="line">â”œâ”€â”€ [ ] rebuild å·²æ‰§è¡Œ</span><br><span class="line">â”œâ”€â”€ [ ] clear-cache å·²æ‰§è¡Œ</span><br><span class="line">â””â”€â”€ [ ] æµè§ˆå™¨ç¼“å­˜å·²æ¸…ç©º</span><br><span class="line"></span><br><span class="line">åŠŸèƒ½éªŒè¯</span><br><span class="line">â”œâ”€â”€ [ ] æ–°èœå•é¡¹æ˜¾ç¤º</span><br><span class="line">â”œâ”€â”€ [ ] æ–°å®ä½“å¯åˆ›å»º/ç¼–è¾‘</span><br><span class="line">â”œâ”€â”€ [ ] æ–° API ç«¯ç‚¹å¯è®¿é—®</span><br><span class="line">â”œâ”€â”€ [ ] ACL æƒé™æ­£ç¡®</span><br><span class="line">â””â”€â”€ [ ] æ—¥å¿—æ— é”™è¯¯</span><br><span class="line"></span><br><span class="line">å¤‡ä»½ç¡®è®¤</span><br><span class="line">â”œâ”€â”€ [ ] ç®¡ç†å‘˜é…ç½®å·²å¤‡ä»½</span><br><span class="line">â””â”€â”€ [ ] æ•°æ®åº“å·²å¤‡ä»½</span><br></pre></td></tr></table></figure><h3 id="5-4-å›æ»šç­–ç•¥"><a href="#5-4-å›æ»šç­–ç•¥" class="headerlink" title="5.4 å›æ»šç­–ç•¥"></a>5.4 å›æ»šç­–ç•¥</h3><p><strong>ä»£ç å›æ»š</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) åœ¨å®¿ä¸»æœºæºç é‡Œå›æ»šåˆ°ä¸Šä¸€ä¸ªå¯ç”¨ç‰ˆæœ¬ï¼ˆç¤ºä¾‹ï¼šGitï¼‰</span></span><br><span class="line">git checkout &lt;last-good-tag-or-commit&gt; -- custom/Espo/Modules/MyModule/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) æŒ‰â€œé€æ–‡ä»¶æ‹·è´â€é‡æ–°éƒ¨ç½²åˆ°å®¹å™¨</span></span><br><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">docker <span class="built_in">cp</span> custom/Espo/Modules/MyModule/Module.php \</span><br><span class="line">  <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Module.php</span><br><span class="line">docker <span class="built_in">cp</span> custom/Espo/Modules/MyModule/Resources/metadata/entityDefs/MyEntity.json \</span><br><span class="line">  <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:/var/www/html/custom/Espo/Modules/MyModule/Resources/metadata/entityDefs/MyEntity.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) rebuild ç”Ÿæ•ˆ</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> php /var/www/html/command.php rebuild</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®å›æ»š</strong>ï¼š</p><p>ç»“è®ºï¼šä¸è¦æŒ‡æœ› rebuild è‡ªåŠ¨â€œå›æ”¶â€æ•°æ®åº“ç»“æ„ã€‚</p><ul><li>é»˜è®¤ rebuildï¼ˆsoftï¼‰åªä¼šåˆ›å»º&#x2F;å˜æ›´éœ€è¦çš„è¡¨ã€åˆ—ã€ç´¢å¼•ï¼›ä¸ä¼š drop è¡¨ï¼Œä¹Ÿä¸ä¼š drop åˆ—</li><li>hard rebuild å¯èƒ½ä¼š drop æœªä½¿ç”¨çš„åˆ—ã€ç¼©çŸ­è¶…é•¿åˆ—é•¿åº¦ï¼Œä½†ä»ä¸ä¼š drop è¡¨ï¼Œä¸”æœ‰æ•°æ®ä¸¢å¤±é£é™©</li></ul><p>æ¨èå›æ»šç­–ç•¥ï¼š</p><ol><li>å›æ»šå‰å…ˆå¤‡ä»½æ•°æ®åº“ï¼ˆè‡³å°‘ schema + ç›¸å…³ä¸šåŠ¡è¡¨æ•°æ®ï¼‰</li><li>å›æ»šä»£ç ä¸å…ƒæ•°æ®åæ‰§è¡Œ rebuildï¼Œè®©ç¼“å­˜ä¸å…ƒæ•°æ®çŠ¶æ€ä¸€è‡´</li><li>å¯¹â€œæ–°å¢è¡¨&#x2F;ä¸­é—´è¡¨&#x2F;ç´¢å¼•â€çš„æ¸…ç†ï¼Œé‡‡ç”¨æ˜¾å¼çš„åå‘ SQLï¼ˆDROP TABLE&#x2F;INDEXï¼‰ï¼Œå¹¶åœ¨æµ‹è¯•åº“éªŒè¯åå†æ‰§è¡Œåˆ°ç”Ÿäº§</li><li>å¯¹â€œæ–°å¢åˆ—&#x2F;å­—æ®µâ€çš„å›æ»šï¼Œä¼˜å…ˆèµ°â€œå¼ƒç”¨è€Œéåˆ é™¤â€ï¼šä¿ç•™åˆ—ä¸æ•°æ®ï¼Œä»…ä»ç•Œé¢ä¸ä¸šåŠ¡é€»è¾‘ä¸­ç§»é™¤ï¼›ç¡®éœ€åˆ é™¤æ—¶ä½¿ç”¨ hard rebuild æˆ–åå‘ SQLï¼Œå¹¶æ˜ç¡®æ•°æ®ä¿ç•™&#x2F;è¿ç§»æ–¹æ¡ˆ</li></ol><h3 id="5-5-ç®¡ç†å‘˜é…ç½®å¤‡ä»½"><a href="#5-5-ç®¡ç†å‘˜é…ç½®å¤‡ä»½" class="headerlink" title="5.5 ç®¡ç†å‘˜é…ç½®å¤‡ä»½"></a>5.5 ç®¡ç†å‘˜é…ç½®å¤‡ä»½</h3><p>å¼€å‘è€…ä»£ç åœ¨ Git ä¸­æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†ç®¡ç†å‘˜é…ç½®ï¼ˆ<code>custom/Espo/Custom/</code>ï¼‰ä¸åœ¨ä»»ä½•ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé‡Œã€‚<strong>ç³»ç»Ÿå´©æºƒæ—¶ï¼Œç®¡ç†å‘˜é…ç½®ä¼šä¸¢å¤±</strong>ã€‚</p><p><strong>é—®é¢˜æœ¬è´¨</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¼€å‘è€…ä»£ç ï¼šGit ç‰ˆæœ¬æ§åˆ¶ â†’ éšæ—¶æ¢å¤ âœ…</span><br><span class="line">ç®¡ç†å‘˜é…ç½®ï¼šæ— ç‰ˆæœ¬æ§åˆ¶ â†’ ç³»ç»Ÿå´© = é…ç½®ä¸¢ âŒ</span><br></pre></td></tr></table></figure><p><strong>æ¨èæ–¹æ¡ˆï¼šå®šæ—¶å¤‡ä»½è„šæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># backup-admin-config.sh</span></span><br><span class="line"></span><br><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/espocrm/admin-config&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ç®¡ç†å‘˜é…ç½®ï¼ˆæ‰“åŒ…æˆå•æ–‡ä»¶ï¼Œåªæ‹·è´å•ä¸ªå½’æ¡£æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line">TMP_FILE=<span class="string">&quot;/tmp/Custom_<span class="variable">$DATE</span>.tar.gz&quot;</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> tar -czf <span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span> -C /var/www/html custom/Espo/Custom</span><br><span class="line">docker <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:<span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span> <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/Custom_<span class="variable">$DATE</span>.tar.gz&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> <span class="built_in">rm</span> -f <span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™æœ€è¿‘ 30 å¤©çš„å¤‡ä»½</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -name <span class="string">&quot;Custom_*.tar.gz&quot;</span> -mtime +30 -delete</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Admin config backed up: Custom_<span class="variable">$DATE</span>.tar.gz&quot;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½® cron æ¯å¤©è‡ªåŠ¨æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘ crontab</span></span><br><span class="line">crontab -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œ</span></span><br><span class="line">0 2 * * * /path/to/backup-admin-config.sh &gt;&gt; /var/log/espocrm-backup.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p><strong>æ¢å¤æµç¨‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¢å¤ç®¡ç†å‘˜é…ç½®ï¼ˆé€‰æ‹©å¤‡ä»½æ—¥æœŸï¼Œä¼šè¦†ç›–ç°æœ‰ Custom é…ç½®ï¼‰</span></span><br><span class="line">CONTAINER_NAME=<span class="string">&quot;&lt;your-espocrm-container&gt;&quot;</span></span><br><span class="line">BACKUP_FILE=<span class="string">&quot;/backup/espocrm/admin-config/Custom_20251227_020000.tar.gz&quot;</span></span><br><span class="line">TMP_FILE=<span class="string">&quot;/tmp/Custom_restore.tar.gz&quot;</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$BACKUP_FILE</span>&quot;</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span>:<span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> tar -xzf <span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span> -C /var/www/html</span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> <span class="built_in">rm</span> -f <span class="string">&quot;<span class="variable">$TMP_FILE</span>&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$CONTAINER_NAME</span>&quot;</span> php /var/www/html/command.php rebuild</span><br></pre></td></tr></table></figure><hr><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><h3 id="6-1-ä¸€å¥—å¯å¤ç”¨çš„å·¥ç¨‹æ¨¡æ¿"><a href="#6-1-ä¸€å¥—å¯å¤ç”¨çš„å·¥ç¨‹æ¨¡æ¿" class="headerlink" title="6.1 ä¸€å¥—å¯å¤ç”¨çš„å·¥ç¨‹æ¨¡æ¿"></a>6.1 ä¸€å¥—å¯å¤ç”¨çš„å·¥ç¨‹æ¨¡æ¿</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ¯ä¸ªéœ€æ±‚æŒ‰åŒä¸€æ¨¡æ¿äº¤ä»˜ï¼š</span><br><span class="line"></span><br><span class="line">â”œâ”€â”€ éœ€æ±‚ä¸éªŒæ”¶æ ‡å‡†</span><br><span class="line">â”œâ”€â”€ æ‰©å±•ç‚¹é€‰æ‹©ä¸ç†ç”±</span><br><span class="line">â”œâ”€â”€ æŠ€æœ¯è®¾è®¡ä¸æ•°æ®æµ</span><br><span class="line">â”œâ”€â”€ ä»£ç å®ç°ï¼ˆæ¨¡å—è¾¹ç•Œå†…ï¼‰</span><br><span class="line">â”œâ”€â”€ æµ‹è¯•ï¼ˆUI + API + è¾¹ç•Œï¼‰</span><br><span class="line">â”œâ”€â”€ éƒ¨ç½²è„šæœ¬ï¼ˆé€æ–‡ä»¶æ‹·è´ï¼‰</span><br><span class="line">â””â”€â”€ å›æ»šç­–ç•¥</span><br></pre></td></tr></table></figure><h3 id="6-2-æœ€ç»ˆå»ºè®®"><a href="#6-2-æœ€ç»ˆå»ºè®®" class="headerlink" title="6.2 æœ€ç»ˆå»ºè®®"></a>6.2 æœ€ç»ˆå»ºè®®</h3><ol><li><strong>èƒ½é…ç½®å°±ä¸å†™ä»£ç </strong> â€”â€” ç”¨å¥½ Formulaã€Dynamic Logic</li><li><strong>èƒ½æ‰©å±•å°±ä¸é‡å†™</strong> â€”â€” é»˜è®¤çœ‹æ¿èƒ½æ‰©å±•å°±åˆ«å®Œå…¨é‡å†™</li><li><strong>æ”¹åŠ¨é”åœ¨æ¨¡å—å†…</strong> â€”â€” ä¸æ”¹ <code>application/</code> ç›®å½•</li><li><strong>rebuild æ˜¯çºªå¾‹</strong> â€”â€” æ”¹å…ƒæ•°æ®å¿…é¡» rebuild</li></ol>]]></content>
    
    
    <summary type="html">EspoCRM å®šåˆ¶çš„ç¬¬ä¸€è¯¾ä¸æ˜¯â€œæ€ä¹ˆå†™ä»£ç â€ï¼Œè€Œæ˜¯â€œæ€ä¹ˆå†™å‡ºå¯å‡çº§çš„ä»£ç â€ã€‚æœ¬æ–‡ç»™å‡ºæ‰©å±•ç‚¹é‡‘å­—å¡”ï¼ˆFormula â†’ Dynamic Logic â†’ Workflow â†’ Hook â†’ Serviceï¼‰ï¼Œå¸®åŠ©é€‰æ‹©æœ€å°ä¾µå…¥æ–¹æ¡ˆã€‚åŒæ—¶æ¢³ç†æ¨¡å—æ¶æ„ã€ç›®å½•åˆ†åŒºã€rebuild çºªå¾‹ã€é€æ–‡ä»¶éƒ¨ç½²ã€å›æ»šä¸é…ç½®å¤‡ä»½ï¼Œç¡®ä¿é•¿æœŸå¯ç»´æŠ¤ã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="customization" scheme="https://www.yzhu.name/tags/customization/"/>
    
    <category term="upgrade-safe" scheme="https://www.yzhu.name/tags/upgrade-safe/"/>
    
    <category term="module-architecture" scheme="https://www.yzhu.name/tags/module-architecture/"/>
    
    <category term="deployment" scheme="https://www.yzhu.name/tags/deployment/"/>
    
  </entry>
  
  <entry>
    <title>OIDC &quot;Need Admin Approval&quot; æ•…éšœæ’é™¤ä¸åˆ†æ</title>
    <link href="https://www.yzhu.name/2025/11/12/OIDC-OAuth2-Need-Admin-Approval/"/>
    <id>https://www.yzhu.name/2025/11/12/OIDC-OAuth2-Need-Admin-Approval/</id>
    <published>2025-11-12T13:12:32.000Z</published>
    <updated>2025-11-12T14:50:12.405Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è¯¦ç»†è®°å½•äº†ä¸€æ¬¡OIDCè®¤è¯ç³»ç»Ÿä¸­é‡åˆ°çš„â€Need admin approvalâ€é—®é¢˜ã€‚ç”¨æˆ·åœ¨ç™»å½•æ—¶æŒç»­æ”¶åˆ°é”™è¯¯æç¤ºï¼Œä½†ä½¿ç”¨ç›¸åŒä»¤ç‰Œçš„ç‹¬ç«‹å·¥å…·å´èƒ½æ­£å¸¸å·¥ä½œã€‚ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°é—®é¢˜æ ¹æºåœ¨äºOIDCé…ç½®ä¸­çš„<code>Authorization Prompt</code>å‚æ•°è®¾ç½®ä¸å½“<span id="more"></span>ã€‚æœ¬æ–‡ä¸ä»…æä¾›äº†å®Œæ•´çš„æ•…éšœæ’é™¤è¿‡ç¨‹ï¼Œè¿˜åŒ…å«äº†OIDC&#x2F;OAuth2.0çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥å¸®åŠ©ä¸åŒæŠ€æœ¯æ°´å¹³çš„åŒäº‹ç†è§£å’Œè§£å†³ç±»ä¼¼é—®é¢˜ã€‚è™½ç„¶æ¡ˆä¾‹åŸºäºEspoCRMï¼Œä½†æ­¤é—®é¢˜åœ¨ä»»ä½•ä½¿ç”¨OIDC&#x2F;OAuth2.0çš„ç³»ç»Ÿä¸­éƒ½å¯èƒ½é‡åˆ°ã€‚</p><h2 id="1-OIDC-OAuth2-0-åŸºç¡€çŸ¥è¯†"><a href="#1-OIDC-OAuth2-0-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1. OIDC&#x2F;OAuth2.0 åŸºç¡€çŸ¥è¯†"></a>1. OIDC&#x2F;OAuth2.0 åŸºç¡€çŸ¥è¯†</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯OIDCï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯OIDCï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯OIDCï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯OIDCï¼Ÿ</h3><p>OpenID Connect (OIDC) æ˜¯å»ºç«‹åœ¨OAuth 2.0åè®®ä¹‹ä¸Šçš„èº«ä»½éªŒè¯å±‚ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéªŒè¯ç»ˆç«¯ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶è·å–åŸºæœ¬çš„ç”¨æˆ·é…ç½®ä¿¡æ¯ã€‚OIDCçš„ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼è®©åº”ç”¨ç¨‹åºèƒ½å¤ŸéªŒè¯ç”¨æˆ·èº«ä»½ã€‚</p><h3 id="1-2-OAuth-2-0-ä¸-OIDC-çš„å…³ç³»"><a href="#1-2-OAuth-2-0-ä¸-OIDC-çš„å…³ç³»" class="headerlink" title="1.2 OAuth 2.0 ä¸ OIDC çš„å…³ç³»"></a>1.2 OAuth 2.0 ä¸ OIDC çš„å…³ç³»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1.è¯·æ±‚è®¿é—®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   å®¢æˆ·ç«¯åº”ç”¨  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  èµ„æºæ‰€æœ‰è€…(ç”¨æˆ·) â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                               â”‚</span><br><span class="line">       â”‚ 2.æˆæƒè¯·æ±‚                    â”‚</span><br><span class="line">       â–¼                               â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ æˆæƒæœåŠ¡å™¨  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  èµ„æºæœåŠ¡å™¨   â”‚</span><br><span class="line">â”‚ (å¦‚Azure AD) â”‚                  â”‚ (å¦‚Graph API) â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                               â”‚</span><br><span class="line">       â”‚ 3.è¿”å›è®¿é—®ä»¤ç‰Œ                â”‚</span><br><span class="line">       â–¼                               â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    4.è®¿é—®èµ„æº      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   å®¢æˆ·ç«¯åº”ç”¨  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  èµ„æºæœåŠ¡å™¨   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="1-3-OIDC-è®¤è¯æµç¨‹æ—¶åºå›¾"><a href="#1-3-OIDC-è®¤è¯æµç¨‹æ—¶åºå›¾" class="headerlink" title="1.3 OIDC è®¤è¯æµç¨‹æ—¶åºå›¾"></a>1.3 OIDC è®¤è¯æµç¨‹æ—¶åºå›¾</h3><pre class="mermaid">sequenceDiagram    participant U as ç”¨æˆ·    participant C as å®¢æˆ·ç«¯åº”ç”¨    participant AS as æˆæƒæœåŠ¡å™¨    participant RS as èµ„æºæœåŠ¡å™¨    U->>C: 1. è®¿é—®åº”ç”¨    C->>U: 2. é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨    U->>AS: 3. ç”¨æˆ·è®¤è¯    AS->>U: 4. ç”¨æˆ·æˆæƒåŒæ„    U->>C: 5. é‡å®šå‘å›å®¢æˆ·ç«¯(æˆæƒç )    C->>AS: 6. äº¤æ¢è®¿é—®ä»¤ç‰Œ    AS->>C: 7. è¿”å›è®¿é—®ä»¤ç‰Œ    C->>RS: 8. è®¿é—®å—ä¿æŠ¤èµ„æº    RS->>C: 9. è¿”å›èµ„æºæ•°æ®</pre><p>OIDCè®¤è¯æµç¨‹çš„è¯¦ç»†æ­¥éª¤ï¼š</p><ol><li>ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯åº”ç”¨</li><li>å®¢æˆ·ç«¯åº”ç”¨é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨</li><li>ç”¨æˆ·åœ¨æˆæƒæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯</li><li>æˆæƒæœåŠ¡å™¨å‘ç”¨æˆ·è¯·æ±‚æˆæƒåŒæ„</li><li>ç”¨æˆ·æˆæƒåï¼Œé‡å®šå‘å›å®¢æˆ·ç«¯åº”ç”¨ï¼ˆæºå¸¦æˆæƒç ï¼‰</li><li>å®¢æˆ·ç«¯åº”ç”¨ä½¿ç”¨æˆæƒç å‘æˆæƒæœåŠ¡å™¨è¯·æ±‚è®¿é—®ä»¤ç‰Œ</li><li>æˆæƒæœåŠ¡å™¨è¿”å›è®¿é—®ä»¤ç‰Œç»™å®¢æˆ·ç«¯åº”ç”¨</li><li>å®¢æˆ·ç«¯åº”ç”¨ä½¿ç”¨è®¿é—®ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡å™¨</li><li>èµ„æºæœåŠ¡å™¨è¿”å›è¯·æ±‚çš„èµ„æºæ•°æ®</li></ol><h3 id="1-4-å…³é”®æ¦‚å¿µ"><a href="#1-4-å…³é”®æ¦‚å¿µ" class="headerlink" title="1.4 å…³é”®æ¦‚å¿µ"></a>1.4 å…³é”®æ¦‚å¿µ</h3><h4 id="1-4-1-Scopeï¼ˆæƒé™èŒƒå›´ï¼‰"><a href="#1-4-1-Scopeï¼ˆæƒé™èŒƒå›´ï¼‰" class="headerlink" title="1.4.1 Scopeï¼ˆæƒé™èŒƒå›´ï¼‰"></a>1.4.1 Scopeï¼ˆæƒé™èŒƒå›´ï¼‰</h4><p>Scopeå®šä¹‰äº†å®¢æˆ·ç«¯åº”ç”¨è¯·æ±‚è®¿é—®çš„æƒé™èŒƒå›´ï¼š</p><ul><li><code>openid</code>ï¼šå¿…éœ€ï¼Œè¡¨ç¤ºä½¿ç”¨OIDC</li><li><code>profile</code>ï¼šè®¿é—®ç”¨æˆ·åŸºæœ¬ä¿¡æ¯</li><li><code>email</code>ï¼šè®¿é—®ç”¨æˆ·é‚®ç®±</li><li><code>User.Read</code>ï¼šè¯»å–ç”¨æˆ·ä¿¡æ¯ï¼ˆMicrosoft Graphï¼‰</li><li><code>Group.Read.All</code>ï¼šè¯»å–æ‰€æœ‰ç»„ä¿¡æ¯ï¼ˆéœ€è¦ç®¡ç†å‘˜åŒæ„ï¼‰</li></ul><h4 id="1-4-2-Prompt-å‚æ•°"><a href="#1-4-2-Prompt-å‚æ•°" class="headerlink" title="1.4.2 Prompt å‚æ•°"></a>1.4.2 Prompt å‚æ•°</h4><p>Promptå‚æ•°æ§åˆ¶æˆæƒæœåŠ¡å™¨å¦‚ä½•ä¸ç”¨æˆ·äº¤äº’ï¼š</p><ul><li><code>none</code>ï¼šä¸æ˜¾ç¤ºä»»ä½•UIç•Œé¢</li><li><code>login</code>ï¼šå¼ºåˆ¶ç”¨æˆ·é‡æ–°è®¤è¯</li><li><code>consent</code>ï¼šå¼ºåˆ¶æ˜¾ç¤ºåŒæ„ç•Œé¢</li><li><code>select_account</code>ï¼šæ˜¾ç¤ºè´¦æˆ·é€‰æ‹©ç•Œé¢</li></ul><h2 id="2-é—®é¢˜ç°è±¡"><a href="#2-é—®é¢˜ç°è±¡" class="headerlink" title="2. é—®é¢˜ç°è±¡"></a>2. é—®é¢˜ç°è±¡</h2><h3 id="2-1-æ•…éšœæè¿°"><a href="#2-1-æ•…éšœæè¿°" class="headerlink" title="2.1 æ•…éšœæè¿°"></a>2.1 æ•…éšœæè¿°</h3><p>åœ¨ä»»ä½•ä½¿ç”¨OIDCä¸èº«ä»½æä¾›å•†ï¼ˆå¦‚Azure ADã€Googleã€Oktaç­‰ï¼‰é›†æˆçš„ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·é€šè¿‡OIDCç™»å½•æ—¶é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œèº«ä»½æä¾›å•†æ˜¾ç¤ºâ€Need admin approvalâ€é”™è¯¯</li><li>ç™»å½•æµç¨‹ä¸­æ–­ï¼Œç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿ</li></ul><h3 id="2-2-çŸ›ç›¾ç°è±¡"><a href="#2-2-çŸ›ç›¾ç°è±¡" class="headerlink" title="2.2 çŸ›ç›¾ç°è±¡"></a>2.2 çŸ›ç›¾ç°è±¡</h3><p>ç„¶è€Œï¼Œä½¿ç”¨ç›¸åŒçš„è®¿é—®ä»¤ç‰Œåœ¨ç‹¬ç«‹å·¥å…·ä¸­ï¼š</p><ul><li>æ‰€æœ‰APIåŠŸèƒ½æ­£å¸¸å·¥ä½œ</li><li>å¯ä»¥æˆåŠŸè®¿é—®éœ€è¦é«˜çº§æƒé™çš„èµ„æº</li><li>æƒé™éªŒè¯å®Œå…¨é€šè¿‡</li></ul><h2 id="3-æ•…éšœæ’æŸ¥è¿‡ç¨‹"><a href="#3-æ•…éšœæ’æŸ¥è¿‡ç¨‹" class="headerlink" title="3. æ•…éšœæ’æŸ¥è¿‡ç¨‹"></a>3. æ•…éšœæ’æŸ¥è¿‡ç¨‹</h2><h3 id="3-1-åˆæ­¥åˆ†æï¼ˆé”™è¯¯æ–¹å‘ï¼‰"><a href="#3-1-åˆæ­¥åˆ†æï¼ˆé”™è¯¯æ–¹å‘ï¼‰" class="headerlink" title="3.1 åˆæ­¥åˆ†æï¼ˆé”™è¯¯æ–¹å‘ï¼‰"></a>3.1 åˆæ­¥åˆ†æï¼ˆé”™è¯¯æ–¹å‘ï¼‰</h3><p>åŸºäºè¡¨é¢ç°è±¡ï¼Œæˆ‘ä»¬æœ€åˆçš„å‡è®¾æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OIDCæµç¨‹å¤±è´¥ â†’ æƒé™ä¸è¶³ â†’ éœ€è¦ç®¡ç†å‘˜åŒæ„</span><br></pre></td></tr></table></figure><p>å°è¯•çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æ£€æŸ¥èº«ä»½æä¾›å•†ä¸­çš„APIæƒé™é…ç½®</li><li>ç§»é™¤éœ€è¦ç®¡ç†å‘˜åŒæ„çš„æƒé™èŒƒå›´ï¼ˆå¦‚<code>Group.Read.All</code>ï¼‰</li><li>éªŒè¯ä»¤ç‰Œå†…å®¹å’Œæƒé™èŒƒå›´</li></ol><h3 id="3-2-å…³é”®ä¿¡æ¯æ¾„æ¸…"><a href="#3-2-å…³é”®ä¿¡æ¯æ¾„æ¸…" class="headerlink" title="3.2 å…³é”®ä¿¡æ¯æ¾„æ¸…"></a>3.2 å…³é”®ä¿¡æ¯æ¾„æ¸…</h3><p>ç»è¿‡æ·±å…¥æ²Ÿé€šï¼Œå‘ç°äº†å…³é”®äº‹å®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OIDCè®¤è¯æµç¨‹ä¸­ç§»é™¤éœ€è¦ç®¡ç†å‘˜åŒæ„çš„scope â†’ è®¤è¯æˆåŠŸ</span><br><span class="line">ä½¿ç”¨æˆåŠŸè·å–çš„ä»¤ç‰Œ â†’ èƒ½è®¿é—®é«˜çº§æƒé™èµ„æºï¼ˆæœ¬ä¸åº”æœ‰æ­¤æƒé™ï¼‰</span><br></pre></td></tr></table></figure><p>è¿™è®©æˆ‘ä»¬æ„è¯†åˆ°é—®é¢˜ä¸åœ¨æƒé™èŒƒå›´æœ¬èº«ï¼Œè€Œåœ¨äºè®¤è¯æµç¨‹çš„æ§åˆ¶æœºåˆ¶ã€‚</p><h3 id="3-3-çªç ´æ€§å‘ç°"><a href="#3-3-çªç ´æ€§å‘ç°" class="headerlink" title="3.3 çªç ´æ€§å‘ç°"></a>3.3 çªç ´æ€§å‘ç°</h3><p>æœ€ç»ˆå‘ç°é—®é¢˜æ ¹æºåœ¨äºå®¢æˆ·ç«¯åº”ç”¨çš„OIDCé…ç½®ä¸­çš„<code>Authorization Prompt</code>å‚æ•°ã€‚</p><h2 id="4-æ ¹æœ¬åŸå› åˆ†æ"><a href="#4-æ ¹æœ¬åŸå› åˆ†æ" class="headerlink" title="4. æ ¹æœ¬åŸå› åˆ†æ"></a>4. æ ¹æœ¬åŸå› åˆ†æ</h2><h3 id="4-1-é—®é¢˜æœ¬è´¨"><a href="#4-1-é—®é¢˜æœ¬è´¨" class="headerlink" title="4.1 é—®é¢˜æœ¬è´¨"></a>4.1 é—®é¢˜æœ¬è´¨</h3><p>é—®é¢˜å¹¶éæƒé™ç¼ºå¤±ï¼Œè€Œæ˜¯OIDCæµç¨‹æ§åˆ¶å‚æ•°é…ç½®ä¸å½“å¯¼è‡´çš„æµç¨‹å†²çªã€‚</p><h3 id="4-2-æŠ€æœ¯ç»†èŠ‚"><a href="#4-2-æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="4.2 æŠ€æœ¯ç»†èŠ‚"></a>4.2 æŠ€æœ¯ç»†èŠ‚</h3><h4 id="4-2-1-é”™è¯¯é…ç½®ï¼šprompt-consent"><a href="#4-2-1-é”™è¯¯é…ç½®ï¼šprompt-consent" class="headerlink" title="4.2.1 é”™è¯¯é…ç½®ï¼šprompt=consent"></a>4.2.1 é”™è¯¯é…ç½®ï¼š<code>prompt=consent</code></h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET https://login.microsoftonline.com/&#123;tenant&#125;/oauth2/v2.0/authorize?</span><br><span class="line">  client_id=&#123;client_id&#125;&amp;</span><br><span class="line">  response_type=code&amp;</span><br><span class="line">  redirect_uri=&#123;redirect_uri&#125;&amp;</span><br><span class="line">  scope=openid profile email User.Read Group.Read.All&amp;</span><br><span class="line">  prompt=consent  // é—®é¢˜æ ¹æº</span><br></pre></td></tr></table></figure><p><strong>è¡Œä¸º</strong>ï¼šå¼ºåˆ¶æ˜¾ç¤ºæƒé™åŒæ„ç•Œé¢<br><strong>å†²çª</strong>ï¼šç§Ÿæˆ·ç­–ç•¥ç¦æ­¢æ™®é€šç”¨æˆ·æ‰§è¡ŒåŒæ„æ“ä½œ</p><h4 id="4-2-2-æ­£ç¡®é…ç½®ï¼šprompt-select-account"><a href="#4-2-2-æ­£ç¡®é…ç½®ï¼šprompt-select-account" class="headerlink" title="4.2.2 æ­£ç¡®é…ç½®ï¼šprompt=select_account"></a>4.2.2 æ­£ç¡®é…ç½®ï¼š<code>prompt=select_account</code></h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET https://login.microsoftonline.com/&#123;tenant&#125;/oauth2/v2.0/authorize?</span><br><span class="line">  client_id=&#123;client_id&#125;&amp;</span><br><span class="line">  response_type=code&amp;</span><br><span class="line">  redirect_uri=&#123;redirect_uri&#125;&amp;</span><br><span class="line">  scope=openid profile email User.Read Group.Read.All&amp;</span><br><span class="line">  prompt=select_account  // æ­£ç¡®é…ç½®</span><br></pre></td></tr></table></figure><p><strong>è¡Œä¸º</strong>ï¼šæ™ºèƒ½æ£€æŸ¥æƒé™çŠ¶æ€ï¼Œå·²æ»¡è¶³åˆ™è·³è¿‡åŒæ„ç•Œé¢</p><h3 id="4-3-æµç¨‹å¯¹æ¯”"><a href="#4-3-æµç¨‹å¯¹æ¯”" class="headerlink" title="4.3 æµç¨‹å¯¹æ¯”"></a>4.3 æµç¨‹å¯¹æ¯”</h3><h4 id="4-3-1-é”™è¯¯æµç¨‹"><a href="#4-3-1-é”™è¯¯æµç¨‹" class="headerlink" title="4.3.1 é”™è¯¯æµç¨‹"></a>4.3.1 é”™è¯¯æµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ· â†’ å®¢æˆ·ç«¯åº”ç”¨ â†’ èº«ä»½æä¾›å•† (prompt=consent) â†’ æ˜¾ç¤ºåŒæ„ç•Œé¢ â†’ ç”¨æˆ·æ— æ³•æ“ä½œ â†’ å¤±è´¥</span><br></pre></td></tr></table></figure><h4 id="4-3-2-æ­£ç¡®æµç¨‹"><a href="#4-3-2-æ­£ç¡®æµç¨‹" class="headerlink" title="4.3.2 æ­£ç¡®æµç¨‹"></a>4.3.2 æ­£ç¡®æµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ· â†’ å®¢æˆ·ç«¯åº”ç”¨ â†’ èº«ä»½æä¾›å•† (prompt=select_account) â†’ æ£€æŸ¥æƒé™ â†’ å·²æ»¡è¶³ â†’ é¢å‘ä»¤ç‰Œ â†’ æˆåŠŸ</span><br></pre></td></tr></table></figure><h2 id="5-è§£å†³æ–¹æ¡ˆ"><a href="#5-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="5. è§£å†³æ–¹æ¡ˆ"></a>5. è§£å†³æ–¹æ¡ˆ</h2><h3 id="5-1-é€šç”¨è§£å†³æ­¥éª¤"><a href="#5-1-é€šç”¨è§£å†³æ­¥éª¤" class="headerlink" title="5.1 é€šç”¨è§£å†³æ­¥éª¤"></a>5.1 é€šç”¨è§£å†³æ­¥éª¤</h3><h4 id="æ­¥éª¤1ï¼šæ£€æŸ¥åº”ç”¨é…ç½®"><a href="#æ­¥éª¤1ï¼šæ£€æŸ¥åº”ç”¨é…ç½®" class="headerlink" title="æ­¥éª¤1ï¼šæ£€æŸ¥åº”ç”¨é…ç½®"></a>æ­¥éª¤1ï¼šæ£€æŸ¥åº”ç”¨é…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•å®¢æˆ·ç«¯åº”ç”¨ç®¡ç†åå°</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2ï¼šæ‰¾åˆ°OIDCé…ç½®"><a href="#æ­¥éª¤2ï¼šæ‰¾åˆ°OIDCé…ç½®" class="headerlink" title="æ­¥éª¤2ï¼šæ‰¾åˆ°OIDCé…ç½®"></a>æ­¥éª¤2ï¼šæ‰¾åˆ°OIDCé…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¯¼èˆªåˆ°èº«ä»½éªŒè¯æˆ–è®¤è¯è®¾ç½®</span><br><span class="line">æ‰¾åˆ°OIDCç›¸å…³é…ç½®</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3ï¼šä¿®æ”¹Authorization-Promptå‚æ•°"><a href="#æ­¥éª¤3ï¼šä¿®æ”¹Authorization-Promptå‚æ•°" class="headerlink" title="æ­¥éª¤3ï¼šä¿®æ”¹Authorization Promptå‚æ•°"></a>æ­¥éª¤3ï¼šä¿®æ”¹Authorization Promptå‚æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ‰¾åˆ°&quot;Authorization Prompt&quot;å­—æ®µ</span><br><span class="line">å°†å€¼ä»&quot;consent&quot;ä¿®æ”¹ä¸º&quot;select_account&quot;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤4ï¼šä¿å­˜é…ç½®"><a href="#æ­¥éª¤4ï¼šä¿å­˜é…ç½®" class="headerlink" title="æ­¥éª¤4ï¼šä¿å­˜é…ç½®"></a>æ­¥éª¤4ï¼šä¿å­˜é…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‚¹å‡»ä¿å­˜æŒ‰é’®</span><br><span class="line">é…ç½®ç«‹å³ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><h3 id="5-2-éªŒè¯ç»“æœ"><a href="#5-2-éªŒè¯ç»“æœ" class="headerlink" title="5.2 éªŒè¯ç»“æœ"></a>5.2 éªŒè¯ç»“æœ</h3><p>ä¿®æ”¹åï¼ŒOIDCç™»å½•æµç¨‹æ¢å¤æ­£å¸¸ï¼š</p><ul><li>ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ç³»ç»Ÿ</li><li>ä¸å†æ˜¾ç¤ºâ€Need admin approvalâ€é”™è¯¯</li><li>ç³»ç»Ÿå¯ä»¥æ­£å¸¸è®¿é—®å—ä¿æŠ¤çš„APIèµ„æº</li></ul><h2 id="6-æŠ€æœ¯æ·±åº¦è§£æ"><a href="#6-æŠ€æœ¯æ·±åº¦è§£æ" class="headerlink" title="6. æŠ€æœ¯æ·±åº¦è§£æ"></a>6. æŠ€æœ¯æ·±åº¦è§£æ</h2><h3 id="6-1-Promptå‚æ•°è¯¦è§£"><a href="#6-1-Promptå‚æ•°è¯¦è§£" class="headerlink" title="6.1 Promptå‚æ•°è¯¦è§£"></a>6.1 Promptå‚æ•°è¯¦è§£</h3><h4 id="6-1-1-prompt-none"><a href="#6-1-1-prompt-none" class="headerlink" title="6.1.1 prompt=none"></a>6.1.1 <code>prompt=none</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€‚ç”¨äºåå°é™é»˜è®¤è¯</span></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦ç”¨æˆ·äº¤äº’ï¼Œç«‹å³è¿”å›é”™è¯¯</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://login.microsoftonline.com/tenant/oauth2/v2.0/authorize&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="6-1-2-prompt-login"><a href="#6-1-2-prompt-login" class="headerlink" title="6.1.2 prompt=login"></a>6.1.2 <code>prompt=login</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼ºåˆ¶ç”¨æˆ·é‡æ–°è¾“å…¥å‡­æ®</span></span><br><span class="line"><span class="comment">// é€‚ç”¨äºé«˜å®‰å…¨è¦æ±‚åœºæ™¯</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://login.microsoftonline.com/tenant/oauth2/v2.0/authorize&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="string">&#x27;login&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="6-1-3-prompt-consent"><a href="#6-1-3-prompt-consent" class="headerlink" title="6.1.3 prompt=consent"></a>6.1.3 <code>prompt=consent</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼ºåˆ¶æ˜¾ç¤ºåŒæ„ç•Œé¢</span></span><br><span class="line"><span class="comment">// é€‚ç”¨äºéœ€è¦ç”¨æˆ·æ˜ç¡®æˆæƒçš„åœºæ™¯</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://login.microsoftonline.com/tenant/oauth2/v2.0/authorize&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="string">&#x27;consent&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="6-1-4-prompt-select-account"><a href="#6-1-4-prompt-select-account" class="headerlink" title="6.1.4 prompt=select_account"></a>6.1.4 <code>prompt=select_account</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ˜¾ç¤ºè´¦æˆ·é€‰æ‹©ç•Œé¢ï¼Œæ™ºèƒ½å¤„ç†æƒé™</span></span><br><span class="line"><span class="comment">// æœ€ä½³å®è·µé…ç½®</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://login.microsoftonline.com/tenant/oauth2/v2.0/authorize&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="string">&#x27;select_account&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="6-2-æƒé™åŒæ„æœºåˆ¶"><a href="#6-2-æƒé™åŒæ„æœºåˆ¶" class="headerlink" title="6.2 æƒé™åŒæ„æœºåˆ¶"></a>6.2 æƒé™åŒæ„æœºåˆ¶</h3><h4 id="6-2-1-ç®¡ç†å‘˜åŒæ„"><a href="#6-2-1-ç®¡ç†å‘˜åŒæ„" class="headerlink" title="6.2.1 ç®¡ç†å‘˜åŒæ„"></a>6.2.1 ç®¡ç†å‘˜åŒæ„</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®¡ç†å‘˜åœ¨èº«ä»½æä¾›å•†ç®¡ç†é—¨æˆ·ä¸­ä¸ºåº”ç”¨æˆäºˆæƒé™</span></span><br><span class="line"><span class="comment">// é€‚ç”¨äºéœ€è¦é«˜æƒé™çš„scope</span></span><br><span class="line"><span class="comment">// ä¸€æ¬¡è®¾ç½®ï¼Œå…¨å±€ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><h4 id="6-2-2-ç”¨æˆ·åŒæ„"><a href="#6-2-2-ç”¨æˆ·åŒæ„" class="headerlink" title="6.2.2 ç”¨æˆ·åŒæ„"></a>6.2.2 ç”¨æˆ·åŒæ„</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šç”¨æˆ·åœ¨è®¤è¯æ—¶åŒæ„æƒé™è¯·æ±‚</span></span><br><span class="line"><span class="comment">// é€‚ç”¨äºåŸºæœ¬æƒé™</span></span><br><span class="line"><span class="comment">// å—ç§Ÿæˆ·ç­–ç•¥é™åˆ¶</span></span><br></pre></td></tr></table></figure><h3 id="6-3-ä¸åŒå¹³å°çš„é…ç½®ç¤ºä¾‹"><a href="#6-3-ä¸åŒå¹³å°çš„é…ç½®ç¤ºä¾‹" class="headerlink" title="6.3 ä¸åŒå¹³å°çš„é…ç½®ç¤ºä¾‹"></a>6.3 ä¸åŒå¹³å°çš„é…ç½®ç¤ºä¾‹</h3><h4 id="6-3-1-EspoCRM"><a href="#6-3-1-EspoCRM" class="headerlink" title="6.3.1 EspoCRM"></a>6.3.1 EspoCRM</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Administration &gt; Authentication &gt; OIDC</span></span><br><span class="line"><span class="comment">// Authorization Prompt: select_account</span></span><br></pre></td></tr></table></figure><h4 id="6-3-2-Djangoåº”ç”¨"><a href="#6-3-2-Djangoåº”ç”¨" class="headerlink" title="6.3.2 Djangoåº”ç”¨"></a>6.3.2 Djangoåº”ç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">SOCIAL_AUTH_LOGIN_REDIRECT_URL = <span class="string">&#x27;/dashboard/&#x27;</span></span><br><span class="line">SOCIAL_AUTH_LOGIN_ERROR_URL = <span class="string">&#x27;/login/error/&#x27;</span></span><br><span class="line">SOCIAL_AUTH_LOGIN_URL = <span class="string">&#x27;/login/&#x27;</span></span><br><span class="line">SOCIAL_AUTH_OAUTH2_SCOPE = [<span class="string">&#x27;openid&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;email&#x27;</span>]</span><br><span class="line">SOCIAL_AUTH_OAUTH2_PROMPT = <span class="string">&#x27;select_account&#x27;</span>  <span class="comment"># å…³é”®é…ç½®</span></span><br></pre></td></tr></table></figure><h4 id="6-3-3-Node-jsåº”ç”¨-Passport-js"><a href="#6-3-3-Node-jsåº”ç”¨-Passport-js" class="headerlink" title="6.3.3 Node.jsåº”ç”¨ (Passport.js)"></a>6.3.3 Node.jsåº”ç”¨ (Passport.js)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OIDCStrategy</span> = <span class="built_in">require</span>(<span class="string">&#x27;passport-azure-ad&#x27;</span>).<span class="property">OIDCStrategy</span>;</span><br><span class="line"></span><br><span class="line">passport.<span class="title function_">use</span>(<span class="keyword">new</span> <span class="title class_">OIDCStrategy</span>(&#123;</span><br><span class="line">  <span class="attr">identityMetadata</span>: config.<span class="property">creds</span>.<span class="property">identityMetadata</span>,</span><br><span class="line">  <span class="attr">clientID</span>: config.<span class="property">creds</span>.<span class="property">clientID</span>,</span><br><span class="line">  <span class="attr">redirectUrl</span>: config.<span class="property">creds</span>.<span class="property">redirectUrl</span>,</span><br><span class="line">  <span class="attr">responseType</span>: <span class="string">&#x27;code&#x27;</span>,</span><br><span class="line">  <span class="attr">responseMode</span>: <span class="string">&#x27;form_post&#x27;</span>,</span><br><span class="line">  <span class="attr">scope</span>: [<span class="string">&#x27;openid&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;email&#x27;</span>],</span><br><span class="line">  <span class="attr">prompt</span>: <span class="string">&#x27;select_account&#x27;</span>,  <span class="comment">// å…³é”®é…ç½®</span></span><br><span class="line">  <span class="attr">loggingLevel</span>: <span class="string">&#x27;info&#x27;</span></span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">iss, sub, profile, accessToken, refreshToken, done</span>) &#123;</span><br><span class="line">  <span class="comment">// å¤„ç†è®¤è¯æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, profile);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h4 id="6-3-4-Spring-Bootåº”ç”¨"><a href="#6-3-4-Spring-Bootåº”ç”¨" class="headerlink" title="6.3.4 Spring Bootåº”ç”¨"></a>6.3.4 Spring Bootåº”ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// application.yml</span></span><br><span class="line">spring:</span><br><span class="line">  security:</span><br><span class="line">    oauth2:</span><br><span class="line">      client:</span><br><span class="line">        registration:</span><br><span class="line">          azure:</span><br><span class="line">            client-id: $&#123;AZURE_CLIENT_ID&#125;</span><br><span class="line">            client-secret: $&#123;AZURE_CLIENT_SECRET&#125;</span><br><span class="line">            provider: azure</span><br><span class="line">            scope: openid,profile,email</span><br><span class="line">            authorization-uri: https:<span class="comment">//login.microsoftonline.com/&#123;tenant&#125;/oauth2/v2.0/authorize?prompt=select_account  // å…³é”®é…ç½®</span></span><br><span class="line">        provider:</span><br><span class="line">          azure:</span><br><span class="line">            issuer-uri: https:<span class="comment">//login.microsoftonline.com/&#123;tenant&#125;/v2.0</span></span><br></pre></td></tr></table></figure><h2 id="7-ç»éªŒæ•™è®­"><a href="#7-ç»éªŒæ•™è®­" class="headerlink" title="7. ç»éªŒæ•™è®­"></a>7. ç»éªŒæ•™è®­</h2><h3 id="7-1-æŠ€æœ¯å±‚é¢"><a href="#7-1-æŠ€æœ¯å±‚é¢" class="headerlink" title="7.1 æŠ€æœ¯å±‚é¢"></a>7.1 æŠ€æœ¯å±‚é¢</h3><ol><li><strong>Promptå‚æ•°çš„é‡è¦æ€§</strong>ï¼šåœ¨OIDC&#x2F;OAuth2.0é—®é¢˜æ’æŸ¥ä¸­ï¼Œpromptå‚æ•°åº”ä½œä¸ºé¦–è¦æ£€æŸ¥ç‚¹</li><li><strong>æƒé™çš„å¤šå±‚æ¬¡æ€§</strong>ï¼šç†è§£ç®¡ç†å‘˜åŒæ„ã€ç”¨æˆ·åŒæ„å’Œåº”ç”¨æ³¨å†Œä¹‹é—´çš„åŒºåˆ«</li><li><strong>æµç¨‹æ§åˆ¶vsæƒé™èŒƒå›´</strong>ï¼šåŒºåˆ†æµç¨‹æ§åˆ¶å‚æ•°å’Œæƒé™èŒƒå›´å‚æ•°çš„ä½œç”¨</li></ol><h3 id="7-2-è¯Šæ–­æ–¹æ³•"><a href="#7-2-è¯Šæ–­æ–¹æ³•" class="headerlink" title="7.2 è¯Šæ–­æ–¹æ³•"></a>7.2 è¯Šæ–­æ–¹æ³•</h3><ol><li><strong>å‡†ç¡®æè¿°é—®é¢˜</strong>ï¼šé—®é¢˜çš„å‡†ç¡®æè¿°å¯¹è¯Šæ–­è‡³å…³é‡è¦</li><li><strong>é€æ­¥æ’é™¤å‡è®¾</strong>ï¼šä»è¡¨è±¡åˆ°æœ¬è´¨ï¼Œé€æ­¥æ’é™¤é”™è¯¯å‡è®¾</li><li><strong>å…³æ³¨IdPç­–ç•¥</strong>ï¼šåŒæ—¶è€ƒè™‘åº”ç”¨ç«¯é…ç½®å’ŒIdPç«¯ç­–ç•¥</li></ol><h3 id="7-3-æœ€ä½³å®è·µ"><a href="#7-3-æœ€ä½³å®è·µ" class="headerlink" title="7.3 æœ€ä½³å®è·µ"></a>7.3 æœ€ä½³å®è·µ</h3><ol><li><strong>é»˜è®¤ä½¿ç”¨<code>select_account</code></strong>ï¼šé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™æ¨èä½¿ç”¨<code>select_account</code></li><li><strong>æƒé™æœ€å°åŒ–åŸåˆ™</strong>ï¼šåªè¯·æ±‚å¿…éœ€çš„æƒé™èŒƒå›´</li><li><strong>å®šæœŸå®¡æŸ¥é…ç½®</strong>ï¼šå®šæœŸæ£€æŸ¥OIDCé…ç½®å‚æ•°çš„åˆç†æ€§</li></ol><h2 id="8-é¢„é˜²æªæ–½"><a href="#8-é¢„é˜²æªæ–½" class="headerlink" title="8. é¢„é˜²æªæ–½"></a>8. é¢„é˜²æªæ–½</h2><h3 id="8-1-é…ç½®æ£€æŸ¥æ¸…å•"><a href="#8-1-é…ç½®æ£€æŸ¥æ¸…å•" class="headerlink" title="8.1 é…ç½®æ£€æŸ¥æ¸…å•"></a>8.1 é…ç½®æ£€æŸ¥æ¸…å•</h3><ul><li><input disabled type="checkbox"> Authorization Promptå‚æ•°è®¾ç½®ä¸º<code>select_account</code></li><li><input disabled type="checkbox"> ScopeåªåŒ…å«å¿…éœ€çš„æƒé™èŒƒå›´</li><li><input disabled type="checkbox"> ç®¡ç†å‘˜åŒæ„å·²æ­£ç¡®æˆäºˆ</li><li><input disabled type="checkbox"> é‡å®šå‘URIé…ç½®æ­£ç¡®</li><li><input disabled type="checkbox"> å®¢æˆ·ç«¯å¯†é’¥å®‰å…¨å­˜å‚¨</li></ul><h3 id="8-2-ç›‘æ§å»ºè®®"><a href="#8-2-ç›‘æ§å»ºè®®" class="headerlink" title="8.2 ç›‘æ§å»ºè®®"></a>8.2 ç›‘æ§å»ºè®®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘æ§OIDCç™»å½•å¤±è´¥æ—¥å¿—</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/application/oidc.log | grep <span class="string">&quot;admin approval&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥èº«ä»½æä¾›å•†å®¡è®¡æ—¥å¿—</span></span><br><span class="line"><span class="comment"># å…·ä½“å‘½ä»¤æ ¹æ®ä¸åŒçš„IdPè€Œå¼‚</span></span><br></pre></td></tr></table></figure><h3 id="8-3-æ•…éšœæ¢å¤é¢„æ¡ˆ"><a href="#8-3-æ•…éšœæ¢å¤é¢„æ¡ˆ" class="headerlink" title="8.3 æ•…éšœæ¢å¤é¢„æ¡ˆ"></a>8.3 æ•…éšœæ¢å¤é¢„æ¡ˆ</h3><ol><li><strong>å¿«é€Ÿå›æ»š</strong>ï¼šå‡†å¤‡é…ç½®å›æ»šæ–¹æ¡ˆ</li><li><strong>å¤‡ç”¨ç™»å½•</strong>ï¼šç¡®ä¿æœ‰å¤‡ç”¨ç™»å½•æ–¹å¼</li><li><strong>ç”¨æˆ·é€šçŸ¥</strong>ï¼šåŠæ—¶é€šçŸ¥ç”¨æˆ·æ•…éšœçŠ¶æ€</li></ol><h2 id="9-ä¸åŒèº«ä»½æä¾›å•†çš„ç‰¹æ®Šè€ƒè™‘"><a href="#9-ä¸åŒèº«ä»½æä¾›å•†çš„ç‰¹æ®Šè€ƒè™‘" class="headerlink" title="9. ä¸åŒèº«ä»½æä¾›å•†çš„ç‰¹æ®Šè€ƒè™‘"></a>9. ä¸åŒèº«ä»½æä¾›å•†çš„ç‰¹æ®Šè€ƒè™‘</h2><h3 id="9-1-Azure-AD"><a href="#9-1-Azure-AD" class="headerlink" title="9.1 Azure AD"></a>9.1 Azure AD</h3><ul><li>ç®¡ç†å‘˜åŒæ„é€šè¿‡Azureé—¨æˆ·é…ç½®</li><li>æ”¯æŒ<code>prompt</code>å‚æ•°</li><li>éœ€è¦æ­£ç¡®é…ç½®APIæƒé™</li></ul><h3 id="9-2-Google-Identity"><a href="#9-2-Google-Identity" class="headerlink" title="9.2 Google Identity"></a>9.2 Google Identity</h3><ul><li>é€šè¿‡Google Cloud Consoleç®¡ç†</li><li>åŒæ ·æ¶‰åŠç®¡ç†å‘˜åŒæ„æµç¨‹</li><li>é…ç½®æ–¹å¼ç•¥æœ‰ä¸åŒ</li></ul><h3 id="9-3-Okta"><a href="#9-3-Okta" class="headerlink" title="9.3 Okta"></a>9.3 Okta</h3><ul><li>é€šè¿‡Admin Consoleé…ç½®</li><li>æ”¯æŒç±»ä¼¼çš„promptæœºåˆ¶</li><li>éœ€è¦é…ç½®åº”ç”¨æƒé™</li></ul><h3 id="9-4-Keycloak"><a href="#9-4-Keycloak" class="headerlink" title="9.4 Keycloak"></a>9.4 Keycloak</h3><ul><li>é€šè¿‡ç®¡ç†æ§åˆ¶å°é…ç½®</li><li>æ”¯æŒè‡ªå®šä¹‰è®¤è¯æµç¨‹</li><li>éœ€è¦é…ç½®å®¢æˆ·ç«¯èŒƒå›´</li></ul><h2 id="10-æ€»ç»“"><a href="#10-æ€»ç»“" class="headerlink" title="10. æ€»ç»“"></a>10. æ€»ç»“</h2><p>è¿™æ¬¡æ•…éšœæ’é™¤è¿‡ç¨‹å±•ç¤ºäº†å¤æ‚è®¤è¯é—®é¢˜çš„å…¸å‹ç‰¹å¾ï¼š</p><ol><li><strong>è¡¨è±¡ä¸æœ¬è´¨çš„å·®å¼‚</strong>ï¼šè¡¨é¢çœ‹ä¼¼æƒé™é—®é¢˜ï¼Œå®é™…æ˜¯æµç¨‹æ§åˆ¶é—®é¢˜</li><li><strong>å¤šå±‚å› ç´ å½±å“</strong>ï¼šæ¶‰åŠåº”ç”¨é…ç½®ã€IdPç­–ç•¥ã€ç”¨æˆ·æƒé™ç­‰å¤šä¸ªå±‚é¢</li><li><strong>è¯Šæ–­çš„é‡è¦æ€§</strong>ï¼šå‡†ç¡®çš„é—®é¢˜æè¿°å’Œé€æ­¥æ’æŸ¥æ˜¯è§£å†³é—®é¢˜çš„å…³é”®</li></ol><p>è¿™ä¸ªé—®é¢˜åœ¨ä»»ä½•ä½¿ç”¨OIDC&#x2F;OAuth2.0çš„ç³»ç»Ÿä¸­éƒ½å¯èƒ½é‡åˆ°ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>ä¼ä¸šç¯å¢ƒä¸­ï¼Œç§Ÿæˆ·ç­–ç•¥è¾ƒä¸ºä¸¥æ ¼</li><li>åº”ç”¨éœ€è¦è®¿é—®éœ€è¦ç®¡ç†å‘˜åŒæ„çš„é«˜çº§æƒé™</li><li>é…ç½®å‚æ•°è®¾ç½®ä¸å½“</li></ul><p>é€šè¿‡è¿™æ¬¡ç»éªŒï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å…·ä½“é—®é¢˜ï¼Œè¿˜åŠ æ·±äº†å¯¹OIDC&#x2F;OAuth2.0åè®®çš„ç†è§£ï¼Œä¸ºæœªæ¥å¤„ç†ç±»ä¼¼é—®é¢˜ç§¯ç´¯äº†å®è´µç»éªŒã€‚</p><h2 id="11-å‚è€ƒèµ„æ–™"><a href="#11-å‚è€ƒèµ„æ–™" class="headerlink" title="11. å‚è€ƒèµ„æ–™"></a>11. å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Specification</a></li><li><a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0 Authorization Framework</a></li><li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/">Microsoft Identity Platform Documentation</a></li><li><a href="https://developers.google.com/identity/">Google Identity Platform Documentation</a></li></ol><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡è¯¦ç»†è®°å½•äº†ä¸€æ¬¡OIDCè®¤è¯ç³»ç»Ÿä¸­é‡åˆ°çš„â€Need admin approvalâ€é—®é¢˜ã€‚ç”¨æˆ·åœ¨ç™»å½•æ—¶æŒç»­æ”¶åˆ°é”™è¯¯æç¤ºï¼Œä½†ä½¿ç”¨ç›¸åŒä»¤ç‰Œçš„ç‹¬ç«‹å·¥å…·å´èƒ½æ­£å¸¸å·¥ä½œã€‚ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°é—®é¢˜æ ¹æºåœ¨äºOIDCé…ç½®ä¸­çš„&lt;code&gt;Authorization Prompt&lt;/code&gt;å‚æ•°è®¾ç½®ä¸å½“&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>EspoCRM é€‰å‹è®°å½•ï¼šçº¦æŸã€PoC ä¸æ€»æˆæœ¬æ ¸ç®—</title>
    <link href="https://www.yzhu.name/2025/10/26/espocrm/00-why-espocrm/"/>
    <id>https://www.yzhu.name/2025/10/26/espocrm/00-why-espocrm/</id>
    <published>2025-10-26T00:00:00.000Z</published>
    <updated>2025-10-26T00:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚ç”¨åœºæ™¯ï¼šä¸­å°å›¢é˜Ÿã€éœ€è¦å®šåˆ¶å¼€å‘ã€åå¥½è‡ªæ‰˜ç®¡&#x2F;ç§æœ‰éƒ¨ç½²</p></blockquote><p>é€‰æ‹© CRM ä¸æ˜¯é€‰â€œåŠŸèƒ½æœ€å¼ºçš„â€ï¼Œè€Œæ˜¯é€‰â€œåœ¨ä½ çº¦æŸä¸‹é•¿æœŸæœ€çœå¿ƒçš„â€ã€‚å¾ˆå¤šå›¢é˜Ÿé€‰å‹ç¿»è½¦ï¼Œä¸æ˜¯å› ä¸ºåŠŸèƒ½ä¸å¤Ÿï¼Œè€Œæ˜¯å› ä¸ºå¿½ç•¥äº†ä¸‰ä»¶äº‹ï¼š<strong>å®šåˆ¶æˆæœ¬ã€è¿ç»´æˆæœ¬ã€åˆè§„æˆæœ¬</strong>ã€‚æœ¬æ–‡ç»™å‡ºä¸€å¥—å¯å¤ç”¨çš„é€‰å‹æ–¹æ³•ï¼Œå¹¶ç”¨ EspoCRM åšä¸€æ¬¡å®Œæ•´è½åœ°ã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul><li><strong>é€‰å‹æ ¸å¿ƒ</strong>ï¼šå…ˆé”å®šâ€œéå¦¥åéœ€æ±‚â€ï¼Œå†åš PoCï¼ˆæ¦‚å¿µéªŒè¯ï¼‰ä¸æˆæœ¬æ ¸ç®—</li><li><strong>æœ€ç»ˆé€‰æ‹©</strong>ï¼šEspoCRM 9.2.2+ å¼€æºç‰ˆï¼ˆè‡ªæ‰˜ç®¡ï¼‰</li><li><strong>å…³é”®ç†ç”±</strong>ï¼šå…ƒæ•°æ®é©±åŠ¨ã€å‡çº§å¯æ§ã€æ‰©å±•ç‚¹æ¸…æ™°ã€ç¤¾åŒºæ´»è·ƒ</li><li><strong>æå‰è­¦å‘Š</strong>ï¼šAGPLv3 åˆè§„ + ä¸­æ–‡æœ¬åœ°åŒ– + æŠ¥è¡¨&#x2F;ç§»åŠ¨ç«¯çŸ­æ¿è¦æå‰è®¾è®¡å…œåº•</li></ul><hr><h2 id="1-é€‰å‹æ ¸å¿ƒç»´åº¦"><a href="#1-é€‰å‹æ ¸å¿ƒç»´åº¦" class="headerlink" title="1. é€‰å‹æ ¸å¿ƒç»´åº¦"></a>1. é€‰å‹æ ¸å¿ƒç»´åº¦</h2><p>é€‰æ‹© CRM å‰ï¼Œå…ˆæ˜ç¡®ä½ çš„â€œéå¦¥åéœ€æ±‚â€ï¼ˆä¸æ»¡è¶³å°±ç›´æ¥æ·˜æ±°ï¼‰ï¼Œé¿å…é™·å…¥â€œçœ‹åŠŸèƒ½åˆ—è¡¨è¶Šçœ‹è¶Šçˆ½â€çš„å¹»è§‰ã€‚</p><table><thead><tr><th align="left">ç»´åº¦</th><th align="left">è¯´æ˜</th><th align="left">æ¨èå–å‘</th></tr></thead><tbody><tr><td align="left"><strong>åŠŸèƒ½è¦†ç›–</strong></td><td align="left">å®¢æˆ·ç®¡ç†ã€å•†æœºã€é”€å”®æ¼æ–—ã€æ—¥å†ã€ä»»åŠ¡</td><td align="left">âœ… åŸºç¡€ CRM åŠŸèƒ½</td></tr><tr><td align="left"><strong>å®šåˆ¶èƒ½åŠ›</strong></td><td align="left">èƒ½å¦äºŒæ¬¡å¼€å‘ã€æ‰©å±•æ€§å¦‚ä½•</td><td align="left">âœ… å¿…é¡»æ”¯æŒæ·±åº¦å®šåˆ¶</td></tr><tr><td align="left"><strong>éƒ¨ç½²æ–¹å¼</strong></td><td align="left">SaaS vs è‡ªæ‰˜ç®¡</td><td align="left">âœ… å¿…é¡»æ”¯æŒç§æœ‰éƒ¨ç½²</td></tr><tr><td align="left"><strong>æˆæœ¬</strong></td><td align="left">è®¸å¯è´¹ã€æœåŠ¡å™¨æˆæœ¬ã€å¼€å‘æˆæœ¬</td><td align="left">âœ… å¼€æºå…è´¹ä¸ºä¸»</td></tr><tr><td align="left"><strong>æŠ€æœ¯æ ˆ</strong></td><td align="left">å¼€å‘è¯­è¨€ã€æ¡†æ¶ã€æ•°æ®åº“</td><td align="left">âš ï¸ ä¸åšç¡¬æ€§é™åˆ¶</td></tr><tr><td align="left"><strong>ç¤¾åŒºæ´»è·ƒåº¦</strong></td><td align="left">æ›´æ–°é¢‘ç‡ã€é—®é¢˜è§£å†³é€Ÿåº¦</td><td align="left">âœ… æ´»è·ƒç»´æŠ¤</td></tr></tbody></table><p>å¾ˆå¤šå›¢é˜Ÿæ¼æ‰ä½†â€œåæœŸä¸€å®šä¼šå’¬ä½ â€çš„ç»´åº¦ï¼š</p><table><thead><tr><th align="left">ç»´åº¦</th><th align="left">ä¸ºä»€ä¹ˆå…³é”®</th></tr></thead><tbody><tr><td align="left"><strong>æƒé™æ¨¡å‹</strong></td><td align="left">ç»„ç»‡æ¶æ„ã€æ•°æ®éš”ç¦»ã€å­—æ®µçº§&#x2F;è®°å½•çº§æƒé™å†³å®šèƒ½å¦è½åœ°</td></tr><tr><td align="left"><strong>å®¡è®¡ä¸åˆè§„</strong></td><td align="left">æ“ä½œæ—¥å¿—ã€æ•°æ®å¯¼å‡ºæ§åˆ¶ã€ç•™å­˜ç­–ç•¥å½±å“é£æ§ä¸åˆè§„</td></tr><tr><td align="left"><strong>æ•°æ®è¿ç§»</strong></td><td align="left">Excel&#x2F;æ—§ç³»ç»Ÿå¯¼å…¥ã€å­—æ®µæ˜ å°„ã€å»é‡ç­–ç•¥å¸¸å¸¸æ˜¯é¡¹ç›®çš„ä¸»æˆ˜åœº</td></tr><tr><td align="left"><strong>é›†æˆèƒ½åŠ›</strong></td><td align="left">é‚®ä»¶ã€æ—¥å†ã€IMã€å‘¼å«ä¸­å¿ƒã€è´¢åŠ¡ç³»ç»Ÿå¯¹æ¥å†³å®šâ€œæ˜¯ä¸æ˜¯å·¥å…·å­¤å²›â€</td></tr></tbody></table><h3 id="1-1-é€‰å‹æµç¨‹ï¼ˆå¯å¤ç”¨æ¨¡æ¿ï¼‰"><a href="#1-1-é€‰å‹æµç¨‹ï¼ˆå¯å¤ç”¨æ¨¡æ¿ï¼‰" class="headerlink" title="1.1 é€‰å‹æµç¨‹ï¼ˆå¯å¤ç”¨æ¨¡æ¿ï¼‰"></a>1.1 é€‰å‹æµç¨‹ï¼ˆå¯å¤ç”¨æ¨¡æ¿ï¼‰</h3><p>æŠŠâ€œé€‰å‹â€å½“ä¸€ä¸ªå°é¡¹ç›®åšï¼Œæ•ˆç‡åè€Œæ›´é«˜ï¼š</p><ol><li><strong>åˆ—æ¸…å•</strong>ï¼šå†™ä¸‹ 10 æ¡éå¦¥åéœ€æ±‚ + 10 æ¡å¯å¦¥åéœ€æ±‚</li><li><strong>æ‹‰å€™é€‰</strong>ï¼š3-5 ä¸ªäº§å“å³å¯ï¼ˆå¤ªå¤šåªä¼šæŠŠç²¾åŠ›æµªè´¹åœ¨è¡¨æ ¼ä¸Šï¼‰</li><li><strong>åš PoC</strong>ï¼šç”¨çœŸå®ä¸šåŠ¡è·‘é€š 3 æ¡å…³é”®æµç¨‹ï¼ˆçº¿ç´¢â†’å•†æœºâ†’æˆäº¤ï¼›å®¢æˆ·â†’æ´»åŠ¨â†’è·Ÿè¿›ï¼›å¯¼å…¥â†’åˆ†é…â†’æƒé™ï¼‰</li><li><strong>ç®—æ€»æˆæœ¬</strong>ï¼šä¸€å¹´å†…äººåŠ›ï¼ˆå¼€å‘&#x2F;è¿ç»´&#x2F;åŸ¹è®­ï¼‰+ æœåŠ¡å™¨ + æœºä¼šæˆæœ¬</li><li><strong>åšåˆè§„è¯„ä¼°</strong>ï¼šå°¤å…¶æ˜¯è®¸å¯è¯ï¼ˆå¦‚ AGPLï¼‰ä¸æ•°æ®å®‰å…¨è¾¹ç•Œ</li></ol><h3 id="1-2-æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆ-Java-èƒŒæ™¯ä¹Ÿå¯èƒ½é€‰æ‹©-PHP"><a href="#1-2-æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆ-Java-èƒŒæ™¯ä¹Ÿå¯èƒ½é€‰æ‹©-PHP" class="headerlink" title="1.2 æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆ Java èƒŒæ™¯ä¹Ÿå¯èƒ½é€‰æ‹© PHP"></a>1.2 æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆ Java èƒŒæ™¯ä¹Ÿå¯èƒ½é€‰æ‹© PHP</h3><p>å¦‚æœä½ çš„å›¢é˜Ÿå <strong>Java èƒŒæ™¯</strong>ï¼Œèµ·åˆå¯èƒ½ä¹Ÿä¼šä¼˜å…ˆçœ‹ Java æŠ€æœ¯æ ˆçš„ CRMï¼ˆä¾‹å¦‚ Apache OFBiz ç­‰ï¼‰ã€‚ä½†åœ¨ CRM è¿™ç±»â€äº§å“å¤æ‚åº¦æé«˜â€çš„ç³»ç»Ÿé‡Œï¼Œ<strong>æŠ€æœ¯æ ˆåŒ¹é…å¾€å¾€ä¸æ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§</strong>ã€‚</p><p>AI ç¼–ç¨‹åŠ©æ‰‹çš„æ™®åŠè¿›ä¸€æ­¥é™ä½äº†è¯­è¨€åˆ‡æ¢æˆæœ¬ï¼Œä½†å®ƒè§£å†³çš„æ˜¯â€œè¯­æ³•ä¸æ ·æ¿â€ï¼Œä¸æ˜¯â€œæ¶æ„ç†è§£ä¸å¯ç»´æŠ¤æ€§â€ã€‚çœŸæ­£åº”è¯¥ä¼˜å…ˆå…³å¿ƒçš„ï¼Œæ˜¯äº§å“æœ¬èº«æ˜¯å¦æˆç†Ÿã€æ‰©å±•ç‚¹æ˜¯å¦æ¸…æ™°ã€å‡çº§æ˜¯å¦å¯æ§ï¼Œè€Œä¸æ˜¯â€œæˆ‘å›¢é˜Ÿä¼šä¸ä¼šå†™ PHPâ€ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸æŠŠè¯­è¨€å½“ç¡¬é—¨æ§›</strong>ï¼š</p><table><thead><tr><th align="left">è¯„ä¼°é¡¹</th><th align="left">Java CRM</th><th align="center">EspoCRM (PHP)</th></tr></thead><tbody><tr><td align="left"><strong>å­¦ä¹ æ›²çº¿</strong></td><td align="left">Java å¼€å‘è€…ä¸Šæ‰‹å¿«ï¼Œä½† CRM æœ¬èº«å¤æ‚</td><td align="center">PHP è¯­æ³•ç®€å•ï¼Œé€šå¸¸æ•°å¤©å†…å¯å®ŒæˆåŸºæœ¬ä¸Šæ‰‹</td></tr><tr><td align="left"><strong>éƒ¨ç½²æˆæœ¬</strong></td><td align="left">JVM + åº”ç”¨æœåŠ¡å™¨ï¼Œèµ„æºå ç”¨é«˜</td><td align="center">ä¼ ç»Ÿ LAMP å †æ ˆï¼Œèµ„æºå ç”¨ç›¸å¯¹å¯æ§</td></tr><tr><td align="left"><strong>å®šåˆ¶å‹å¥½</strong></td><td align="left">æ¡†æ¶åšé‡ï¼Œæ”¹ä¸€è¡Œä»£ç å¯èƒ½ç‰µä¸€å‘åŠ¨å…¨èº«</td><td align="center">å…ƒæ•°æ®é©±åŠ¨ï¼Œå¤§éƒ¨åˆ†å®šåˆ¶åªéœ€æ”¹é…ç½®</td></tr><tr><td align="left"><strong>ç»´æŠ¤æˆæœ¬</strong></td><td align="left">ä¾èµ–å¤šï¼Œå‡çº§å¤æ‚</td><td align="center">ä¾èµ–å°‘ï¼Œå‡çº§å‹å¥½</td></tr></tbody></table><p><strong>æ ¸å¿ƒå†³ç­–</strong>ï¼š</p><blockquote><p><strong>â€œé€‰äº§å“æœ¬è´¨ï¼Œä¸æ˜¯é€‰è¯­è¨€ã€‚â€</strong> ä¸€ä¸ªä¼˜ç§€çš„ PHP CRMï¼Œå¾€å¾€èƒœè¿‡ä¸€ä¸ªä¸æˆç†Ÿçš„åŒç±»äº§å“ã€‚</p></blockquote><p>å®è·µä¸­æ›´ç¨³å¦¥çš„ç­–ç•¥æ˜¯ï¼šä¼˜å…ˆé€‰æˆç†Ÿäº§å“ï¼Œå†è§£å†³è¯­è¨€ä¸å·¥ç¨‹ä½“ç³»çš„é€‚é…é—®é¢˜ã€‚</p><hr><h2 id="2-å¯¹æ¯”æ ·æœ¬ï¼šTwenty-CRM-vs-EspoCRM-vs-OFBiz"><a href="#2-å¯¹æ¯”æ ·æœ¬ï¼šTwenty-CRM-vs-EspoCRM-vs-OFBiz" class="headerlink" title="2. å¯¹æ¯”æ ·æœ¬ï¼šTwenty CRM vs EspoCRM vs OFBiz"></a>2. å¯¹æ¯”æ ·æœ¬ï¼šTwenty CRM vs EspoCRM vs OFBiz</h2><p>è¿™é‡Œç”¨ä¸‰æ¬¾ä»£è¡¨æ€§äº§å“åšæ ·æœ¬ï¼š<strong>Twenty CRM</strong>ï¼ˆæ–°å…´ç°ä»£ï¼‰ã€<strong>EspoCRM</strong>ï¼ˆæˆç†Ÿç¨³å®šï¼‰ã€<strong>Apache OFBiz</strong>ï¼ˆä¼ä¸šçº§ Java æ¡†æ¶ï¼‰ã€‚</p><h3 id="2-1-å¯¹æ¯”æ€»è§ˆ"><a href="#2-1-å¯¹æ¯”æ€»è§ˆ" class="headerlink" title="2.1 å¯¹æ¯”æ€»è§ˆ"></a>2.1 å¯¹æ¯”æ€»è§ˆ</h3><table><thead><tr><th align="left">äº§å“</th><th align="left">æŠ€æœ¯æ ˆ</th><th align="center">æˆç†Ÿåº¦</th><th align="left">å®šåˆ¶éš¾åº¦</th><th align="left">éƒ¨ç½²å¤æ‚åº¦</th><th align="center">æœ€ç»ˆé€‰æ‹©</th></tr></thead><tbody><tr><td align="left"><strong>EspoCRM</strong></td><td align="left">PHP + MySQL + JS</td><td align="center">â­â­â­â­â­</td><td align="left">â­â­ å®¹æ˜“</td><td align="left">â­â­ ç®€å•</td><td align="center">âœ…</td></tr><tr><td align="left">Twenty CRM</td><td align="left">React + NestJS + PG</td><td align="center">â­â­â­</td><td align="left">â­â­ å®¹æ˜“</td><td align="left">â­â­â­â­ å¤æ‚</td><td align="center">âŒ</td></tr><tr><td align="left">Apache OFBiz</td><td align="left">Java + PostgreSQL</td><td align="center">â­â­â­â­</td><td align="left">â­â­â­â­ å›°éš¾</td><td align="left">â­â­â­â­â­ å¤æ‚</td><td align="center">âŒ</td></tr></tbody></table><h3 id="2-2-Twenty-CRMï¼šçœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†å¤ªæ–°"><a href="#2-2-Twenty-CRMï¼šçœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†å¤ªæ–°" class="headerlink" title="2.2 Twenty CRMï¼šçœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†å¤ªæ–°"></a>2.2 Twenty CRMï¼šçœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†å¤ªæ–°</h3><p>Twenty CRM æ˜¯ 2022 å¹´å¯åŠ¨çš„æ–°é¡¹ç›®ï¼ŒæŠ€æœ¯æ ˆéå¸¸ç°ä»£ï¼ˆReact + NestJS + TypeScriptï¼‰ï¼Œç•Œé¢ç²¾ç¾ï¼Œæ¶æ„è®¾è®¡ä¼˜ç§€ã€‚</p><table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">Twenty CRM</th><th align="left">é—®é¢˜</th></tr></thead><tbody><tr><td align="left"><strong>æŠ€æœ¯æ ˆ</strong></td><td align="left">React + NestJS + PostgreSQL</td><td align="left">éœ€è¦å…¨æ ˆ JS&#x2F;TS èƒ½åŠ›</td></tr><tr><td align="left"><strong>æˆç†Ÿåº¦</strong></td><td align="left">å¿«é€Ÿè¿­ä»£ä¸­</td><td align="left">ç‰ˆæœ¬æ¼”è¿›å¿«ï¼Œå…¼å®¹æ€§éœ€è¦è‡ªå·±éªŒè¯</td></tr><tr><td align="left"><strong>æ–‡æ¡£</strong></td><td align="left">è‹±æ–‡ä¸ºä¸»ï¼Œè¦†ç›–æœ‰é™</td><td align="left">é‡åˆ°é—®é¢˜éš¾ä»¥æ‰¾åˆ°ç­”æ¡ˆ</td></tr><tr><td align="left"><strong>ç¤¾åŒº</strong></td><td align="left">GitHub æ´»è·ƒ</td><td align="left">å®é™…ç”¨æˆ·å°‘</td></tr><tr><td align="left"><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td><td align="left">æ ¸å¿ƒåŠŸèƒ½é½å…¨</td><td align="left">é«˜çº§åŠŸèƒ½ï¼ˆæŠ¥è¡¨ã€å·¥ä½œæµï¼‰å°šåœ¨å¼€å‘</td></tr></tbody></table><p><strong>ç»“è®º</strong>ï¼šTwenty CRM ä»£è¡¨æœªæ¥æ–¹å‘ï¼Œå€¼å¾—æŒç»­å…³æ³¨ã€‚ä½†å½“å‰é˜¶æ®µä½œä¸ºç”Ÿäº§ç³»ç»Ÿä½¿ç”¨é£é™©è¾ƒå¤§ â€”â€” ä½ ä¸å¸Œæœ›æˆä¸ºæ—©æœŸè¸©å‘çš„ç”¨æˆ·ã€‚</p><h3 id="2-3-Apache-OFBizï¼šå¼ºå¤§ä½†ç¬¨é‡"><a href="#2-3-Apache-OFBizï¼šå¼ºå¤§ä½†ç¬¨é‡" class="headerlink" title="2.3 Apache OFBizï¼šå¼ºå¤§ä½†ç¬¨é‡"></a>2.3 Apache OFBizï¼šå¼ºå¤§ä½†ç¬¨é‡</h3><p>Apache OFBiz æ˜¯ Apache åŸºé‡‘ä¼šçš„ä¼ä¸šçº§ ERP&#x2F;CRM æ¡†æ¶ï¼ŒåŠŸèƒ½æå…¶å¼ºå¤§ï¼Œä½†å­¦ä¹ æ›²çº¿é™¡å³­ã€‚</p><table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">Apache OFBiz</th><th align="left">é—®é¢˜</th></tr></thead><tbody><tr><td align="left"><strong>æŠ€æœ¯æ ˆ</strong></td><td align="left">Java + PostgreSQL</td><td align="left">æŠ€æœ¯æ ˆåŒ¹é… âœ…</td></tr><tr><td align="left"><strong>åŠŸèƒ½</strong></td><td align="left">ERP + CRM + ç”µå•†å…¨éƒ½æœ‰</td><td align="left">åŠŸèƒ½è¿‡äºåºå¤§ï¼Œç”¨ä¸ä¸Š</td></tr><tr><td align="left"><strong>æ¶æ„</strong></td><td align="left">ç»„ä»¶åŒ–ï¼Œé«˜åº¦å¯é…ç½®</td><td align="left">æ¦‚å¿µå¤æ‚ï¼Œå­¦ä¹ æˆæœ¬æé«˜</td></tr><tr><td align="left"><strong>ç•Œé¢</strong></td><td align="left">ä¼ ç»Ÿä¼ä¸šé£ï¼Œå¯å®šåˆ¶</td><td align="left">UI ç°ä»£åŒ–éœ€è¦å¤§é‡æŠ•å…¥</td></tr><tr><td align="left"><strong>æ–‡æ¡£</strong></td><td align="left">å®˜æ–¹æ–‡æ¡£è¯¦ç»†</td><td align="left">æ–‡æ¡£ç»„ç»‡æ··ä¹±ï¼Œæ–°æ‰‹è¿·å¤±</td></tr><tr><td align="left"><strong>éƒ¨ç½²</strong></td><td align="left">JVM + Tomcat + æ•°æ®åº“</td><td align="left">èµ„æºå ç”¨é«˜ï¼Œè¿ç»´å¤æ‚</td></tr></tbody></table><p><strong>ç»“è®º</strong>ï¼šOFBiz é€‚åˆå¤§å‹ä¼ä¸šçš„å¤æ‚ ERP éœ€æ±‚ã€‚å¯¹äºåªéœ€è¦ CRM çš„å›¢é˜Ÿï¼Œæ€é¸¡ç”¨ç‰›åˆ€ï¼Œç»´æŠ¤æˆæœ¬è¿‡é«˜ã€‚</p><h3 id="2-4-EspoCRMï¼šæˆç†Ÿç¨³å®šï¼Œå®šåˆ¶å‹å¥½"><a href="#2-4-EspoCRMï¼šæˆç†Ÿç¨³å®šï¼Œå®šåˆ¶å‹å¥½" class="headerlink" title="2.4 EspoCRMï¼šæˆç†Ÿç¨³å®šï¼Œå®šåˆ¶å‹å¥½"></a>2.4 EspoCRMï¼šæˆç†Ÿç¨³å®šï¼Œå®šåˆ¶å‹å¥½</h3><p>EspoCRM å‘å¸ƒäº 2014 å¹´ï¼Œç»è¿‡ 10+ å¹´å‘å±•ï¼Œå·²ç»éå¸¸æˆç†Ÿã€‚</p><table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">EspoCRM</th><th align="left">ä¼˜åŠ¿</th></tr></thead><tbody><tr><td align="left"><strong>æŠ€æœ¯æ ˆ</strong></td><td align="left">PHP + MySQL + JS</td><td align="left">PHP ç®€å•ï¼Œè·¨è¯­è¨€ä¸Šæ‰‹æˆæœ¬å¯æ§</td></tr><tr><td align="left"><strong>æˆç†Ÿåº¦</strong></td><td align="left">10+ å¹´å†å²</td><td align="left">ç¨³å®šå¯é ï¼Œç ´åæ€§æ›´æ–°å°‘</td></tr><tr><td align="left"><strong>æ¶æ„</strong></td><td align="left">å…ƒæ•°æ®é©±åŠ¨ + æ¨¡å—åŒ–</td><td align="left">å¤§éƒ¨åˆ†å®šåˆ¶åªéœ€æ”¹é…ç½®æ–‡ä»¶</td></tr><tr><td align="left"><strong>æ–‡æ¡£</strong></td><td align="left">å®˜æ–¹æ–‡æ¡£å®Œå–„</td><td align="left">ç¤¾åŒºè´¡çŒ®å¤šï¼Œé—®é¢˜èƒ½æ‰¾åˆ°ç­”æ¡ˆ</td></tr><tr><td align="left"><strong>ç¤¾åŒº</strong></td><td align="left">GitHub æ´»è·ƒï¼Œå…¨çƒç”¨æˆ·</td><td align="left">å•†ä¸šæ”¯æŒå¯é€‰ï¼Œç¤¾åŒºå…è´¹æ”¯æŒä¹Ÿå¤Ÿç”¨</td></tr><tr><td align="left"><strong>éƒ¨ç½²</strong></td><td align="left">ä¼ ç»Ÿ LAMP å †æ ˆ</td><td align="left">éƒ¨ç½²è·¯å¾„æ¸…æ™°ï¼Œè¿ç»´æˆæœ¬å¯æ§</td></tr></tbody></table><p><strong>ç»“è®º</strong>ï¼šEspoCRM åœ¨æˆç†Ÿåº¦ã€å®šåˆ¶å‹å¥½æ€§ã€è¿ç»´æˆæœ¬ä¹‹é—´è¾¾åˆ°äº†æœ€ä½³å¹³è¡¡ã€‚</p><blockquote><p><strong>å…³äºè¯­è¨€</strong>ï¼šEspoCRM å®˜æ–¹ä»¥è‹±è¯­ä¸ºä¸»ï¼Œä¸­æ–‡æœ¬åœ°åŒ–ç›¸å¯¹å¼±ã€‚å¦‚æœä½ çš„ç”¨æˆ·éœ€è¦å¼ºä¸­æ–‡æ”¯æŒï¼Œå¯èƒ½éœ€è¦é¢å¤–æŠ•å…¥åšæœ¬åœ°åŒ–æˆ–ç»´æŠ¤è¯­è¨€åŒ…è¦†ç›–ã€‚</p></blockquote><h3 id="2-5-å†³ç­–çŸ©é˜µ"><a href="#2-5-å†³ç­–çŸ©é˜µ" class="headerlink" title="2.5 å†³ç­–çŸ©é˜µ"></a>2.5 å†³ç­–çŸ©é˜µ</h3><p>è¯´æ˜ï¼šä¸‹é¢çš„æ‰“åˆ†æ˜¯åŸºäºæœ¬æ–‡å¼€å¤´çš„â€œéå¦¥åéœ€æ±‚â€ï¼ˆå¯è‡ªæ‰˜ç®¡ã€å¯æ·±åº¦å®šåˆ¶ã€æˆæœ¬å¯æ§ã€å¯ç»´æŠ¤ï¼‰ä»¥åŠæˆ‘å¯¹ä¸‰æ¬¾äº§å“çš„è¯•ç”¨ä¸èµ„æ–™è°ƒç ”åšçš„ä¸»è§‚è¯„åˆ†ã€‚ä½ åœ¨è‡ªå·±çš„ PoC é˜¶æ®µï¼Œå»ºè®®æŒ‰ä¸šåŠ¡å…³é”®æµç¨‹é‡æ–°æ‰“åˆ†ï¼Œåˆ«ç…§æŠ„æ˜Ÿæ˜Ÿã€‚</p><table><thead><tr><th align="left">è¯„ä¼°ç»´åº¦</th><th align="center">Twenty CRM</th><th align="center">EspoCRM</th><th align="center">OFBiz</th></tr></thead><tbody><tr><td align="left"><strong>çŸ­æœŸä¸Šçº¿</strong></td><td align="center">â­â­â­â­â­</td><td align="center">â­â­â­â­â­</td><td align="center">â­â­</td></tr><tr><td align="left"><strong>é•¿æœŸç»´æŠ¤</strong></td><td align="center">â­â­</td><td align="center">â­â­â­â­â­</td><td align="center">â­â­â­</td></tr><tr><td align="left"><strong>å®šåˆ¶æ•ˆç‡</strong></td><td align="center">â­â­</td><td align="center">â­â­â­â­â­</td><td align="center">â­â­</td></tr><tr><td align="left"><strong>å›¢é˜Ÿé€‚åº”</strong></td><td align="center">â­â­â­</td><td align="center">â­â­â­</td><td align="center">â­â­â­</td></tr><tr><td align="left"><strong>è¿ç»´æˆæœ¬</strong></td><td align="center">â­â­â­â­â­</td><td align="center">â­â­â­â­â­</td><td align="center">â­â­</td></tr><tr><td align="left"><strong>é£é™©å¯æ§</strong></td><td align="center">â­â­</td><td align="center">â­â­â­â­â­</td><td align="center">â­â­â­</td></tr></tbody></table><p><strong>æœ€ç»ˆé€‰æ‹©ï¼šEspoCRM</strong></p><h3 id="2-6-å…¶ä»–å¸¸è§å¼€æº-CRMï¼ˆå¿«é€Ÿæ‰«ä¸€çœ¼ï¼‰"><a href="#2-6-å…¶ä»–å¸¸è§å¼€æº-CRMï¼ˆå¿«é€Ÿæ‰«ä¸€çœ¼ï¼‰" class="headerlink" title="2.6 å…¶ä»–å¸¸è§å¼€æº CRMï¼ˆå¿«é€Ÿæ‰«ä¸€çœ¼ï¼‰"></a>2.6 å…¶ä»–å¸¸è§å¼€æº CRMï¼ˆå¿«é€Ÿæ‰«ä¸€çœ¼ï¼‰</h3><p>å¦‚æœä½ æƒ³æŠŠå€™é€‰æ± æ‹‰å¤§ï¼Œä¸‹é¢è¿™äº›åå­—å‡ ä¹ç»•ä¸å¼€ã€‚è¿™é‡Œä¸åšç»“è®ºï¼Œåªç»™ä½ â€œé€‚åˆä»€ä¹ˆ&#x2F;è¦æ³¨æ„ä»€ä¹ˆâ€ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿå†³å®šè¦ä¸è¦çº³å…¥ PoCã€‚</p><table><thead><tr><th align="left">äº§å“</th><th align="left">é€‚åˆä»€ä¹ˆ</th><th align="left">è¦æ³¨æ„ä»€ä¹ˆ</th></tr></thead><tbody><tr><td align="left"><strong>SuiteCRM</strong></td><td align="left">åä¼ ç»Ÿ CRM å½¢æ€ã€å¯¹â€œå¼€æºè€ç‰Œç”Ÿæ€â€æœ‰åå¥½ã€èƒ½æ¥å—è¾ƒä¼ ç»Ÿçš„ UI</td><td align="left">å®šåˆ¶ä¸å‡çº§æˆæœ¬éœ€è¦æå‰è¯„ä¼°ï¼Œåˆ«åªçœ‹åŠŸèƒ½åˆ—è¡¨</td></tr><tr><td align="left"><strong>Vtiger</strong></td><td align="left">éœ€è¦æ›´â€œäº§å“åŒ–â€çš„ç°æˆèƒ½åŠ›ã€æ„¿æ„è€ƒè™‘å•†ä¸šæ”¯æŒ&#x2F;ä»˜è´¹ç‰ˆè·¯çº¿</td><td align="left">å¼€æºç‰ˆä¸å•†ä¸šç‰ˆè¾¹ç•Œè¦çœ‹æ¸…æ¥šï¼Œé¿å…é€‰åˆ°åæœŸè¢«èƒ½åŠ›å¡æ­»</td></tr><tr><td align="left"><strong>Dolibarr</strong></td><td align="left">æ›´åâ€œè½»é‡ ERP&#x2F;è¿›é”€å­˜ + CRMâ€çš„åœºæ™¯ï¼Œå°å›¢é˜Ÿæƒ³ä¸€å¥—ç³»ç»Ÿè¦†ç›–æ›´å¤šæ¨¡å—</td><td align="left">CRM æ·±åº¦å¯èƒ½ä¸å¦‚ä¸“é—¨ CRMï¼Œå¤æ‚é”€å”®æµç¨‹è¦å…ˆåš PoC éªŒè¯</td></tr></tbody></table><hr><h2 id="3-æœ€ç»ˆé€‰æ‹©-EspoCRM-çš„å…³é”®ç†ç”±"><a href="#3-æœ€ç»ˆé€‰æ‹©-EspoCRM-çš„å…³é”®ç†ç”±" class="headerlink" title="3. æœ€ç»ˆé€‰æ‹© EspoCRM çš„å…³é”®ç†ç”±"></a>3. æœ€ç»ˆé€‰æ‹© EspoCRM çš„å…³é”®ç†ç”±</h2><h3 id="3-1-ä»£ç è´¨é‡ä¸æ¶æ„"><a href="#3-1-ä»£ç è´¨é‡ä¸æ¶æ„" class="headerlink" title="3.1 ä»£ç è´¨é‡ä¸æ¶æ„"></a>3.1 ä»£ç è´¨é‡ä¸æ¶æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¼˜åŠ¿ï¼š</span><br><span class="line">â”œâ”€â”€ å…ƒæ•°æ®é©±åŠ¨ï¼šå¤§éƒ¨åˆ†å®šåˆ¶åªéœ€æ”¹é…ç½®ï¼Œä¸æ”¹ä»£ç </span><br><span class="line">â”œâ”€â”€ æ¨¡å—åŒ–æ¶æ„ï¼šcustom/ ç›®å½•éš”ç¦»ï¼Œå¯å‡çº§</span><br><span class="line">â”œâ”€â”€ æ¸…æ™°çš„æ‰©å±•ç‚¹ï¼šFormula â†’ Dynamic Logic â†’ Hook â†’ Service</span><br><span class="line">â”œâ”€â”€ RESTful APIï¼šå®Œå–„çš„ API è®¾è®¡ï¼Œæ˜“äºé›†æˆ</span><br><span class="line">â””â”€â”€ å‰ç«¯æŠ€æœ¯æ ˆç¨³å®šï¼šBackbone.js + Handlebarsï¼ŒäºŒæ¬¡å¼€å‘è·¯å¾„æ¸…æ™°</span><br></pre></td></tr></table></figure><h3 id="3-2-å®šåˆ¶å‹å¥½æ€§"><a href="#3-2-å®šåˆ¶å‹å¥½æ€§" class="headerlink" title="3.2 å®šåˆ¶å‹å¥½æ€§"></a>3.2 å®šåˆ¶å‹å¥½æ€§</h3><p>EspoCRM å¯¹å¼€å‘è€…éå¸¸å‹å¥½ï¼š</p><ul><li><strong>å…ƒæ•°æ®é©±åŠ¨</strong>ï¼šentityDefsã€clientDefsã€scopes ç­‰é…ç½®æ–‡ä»¶æ§åˆ¶å¤§éƒ¨åˆ†è¡Œä¸º</li><li><strong>rebuild æœºåˆ¶</strong>ï¼šä¿®æ”¹å…ƒæ•°æ®åæ‰§è¡Œ rebuildï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ&#x2F;æ›´æ–°è¡¨ç»“æ„</li><li><strong>æ¨¡å—éš”ç¦»</strong>ï¼š<code>custom/Espo/Modules/</code> ä¸‹çš„æ”¹åŠ¨ä¸å½±å“æ ¸å¿ƒå‡çº§</li><li><strong>ä¸°å¯Œçš„ Hook</strong>ï¼šBeforeSaveã€AfterSaveã€BeforeDelete ç­‰æ‹¦æˆªæ•°æ®æ“ä½œ</li></ul><h3 id="3-3-ç¤¾åŒºä¸æ–‡æ¡£"><a href="#3-3-ç¤¾åŒºä¸æ–‡æ¡£" class="headerlink" title="3.3 ç¤¾åŒºä¸æ–‡æ¡£"></a>3.3 ç¤¾åŒºä¸æ–‡æ¡£</h3><ul><li><strong>GitHub æ´»è·ƒ</strong>ï¼šæŒç»­æ›´æ–°ï¼Œissue å“åº”åŠæ—¶</li><li><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼šæ¶µç›–å¼€å‘ã€å®šåˆ¶ã€API</li><li><strong>ç¤¾åŒºè®ºå›</strong>ï¼šå…¨çƒç”¨æˆ·åˆ†äº«ç»éªŒ</li><li><strong>ä¸­æ–‡èµ„æº</strong>ï¼šå›½å†…æœ‰å°‘é‡å®è·µæ¡ˆä¾‹ï¼ˆæ­£åœ¨å¢é•¿ï¼‰</li></ul><h3 id="3-4-éƒ¨ç½²ä¸è¿ç»´"><a href="#3-4-éƒ¨ç½²ä¸è¿ç»´" class="headerlink" title="3.4 éƒ¨ç½²ä¸è¿ç»´"></a>3.4 éƒ¨ç½²ä¸è¿ç»´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  -e ESPOCRM_DATABASE_HOST=<span class="string">&quot;&lt;DB_HOST&gt;&quot;</span> \</span><br><span class="line">  -e ESPOCRM_DATABASE_USER=<span class="string">&quot;&lt;DB_USER&gt;&quot;</span> \</span><br><span class="line">  -e ESPOCRM_DATABASE_PASSWORD=<span class="string">&quot;&lt;DB_PASSWORD&gt;&quot;</span> \</span><br><span class="line">  -e ESPOCRM_ADMIN_USER=<span class="string">&quot;&lt;ADMIN_USER&gt;&quot;</span> \</span><br><span class="line">  -e ESPOCRM_ADMIN_PASSWORD=<span class="string">&quot;&lt;ADMIN_PASSWORD&gt;&quot;</span> \</span><br><span class="line">  -p 8080:80 \</span><br><span class="line">  espocrm/espocrm</span><br></pre></td></tr></table></figure><ul><li>æ”¯æŒ Docker éƒ¨ç½²</li><li>æ”¯æŒ PHP 8.2 - 8.4</li><li>æ”¯æŒ MySQL 8.0+ æˆ– MariaDB 10.3+ï¼ˆä¹Ÿæ”¯æŒ PostgreSQL 15+ï¼‰</li><li>èµ„æºå ç”¨ç›¸å¯¹å¯æ§ï¼Œå°è§„æ¨¡å¯ä»ä½é…èµ·æ­¥ï¼ŒæŒ‰å¹¶å‘ä¸æ•°æ®é‡æ‰©å®¹</li></ul><hr><h2 id="4-EspoCRM-çš„å±€é™ä¸è§„é¿"><a href="#4-EspoCRM-çš„å±€é™ä¸è§„é¿" class="headerlink" title="4. EspoCRM çš„å±€é™ä¸è§„é¿"></a>4. EspoCRM çš„å±€é™ä¸è§„é¿</h2><h3 id="4-1-å·²çŸ¥å±€é™"><a href="#4-1-å·²çŸ¥å±€é™" class="headerlink" title="4.1 å·²çŸ¥å±€é™"></a>4.1 å·²çŸ¥å±€é™</h3><table><thead><tr><th align="left">å±€é™</th><th align="left">è¯´æ˜</th><th align="left">å½±å“</th></tr></thead><tbody><tr><td align="left"><strong>ç§»åŠ¨ç«¯è¾ƒå¼±</strong></td><td align="left">ç§»åŠ¨ç‰ˆåŠŸèƒ½æœ‰é™</td><td align="left">å¤–å‹¤å¤šéœ€è¦é¢å¤–é€‚é…</td></tr><tr><td align="left"><strong>æŠ¥è¡¨åŠŸèƒ½åŸºç¡€</strong></td><td align="left">å†…ç½®æŠ¥è¡¨è¾ƒç®€å•</td><td align="left">å¤æ‚æŠ¥è¡¨éœ€è¦äºŒæ¬¡å¼€å‘</td></tr><tr><td align="left"><strong>ä¸­æ–‡æœ¬åœ°åŒ–</strong></td><td align="left">å®˜æ–¹ä¸­æ–‡æ”¯æŒæœ‰é™</td><td align="left">éœ€è¦è‡ªå·±ç¿»è¯‘è¯­è¨€åŒ…</td></tr><tr><td align="left"><strong>é«˜çº§åŠŸèƒ½ä»˜è´¹</strong></td><td align="left">é«˜çº§åŠŸèƒ½åœ¨ä»˜è´¹ç‰ˆä¸­</td><td align="left">å¦‚éœ€æŸäº›åŠŸèƒ½éœ€è´­ä¹°</td></tr><tr><td align="left"><strong>è®¸å¯çº¦æŸï¼ˆAGPLï¼‰</strong></td><td align="left">ä»¥ AGPLv3 å‘å¸ƒ</td><td align="left">ä¿®æ”¹åä¾›ç”¨æˆ·é€šè¿‡ç½‘ç»œä½¿ç”¨æ—¶éœ€å±¥è¡Œæºç æä¾›ä¹‰åŠ¡</td></tr></tbody></table><h3 id="4-2-è§„é¿æ–¹å¼"><a href="#4-2-è§„é¿æ–¹å¼" class="headerlink" title="4.2 è§„é¿æ–¹å¼"></a>4.2 è§„é¿æ–¹å¼</h3><p><strong>ç§»åŠ¨ç«¯å¼±</strong> â†’ ä½¿ç”¨å“åº”å¼å¸ƒå±€ + PWAï¼Œæˆ–å¯¹æ¥ç§»åŠ¨ç«¯å…¥å£ï¼ˆä¼ä¸š IM&#x2F;é—¨æˆ·ç­‰ï¼‰</p><p><strong>æŠ¥è¡¨åŠŸèƒ½åŸºç¡€</strong> â†’ï¼š</p><ul><li>ä½¿ç”¨ BI å·¥å…·ï¼ˆMetabaseã€Supersetï¼‰ç›´è¿æ•°æ®åº“</li><li>è‡ªå®šä¹‰ API å¯¼å‡ºæ•°æ®åˆ° Excel&#x2F;BI ç³»ç»Ÿ</li></ul><p><strong>é«˜çº§åŠŸèƒ½ä»˜è´¹</strong> â†’ï¼š</p><ul><li>å¤§éƒ¨åˆ†åŠŸèƒ½å¯ä»¥é€šè¿‡å®šåˆ¶å¼€å‘å®ç°</li><li>æœ¬ç³»åˆ—æ–‡ç« ç»™å‡ºä¸€å¥—â€œå¼€æºç‰ˆå¯è½åœ°â€çš„æ‰©å±•è·¯å¾„</li></ul><p><strong>è®¸å¯çº¦æŸï¼ˆAGPLï¼‰</strong> â†’ï¼š</p><ul><li>åœ¨ç«‹é¡¹&#x2F;PoC é˜¶æ®µæ˜ç¡®ï¼šæ˜¯å¦ä¼šä¿®æ”¹æºç ï¼ˆæˆ–å½¢æˆè¡ç”Ÿä½œå“ï¼‰ã€å“ªäº›ç”¨æˆ·ä¼šé€šè¿‡ç½‘ç»œè®¿é—®ç³»ç»Ÿ</li><li>è‹¥è§¦å‘ AGPL ä¹‰åŠ¡ï¼Œé¢„ç•™æºç æä¾›ä¸æ³•å¾‹å£°æ˜çš„äº¤ä»˜è·¯å¾„ï¼›å¿…è¦æ—¶è¯„ä¼°å•†ä¸šè®¸å¯æˆ–å®˜æ–¹ä»˜è´¹æ–¹æ¡ˆ</li></ul><hr><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><h3 id="5-1-é€‰æ‹©-EspoCRM-çš„æ ¸å¿ƒåŸå› "><a href="#5-1-é€‰æ‹©-EspoCRM-çš„æ ¸å¿ƒåŸå› " class="headerlink" title="5.1 é€‰æ‹© EspoCRM çš„æ ¸å¿ƒåŸå› "></a>5.1 é€‰æ‹© EspoCRM çš„æ ¸å¿ƒåŸå› </h3><ol><li><strong>æ¶æ„ç°ä»£</strong>ï¼šå…ƒæ•°æ®é©±åŠ¨ + æ¨¡å—åŒ–ï¼Œé•¿æœŸå¯ç»´æŠ¤</li><li><strong>å®šåˆ¶å‹å¥½</strong>ï¼šä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œå¼€å‘æ•ˆç‡é«˜</li><li><strong>æˆæœ¬å¯æ§</strong>ï¼šå¼€æºå…è´¹ï¼Œè‡ªæ‰˜ç®¡æ— è®¸å¯è´¹</li><li><strong>ç¤¾åŒºæ´»è·ƒ</strong>ï¼šæŒç»­æ›´æ–°ï¼Œé—®é¢˜èƒ½æ‰¾åˆ°ç­”æ¡ˆ</li><li><strong>éƒ¨ç½²ç®€å•</strong>ï¼šDocker ä¸€é”®å¯åŠ¨ï¼Œè¿ç»´æˆæœ¬ä½</li></ol><h3 id="5-2-é€‚åˆäººç¾¤"><a href="#5-2-é€‚åˆäººç¾¤" class="headerlink" title="5.2 é€‚åˆäººç¾¤"></a>5.2 é€‚åˆäººç¾¤</h3><p>EspoCRM ç‰¹åˆ«é€‚åˆï¼š</p><ul><li>âœ… æœ‰å¼€å‘èƒ½åŠ›çš„å›¢é˜Ÿï¼ˆæˆ–å¯å¤–åŒ…ï¼‰</li><li>âœ… éœ€è¦æ·±åº¦å®šåˆ¶çš„ä¸šåŠ¡åœºæ™¯</li><li>âœ… æ³¨é‡æ•°æ®éšç§ï¼Œå¿…é¡»ç§æœ‰éƒ¨ç½²</li><li>âœ… é¢„ç®—æœ‰é™ï¼Œä¸æƒ³ä»˜é«˜æ˜‚ SaaS è´¹ç”¨</li></ul><h3 id="5-3-ä¸é€‚åˆçš„æƒ…å†µ"><a href="#5-3-ä¸é€‚åˆçš„æƒ…å†µ" class="headerlink" title="5.3 ä¸é€‚åˆçš„æƒ…å†µ"></a>5.3 ä¸é€‚åˆçš„æƒ…å†µ</h3><ul><li>âŒ å®Œå…¨æ²¡æœ‰æŠ€æœ¯èƒ½åŠ›ï¼Œä¹Ÿä¸æƒ³å¤–åŒ…</li><li>âŒ éœ€è¦å¼€ç®±å³ç”¨çš„å¤æ‚æŠ¥è¡¨</li><li>âŒ å¯¹ UI&#x2F;UX æœ‰æé«˜è¦æ±‚ï¼ˆéœ€è¦äºŒæ¬¡å¼€å‘ï¼‰</li></ul><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.espocrm.com/">EspoCRM</a></li><li><a href="https://twenty.com/">Twenty CRM</a></li><li><a href="https://ofbiz.apache.org/">Apache OFBiz</a></li></ul>]]></content>
    
    
    <summary type="html">ç»™å‡ºå¯å¤ç”¨çš„ CRM é€‰å‹æ–¹æ³•ï¼šå…ˆé”å®šéå¦¥åéœ€æ±‚ï¼Œå†åš PoCï¼ˆæ¦‚å¿µéªŒè¯ï¼‰ä¸æ€»æˆæœ¬æ ¸ç®—ã€‚ä»¥ Twenty CRMã€EspoCRMã€Apache OFBiz ä¸ºæ ·æœ¬ï¼Œè¯´æ˜ä¸ºä½•ä¸æŠŠæŠ€æœ¯æ ˆå½“ç¡¬é—¨æ§›ï¼Œå¹¶è¡¥ä¸Šæƒé™ã€å®¡è®¡ã€è¿ç§»ã€é›†æˆä¸ AGPL åˆè§„ç­‰â€œåæœŸä¸€å®šä¼šå’¬ä½ â€çš„ç»´åº¦ã€‚æœ€åæ¢³ç† EspoCRM çš„ä¼˜åŠ¿ã€å±€é™ä¸è§„é¿æ–¹å¼ã€‚</summary>
    
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/categories/EspoCRM/"/>
    
    
    <category term="EspoCRM" scheme="https://www.yzhu.name/tags/EspoCRM/"/>
    
    <category term="CRM" scheme="https://www.yzhu.name/tags/CRM/"/>
    
    <category term="selection" scheme="https://www.yzhu.name/tags/selection/"/>
    
    <category term="comparison" scheme="https://www.yzhu.name/tags/comparison/"/>
    
    <category term="open-source" scheme="https://www.yzhu.name/tags/open-source/"/>
    
  </entry>
  
  <entry>
    <title>Dify æºç æ”¹é€ ï¼šè‡ªå®šä¹‰å“ç‰Œå®è·µ</title>
    <link href="https://www.yzhu.name/2025/09/20/dify-custom-brand/"/>
    <id>https://www.yzhu.name/2025/09/20/dify-custom-brand/</id>
    <published>2025-09-20T14:56:55.000Z</published>
    <updated>2025-11-11T03:53:15.776Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>Dify æ˜¯ä¸€æ¬¾å¼€æºçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åº”ç”¨å¼€å‘å¹³å°ï¼Œå‡­å€Ÿå…¶çµæ´»çš„æ’ä»¶æœºåˆ¶å’Œå¯è§†åŒ–ç¼–æ’èƒ½åŠ›ï¼Œæˆä¸ºä¼ä¸šæ„å»º AI åº”ç”¨çš„çƒ­é—¨é€‰æ‹©ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡å“ç‰Œ(ä»¥å“ç‰Œ <code>YZHU</code> ä¸ºä¾‹)å®šåˆ¶è®© Dify å¹³å°èå…¥å…¶ä¼ä¸šå½¢è±¡ï¼Œå¼ºåŒ–ç”¨æˆ·å¯¹å“ç‰Œçš„è®¤çŸ¥ã€‚<span id="more"></span></p><p>æœ¬æ¬¡å˜æ›´èšç„¦äºå“ç‰Œå®šåˆ¶ï¼Œè¦†ç›–å‰ç«¯ç•Œé¢ï¼ˆæ ‡é¢˜ã€Logoï¼‰å’ŒåµŒå…¥å¼è„šæœ¬ï¼ˆäº¤äº’å›¾æ ‡ï¼‰ï¼Œå½¢æˆäº†ä¸€å¥—å®Œæ•´çš„å“ç‰Œæ›¿æ¢æµç¨‹ã€‚è¿™ç§åœºæ™¯åœ¨å¼€æºé¡¹ç›®äºŒæ¬¡å¼€å‘ä¸­éå¸¸å¸¸è§ï¼šä¼ä¸šéœ€è¦é€šè¿‡å“ç‰Œæ›¿æ¢å’Œé…ç½®è°ƒæ•´ï¼Œè®©å·¥å…·æ›´è´´åˆä¸šåŠ¡éœ€æ±‚ã€‚æœ¬æ–‡è®°å½•äº†æ­¤æ¬¡å˜æ›´çš„å®è·µç»†èŠ‚ï¼Œå¸Œæœ›ä¸ºå…¶ä»–å¼€å‘è€…æä¾›å¯å¤ç”¨çš„å‚è€ƒæ¨¡æ¿ã€‚</p><h2 id="æ ¸å¿ƒå˜æ›´çš„æŠ€æœ¯ç»†èŠ‚"><a href="#æ ¸å¿ƒå˜æ›´çš„æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="æ ¸å¿ƒå˜æ›´çš„æŠ€æœ¯ç»†èŠ‚"></a>æ ¸å¿ƒå˜æ›´çš„æŠ€æœ¯ç»†èŠ‚</h2><p>æœ¬æ¬¡å˜æ›´æ¶‰åŠ <strong>å‰ç«¯èµ„æº</strong> å’Œ <strong>åµŒå…¥å¼è„šæœ¬</strong> ä¸¤ä¸ªæ¨¡å—ï¼Œå›´ç»•å“ç‰Œå®šåˆ¶ç›®æ ‡å±•å¼€ã€‚ä»¥ä¸‹ä»æŠ€æœ¯è§†è§’é€ä¸€è§£æå…³é”®ä¿®æ”¹ç‚¹ã€‚</p><h3 id="å‰ç«¯èµ„æº"><a href="#å‰ç«¯èµ„æº" class="headerlink" title="å‰ç«¯èµ„æº"></a>å‰ç«¯èµ„æº</h3><p>å‰ç«¯èµ„æºæ˜¯å“ç‰Œå®šåˆ¶çš„æ ¸å¿ƒï¼Œç›®æ ‡æ˜¯å°† â€œDifyâ€ å“ç‰Œæ›¿æ¢ä¸º â€œYZHUâ€ï¼Œå¹¶ä¼˜åŒ–è§†è§‰å’Œæ— éšœç¢ä½“éªŒã€‚</p><h4 id="1-é¡µé¢æ ‡é¢˜"><a href="#1-é¡µé¢æ ‡é¢˜" class="headerlink" title="1. é¡µé¢æ ‡é¢˜"></a>1. é¡µé¢æ ‡é¢˜</h4><p>ä¿®æ”¹ <code>web/hooks/use-document-title.ts</code> ä¸­çš„æ ‡é¢˜æ‹¼æ¥é€»è¾‘ï¼Œå°† <code>${prefix}Dify</code> æ›¿æ¢ä¸º <code>${prefix}YZHU</code>ï¼Œç¡®ä¿æ‰€æœ‰é¡µé¢æ ‡é¢˜ï¼ˆå¦‚ â€œHome - Difyâ€ï¼‰æ˜¾ç¤ºä¸º â€œHome - YZHUâ€ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// web/hooks/use-document-title.ts</span><br><span class="line"><span class="deletion">- const title = `$&#123;prefix&#125;Dify`;</span></span><br><span class="line"><span class="addition">+ const title = `$&#123;prefix&#125;YZHU`;</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•æ–¹æ³•</strong>ï¼šè¿è¡Œ <code>npm run dev</code>ï¼Œæ‰“å¼€æµè§ˆå™¨æ£€æŸ¥é¡µé¢æ ‡é¢˜åç¼€æ˜¯å¦æ­£ç¡®æ›´æ–°ä¸º â€œ - YZHUâ€ ã€‚</p><h4 id="2-Logo-æè¿°"><a href="#2-Logo-æè¿°" class="headerlink" title="2. Logo æè¿°"></a>2. Logo æè¿°</h4><p>æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ä¸­ Logo å›¾ç‰‡çš„ <code>alt</code> å±æ€§ï¼Œä» â€œDify logoâ€ æ”¹ä¸º â€œYZHU logoâ€ï¼Œæå‡æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰å’Œæ— éšœç¢è®¿é—®ä½“éªŒï¼ˆå±å¹•é˜…è¯»å™¨ä¼šè¯»å– <code>alt</code> æ–‡æœ¬ï¼‰ï¼š</p><ul><li><code>web/app/account/(commonLayout)/header.tsx</code></li><li><code>web/app/components/base/logo/dify-logo.tsx</code></li></ul><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// web/app/components/base/logo/dify-logo.tsx</span><br><span class="line"><span class="deletion">- &lt;img src=&quot;logo.svg&quot; alt=&quot;Dify logo&quot; /&gt;</span></span><br><span class="line"><span class="addition">+ &lt;img src=&quot;logo.svg&quot; alt=&quot;YZHU logo&quot; /&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>alt</code> å±æ€§çš„ä¿®æ”¹éœ€ç¡®ä¿æè¿°å‡†ç¡®ï¼Œåæ˜ å“ç‰Œåç§°ï¼Œæœ‰åŠ©äºæœç´¢å¼•æ“æŠ“å–å’Œæ— éšœç¢å·¥å…·è¯†åˆ«ã€‚</p><h4 id="3-Logo-å›¾ç‰‡æ›´æ–°"><a href="#3-Logo-å›¾ç‰‡æ›´æ–°" class="headerlink" title="3. Logo å›¾ç‰‡æ›´æ–°"></a>3. Logo å›¾ç‰‡æ›´æ–°</h4><p>å°† <code>web/app/components/base/logo/logo.svg</code> æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„ YZHU Logoã€‚ç¡®ä¿æ–° SVG æ–‡ä»¶çš„å°ºå¯¸ä¸åŸæ–‡ä»¶ä¸€è‡´ï¼Œä»¥é¿å…ç•Œé¢å¸ƒå±€é”™ä¹±ã€‚ç¤ºä¾‹ SVG ç»“æ„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web/app/components/base/logo/logo.svg --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;50&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 200 50&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;10&quot;</span> <span class="attr">y</span>=<span class="string">&quot;35&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;24&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#000&quot;</span>&gt;</span>YZHU<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•æ–¹æ³•</strong>ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­æ£€æŸ¥ Logo åœ¨ä¸åŒé¡µé¢å’Œå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤ºæ•ˆæœï¼Œç¡®ä¿æ— æ‹‰ä¼¸æˆ–æ¨¡ç³Šã€‚</p><h3 id="åµŒå…¥å¼è„šæœ¬"><a href="#åµŒå…¥å¼è„šæœ¬" class="headerlink" title="åµŒå…¥å¼è„šæœ¬"></a>åµŒå…¥å¼è„šæœ¬</h3><p>åµŒå…¥å¼è„šæœ¬ <code>embed.js</code> ç”¨äºåœ¨ç½‘é¡µä¸­åµŒå…¥ Dify çš„äº¤äº’ç»„ä»¶ï¼ˆå¦‚èŠå¤©çª—å£ï¼‰ã€‚æœ¬æ¬¡å˜æ›´æ›´æ–°äº†è„šæœ¬ä¸­ä½¿ç”¨çš„å›¾æ ‡æ–‡ä»¶ <code>closeIcon.svg</code> å’Œ <code>openIcon.svg</code>ï¼Œç”¨äº â€œå±•å¼€&#x2F;å…³é—­â€ äº¤äº’æŒ‰é’®ã€‚</p><h4 id="å›¾æ ‡æ–‡ä»¶æ›´æ–°"><a href="#å›¾æ ‡æ–‡ä»¶æ›´æ–°" class="headerlink" title="å›¾æ ‡æ–‡ä»¶æ›´æ–°"></a>å›¾æ ‡æ–‡ä»¶æ›´æ–°</h4><p>åœ¨<code>embed.js</code>å°† <code>closeIcon.svg</code> å’Œ <code>openIcon.svg</code> æ›¿æ¢ä¸ºè‡ªå®šä¹‰ SVG å›¾æ ‡ã€‚SVG æ ¼å¼æ”¯æŒçŸ¢é‡ç¼©æ”¾ï¼Œé€‚åˆé«˜æ¸…å±å¹•ï¼Œä¸”å¯é€šè¿‡ä»£ç è°ƒæ•´æ ·å¼ï¼ˆä¾‹å¦‚é¢œè‰²ã€å¤§å°ï¼‰ã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- closeIcon.svg --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;24&quot;</span> <span class="attr">height</span>=<span class="string">&quot;24&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">fill</span>=<span class="string">&quot;#FF0000&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M10 10L14 14M14 10L10 14&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- openIcon.svg --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;24&quot;</span> <span class="attr">height</span>=<span class="string">&quot;24&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">fill</span>=<span class="string">&quot;#0000FF&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M12 5V19M5 12H19&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šSVG å›¾æ ‡æ”¯æŒåŠ¨æ€ä¿®æ”¹ <code>fill</code> å±æ€§ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢ä¸ºæš—æ¨¡å¼æ—¶æ›´æ”¹é¢œè‰²ï¼‰ï¼Œæ¯”å­—ä½“å›¾æ ‡æ›´çµæ´»ã€‚</p><p><strong>æµ‹è¯•æ–¹æ³•</strong>ï¼šåœ¨ç½‘é¡µä¸­åµŒå…¥ <code>embed.js</code>ï¼Œæ£€æŸ¥äº¤äº’æŒ‰é’®çš„å›¾æ ‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼Œç‚¹å‡»æ—¶æ˜¯å¦è§¦å‘å±•å¼€&#x2F;å…³é—­åŠŸèƒ½ã€‚</p><h3 id="åç»­ä¼˜åŒ–å»ºè®®"><a href="#åç»­ä¼˜åŒ–å»ºè®®" class="headerlink" title="åç»­ä¼˜åŒ–å»ºè®®"></a>åç»­ä¼˜åŒ–å»ºè®®</h3><p>æ–°å¢å“ç‰Œé…ç½®æ–‡ä»¶ï¼šå½“å‰å“ç‰Œæ ‡è¯†ï¼ˆå¦‚ â€œYZHUâ€ï¼‰ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œåç»­ä¿®æ”¹éœ€é€æ–‡ä»¶æ›¿æ¢ã€‚å»ºè®®æ–°å¢ brand.config.jsï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// web/brand.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> brand = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;YZHU&#x27;</span>,</span><br><span class="line">  <span class="attr">logoPath</span>: <span class="string">&#x27;/path/to/logo.svg&#x27;</span>,</span><br><span class="line">  <span class="attr">altText</span>: <span class="string">&#x27;YZHU logo&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç ä¸­å¼•ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; brand &#125; from &#x27;./brand.config.js&#x27;;</span><br><span class="line">const title = `$&#123;prefix&#125;$&#123;brand.name&#125;`;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¼€æºé¡¹ç›®çš„äºŒæ¬¡å¼€å‘ä¸ä¸€å®šéœ€è¦æ”¹åŠ¨æ ¸å¿ƒåŠŸèƒ½ï¼Œåƒæœ¬æ¬¡ Dify å“ç‰Œå®šåˆ¶è¿™æ ·ï¼Œé€šè¿‡ç²¾ç»†åŒ–çš„æ–‡æœ¬æ›¿æ¢ã€è§†è§‰æ›´æ–°å’Œéƒ¨ç½²ä¼˜åŒ–ï¼ŒåŒæ ·èƒ½è®©å·¥å…·æ— ç¼èå…¥ä¼ä¸šä¸šåŠ¡åœºæ™¯ã€‚æœ¬æ–‡æä¾›äº†ä¸€å¥—å¯å¤ç”¨çš„å“ç‰Œæ›¿æ¢æµç¨‹ï¼Œæ¶µç›–å‰ç«¯èµ„æºå’ŒåµŒå…¥å¼è„šæœ¬ï¼Œé€‚åˆä¸­å°å‹ä¼ä¸šæˆ–åˆæ¬¡æ¥è§¦ Dify çš„å¼€å‘è€…ã€‚</p><p>å¦‚æœä½ ä¹Ÿåœ¨è¿›è¡Œ Dify çš„äºŒæ¬¡å¼€å‘ï¼Œæ¬¢è¿åˆ†äº«ä½ çš„ç»éªŒï¼å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ çš„é¡¹ç›®æä¾›å‚è€ƒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;Dify æ˜¯ä¸€æ¬¾å¼€æºçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åº”ç”¨å¼€å‘å¹³å°ï¼Œå‡­å€Ÿå…¶çµæ´»çš„æ’ä»¶æœºåˆ¶å’Œå¯è§†åŒ–ç¼–æ’èƒ½åŠ›ï¼Œæˆä¸ºä¼ä¸šæ„å»º AI åº”ç”¨çš„çƒ­é—¨é€‰æ‹©ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡å“ç‰Œ(ä»¥å“ç‰Œ &lt;code&gt;YZHU&lt;/code&gt; ä¸ºä¾‹)å®šåˆ¶è®© Dify å¹³å°èå…¥å…¶ä¼ä¸šå½¢è±¡ï¼Œå¼ºåŒ–ç”¨æˆ·å¯¹å“ç‰Œçš„è®¤çŸ¥ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶å¯¹æ¯”ï¼šNacosã€Consulã€ZooKeeperä¸etcd</title>
    <link href="https://www.yzhu.name/2025/07/08/Nacos-Consul-Zk-Etcd/"/>
    <id>https://www.yzhu.name/2025/07/08/Nacos-Consul-Zk-Etcd/</id>
    <published>2025-07-08T08:01:07.000Z</published>
    <updated>2025-11-11T03:53:15.771Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ï¼ŒæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’Œåˆ†å¸ƒå¼åè°ƒæ˜¯ä¸‰å¤§æ ¸å¿ƒæŒ‘æˆ˜ã€‚ç›®å‰ä¸šç•Œä¸»æµçš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ Nacosã€Consulã€ZooKeeper å’Œ etcdï¼Œå®ƒä»¬å„è‡ªåŸºäºä¸åŒçš„è®¾è®¡ç†å¿µï¼Œé€‚ç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒåŠŸèƒ½ã€ç‰¹æ€§ç»†èŠ‚ã€é€‚ç”¨åœºæ™¯ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œæ·±å…¥å¯¹æ¯”ï¼Œå¸®åŠ©æŠ€æœ¯å›¢é˜Ÿåœ¨å®é™…é¡¹ç›®ä¸­åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚<span id="more"></span></p><h2 id="æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”æ¦‚è§ˆ"><a href="#æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”æ¦‚è§ˆ" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”æ¦‚è§ˆ"></a>æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”æ¦‚è§ˆ</h2><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>ZooKeeper</strong></th><th><strong>etcd</strong></th><th><strong>Consul</strong></th><th><strong>Nacos</strong></th></tr></thead><tbody><tr><td><strong>è¯ç”Ÿæ—¶é—´</strong></td><td>æœ€æ—© (2006)</td><td>è¾ƒæ–° (2013)</td><td>è¾ƒæ–° (2014)</td><td>æœ€æ–° (2018)</td></tr><tr><td><strong>ä¸»è¦å®šä½</strong></td><td>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</td><td>åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼ŒK8s æ ¸å¿ƒç»„ä»¶</td><td>æœåŠ¡ç½‘æ ¼ä¸æœåŠ¡å‘ç°å¹³å°</td><td>å¾®æœåŠ¡ä¸€ç«™å¼æœåŠ¡æ²»ç†å¹³å°</td></tr><tr><td><strong>ä¸€è‡´æ€§åè®®</strong></td><td>ZAB (ZooKeeper Atomic Broadcast)</td><td>Raft</td><td>Raftï¼ˆå•æ•°æ®ä¸­å¿ƒå¼ºä¸€è‡´ï¼Œè·¨ä¸­å¿ƒæœ€ç»ˆä¸€è‡´ï¼‰</td><td>CP (Raft) &amp; AP (Distro) åŒæ¨¡</td></tr><tr><td><strong>æ•°æ®æ¨¡å‹</strong></td><td>å±‚æ¬¡åŒ–çš„ ZNode èŠ‚ç‚¹ (ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿ)</td><td>æ‰å¹³çš„é”®å€¼å¯¹ (æ”¯æŒèŒƒå›´æŸ¥è¯¢)</td><td>æ‰å¹³çš„é”®å€¼å¯¹ (æ”¯æŒç›®å½•å’Œå‰ç¼€æŸ¥è¯¢)</td><td>æ‰å¹³çš„é”®å€¼å¯¹ (æ”¯æŒåˆ†ç»„å’Œå‘½åç©ºé—´)</td></tr><tr><td><strong>API&#x2F;åè®®</strong></td><td>è‡ªå®šä¹‰ TCP åè®®ï¼ŒJava&#x2F;C å®¢æˆ·ç«¯</td><td>HTTP&#x2F;JSON, gRPC</td><td>HTTP&#x2F;JSON, DNS æ¥å£</td><td>HTTP&#x2F;JSON, gRPC æ¥å£</td></tr><tr><td><strong>æ€§èƒ½ç‰¹ç‚¹</strong></td><td>è¯»å¤šå†™å°‘åœºæ™¯æ€§èƒ½ä¼˜å¼‚</td><td>è¯»å†™æ€§èƒ½å‡é«˜ï¼Œå†™å…¥çº¿æ€§ä¸€è‡´</td><td>è¯»å†™æ€§èƒ½é«˜ï¼Œæ”¯æŒå¥åº·æ£€æŸ¥ä¼˜åŒ–</td><td>æ”¯æŒå¤§è§„æ¨¡å®ä¾‹æ³¨å†Œï¼Œè¯»å†™æ€§èƒ½ä¼˜è¶Š</td></tr><tr><td><strong>å¼€å‘è¯­è¨€</strong></td><td>Java</td><td>Go</td><td>Go</td><td>Java</td></tr><tr><td><strong>é«˜å¯ç”¨ä¸æ‰©å±•æ€§</strong></td><td>éœ€å¥‡æ•°èŠ‚ç‚¹ï¼Œæ‰©å®¹å¤æ‚ï¼Œå¼ºä¸€è‡´æ€§</td><td>åŠ¨æ€æ‰©å®¹ï¼Œå¼ºä¸€è‡´æ€§</td><td>å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼ŒåŠ¨æ€æ‰©ç¼©å®¹</td><td>AP&#x2F;CP å¤åˆæ¨¡å‹ï¼ŒæœåŠ¡æ³¨å†Œé«˜å¯ç”¨ï¼Œé…ç½®éœ€å…³æ³¨ Raft</td></tr><tr><td><strong>è¿ç»´ä¸ç›‘æ§</strong></td><td>æ— åŸç”Ÿ UIï¼Œä¾èµ–ç¬¬ä¸‰æ–¹å·¥å…·</td><td>æä¾› CLI å’Œ APIï¼Œæ”¯æŒ Prometheus</td><td>è‡ªå¸¦ Web UIï¼Œç›‘æ§é›†æˆå‹å¥½</td><td>è‡ªå¸¦ Web æ§åˆ¶å°ï¼ŒPrometheus é›†æˆ</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>æ”¯æŒ SASLã€ACLã€TLSï¼Œé…ç½®å¤æ‚</td><td>æ”¯æŒ TLSã€RBACã€è®¤è¯æœºåˆ¶å®Œå–„</td><td>æ”¯æŒ TLSã€ACLï¼Œä¼ä¸šç‰ˆæ›´å¼º</td><td>æ”¯æŒ TLSã€è®¤è¯ï¼Œéœ€å…³æ³¨ JVM ç›¸å…³å®‰å…¨é…ç½®</td></tr></tbody></table><blockquote><p><strong>æ³¨ï¼šNacos 2.x é‡‡ç”¨å¤åˆä¸€è‡´æ€§æ¨¡å‹ã€‚Raft åè®®ç”¨äºæ‰€æœ‰æŒä¹…åŒ–æ•°æ®ï¼ˆåŒ…æ‹¬é…ç½®ç®¡ç†å’ŒæœåŠ¡çš„æŒä¹…åŒ–å®ä¾‹ï¼‰ï¼Œä¿è¯ CP å¼ºä¸€è‡´æ€§ï¼›è€ŒæœåŠ¡æ³¨å†Œä¸­çš„ä¸´æ—¶å®ä¾‹åˆ™é‡‡ç”¨è‡ªç ”çš„ Distro åè®®ï¼Œå®ç°é«˜å¯ç”¨ä½†å¼±ä¸€è‡´æ€§ã€‚</strong></p></blockquote><hr><h2 id="ç»„ä»¶è¯¦ç»†åˆ†æ"><a href="#ç»„ä»¶è¯¦ç»†åˆ†æ" class="headerlink" title="ç»„ä»¶è¯¦ç»†åˆ†æ"></a>ç»„ä»¶è¯¦ç»†åˆ†æ</h2><h3 id="1-ZooKeeperï¼šåˆ†å¸ƒå¼åè°ƒçš„å…ƒè€"><a href="#1-ZooKeeperï¼šåˆ†å¸ƒå¼åè°ƒçš„å…ƒè€" class="headerlink" title="1. ZooKeeperï¼šåˆ†å¸ƒå¼åè°ƒçš„å…ƒè€"></a>1. ZooKeeperï¼šåˆ†å¸ƒå¼åè°ƒçš„å…ƒè€</h3><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>Apache é¡¶çº§é¡¹ç›®ï¼Œè¯ç”Ÿäº 2006 å¹´ï¼Œæ˜¯åˆ†å¸ƒå¼åè°ƒé¢†åŸŸçš„æ ‡æ†ï¼Œè¢« Kafkaã€Hadoopã€HBase ç­‰å¹¿æ³›é‡‡ç”¨ã€‚</li><li>æä¾›åˆ†å¸ƒå¼é”ã€é¢†å¯¼è€…é€‰ä¸¾ã€é›†ç¾¤æˆå‘˜ç®¡ç†ç­‰åˆ†å¸ƒå¼åŸè¯­ï¼Œæ˜¯è®¸å¤šåº•å±‚ç³»ç»Ÿçš„â€œç¥ç»ä¸­æ¢â€ã€‚</li><li>ä½¿ç”¨æ ‘çŠ¶ç»“æ„ï¼ˆZNodeï¼‰ï¼Œæ”¯æŒ Watch æœºåˆ¶ï¼Œå®ç°äº‹ä»¶é©±åŠ¨çš„æ•°æ®è®¢é˜…ã€‚</li><li>ç”Ÿæ€æˆç†Ÿï¼Œé…åˆ Curator æ¡†æ¶å¯ç®€åŒ–å¼€å‘å¤æ‚åº¦ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>åˆ†å¸ƒå¼åè°ƒä¸ºæ ¸å¿ƒè¯‰æ±‚çš„ç³»ç»Ÿ</li><li>ä¸ Hadoop&#x2F;Kafka ç­‰å¤§æ•°æ®ç”Ÿæ€æ·±åº¦é›†æˆ</li><li>éœ€è¦åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€å…ƒæ•°æ®ç®¡ç†çš„åœºæ™¯</li></ul><p><strong>å±€é™æ€§</strong>ï¼š</p><ul><li>åŸç”Ÿ API è®¾è®¡åº•å±‚ï¼Œå¼€å‘å¤æ‚</li><li>æœåŠ¡å‘ç°èƒ½åŠ›å¼±ï¼Œæ— å†…ç½®å¥åº·æ£€æŸ¥</li><li>é›†ç¾¤æ‰©å®¹éœ€é‡å¯ï¼Œç»´æŠ¤å¤æ‚ï¼Œå¯¹ç½‘ç»œæŠ–åŠ¨æ•æ„Ÿ</li></ul><hr><h3 id="2-etcdï¼šäº‘åŸç”Ÿæ—¶ä»£çš„å¼ºä¸€è‡´å­˜å‚¨åŸºçŸ³"><a href="#2-etcdï¼šäº‘åŸç”Ÿæ—¶ä»£çš„å¼ºä¸€è‡´å­˜å‚¨åŸºçŸ³" class="headerlink" title="2. etcdï¼šäº‘åŸç”Ÿæ—¶ä»£çš„å¼ºä¸€è‡´å­˜å‚¨åŸºçŸ³"></a>2. etcdï¼šäº‘åŸç”Ÿæ—¶ä»£çš„å¼ºä¸€è‡´å­˜å‚¨åŸºçŸ³</h3><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>Kubernetes é»˜è®¤æ•°æ®å­˜å‚¨ï¼Œä¸“ä¸ºäº‘åŸç”Ÿæ¶æ„è®¾è®¡</li><li>ä½¿ç”¨ Raft ç®—æ³•ï¼Œä¿è¯å†™å…¥çº¿æ€§ä¸€è‡´æ€§</li><li>æ”¯æŒ gRPC å’Œ REST APIï¼Œè·¨è¯­è¨€å‹å¥½</li><li>Watch æœºåˆ¶æ”¯æŒäº‹ä»¶ç›‘å¬ï¼Œä¾¿äºé…ç½®æ¨é€</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>Kubernetes ç¯å¢ƒä¸­çš„é…ç½®ä¸å…ƒæ•°æ®å­˜å‚¨</li><li>é«˜å¯ç”¨ã€å¼ºä¸€è‡´æ€§é”®å€¼å­˜å‚¨éœ€æ±‚</li><li>è½»é‡çº§æœåŠ¡æ³¨å†Œä¸­å¿ƒ</li></ul><p><strong>å±€é™æ€§</strong>ï¼š</p><ul><li>é»˜è®¤å•é”®å€¼å¤§å°ä¸è¶…è¿‡ 1.5MBï¼ˆå¯é€šè¿‡å‚æ•°è°ƒæ•´ï¼‰</li><li>ä¸æä¾›æœåŠ¡ç½‘æ ¼ã€å¥åº·æ£€æŸ¥ç­‰æ²»ç†åŠŸèƒ½</li><li>æ›´åå‘å¹³å°ç»„ä»¶ï¼Œç¼ºä¹ä¸€ç«™å¼ç®¡ç†ä½“éªŒ</li></ul><hr><h3 id="3-Consulï¼šæœåŠ¡æ²»ç†çš„å…¨èƒ½é€‰æ‰‹"><a href="#3-Consulï¼šæœåŠ¡æ²»ç†çš„å…¨èƒ½é€‰æ‰‹" class="headerlink" title="3. Consulï¼šæœåŠ¡æ²»ç†çš„å…¨èƒ½é€‰æ‰‹"></a>3. Consulï¼šæœåŠ¡æ²»ç†çš„å…¨èƒ½é€‰æ‰‹</h3><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>é›†æœåŠ¡å‘ç°ã€KV å­˜å‚¨ã€å¥åº·æ£€æŸ¥ã€æœåŠ¡ç½‘æ ¼äºä¸€ä½“</li><li>æ”¯æŒ DNS å’Œ HTTP ä¸¤ç§æœåŠ¡å‘ç°æ–¹å¼</li><li>å†…å»ºå¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼Œè·¨åœ°åŸŸéƒ¨ç½²æ–¹ä¾¿</li><li>Consul Connect æ”¯æŒ mTLSã€æœåŠ¡ä»£ç†ã€ACL ç­‰ç½‘æ ¼èƒ½åŠ›</li><li>è‡ªå¸¦ Web UIï¼ŒçŠ¶æ€ç®¡ç†ç›´è§‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æ³¨å†Œä¸å¥åº·æ£€æŸ¥</li><li>æ„å»ºè·¨åŒºåŸŸæœåŠ¡ç½‘ç»œ</li><li>å¯¹æœåŠ¡ç½‘æ ¼ã€å®‰å…¨åŠ å¯†é€šä¿¡æœ‰è¦æ±‚çš„ç³»ç»Ÿ</li></ul><p><strong>å±€é™æ€§</strong>ï¼š</p><ul><li>å¤šä¸­å¿ƒé—´ä»…æä¾›æœ€ç»ˆä¸€è‡´æ€§</li><li>æœåŠ¡ç½‘æ ¼åŠŸèƒ½éœ€é¢å¤–éƒ¨ç½² Envoy ç­‰ä»£ç†ç»„ä»¶</li><li>ä¼ä¸šç‰ˆåŠŸèƒ½æ›´ä¸°å¯Œï¼Œå¼€æºç‰ˆç•¥æ˜¾ä¸è¶³</li></ul><hr><h3 id="4-Nacosï¼šä¸ºå¾®æœåŠ¡è€Œç”Ÿçš„ä¸€ç«™å¼å¹³å°"><a href="#4-Nacosï¼šä¸ºå¾®æœåŠ¡è€Œç”Ÿçš„ä¸€ç«™å¼å¹³å°" class="headerlink" title="4. Nacosï¼šä¸ºå¾®æœåŠ¡è€Œç”Ÿçš„ä¸€ç«™å¼å¹³å°"></a>4. Nacosï¼šä¸ºå¾®æœåŠ¡è€Œç”Ÿçš„ä¸€ç«™å¼å¹³å°</h3><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>é›†æœåŠ¡æ³¨å†Œã€é…ç½®ç®¡ç†ã€æœåŠ¡æ²»ç†ä¸ºä¸€ä½“ï¼Œé™ä½é›†æˆæˆæœ¬</li><li>æ”¯æŒåŒæ¨¡ä¸€è‡´æ€§æ¨¡å‹ï¼ˆRaft + Distroï¼‰ï¼š<ul><li><strong>Raftï¼ˆCP æ¨¡å¼ï¼‰</strong>ï¼šæŒä¹…åŒ–æ•°æ®ï¼Œå¦‚é…ç½®ä¸æŒä¹…å®ä¾‹</li><li><strong>Distroï¼ˆAP æ¨¡å¼ï¼‰</strong>ï¼šä¸´æ—¶å®ä¾‹æ³¨å†Œï¼Œä¿éšœé«˜å¯ç”¨</li></ul></li><li>ä¸ Spring Cloudã€Dubbo ç­‰ä¸»æµæ¡†æ¶æ·±åº¦é›†æˆ</li><li>æä¾›æœåŠ¡åˆ†ç»„ã€å‘½åç©ºé—´ã€ç°åº¦å‘å¸ƒã€æµé‡è°ƒåº¦ç­‰é«˜çº§èƒ½åŠ›</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>Java æŠ€æœ¯æ ˆå¾®æœåŠ¡é¡¹ç›®</li><li>åŒæ—¶éœ€è¦é…ç½®ä¸­å¿ƒä¸æ³¨å†Œä¸­å¿ƒçš„ç³»ç»Ÿ</li><li>éœ€è¦çµæ´»æœåŠ¡æ²»ç†èƒ½åŠ›çš„ä¸­å¤§å‹é¡¹ç›®</li></ul><p><strong>å±€é™æ€§</strong>ï¼š</p><ul><li>å›½é™…ç¤¾åŒºæ´»è·ƒåº¦ä¸å¦‚ Consulã€etcd</li><li>JVM è¿ç»´è°ƒä¼˜è¦æ±‚é«˜ï¼Œå¤§è§„æ¨¡åœºæ™¯ä¸‹éœ€å…³æ³¨æ•°æ®åº“ä¸çº¿ç¨‹èµ„æºé…ç½®</li></ul><hr><h2 id="é«˜å¯ç”¨æ€§ä¸æ‰©å±•æ€§å¯¹æ¯”"><a href="#é«˜å¯ç”¨æ€§ä¸æ‰©å±•æ€§å¯¹æ¯”" class="headerlink" title="é«˜å¯ç”¨æ€§ä¸æ‰©å±•æ€§å¯¹æ¯”"></a>é«˜å¯ç”¨æ€§ä¸æ‰©å±•æ€§å¯¹æ¯”</h2><ul><li><strong>ZooKeeper</strong>ï¼šéœ€å¥‡æ•°èŠ‚ç‚¹ï¼Œæ‰©å®¹éœ€é‡å¯ï¼Œç¨³å®šæ€§ä¾èµ–ç½‘ç»œçŠ¶å†µ</li><li><strong>etcd</strong>ï¼šæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼ŒRaft ä¿éšœå¼ºä¸€è‡´ï¼Œé€‚åˆäº‘åŸç”Ÿéƒ¨ç½²</li><li><strong>Consul</strong>ï¼šæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåŒæ­¥ï¼Œæœ¬åœ°å¼ºä¸€è‡´ï¼Œè¿œç«¯æœ€ç»ˆä¸€è‡´</li><li><strong>Nacos</strong>ï¼šæœåŠ¡æ³¨å†ŒåŸºäº AP æ¨¡å‹å…·å¤‡æ‰©å±•å¼¹æ€§ï¼Œé…ç½®ç®¡ç†ä¾èµ– CP æ¨¡å¼çš„ Raft é›†ç¾¤</li></ul><hr><h2 id="è¿ç»´ä¸ç›‘æ§å¯¹æ¯”"><a href="#è¿ç»´ä¸ç›‘æ§å¯¹æ¯”" class="headerlink" title="è¿ç»´ä¸ç›‘æ§å¯¹æ¯”"></a>è¿ç»´ä¸ç›‘æ§å¯¹æ¯”</h2><ul><li><strong>ZooKeeper</strong>ï¼šéœ€ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ zkuiã€Exhibitorï¼Œç›‘æ§é…ç½®å¤æ‚</li><li><strong>etcd</strong>ï¼šCLI&#x2F;API ç›´è§‚ï¼Œæ”¯æŒ Prometheus é›†æˆï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜</li><li><strong>Consul</strong>ï¼šè‡ªå¸¦ UIï¼Œæ”¯æŒ Prometheusã€Grafanaï¼Œæ˜“äºè§‚æµ‹ä¸æ•…éšœæ’æŸ¥</li><li><strong>Nacos</strong>ï¼šå†…å»ºæ§åˆ¶å°ï¼Œæ”¯æŒ Prometheusï¼Œç•Œé¢å‹å¥½ï¼Œæ˜“äºå…¥é—¨</li></ul><hr><h2 id="å®‰å…¨æ€§å¯¹æ¯”"><a href="#å®‰å…¨æ€§å¯¹æ¯”" class="headerlink" title="å®‰å…¨æ€§å¯¹æ¯”"></a>å®‰å…¨æ€§å¯¹æ¯”</h2><ul><li><strong>ZooKeeper</strong>ï¼šæ”¯æŒ SASLã€ACLã€TLSï¼Œä½†é…ç½®ç¹ç</li><li><strong>etcd</strong>ï¼šæ”¯æŒ TLS åŠ å¯†ã€å®¢æˆ·ç«¯è®¤è¯ã€RBAC æƒé™æ§åˆ¶ï¼Œå®‰å…¨æ€§å¼º</li><li><strong>Consul</strong>ï¼šæ”¯æŒ TLS å’Œ ACLï¼Œä¼ä¸šç‰ˆå®‰å…¨èƒ½åŠ›æ›´å¼º</li><li><strong>Nacos</strong>ï¼šæ”¯æŒ TLS å’Œè®¤è¯æœºåˆ¶ï¼Œéœ€å…³æ³¨ JVM åŠé…ç½®å®‰å…¨</li></ul><hr><h2 id="ç”Ÿæ€ä¸é›†æˆå¯¹æ¯”"><a href="#ç”Ÿæ€ä¸é›†æˆå¯¹æ¯”" class="headerlink" title="ç”Ÿæ€ä¸é›†æˆå¯¹æ¯”"></a>ç”Ÿæ€ä¸é›†æˆå¯¹æ¯”</h2><table><thead><tr><th>ç»„ä»¶</th><th>é›†æˆç”Ÿæ€</th></tr></thead><tbody><tr><td><strong>ZooKeeper</strong></td><td>Kafkaã€Hadoopã€HBaseã€Java ç³»ç»Ÿ</td></tr><tr><td><strong>etcd</strong></td><td>Kubernetesã€CoreOSã€Go å¾®æœåŠ¡æ¡†æ¶</td></tr><tr><td><strong>Consul</strong></td><td>HashiCorp å·¥å…·é“¾ï¼ˆTerraformã€Nomadï¼‰ã€äº‘åŸç”Ÿç”Ÿæ€</td></tr><tr><td><strong>Nacos</strong></td><td>Spring Cloudã€Dubboã€é˜¿é‡Œäº‘å¾®æœåŠ¡ç”Ÿæ€ï¼Œä¸­å›½ç¤¾åŒºæ´»è·ƒ</td></tr></tbody></table><hr><h2 id="ç»„ä»¶é€‰æ‹©æŒ‡å—"><a href="#ç»„ä»¶é€‰æ‹©æŒ‡å—" class="headerlink" title="ç»„ä»¶é€‰æ‹©æŒ‡å—"></a>ç»„ä»¶é€‰æ‹©æŒ‡å—</h2><h3 id="æŒ‰æ ¸å¿ƒéœ€æ±‚é€‰å‹"><a href="#æŒ‰æ ¸å¿ƒéœ€æ±‚é€‰å‹" class="headerlink" title="æŒ‰æ ¸å¿ƒéœ€æ±‚é€‰å‹"></a>æŒ‰æ ¸å¿ƒéœ€æ±‚é€‰å‹</h3><ul><li><strong>åˆ†å¸ƒå¼åè°ƒéœ€æ±‚é«˜</strong>ï¼šZooKeeperï¼ˆé… Curatorï¼‰æˆ– etcd</li><li><strong>æ³¨å†Œä¸­å¿ƒ + å¥åº·æ£€æŸ¥</strong>ï¼šConsul æˆ– Nacos æ›´é€‚åˆ</li><li><strong>é…ç½®ä¸­å¿ƒä¸ºä¸»</strong>ï¼šNacosï¼ˆåŠŸèƒ½é½å…¨ï¼‰ã€etcdï¼ˆä¸€è‡´æ€§å¼ºï¼‰ã€Consulï¼ˆKVå­˜å‚¨ç¨³å¥ï¼‰</li><li><strong>æœåŠ¡ç½‘æ ¼éœ€æ±‚å¼º</strong>ï¼šé¦–é€‰ Consul Connectï¼ˆæˆ–è€ƒè™‘ Istioï¼‰</li><li><strong>Java æŠ€æœ¯æ ˆ</strong>ï¼šNacos ä¸ Spring Cloud é›†æˆæœ€é¡ºç•…</li></ul><h3 id="æŒ‰å›¢é˜ŸæŠ€æœ¯æ ˆé€‰å‹"><a href="#æŒ‰å›¢é˜ŸæŠ€æœ¯æ ˆé€‰å‹" class="headerlink" title="æŒ‰å›¢é˜ŸæŠ€æœ¯æ ˆé€‰å‹"></a>æŒ‰å›¢é˜ŸæŠ€æœ¯æ ˆé€‰å‹</h3><ul><li><strong>åå‘ Java</strong>ï¼šZooKeeper æˆ– Nacos</li><li><strong>Go&#x2F;K8s ç¯å¢ƒ</strong>ï¼šetcd æˆ– Consul</li><li><strong>å¤§æ•°æ®ç³»ç»Ÿ</strong>ï¼šZooKeeper ä¸ºé¦–é€‰</li></ul><h3 id="æŒ‰è§„æ¨¡ä¸è¿ç»´èƒ½åŠ›é€‰å‹"><a href="#æŒ‰è§„æ¨¡ä¸è¿ç»´èƒ½åŠ›é€‰å‹" class="headerlink" title="æŒ‰è§„æ¨¡ä¸è¿ç»´èƒ½åŠ›é€‰å‹"></a>æŒ‰è§„æ¨¡ä¸è¿ç»´èƒ½åŠ›é€‰å‹</h3><ul><li><strong>å°å›¢é˜Ÿåˆåˆ›é¡¹ç›®</strong>ï¼šNacos ä¸Šæ‰‹å¿«ï¼Œç»´æŠ¤ç®€å•</li><li><strong>å¤§è§„æ¨¡å¾®æœåŠ¡ä½“ç³»</strong>ï¼šConsul&#x2F;Nacos å¯åº”å¯¹å¤§å¹¶å‘</li><li><strong>æç®€æ¶æ„åå¥½è€…</strong>ï¼šetcd åŠŸèƒ½èšç„¦ï¼Œéƒ¨ç½²ç®€ä¾¿</li></ul><hr><h2 id="å…¸å‹åœºæ™¯æ¨èæ–¹æ¡ˆ"><a href="#å…¸å‹åœºæ™¯æ¨èæ–¹æ¡ˆ" class="headerlink" title="å…¸å‹åœºæ™¯æ¨èæ–¹æ¡ˆ"></a>å…¸å‹åœºæ™¯æ¨èæ–¹æ¡ˆ</h2><ol><li><p><strong>ä¼ ç»Ÿ Java å¾®æœåŠ¡ï¼ˆé K8sï¼‰</strong>ï¼š</p><ul><li>æœåŠ¡æ²»ç†ï¼šNacosï¼ˆSpring Cloud æ·±åº¦é›†æˆï¼‰</li><li>åˆ†å¸ƒå¼åè°ƒï¼šetcd æˆ– ZooKeeper + Curator</li><li>ä¸€ä½“åŒ–æ–¹æ¡ˆï¼šNacos æ”¯æŒæœåŠ¡æ³¨å†Œ + é…ç½®ç®¡ç†</li></ul></li><li><p><strong>Kubernetes å®¹å™¨å¹³å°</strong>ï¼š</p><ul><li>æ ¸å¿ƒæ•°æ®å­˜å‚¨ï¼šetcdï¼ˆK8s æ ‡é…ï¼‰</li><li>æœåŠ¡æ³¨å†Œï¼šK8s Service + CoreDNS</li><li>é«˜çº§é…ç½®ä¸­å¿ƒï¼šetcd æˆ– Nacos</li></ul></li><li><p><strong>è·¨åœ°åŸŸéƒ¨ç½²ç³»ç»Ÿ</strong>ï¼š</p><ul><li>æœåŠ¡ç½‘ç»œç®¡ç†ï¼šConsulï¼ˆå†…å»ºå¤šæ•°æ®ä¸­å¿ƒï¼‰</li><li>é…ç½®ä¸­å¿ƒï¼šConsul KV æˆ– Nacosï¼ˆå‘½åç©ºé—´éš”ç¦»ï¼‰</li></ul></li></ol><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½ç»„ä»¶æ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„é€‰æ‹©ï¼Œåªæœ‰å¥‘åˆä¸šåŠ¡åœºæ™¯çš„æœ€ä¼˜è§£ã€‚ZooKeeper æ˜¯åè°ƒé¢†åŸŸçš„ç»å…¸åŸºçŸ³ï¼Œetcd æˆä¸ºäº‘åŸç”Ÿä¸­çš„å¼ºä¸€è‡´æ ¸å¿ƒï¼ŒConsul åœ¨æœåŠ¡ç½‘æ ¼å’Œç½‘ç»œæ²»ç†ä¸­ç‹¬å…·ä¼˜åŠ¿ï¼Œè€Œ Nacos æä¾›äº†å¾®æœåŠ¡ä½“ç³»ä¸‹çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><p>å®é™…é¡¹ç›®ä¸­å»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚ã€æŠ€æœ¯ç”Ÿæ€ã€å›¢é˜Ÿèƒ½åŠ›ä¸‰æ–¹é¢ç»¼åˆè¯„ä¼°ï¼Œçµæ´»é€‰å‹ã€‚é€šå¸¸å¾®æœåŠ¡ä½“ç³»ä¸‹ï¼Œ<strong>Nacos å’Œ Consul</strong> æ˜¯å…¼é¡¾åŠŸèƒ½ä¸å¤æ‚åº¦çš„ä¼˜é€‰ï¼›è€Œåœ¨ K8s ç¯å¢ƒä¸­ï¼Œ<strong>etcd</strong> æ˜¯ä¸å¯æ›¿ä»£çš„åŸºç¡€è®¾æ–½æ ¸å¿ƒã€‚</p><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://nacos.io/">Nacos</a></li><li><a href="https://www.consul.io/">Consul</a></li><li><a href="https://zookeeper.apache.org/">ZooKeeper</a></li><li><a href="https://etcd.io/">etcd</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ï¼ŒæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’Œåˆ†å¸ƒå¼åè°ƒæ˜¯ä¸‰å¤§æ ¸å¿ƒæŒ‘æˆ˜ã€‚ç›®å‰ä¸šç•Œä¸»æµçš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ Nacosã€Consulã€ZooKeeper å’Œ etcdï¼Œå®ƒä»¬å„è‡ªåŸºäºä¸åŒçš„è®¾è®¡ç†å¿µï¼Œé€‚ç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒåŠŸèƒ½ã€ç‰¹æ€§ç»†èŠ‚ã€é€‚ç”¨åœºæ™¯ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œæ·±å…¥å¯¹æ¯”ï¼Œå¸®åŠ©æŠ€æœ¯å›¢é˜Ÿåœ¨å®é™…é¡¹ç›®ä¸­åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://www.yzhu.name/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Biometric-Based Payment Product</title>
    <link href="https://www.yzhu.name/2025/04/26/Biometric-Based-Payment-Product/"/>
    <id>https://www.yzhu.name/2025/04/26/Biometric-Based-Payment-Product/</id>
    <published>2025-04-26T11:55:19.000Z</published>
    <updated>2025-11-11T03:53:15.766Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´å®Œæˆäº†ä¸€ä¸ªåŸºäºç”Ÿç‰©è¯†åˆ«æŠ€æœ¯çš„æ”¯ä»˜äº§å“æ–¹æ¡ˆè®¾è®¡ã€‚è¯¥æ–¹æ¡ˆæ—¨åœ¨é€šè¿‡ç”Ÿç‰©ç‰¹å¾è¯†åˆ«ï¼ˆå¦‚æŒé™è„‰æ‰«æï¼‰å®ç°æ— éœ€æ‰‹æœºçš„ä¾¿æ·æ”¯ä»˜ä½“éªŒï¼Œä¸ºç”¨æˆ·å’Œå•†æˆ·æä¾›æ›´åŠ å®‰å…¨ã€é«˜æ•ˆçš„æ”¯ä»˜è§£å†³æ–¹æ¡ˆã€‚ç»è¿‡å¯¹æ•æ„Ÿä¿¡æ¯çš„è„±æ•å¤„ç†ï¼Œæˆ‘å°†è¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒè®¾è®¡ç†å¿µã€ç³»ç»Ÿæ¶æ„å’Œå…³é”®æµç¨‹è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½ä¸ºå¯¹ç±»ä¼¼æŠ€æœ¯æ„Ÿå…´è¶£çš„è¯»è€…æä¾›ä¸€äº›å‚è€ƒå’Œå¯å‘ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¯¥æ”¯ä»˜äº§å“çš„ç›®æ ‡ã€æ ¸å¿ƒåŠŸèƒ½ã€ç³»ç»Ÿæ¶æ„ä»¥åŠäº¤äº’æµç¨‹ï¼Œå±•ç¤ºå¦‚ä½•å°†ç”Ÿç‰©è¯†åˆ«æŠ€æœ¯ä¸æ”¯ä»˜ç³»ç»Ÿæœ‰æœºç»“åˆï¼Œæ‰“é€ ä¸€ä¸ªæ—¢å®‰å…¨åˆä¾¿æ·çš„æ”¯ä»˜ç”Ÿæ€ç³»ç»Ÿã€‚<span id="more"></span></p><p>åœ¨æŠ€æœ¯å¿«é€Ÿè¿­ä»£çš„ä»Šå¤©ï¼Œç”Ÿç‰©è¯†åˆ«æ”¯ä»˜ä»£è¡¨äº†æœªæ¥æ”¯ä»˜æ–¹å¼çš„é‡è¦å‘å±•æ–¹å‘ä¹‹ä¸€ã€‚é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å¸Œæœ›èƒ½åˆ†äº«è¿™ä¸€é¢†åŸŸçš„ä¸€äº›æ€è€ƒå’Œå®è·µç»éªŒã€‚</p><h1 id="Biometric-Based-Payment-Product"><a href="#Biometric-Based-Payment-Product" class="headerlink" title="Biometric-Based Payment Product"></a>Biometric-Based Payment Product</h1><h2 id="1-Project-Overview"><a href="#1-Project-Overview" class="headerlink" title="1. Project Overview"></a>1. Project Overview</h2><p>This project aims to provide an innovative, convenient, and secure payment solution for users, allowing them to make payments without a phone using biometric features (such as palm vein scanning). The product will integrate payment API and biometric capture technology from a partner vendor to deliver a new payment experience for users and an efficient and secure method of receiving payments for merchants. </p><h2 id="2-Project-Goals"><a href="#2-Project-Goals" class="headerlink" title="2. Project Goals"></a>2. Project Goals</h2><ul><li>To provide users with a convenient way to make payments without a phone</li><li>To enhance payment security and reduce the risk of fraud through multi-factor authentication</li><li>To simplify the payment process and improve transaction efficiency</li><li>To offer merchants a modern method of receiving payments with real-time settlement</li><li>To comply with local payment regulatory requirements and data protection standards</li><li>To ensure system scalability and high availability</li></ul><h2 id="3-Product-Core-Feature-List"><a href="#3-Product-Core-Feature-List" class="headerlink" title="3. Product Core Feature List"></a>3. Product Core Feature List</h2><h4 id="3-1-User-Features"><a href="#3-1-User-Features" class="headerlink" title="3.1 User Features:"></a>3.1 User Features:</h4><ul><li>User account registration with multi-factor authentication</li><li>Biometric feature (e.g., palm vein) capture and secure encryption</li><li>Initiating payments by scanning biometric features at participating merchants</li><li>Real-time payment notifications (via biometric capture device, APP, SMS, Email, WhatsApp Message)</li><li>Detailed transaction history with advanced filtering (via App)</li><li>Comprehensive user account management (card binding, password change, security settings)</li><li>Emergency account freeze functionality</li></ul><h4 id="3-2-Merchant-Features"><a href="#3-2-Merchant-Features" class="headerlink" title="3.2 Merchant Features:"></a>3.2 Merchant Features:</h4><ul><li>Real-time payment processing and confirmation</li><li>Automated refund processing with approval workflow</li><li>Flexible settlement cycles (T+0, T+1) with detailed reporting</li><li>Advanced transaction search and export capabilities</li><li>Detailed settlement reports and reconciliation tools</li><li>Merchant profile and branch management</li><li>Custom payment limit settings</li><li>Integration with existing POS systems</li></ul><h4 id="3-3-System-Management-Features"><a href="#3-3-System-Management-Features" class="headerlink" title="3.3 System Management Features:"></a>3.3 System Management Features:</h4><ul><li>Centralized user account management with audit trails</li><li>Real-time transaction monitoring and fraud detection</li><li>Device health monitoring and remote management</li><li>Configurable system parameters and business rules</li><li>Comprehensive reporting with data visualization</li><li>System performance monitoring and alerts</li><li>Audit logging for all critical operations</li><li>Automated backup and disaster recovery</li></ul><h2 id="4-System-Architecture"><a href="#4-System-Architecture" class="headerlink" title="4 System Architecture"></a>4 System Architecture</h2><p>To serve 500k users with room for growth, this system involves the following enhanced components:</p><ul><li><strong>Biometric Capture Device:</strong> Secure biometric capture with encryption and matching capabilities</li><li><strong>User App:</strong> The main entry point for user registration, account management, transaction viewing, etc.</li><li><strong>User Backend System:</strong> core business logic processing center, responsible for user management, biometric data management, interaction with Tap API, transaction processing, security control, etc.</li><li><strong>Payment API:</strong> Used to process actual payment transactions, including fund deduction and settlement.</li><li><strong>Merchant Backend (Web):</strong> The main entry point for merchants to receive payments, view transaction records, etc.</li><li><strong>Admin Backend (Web):</strong> Used by system administrators to manage system, generate reports, etc.</li><li><strong>Job Service:</strong> Used for scheduled tasks, such as payment reconciliationï¼Œdata compensation, etc.</li><li><strong>Database:</strong> Used to store user information, transaction records, etc.(maybe master-slave architecture)</li><li><strong>Message Queue:</strong> Used for asynchronous message processing, such as payment notification, etc.</li><li><strong>Cache Layer:</strong> Distributed caching for performance optimization</li><li><strong>Monitoring System:</strong> Real-time system monitoring and alerting</li></ul><p>In order to ensure the systemâ€™s scalability and high availability, the system deployment is implemented as described below:</p><pre class="mermaid">flowchart TB    subgraph payment gateway        Payment-Gateway[third-payment-gateway]     end    subgraph Storage        MySQL[RDS-MySQL]         Redis[Redis]    end        subgraph MessageQueue        MQ[RabbitMQ]    end    subgraph backend        BackendService[backend-service] -->|JDBC| MySQL        BackendService -->|Redis API| Redis        BackendService -->|API| Payment-Gateway        BackendService -->|send| MQ        Payment-Gateway -.->|async| BackendService    end    subgraph user        App[App] -->|REST API| BackendService        BiometricDevice[biometric-device] --> BackendService    end    subgraph merchant        WebMerchant[Merchant-UI] -->Merchant-Service        Merchant-Service-->|JDBC| MySQL        Merchant-Service-->|Redis API| Redis    end    subgraph operation admin        WebAdmin[Admin-UI] -->Admin-Service        Admin-Service-->|JDBC| MySQL        Admin-Service-->|Redis API| Redis    end        subgraph job        Job-Service -->|JDBC| MySQL        Job-Service -->|Redis API| Redis        Job-Service -.->|consume| MQ    end</pre><h2 id="5-Core-Interactive-Process"><a href="#5-Core-Interactive-Process" class="headerlink" title="5. Core Interactive Process"></a>5. Core Interactive Process</h2><h4 id="5-1-Registration"><a href="#5-1-Registration" class="headerlink" title="5.1 Registration"></a>5.1 Registration</h4><pre class="mermaid">sequenceDiagram    participant User    participant App    participant BackendService    participant BiometricDevice    User->>App: Initiate Registration Request    App->>BackendService: Send Registration Request (User Information)    BackendService->>BiometricDevice: Request Biometric Capture    BiometricDevice->>User: Prompt User for Biometric Capture    User->>BiometricDevice: Complete Biometric Capture    BiometricDevice->>BackendService: Send Biometric Data    BackendService->>Database: Store User Information and Biometric Information    Database-->>BackendService: Return Storage Result    BackendService-->>App: Return Registration Success Information    App->>User: Display Registration Success</pre><h4 id="5-2-Link-Bank-Card"><a href="#5-2-Link-Bank-Card" class="headerlink" title="5.2 Link Bank Card"></a>5.2 Link Bank Card</h4><pre class="mermaid">sequenceDiagram    participant User    participant App    participant BackendService    participant Tap as Payment API    User->>App: Initiate Card Linking    App->>BackendService: Request Card Linking Initiation (User ID)    BackendService->>App: Instruct App to Present Payment's Secure Form    App->>User: Display Payment's Secure Card Input Form    User->>App: Enter Bank Card Details    App->>Tap: Send Card Details Securely (via SDK or Payment Page)    Tap-->>App: Return Card Token    App->>BackendService: Send Card Token and User ID    BackendService->>Database: Associate Card Token with User Account    Database-->>BackendService: Return Association Result    BackendService-->>App: Return Card Linking Success Confirmation    App->>User: Display "Card Linked Successfully"</pre><h4 id="5-3-Payment"><a href="#5-3-Payment" class="headerlink" title="5.3 Payment"></a>5.3 Payment</h4><pre class="mermaid">sequenceDiagram    participant User    participant BiometricDevice    participant BackendService    participant Tap as Payment API    User->>BiometricDevice: Initiate Payment Request    BiometricDevice->>BackendService: Send Payment Request (Device ID, May Contain Initial User Identification)    BackendService->>BiometricDevice: Request Biometric Verification    BiometricDevice->>User: Prompt User for Biometric Verification    User->>BiometricDevice: Complete Biometric Verification    BiometricDevice->>BackendService: Send Biometric Data    BackendService->>Database: Query User Biometric Information    Database-->>BackendService: Return User Biometric Information    alt Verification Successful        BackendService->>Database: Retrieve User's Card Token        Database-->>BackendService: Return Card Token        BackendService->>Tap: Initiate Payment Request (Amount, Card Token, Merchant ID, etc.)        Tap-->>BackendService: Return Payment Result        BackendService->>BiometricDevice: Return Payment Success Information        BiometricDevice->>User: Display Payment Success    else Verification Failed        BackendService->>BiometricDevice: Return Payment Failure Information        BiometricDevice->>User: Display Payment Failure    end</pre><h2 id="6-Security-and-Compliance-Considerations"><a href="#6-Security-and-Compliance-Considerations" class="headerlink" title="6. Security and Compliance Considerations"></a>6. Security and Compliance Considerations</h2><h4 id="6-1-Data-Security"><a href="#6-1-Data-Security" class="headerlink" title="6.1 Data Security"></a>6.1 Data Security</h4><ul><li>End-to-end encryption for biometric data storage and transmission</li><li>Strict access control mechanisms for sensitive data</li><li>Separation of biometric data from user identity information</li><li>Regular security audits and penetration testing</li><li>Multi-layered security architecture with defense-in-depth approach</li></ul><h4 id="6-2-Compliance"><a href="#6-2-Compliance" class="headerlink" title="6.2 Compliance"></a>6.2 Compliance</h4><ul><li>Adherence to payment industry regulations and standards (PCI DSS)</li><li>Compliance with data protection regulations (GDPR or local equivalents)</li><li>Implementation of comprehensive user privacy protection mechanisms</li><li>Complete compliance audit trail to meet regulatory requirements</li><li>Regular compliance reviews and updates</li></ul><h2 id="7-Performance-and-Scalability"><a href="#7-Performance-and-Scalability" class="headerlink" title="7. Performance and Scalability"></a>7. Performance and Scalability</h2><h4 id="7-1-Performance-Metrics"><a href="#7-1-Performance-Metrics" class="headerlink" title="7.1 Performance Metrics"></a>7.1 Performance Metrics</h4><ul><li>Transaction response time: Average &lt;1 second, 99% of transactions &lt;3 seconds</li><li>System throughput: Peak capacity of 100+ transaction requests per second</li><li>System availability: 99.99% uptime (less than 1 hour of unplanned downtime annually)</li><li>Data consistency: Ensuring integrity and consistency of all transaction data</li><li>Biometric matching accuracy: False acceptance rate &lt;0.001%, false rejection rate &lt;1%</li></ul><h4 id="7-2-Scalability-Strategy"><a href="#7-2-Scalability-Strategy" class="headerlink" title="7.2 Scalability Strategy"></a>7.2 Scalability Strategy</h4><ul><li>Automated elastic scaling based on load patterns</li><li>Capacity planning for 300% growth over the next 2 years</li></ul><h2 id="8-Implementation-and-Operations"><a href="#8-Implementation-and-Operations" class="headerlink" title="8. Implementation and Operations"></a>8. Implementation and Operations</h2><h4 id="8-1-Implementation-Roadmap"><a href="#8-1-Implementation-Roadmap" class="headerlink" title="8.1 Implementation Roadmap"></a>8.1 Implementation Roadmap</h4><ul><li>Phase 1: Core payment functionality development and testing (2 months)</li><li>Phase 2: Merchant management system and settlement functionality (1 months)</li><li>Phase 3: Pilot deployment and optimization (1 months)</li><li>Phase 4: Full-scale rollout and continuous improvement (ongoing)</li></ul><h4 id="8-2-Operational-Strategy"><a href="#8-2-Operational-Strategy" class="headerlink" title="8.2 Operational Strategy"></a>8.2 Operational Strategy</h4><ul><li>24&#x2F;7 monitoring system with real-time alerts</li><li>Automated deployment and rollback mechanisms</li><li>Comprehensive logging and analytics system</li><li>Detailed disaster recovery plan with regular testing</li><li>Continuous performance optimization and capacity planning</li></ul><h2 id="å†™åˆ°æœ€å"><a href="#å†™åˆ°æœ€å" class="headerlink" title="å†™åˆ°æœ€å"></a>å†™åˆ°æœ€å</h2><p>ä»¥ä¸Šæ˜¯è¿™ä¸ªé¡¹ç›®çš„å®Œæ•´æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆé€šè¿‡æ•´åˆç”Ÿç‰©è¯†åˆ«æŠ€æœ¯ä¸æ”¯ä»˜APIï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ— éœ€æ‰‹æœºå³å¯å®Œæˆæ”¯ä»˜çš„ä¾¿æ·æ–¹å¼ã€‚ç³»ç»Ÿæ¶æ„è®¾è®¡å……åˆ†è€ƒè™‘äº†å®‰å…¨æ€§ã€å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§ï¼Œèƒ½å¤Ÿæ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·ç¾¤ä½“çš„ä½¿ç”¨éœ€æ±‚ã€‚</p><p>é€šè¿‡å®æ–½è¿™ä¸€æ”¯ä»˜è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿï¼š</p><ul><li>ä¸ºç”¨æˆ·æä¾›æ›´åŠ ä¾¿æ·ã€å®‰å…¨çš„æ”¯ä»˜ä½“éªŒ</li><li>ä¸ºå•†æˆ·æä¾›æ›´åŠ é«˜æ•ˆã€å¯é çš„æ”¶æ¬¾æ–¹å¼</li></ul><p>æœªæ¥ï¼Œæˆ‘ä»¬è®¡åˆ’è¿›ä¸€æ­¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œæ‰©å±•æ›´å¤šåœºæ™¯åº”ç”¨ï¼Œå¦‚å°†ç”Ÿç‰©è¯†åˆ«æ”¯ä»˜æŠ€æœ¯åº”ç”¨äºå¤šä¸ªé¢†åŸŸã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°†æŒç»­å…³æ³¨ç”Ÿç‰©è¯†åˆ«æŠ€æœ¯çš„å‘å±•ï¼Œæ¢ç´¢æ›´å¤šåˆ›æ–°çš„æ”¯ä»˜è§£å†³æ–¹æ¡ˆï¼Œä¸ºç”¨æˆ·å’Œå•†æˆ·åˆ›é€ æ›´å¤§çš„ä»·å€¼ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å‰ä¸€æ®µæ—¶é—´å®Œæˆäº†ä¸€ä¸ªåŸºäºç”Ÿç‰©è¯†åˆ«æŠ€æœ¯çš„æ”¯ä»˜äº§å“æ–¹æ¡ˆè®¾è®¡ã€‚è¯¥æ–¹æ¡ˆæ—¨åœ¨é€šè¿‡ç”Ÿç‰©ç‰¹å¾è¯†åˆ«ï¼ˆå¦‚æŒé™è„‰æ‰«æï¼‰å®ç°æ— éœ€æ‰‹æœºçš„ä¾¿æ·æ”¯ä»˜ä½“éªŒï¼Œä¸ºç”¨æˆ·å’Œå•†æˆ·æä¾›æ›´åŠ å®‰å…¨ã€é«˜æ•ˆçš„æ”¯ä»˜è§£å†³æ–¹æ¡ˆã€‚ç»è¿‡å¯¹æ•æ„Ÿä¿¡æ¯çš„è„±æ•å¤„ç†ï¼Œæˆ‘å°†è¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒè®¾è®¡ç†å¿µã€ç³»ç»Ÿæ¶æ„å’Œå…³é”®æµç¨‹è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½ä¸ºå¯¹ç±»ä¼¼æŠ€æœ¯æ„Ÿå…´è¶£çš„è¯»è€…æä¾›ä¸€äº›å‚è€ƒå’Œå¯å‘ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¯¥æ”¯ä»˜äº§å“çš„ç›®æ ‡ã€æ ¸å¿ƒåŠŸèƒ½ã€ç³»ç»Ÿæ¶æ„ä»¥åŠäº¤äº’æµç¨‹ï¼Œå±•ç¤ºå¦‚ä½•å°†ç”Ÿç‰©è¯†åˆ«æŠ€æœ¯ä¸æ”¯ä»˜ç³»ç»Ÿæœ‰æœºç»“åˆï¼Œæ‰“é€ ä¸€ä¸ªæ—¢å®‰å…¨åˆä¾¿æ·çš„æ”¯ä»˜ç”Ÿæ€ç³»ç»Ÿã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="æŠ€æœ¯æ–¹æ¡ˆ" scheme="https://www.yzhu.name/tags/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘è€…å¿…å¤‡çš„åœ¨çº¿å·¥å…·é›†åˆ</title>
    <link href="https://www.yzhu.name/2024/11/15/efficiency-labs/"/>
    <id>https://www.yzhu.name/2024/11/15/efficiency-labs/</id>
    <published>2024-11-15T14:16:33.000Z</published>
    <updated>2025-01-10T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†æ ¼å¼è½¬æ¢ã€æ—¥æœŸè®¡ç®—ã€ç¼–ç è§£ç ç­‰åŸºç¡€æ“ä½œã€‚è¿™äº›ä»»åŠ¡è¦ä¹ˆéœ€è¦åœ¨å¼€å‘ç¯å¢ƒä¸­ç¼–å†™ä»£ç å®ç°ï¼Œè¦ä¹ˆéœ€è¦åœ¨ç½‘ä¸Šæœç´¢å¯¹åº”çš„åœ¨çº¿å·¥å…·ã€‚ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ï¼Œæˆ‘æ•´åˆäº†ä¸€ç³»åˆ—å¸¸ç”¨å·¥å…·ï¼Œå¹¶å°†å®ƒä»¬é›†æˆåˆ° <a href="https://labs.yzhu.name" target="_blank"><strong>æ•ˆç‡å®éªŒå®¤</strong></a> ä¸­ã€‚</p><span id="more"></span><h2 id="å·¥å…·åˆ—è¡¨"><a href="#å·¥å…·åˆ—è¡¨" class="headerlink" title="å·¥å…·åˆ—è¡¨"></a>å·¥å…·åˆ—è¡¨</h2><p>ç›®å‰è¯¥å·¥å…·ç«™æä¾›ä»¥ä¸‹ 8 ä¸ªåœ¨çº¿å·¥å…·ï¼Œå…¨éƒ¨å…è´¹ä½¿ç”¨ï¼Œæ— éœ€æ³¨å†Œï¼š</p><h3 id="1-æ—¥æœŸè®¡ç®—å™¨"><a href="#1-æ—¥æœŸè®¡ç®—å™¨" class="headerlink" title="1. æ—¥æœŸè®¡ç®—å™¨"></a>1. æ—¥æœŸè®¡ç®—å™¨</h3><p><a href="https://labs.yzhu.name/date-calculator" target="_blank">https://labs.yzhu.name/date-calculator</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè®¡ç®—é¡¹ç›®å‘¨æœŸã€è´¦å•æ—¥æœŸã€ä¼šå‘˜åˆ°æœŸæ—¶é—´ç­‰</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å·®</li><li>æ—¥æœŸåŠ &#x2F;å‡å¤©æ•°è®¡ç®—</li><li>æ”¯æŒç›´è§‚çš„æ—¥æœŸé€‰æ‹©å™¨</li></ul><h3 id="2-å•ä½è½¬æ¢å™¨"><a href="#2-å•ä½è½¬æ¢å™¨" class="headerlink" title="2. å•ä½è½¬æ¢å™¨"></a>2. å•ä½è½¬æ¢å™¨</h3><p><a href="https://labs.yzhu.name/unit-converter" target="_blank">https://labs.yzhu.name/unit-converter</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå¤„ç†è·¨å›½é¡¹ç›®æ—¶çš„å•ä½æ¢ç®—ï¼Œå¦‚ç¾å›½é¡¹ç›®å¸¸ç”¨çš„è‹±åˆ¶å•ä½è½¬æ¢</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>é•¿åº¦è½¬æ¢ï¼šç±³ã€åƒç±³ã€å˜ç±³ã€æ¯«ç±³ã€è‹±å°ºã€è‹±å¯¸ã€ç ã€è‹±é‡Œ</li><li>é‡é‡è½¬æ¢ï¼šåƒå…‹ã€å…‹ã€ç£…ã€ç›å¸ç­‰</li><li>ä½“ç§¯è½¬æ¢ï¼šå‡ã€æ¯«å‡ã€åŠ ä»‘ã€å“è„±ç­‰</li><li>æ¸©åº¦è½¬æ¢ï¼šæ‘„æ°åº¦ã€åæ°åº¦ã€å¼€å°”æ–‡</li></ul><h3 id="3-JSON-æ ¼å¼åŒ–ä¸éªŒè¯"><a href="#3-JSON-æ ¼å¼åŒ–ä¸éªŒè¯" class="headerlink" title="3. JSON æ ¼å¼åŒ–ä¸éªŒè¯"></a>3. JSON æ ¼å¼åŒ–ä¸éªŒè¯</h3><p><a href="https://labs.yzhu.name/json-formatter" target="_blank">https://labs.yzhu.name/json-formatter</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè°ƒè¯• API è¿”å›ç»“æœã€é…ç½®æ–‡ä»¶æ ¼å¼åŒ–</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>JSON æ ¼å¼åŒ–ï¼ˆå¸¦ç¼©è¿›å’Œè¯­æ³•é«˜äº®ï¼‰</li><li>JSON å‹ç¼©ï¼ˆå•è¡Œè¾“å‡ºï¼‰</li><li>JSON è¯­æ³•éªŒè¯ï¼Œå¿«é€Ÿå®šä½é”™è¯¯ä½ç½®</li></ul><h3 id="4-ç¼–ç -è§£ç å·¥å…·"><a href="#4-ç¼–ç -è§£ç å·¥å…·" class="headerlink" title="4. ç¼–ç &#x2F;è§£ç å·¥å…·"></a>4. ç¼–ç &#x2F;è§£ç å·¥å…·</h3><p><a href="https://labs.yzhu.name/encoder-decoder" target="_blank">https://labs.yzhu.name/encoder-decoder</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ•°æ®ä¼ è¾“ç¼–ç ã€å¯†ç å“ˆå¸Œç”Ÿæˆã€URL ç¼–ç å¤„ç†</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>Base64 ç¼–ç &#x2F;è§£ç </li><li>URL ç¼–ç &#x2F;è§£ç </li><li>MD5 å“ˆå¸Œç”Ÿæˆ</li><li>SHA-1ã€SHA-256 å“ˆå¸Œç”Ÿæˆ</li><li>DES åŠ å¯†&#x2F;è§£å¯†</li></ul><h3 id="5-Unix-æ—¶é—´æˆ³è½¬æ¢"><a href="#5-Unix-æ—¶é—´æˆ³è½¬æ¢" class="headerlink" title="5. Unix æ—¶é—´æˆ³è½¬æ¢"></a>5. Unix æ—¶é—´æˆ³è½¬æ¢</h3><p><a href="https://labs.yzhu.name/timestamp-converter" target="_blank">https://labs.yzhu.name/timestamp-converter</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ—¥å¿—æ—¶é—´è§£æã€æ•°æ®åº“æ—¶é—´å­—æ®µè½¬æ¢ã€API è°ƒè¯•</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>å®æ—¶æ˜¾ç¤ºå½“å‰ Unix æ—¶é—´æˆ³</li><li>æ—¶é—´æˆ³è½¬æ—¥æœŸæ—¶é—´</li><li>æ—¥æœŸæ—¶é—´è½¬æ—¶é—´æˆ³</li><li>æ”¯æŒå¤šç§å¸¸ç”¨æ—¥æœŸæ ¼å¼æ˜¾ç¤º</li></ul><h3 id="6-YAML-JSON-è½¬æ¢"><a href="#6-YAML-JSON-è½¬æ¢" class="headerlink" title="6. YAML&#x2F;JSON è½¬æ¢"></a>6. YAML&#x2F;JSON è½¬æ¢</h3><p><a href="https://labs.yzhu.name/yaml-json-converter" target="_blank">https://labs.yzhu.name/yaml-json-converter</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šKubernetes é…ç½®è½¬æ¢ã€CI&#x2F;CD æµæ°´çº¿é…ç½®è¿ç§»</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>YAML è½¬ JSON</li><li>JSON è½¬ YAML</li><li>å®æ—¶è½¬æ¢ï¼Œè¾¹è¾“å…¥è¾¹è½¬æ¢</li><li>æ”¯æŒæ ¼å¼åŒ–å’Œè¯­æ³•éªŒè¯</li></ul><h3 id="7-å›¾ç‰‡èƒŒæ™¯ç§»é™¤"><a href="#7-å›¾ç‰‡èƒŒæ™¯ç§»é™¤" class="headerlink" title="7. å›¾ç‰‡èƒŒæ™¯ç§»é™¤"></a>7. å›¾ç‰‡èƒŒæ™¯ç§»é™¤</h3><p><a href="https://labs.yzhu.name/image-background-removal" target="_blank">https://labs.yzhu.name/image-background-removal</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç”µå•†äº§å“å›¾å¤„ç†ã€è¯ä»¶ç…§èƒŒæ™¯å¤„ç†ã€PPT ç´ æåˆ¶ä½œ</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>ä¸€é”®è‡ªåŠ¨ç§»é™¤å›¾ç‰‡èƒŒæ™¯</li><li>è½¬æ¢ä¸ºç™½åº•å›¾ç‰‡</li><li>æ”¯æŒ PNGã€JPGã€JPEG æ ¼å¼</li><li>æœ€å¤§æ”¯æŒ 5MB å›¾ç‰‡</li></ul><h3 id="8-é¢œè‰²å·¥å…·ï¼ˆåå‘è®¡ç®—ä¸æ··åˆï¼‰"><a href="#8-é¢œè‰²å·¥å…·ï¼ˆåå‘è®¡ç®—ä¸æ··åˆï¼‰" class="headerlink" title="8. é¢œè‰²å·¥å…·ï¼ˆåå‘è®¡ç®—ä¸æ··åˆï¼‰"></a>8. é¢œè‰²å·¥å…·ï¼ˆåå‘è®¡ç®—ä¸æ··åˆï¼‰</h3><p><a href="https://labs.yzhu.name/color-reverse-calculator" target="_blank">https://labs.yzhu.name/color-reverse-calculator</a></p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šUI è®¾è®¡ã€å“ç‰Œé…è‰²ã€å‰ç«¯å¼€å‘</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>é¢œè‰²åå‘è®¡ç®—ï¼šå·²çŸ¥å›ºå®šé¢œè‰²å’Œç›®æ ‡é¢œè‰²ï¼Œè®¡ç®—éœ€è¦æ··åˆçš„ä¸­é—´è‰²</li><li>é¢œè‰²æ··åˆå™¨ï¼šæŒ‰æ¯”ä¾‹æ··åˆå¤šç§é¢œè‰²</li><li>RGB&#x2F;HEX é¢œè‰²å€¼è½¬æ¢</li><li>æœ€è¿‘ä¼¼ Pantone è‰²å·åŒ¹é…ï¼ˆæ”¯æŒ Coated ç³»åˆ—ï¼‰</li></ul><hr><h2 id="è®¾è®¡ç†å¿µ"><a href="#è®¾è®¡ç†å¿µ" class="headerlink" title="è®¾è®¡ç†å¿µ"></a>è®¾è®¡ç†å¿µ</h2><p>è¿™äº›å·¥å…·çš„çµæ„Ÿæ¥æºäºæ—¥å¸¸å·¥ä½œä¸­çš„ä¸€äº›é«˜é¢‘éœ€æ±‚ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š</p><ol><li><strong>ç®€å•æ˜“ç”¨</strong>ï¼šæ— éœ€æ³¨å†Œï¼Œæ‰“å¼€å³ç”¨</li><li><strong>çº¯å‰ç«¯å¤„ç†</strong>ï¼šæ•°æ®ä¸ä¸Šä¼ æœåŠ¡å™¨ï¼Œä¿æŠ¤éšç§</li><li><strong>å“åº”å¼è®¾è®¡</strong>ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡</li><li><strong>å³æ—¶åé¦ˆ</strong>ï¼šæ“ä½œç»“æœå®æ—¶æ˜¾ç¤º</li></ol><h2 id="å·¥å…·åœ°å€"><a href="#å·¥å…·åœ°å€" class="headerlink" title="å·¥å…·åœ°å€"></a>å·¥å…·åœ°å€</h2><p><a href="https://labs.yzhu.name" target="_blank"><strong>https://labs.yzhu.name</strong></a></p><blockquote><p>åç»­ä¼šæ ¹æ®å®é™…éœ€æ±‚æŒç»­æ·»åŠ æ–°çš„å·¥å…·ï¼Œæ¬¢è¿æ”¶è—ä½¿ç”¨ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">æ•´åˆäº†æ—¥æœŸè®¡ç®—ã€å•ä½è½¬æ¢ã€JSONæ ¼å¼åŒ–ã€ç¼–è§£ç ã€æ—¶é—´æˆ³è½¬æ¢ã€YAML/JSONè½¬æ¢ã€å›¾ç‰‡èƒŒæ™¯ç§»é™¤ã€é¢œè‰²æ··åˆç­‰8ä¸ªå¼€å‘è€…å¸¸ç”¨åœ¨çº¿å·¥å…·ï¼Œæé«˜å·¥ä½œæ•ˆç‡</summary>
    
    
    
    <category term="å·¥å…·ç«™" scheme="https://www.yzhu.name/categories/%E5%B7%A5%E5%85%B7%E7%AB%99/"/>
    
    
    <category term="å·¥å…·" scheme="https://www.yzhu.name/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="æ•ˆç‡" scheme="https://www.yzhu.name/tags/%E6%95%88%E7%8E%87/"/>
    
    <category term="å¼€å‘å·¥å…·" scheme="https://www.yzhu.name/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    <category term="åœ¨çº¿å·¥å…·" scheme="https://www.yzhu.name/tags/%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7/"/>
    
    <category term="JSONæ ¼å¼åŒ–" scheme="https://www.yzhu.name/tags/JSON%E6%A0%BC%E5%BC%8F%E5%8C%96/"/>
    
    <category term="æ—¶é—´æˆ³è½¬æ¢" scheme="https://www.yzhu.name/tags/%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title>è·¨å¢ƒç”µå•†ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿæ¶æ„è®¾è®¡</title>
    <link href="https://www.yzhu.name/2023/12/10/User-Tag/"/>
    <id>https://www.yzhu.name/2023/12/10/User-Tag/</id>
    <published>2023-12-10T10:25:21.000Z</published>
    <updated>2025-11-11T03:53:15.776Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼"><a href="#ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼" class="headerlink" title="ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼"></a>ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼</h3><p>åœ¨ç«äº‰æ¿€çƒˆçš„è·¨å¢ƒç”µå•†é¢†åŸŸï¼Œç”¨æˆ·ä½“éªŒå’Œç²¾ç»†åŒ–è¿è¥è‡³å…³é‡è¦ã€‚ä¸ºäº†å®ç°<strong>ç²¾å‡†è¥é”€ã€åŠ¨æ€å®šä»·å’Œè¿è¥åˆ†æ</strong>ç­‰å…³é”®ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠæ—¶ã€æ›´å‡†ç¡®åœ°ç†è§£ç”¨æˆ·è¡Œä¸º<span id="more"></span>ã€‚</p><p>ç„¶è€Œï¼Œä¼ ç»Ÿç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿä¾èµ–ç¦»çº¿è®¡ç®—ï¼Œæ•°æ®æ›´æ–°é¢‘ç‡ä¸º<strong>æ¯æ—¥ä¸€æ¬¡</strong>ï¼Œå®æ—¶æ€§ä¸è¶³ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå“åº”ç”¨æˆ·è¡Œä¸ºå˜åŒ–çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œ<strong>æ–°ç”¨æˆ·ä¸‹å•åæ— æ³•ç«‹å³äº«å—è€ç”¨æˆ·æŠ˜æ‰£</strong>ï¼Œ<strong>ä¸ªæ€§åŒ–æ¨èä¹Ÿå­˜åœ¨æ»åæ€§</strong>ã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä»¬å¯åŠ¨äº†<strong>å®æ—¶ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿ</strong>é¡¹ç›®ï¼Œæ—¨åœ¨æ„å»ºä¸€å¥—<strong>é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å¯æ‰©å±•</strong>çš„ç”¨æˆ·æ ‡ç­¾åŸºç¡€è®¾æ–½ï¼Œå®ç°ç”¨æˆ·è¡Œä¸ºçš„<strong>å®æ—¶é‡‡é›†ã€è®¡ç®—å’Œåº”ç”¨</strong>ï¼Œä¸ºä¸šåŠ¡å¢é•¿æä¾›æœ‰åŠ›çš„æ•°æ®æ”¯æ’‘ã€‚</p><p>ç³»ç»Ÿä¸Šçº¿åï¼ŒæˆåŠŸæ”¯æ’‘<strong>æ—¥å‡ä¸‰åƒä¸‡çº§</strong>ç”¨æˆ·è¡Œä¸ºæ•°æ®å¤„ç†ï¼Œ<strong>æ ‡ç­¾æ›´æ–°å»¶è¿Ÿæ§åˆ¶åœ¨500mså†…</strong>ï¼Œä¸ºä»¥ä¸‹å…³é”®ä¸šåŠ¡åœºæ™¯æä¾›äº†æœ‰åŠ›æ”¯æŒï¼š</p><ul><li><strong>ç²¾å‡†è¥é”€</strong>ï¼šåŸºäºç”¨æˆ·æ ‡ç­¾å®ç°<strong>åƒäººåƒé¢</strong>çš„å•†å“æ¨èï¼Œæå‡ç‚¹å‡»ç‡å’Œè½¬åŒ–ç‡ã€‚</li><li><strong>åŠ¨æ€å®šä»·</strong>ï¼šæ ¹æ®ç”¨æˆ·æ ‡ç­¾ï¼ˆå¦‚æ–°è€ç”¨æˆ·ï¼‰å®æ–½<strong>å·®å¼‚åŒ–ä»·æ ¼ç­–ç•¥</strong>ï¼Œæå‡ç”¨æˆ·ç²˜æ€§å’Œå¤è´­ç‡ã€‚</li><li><strong>è¿è¥åˆ†æ</strong>ï¼šé€šè¿‡ç”¨æˆ·è¡Œä¸ºæ ‡ç­¾è¿›è¡Œ<strong>ç”¨æˆ·è¡Œä¸ºæ´å¯Ÿå’Œè½¬åŒ–ç‡ä¼˜åŒ–</strong>ï¼ŒæŒ‡å¯¼è¿è¥ç­–ç•¥è°ƒæ•´ã€‚</li></ul><h3 id="äºŒã€æ¶æ„è®¾è®¡å…¨æ™¯å›¾"><a href="#äºŒã€æ¶æ„è®¾è®¡å…¨æ™¯å›¾" class="headerlink" title="äºŒã€æ¶æ„è®¾è®¡å…¨æ™¯å›¾"></a>äºŒã€æ¶æ„è®¾è®¡å…¨æ™¯å›¾</h3><h4 id="1-æ•´ä½“æ¶æ„"><a href="#1-æ•´ä½“æ¶æ„" class="headerlink" title="1. æ•´ä½“æ¶æ„"></a>1. æ•´ä½“æ¶æ„</h4><pre class="mermaid">graph TD    AAW[App/Web] -->|HTTPä¸ŠæŠ¥| A[åŒºåŸŸAæ•°æ®é‡‡é›†ç³»ç»Ÿ]    ABK[åç«¯ç³»ç»Ÿ] -->|SDKä¸ŠæŠ¥| A    BAW[App/Web] -->|HTTä¸ŠæŠ¥| B[åŒºåŸŸBæ•°æ®é‡‡é›†ç³»ç»Ÿ]    BBK[åç«¯ç³»ç»Ÿ] -->|SDKä¸ŠæŠ¥| B    A -->|MQ| C[æ ‡ç­¾è®¡ç®—ç³»ç»Ÿ]    B -->|MQ| C    C --> Da[åŒºåŸŸAæ•°æ®åº“é›†ç¾¤: MongoDB+MySQL+Redis]    C --> Db[åŒºåŸŸBæ•°æ®åº“é›†ç¾¤: MySQL+Redis]    Ea[æ ‡ç­¾æŸ¥è¯¢] --> Da    Fa[ç”¨æˆ·ç³»ç»Ÿ]-->Ea    Ga[è®¢å•ç³»ç»Ÿ]-->Ea    Ia[è¥é”€ç³»ç»Ÿ]-->Ea    Ha[å…¶å®ƒ...ç³»ç»Ÿ]-->Ea    Eb[æ ‡ç­¾æŸ¥è¯¢] --> Db    Fb[ç”¨æˆ·ç³»ç»Ÿ]-->Eb    Gb[è®¢å•ç³»ç»Ÿ]-->Eb    Ib[è¥é”€ç³»ç»Ÿ]-->Eb    Hb[å…¶å®ƒ...ç³»ç»Ÿ]-->Eb</pre><p><strong>æ•°æ®æµ:</strong>  <code>App/Web/åç«¯ç³»ç»Ÿ</code> â†’ <code>HTTP/SDKä¸ŠæŠ¥</code> â†’ <code>åŒºåŸŸé‡‡é›†ç³»ç»Ÿ</code> â†’ <code>RabbitMQ</code> â†’ <code>æ ‡ç­¾è®¡ç®—ç³»ç»Ÿ</code> â†’ <code>MongoDB/MySQL/Redis</code></p><p><strong>åˆ†å±‚æ¶æ„:</strong></p><ul><li><strong>æ•°æ®é‡‡é›†å±‚</strong>ï¼šé‡‡ç”¨ <strong>Nginx+SpringCloud</strong> æŠ€æœ¯æ ˆï¼Œ<strong>åŒåŒºåŸŸç‹¬ç«‹éƒ¨ç½²</strong> (åŒºåŸŸAå’ŒåŒºåŸŸBæ•°æ®é‡‡é›†ç³»ç»Ÿ)ï¼Œæ”¯æŒ <strong>App&#x2F;Web&#x2F;API å¤šç«¯ç»Ÿä¸€æ¥å…¥</strong>ã€‚å…·å¤‡ <strong>é«˜å¹¶å‘ HTTP æ¥å…¥</strong> èƒ½åŠ›å’Œ <strong>åŒºåŸŸè·¯ç”±</strong> åŠŸèƒ½ï¼Œç¡®ä¿æ•°æ®å°±è¿‘æ¥å…¥ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚</li><li><strong>æ¶ˆæ¯ä¸­é—´ä»¶</strong>ï¼šå¤ç”¨ç°æœ‰ <strong>RabbitMQ é›†ç¾¤</strong>ï¼Œé™ä½è¿ç»´æˆæœ¬ã€‚RabbitMQ æ‰¿æ‹… <strong>æ•°æ®ç¼“å†²å’Œå¼‚æ­¥è§£è€¦</strong> çš„ä½œç”¨ï¼Œä¿éšœæ•°æ®é‡‡é›†å±‚å’Œè®¡ç®—å±‚ä¹‹é—´çš„ç¨³å®šé€šä¿¡ã€‚</li><li><strong>è®¡ç®—å­˜å‚¨å±‚</strong>ï¼š<ul><li><strong>æ ‡ç­¾è®¡ç®—ç³»ç»Ÿ</strong>ï¼šåŸºäº <strong>Spring</strong> æ„å»ºï¼Œé‡‡ç”¨ <strong>è½»é‡çº§è§„åˆ™å¼•æ“</strong> æ¡†æ¶ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚</li><li><strong>è§„åˆ™ç®¡ç†</strong>ï¼š<strong>MySQL</strong> å­˜å‚¨æ ‡ç­¾è§„åˆ™ï¼Œå®ç° <strong>è§„åˆ™ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»š</strong>ï¼Œæ–¹ä¾¿è§„åˆ™è¿­ä»£å’Œç®¡ç†ã€‚</li><li><strong>æ ‡ç­¾å­˜å‚¨</strong>ï¼šé‡‡ç”¨ <strong>MySQL+Redis</strong> ç»„åˆï¼Œ<strong>MySQL</strong> æŒä¹…åŒ–å­˜å‚¨æ ‡ç­¾è§„åˆ™ä¸è®¡ç®—ç»“æœï¼Œ<strong>Redis</strong> æä¾› <strong>å®æ—¶æŸ¥è¯¢èƒ½åŠ›</strong>ï¼Œæ”¯æ’‘é«˜å¹¶å‘çš„æ ‡ç­¾æŸ¥è¯¢è¯·æ±‚ã€‚</li></ul></li></ul><h4 id="2-æ ¸å¿ƒç»„ä»¶è®¾è®¡"><a href="#2-æ ¸å¿ƒç»„ä»¶è®¾è®¡" class="headerlink" title="2. æ ¸å¿ƒç»„ä»¶è®¾è®¡"></a>2. æ ¸å¿ƒç»„ä»¶è®¾è®¡</h4><table><thead><tr><th>æ¨¡å—</th><th>æŠ€æœ¯é€‰å‹</th><th>è®¾è®¡è¦ç‚¹</th></tr></thead><tbody><tr><td>æ•°æ®é‡‡é›†</td><td>Nginx+SpringCloud</td><td>é«˜å¹¶å‘HTTPæ¥å…¥ï¼ŒåŒºåŸŸè·¯ç”±</td></tr><tr><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td>RabbitMQé›†ç¾¤</td><td>æ¶ˆæ¯æŒä¹…åŒ–ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»</td></tr><tr><td>æ ‡ç­¾è®¡ç®—</td><td>Spring</td><td>è½»é‡çº§è§„åˆ™å¼•æ“ï¼Œæ˜“äºæ‰©å±•</td></tr><tr><td>è§„åˆ™ç®¡ç†</td><td>MySQL</td><td>è§„åˆ™ç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒå›æ»š</td></tr><tr><td>æ ‡ç­¾å­˜å‚¨</td><td>MySQL+Redis</td><td>å†·çƒ­æ•°æ®åˆ†ç¦»å­˜å‚¨ç­–ç•¥</td></tr><tr><td>ç”¨æˆ·è¡Œä¸ºå­˜å‚¨</td><td>MongoDB</td><td>ç”¨æˆ·è¡Œä¸ºæŒä¹…åŒ–</td></tr></tbody></table><h3 id="ä¸‰ã€æ ¸å¿ƒè®¾è®¡å†³ç­–"><a href="#ä¸‰ã€æ ¸å¿ƒè®¾è®¡å†³ç­–" class="headerlink" title="ä¸‰ã€æ ¸å¿ƒè®¾è®¡å†³ç­–"></a>ä¸‰ã€æ ¸å¿ƒè®¾è®¡å†³ç­–</h3><h4 id="1-æ•°æ®é‡‡é›†æ–¹æ¡ˆ"><a href="#1-æ•°æ®é‡‡é›†æ–¹æ¡ˆ" class="headerlink" title="1. æ•°æ®é‡‡é›†æ–¹æ¡ˆ"></a>1. æ•°æ®é‡‡é›†æ–¹æ¡ˆ</h4><ul><li><strong>å¤šç«¯ç»Ÿä¸€æ¥å…¥</strong>ï¼šå®šä¹‰æ ‡å‡† <strong>HTTP ä¸ŠæŠ¥åè®®</strong>ï¼Œç»Ÿä¸€ <code>App/Web/API</code> å¤šç«¯æ•°æ®æ¥å…¥æ–¹å¼ï¼Œé™ä½æ¥å…¥æˆæœ¬ã€‚</li><li><strong>åŒºåŸŸè·¯ç”±ç­–ç•¥</strong>ï¼šåŸºäº <strong>ç”¨æˆ·æ ‡è¯†è‡ªåŠ¨è·¯ç”±</strong> åˆ°ç›¸åº”åŒºåŸŸé‡‡é›†èŠ‚ç‚¹ï¼Œæå‡æ•°æ®ä¸ŠæŠ¥æ•ˆç‡ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚</li><li><strong>æ•°æ®æ ¡éªŒæœºåˆ¶</strong>ï¼š<ul><li><strong>ä¸ŠæŠ¥æ•°æ®æ ¼å¼æ ¡éªŒ</strong>ï¼šåœ¨é‡‡é›†å±‚è¿›è¡Œæ•°æ®æ ¼å¼æ ¡éªŒï¼Œè¿‡æ»¤æ— æ•ˆæ•°æ®ã€‚</li><li><strong>å»é‡å¤„ç†</strong>ï¼šå¯¹é‡å¤ä¸ŠæŠ¥æ•°æ®è¿›è¡Œ <strong>å»é‡å¤„ç†</strong>ï¼Œä¿éšœæ•°æ®è´¨é‡ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</li></ul></li></ul><h4 id="2-æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹"><a href="#2-æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹" class="headerlink" title="2. æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹"></a>2. æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹</h4><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>RabbitMQä¼˜åŠ¿</th><th>è®¾è®¡è€ƒé‡ç‚¹</th></tr></thead><tbody><tr><td>è¿ç»´æˆæœ¬</td><td>å¤ç”¨ç°æœ‰é›†ç¾¤</td><td><strong>æ— éœ€é¢å¤–è¿ç»´æŠ•å…¥</strong></td></tr><tr><td>å¯é æ€§</td><td>æ¶ˆæ¯æŒä¹…åŒ–+ACKæœºåˆ¶</td><td><strong>æ•°æ®é›¶ä¸¢å¤±ä¿éšœ</strong></td></tr><tr><td>æ‰©å±•æ€§</td><td>é›†ç¾¤æ¨¡å¼æ”¯æŒæ°´å¹³æ‰©å±•</td><td><strong>æ»¡è¶³æœªæ¥å¢é•¿éœ€æ±‚</strong></td></tr></tbody></table><p><strong>é€‰å‹åˆ†æ:</strong>  ç»¼åˆè€ƒè™‘ <strong>è¿ç»´æˆæœ¬ã€å¯é æ€§å’Œæ‰©å±•æ€§</strong> ç­‰å› ç´ ï¼Œ<strong>å¤ç”¨ç°æœ‰ RabbitMQ é›†ç¾¤</strong> æ˜¯æœ€ä¼˜é€‰æ‹©ã€‚RabbitMQ é›†ç¾¤å…·å¤‡è‰¯å¥½çš„ <strong>æ¶ˆæ¯æŒä¹…åŒ–ã€ACK æœºåˆ¶å’Œæ°´å¹³æ‰©å±•èƒ½åŠ›</strong>ï¼Œèƒ½å¤Ÿæ»¡è¶³å®æ—¶ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿå¯¹æ¶ˆæ¯é˜Ÿåˆ—çš„éœ€æ±‚ã€‚</p><h4 id="3-è®¡ç®—å­˜å‚¨æ¶æ„"><a href="#3-è®¡ç®—å­˜å‚¨æ¶æ„" class="headerlink" title="3. è®¡ç®—å­˜å‚¨æ¶æ„"></a>3. è®¡ç®—å­˜å‚¨æ¶æ„</h4><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­˜å‚¨æ–¹æ¡ˆ</th><th>è®¾è®¡è€ƒé‡ç‚¹</th></tr></thead><tbody><tr><td>ä¸ŠæŠ¥æ—¥å¿—</td><td>MongoDBåˆ†ç‰‡é›†ç¾¤</td><td><strong>é«˜ååå†™å…¥ï¼Œçµæ´» Schema</strong>ï¼Œæ”¯æŒæµ·é‡ç”¨æˆ·è¡Œä¸ºæ—¥å¿—å­˜å‚¨</td></tr><tr><td>æ ‡ç­¾è§„åˆ™</td><td>MySQL</td><td><strong>äº‹åŠ¡æ”¯æŒï¼Œç‰ˆæœ¬ç®¡ç†</strong>ï¼Œä¿éšœè§„åˆ™æ•°æ®ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§</td></tr><tr><td>æ ‡ç­¾ç»“æœ</td><td>MySQL+Redis</td><td><strong>å®æ—¶æŸ¥è¯¢ä¸æŒä¹…åŒ–å­˜å‚¨</strong>ï¼Œå…¼é¡¾å®æ—¶æŸ¥è¯¢æ€§èƒ½å’Œæ•°æ®å¯é æ€§</td></tr></tbody></table><p><strong>å­˜å‚¨é€‰å‹:</strong></p><ul><li><strong>MongoDB åˆ†ç‰‡é›†ç¾¤</strong>ï¼šé€‚ç”¨äºå­˜å‚¨ <strong>æµ·é‡ã€Schema çµæ´»</strong> çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ•°æ®ï¼Œæ»¡è¶³é«˜ååå†™å…¥éœ€æ±‚ã€‚</li><li><strong>MySQL</strong>ï¼šé€‚ç”¨äºå­˜å‚¨ <strong>ç»“æ„åŒ–</strong> çš„æ ‡ç­¾è§„åˆ™å’Œæ ‡ç­¾ç»“æœæ•°æ®ï¼Œæä¾› <strong>äº‹åŠ¡æ”¯æŒå’Œæ•°æ®ä¸€è‡´æ€§</strong> ä¿éšœã€‚</li><li><strong>Redis</strong>ï¼šé€‚ç”¨äºç¼“å­˜ <strong>çƒ­ç‚¹æ ‡ç­¾æ•°æ®</strong>ï¼Œåˆ©ç”¨å…¶ <strong>é«˜æ€§èƒ½å†…å­˜æ•°æ®åº“</strong> ç‰¹æ€§ï¼Œæå‡æ ‡ç­¾æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h3 id="å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ"><a href="#å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ" class="headerlink" title="å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ"></a>å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ</h3><h4 id="1-é‡‡é›†å±‚ä¼˜åŒ–"><a href="#1-é‡‡é›†å±‚ä¼˜åŒ–" class="headerlink" title="1. é‡‡é›†å±‚ä¼˜åŒ–"></a>1. é‡‡é›†å±‚ä¼˜åŒ–</h4><ul><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šé‡‡ç”¨ <strong>Nginx è½®è¯¢ + æƒé‡åˆ†é…</strong> ç­–ç•¥ï¼Œå®ç°é‡‡é›†å±‚è´Ÿè½½å‡è¡¡ï¼Œ<strong>å•èŠ‚ç‚¹æ”¯æŒ 10k QPS</strong> é«˜å¹¶å‘æ¥å…¥ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ•°æ®ä¸ŠæŠ¥è¯·æ±‚ <strong>å¼‚æ­¥åŒ–å¤„ç†</strong>ï¼Œé™ä½è¯·æ±‚å“åº”æ—¶é—´ï¼Œ<strong>å“åº”æ—¶é—´ &lt;50ms</strong>ã€‚</li><li><strong>æ•°æ®å‹ç¼©</strong>ï¼šé‡‡ç”¨ <strong>Gzip å‹ç¼©</strong> æŠ€æœ¯ï¼Œå¯¹ä¸ŠæŠ¥æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œ<strong>é™ä½ 70% ç½‘ç»œä¼ è¾“é‡</strong>ï¼Œæå‡ä¼ è¾“æ•ˆç‡ã€‚</li></ul><h4 id="2-å®¹ç¾æ–¹æ¡ˆè®¾è®¡"><a href="#2-å®¹ç¾æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="2. å®¹ç¾æ–¹æ¡ˆè®¾è®¡"></a>2. å®¹ç¾æ–¹æ¡ˆè®¾è®¡</h4><ul><li><strong>æ¶ˆæ¯é‡è¯•</strong>ï¼šRabbitMQ å¯ç”¨ <strong>æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼Œå¤„ç†æ ‡ç­¾è®¡ç®—å¤±è´¥æ¶ˆæ¯ï¼Œä¿éšœæ•°æ®å¯é æ€§ã€‚</li><li><strong>æ•°æ®å¤‡ä»½</strong>ï¼šMySQL æ•°æ®åº“è¿›è¡Œ <strong>æ¯æ—¥å…¨é‡å¤‡ä»½ + å¢é‡å¤‡ä»½</strong>ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>æ•…éšœåˆ‡æ¢</strong>ï¼šRedis é‡‡ç”¨ <strong>ä¸»ä»æ¨¡å¼</strong> éƒ¨ç½²ï¼Œå®ç° <strong>ä¸»ä»è‡ªåŠ¨åˆ‡æ¢</strong>ï¼Œ<strong>åˆ‡æ¢æ—¶é—´ &lt;30s</strong>ï¼Œä¿éšœç¼“å­˜æœåŠ¡é«˜å¯ç”¨ã€‚</li></ul><h3 id="äº”ã€æ ‡ç­¾ä½“ç³»è®¾è®¡"><a href="#äº”ã€æ ‡ç­¾ä½“ç³»è®¾è®¡" class="headerlink" title="äº”ã€æ ‡ç­¾ä½“ç³»è®¾è®¡"></a>äº”ã€æ ‡ç­¾ä½“ç³»è®¾è®¡</h3><h4 id="1-æ ‡ç­¾åˆ†ç±»æ¨¡å‹"><a href="#1-æ ‡ç­¾åˆ†ç±»æ¨¡å‹" class="headerlink" title="1. æ ‡ç­¾åˆ†ç±»æ¨¡å‹"></a>1. æ ‡ç­¾åˆ†ç±»æ¨¡å‹</h4><pre class="mermaid">graph TD    A[ç”¨æˆ·æ ‡ç­¾] --> B(åŸºç¡€æ ‡ç­¾)    A --> C(è¡Œä¸ºæ ‡ç­¾)    B --> D[ç”¨æˆ·å±æ€§]    B --> E[è®¾å¤‡ä¿¡æ¯]    C --> F[è´­ä¹°è¡Œä¸º]    C --> G[æµè§ˆåå¥½]</pre><ul><li><strong>åŸºç¡€æ ‡ç­¾</strong>ï¼šæè¿°ç”¨æˆ·çš„<strong>é™æ€å±æ€§</strong>ï¼Œä¾‹å¦‚ï¼šç”¨æˆ·å±æ€§ï¼ˆå¹´é¾„ã€åœ°åŸŸï¼‰ã€è®¾å¤‡ä¿¡æ¯ï¼ˆè®¾å¤‡ç±»å‹ã€æ“ä½œç³»ç»Ÿï¼‰ã€‚<strong>æ›´æ–°æœºåˆ¶ä¸ºæ‰¹é‡æ¯æ—¥æ›´æ–°</strong>ã€‚</li><li><strong>è¡Œä¸ºæ ‡ç­¾</strong>ï¼šæè¿°ç”¨æˆ·çš„<strong>åŠ¨æ€è¡Œä¸º</strong>ï¼Œä¾‹å¦‚ï¼šè´­ä¹°è¡Œä¸ºï¼ˆè´­ä¹°å•†å“ã€è®¢å•é‡‘é¢ï¼‰ã€æµè§ˆåå¥½ï¼ˆæµè§ˆå•†å“ç±»ç›®ã€æµè§ˆæ—¶é•¿ï¼‰ã€‚<strong>æ›´æ–°æœºåˆ¶ä¸ºäº‹ä»¶é©±åŠ¨å®æ—¶æ›´æ–°</strong>ã€‚</li></ul><h4 id="2-å…¸å‹åœºæ™¯å®ç°ï¼šæ–°ç”¨æˆ·è½¬è€ç”¨æˆ·é€»è¾‘"><a href="#2-å…¸å‹åœºæ™¯å®ç°ï¼šæ–°ç”¨æˆ·è½¬è€ç”¨æˆ·é€»è¾‘" class="headerlink" title="2. å…¸å‹åœºæ™¯å®ç°ï¼šæ–°ç”¨æˆ·è½¬è€ç”¨æˆ·é€»è¾‘"></a>2. å…¸å‹åœºæ™¯å®ç°ï¼šæ–°ç”¨æˆ·è½¬è€ç”¨æˆ·é€»è¾‘</h4><p>ä»¥ <strong>æ–°ç”¨æˆ·è½¬è€ç”¨æˆ·</strong> æ ‡ç­¾æ›´æ–°åœºæ™¯ä¸ºä¾‹ï¼Œè¯´æ˜å®æ—¶æ ‡ç­¾ç³»ç»Ÿçš„åº”ç”¨æµç¨‹ï¼š</p><ol><li><strong>ç›‘å¬ä¸‹å•äº‹ä»¶</strong>ï¼šç³»ç»Ÿ <strong>å®æ—¶ç›‘å¬</strong> è®¢å•ç³»ç»Ÿäº§ç”Ÿçš„ä¸‹å•äº‹ä»¶ã€‚</li><li><strong>æ ¡éªŒå†å²è®¢å•æ•°</strong>ï¼šæ ‡ç­¾è®¡ç®—ç³»ç»Ÿæ¥æ”¶åˆ°ä¸‹å•äº‹ä»¶åï¼Œ<strong>æ ¡éªŒç”¨æˆ·è¿‘ä¸€å¹´å†…å†å²è®¢å•æ•°æ˜¯å¦ä¸º 1</strong>ã€‚</li><li><strong>è§¦å‘æ ‡ç­¾çŠ¶æ€å˜æ›´</strong>ï¼šè‹¥æ ¡éªŒé€šè¿‡ï¼Œåˆ™ <strong>è§¦å‘ç”¨æˆ·æ ‡ç­¾çŠ¶æ€å˜æ›´</strong>ï¼Œå°†ç”¨æˆ·æ ‡ç­¾ä» â€œæ–°ç”¨æˆ·â€ æ›´æ–°ä¸º â€œè€ç”¨æˆ·â€ã€‚</li><li><strong>æ¨é€ä»·æ ¼ç­–ç•¥</strong>ï¼šæ ‡ç­¾è®¡ç®—ç³»ç»Ÿå°† <strong>æ–°çš„ç”¨æˆ·æ ‡ç­¾æ¨é€è‡³å•†å“æœåŠ¡</strong>ã€‚å•†å“æœåŠ¡ <strong>å®æ—¶æ›´æ–°ä»·æ ¼ç­–ç•¥</strong>ï¼Œä½¿ç”¨æˆ·åœ¨ <strong>&lt;500ms å†…</strong> çœ‹åˆ°å•†å“ä»·æ ¼æŠ˜æ‰£ã€‚</li></ol><h3 id="å…­ã€æ€»ç»“ä¸å±•æœ›"><a href="#å…­ã€æ€»ç»“ä¸å±•æœ›" class="headerlink" title="å…­ã€æ€»ç»“ä¸å±•æœ›"></a>å…­ã€æ€»ç»“ä¸å±•æœ›</h3><p>å®æ—¶ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿçš„æˆåŠŸä¸Šçº¿ï¼Œæ˜¾è‘—æå‡äº†ç”¨æˆ·æ ‡ç­¾çš„<strong>å®æ—¶æ€§</strong>å’Œ<strong>åº”ç”¨æ•ˆç‡</strong>ï¼Œä¸ºä¸šåŠ¡çš„<strong>ç²¾ç»†åŒ–è¿è¥</strong>æä¾›äº†å¼ºæœ‰åŠ›çš„æ•°æ®æ”¯æ’‘ã€‚é¡¹ç›®åœ¨<strong>é«˜æ€§èƒ½ã€é«˜å¯é ã€å¯æ‰©å±•</strong>ç­‰æ–¹é¢åšäº†æ·±å…¥è®¾è®¡å’Œä¼˜åŒ–ï¼Œä¸ºåç»­çš„è¿­ä»£å‡çº§å¥ å®šäº†åšå®åŸºç¡€ã€‚</p><p>æœªæ¥ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨ä»¥ä¸‹æ–¹é¢è¿›è¡Œæ¢ç´¢å’Œä¼˜åŒ–ï¼š</p><ul><li><strong>æ›´æ™ºèƒ½çš„å‘Šè­¦</strong>ï¼šå¼•å…¥ <strong>å¼‚å¸¸æ£€æµ‹</strong> ç­‰æ™ºèƒ½å‘Šè­¦ç­–ç•¥ï¼Œæå‡é—®é¢˜å‘ç°å’Œå¤„ç†æ•ˆç‡ã€‚</li><li><strong>æ›´ä¸°å¯Œçš„æ ‡ç­¾ç±»å‹</strong>ï¼šæ‰©å±• <strong>ç”¨æˆ·å…´è¶£æ ‡ç­¾ã€ç”¨æˆ·åå¥½æ ‡ç­¾</strong> ç­‰ï¼Œæ„å»ºæ›´å…¨é¢çš„ç”¨æˆ·ç”»åƒã€‚</li><li><strong>æ›´çµæ´»çš„è§„åˆ™å¼•æ“</strong>ï¼šå®ç°æ›´è´Ÿè½½çš„æ ‡ç­¾è®¡ç®—é€»è¾‘ï¼Œæå‡ç³»ç»Ÿçµæ´»æ€§ã€‚</li></ul><p>éšç€å®æ—¶ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿçš„ä¸æ–­å®Œå–„ï¼Œå°†ä¸ºä¸šåŠ¡å¸¦æ¥æ›´å¤§çš„ä»·å€¼ï¼ŒæŒç»­é©±åŠ¨ä¸šåŠ¡å¢é•¿ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼&quot;&gt;&lt;a href=&quot;#ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼&quot;&gt;&lt;/a&gt;ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ä¸šåŠ¡ä»·å€¼&lt;/h3&gt;&lt;p&gt;åœ¨ç«äº‰æ¿€çƒˆçš„è·¨å¢ƒç”µå•†é¢†åŸŸï¼Œç”¨æˆ·ä½“éªŒå’Œç²¾ç»†åŒ–è¿è¥è‡³å…³é‡è¦ã€‚ä¸ºäº†å®ç°&lt;strong&gt;ç²¾å‡†è¥é”€ã€åŠ¨æ€å®šä»·å’Œè¿è¥åˆ†æ&lt;/strong&gt;ç­‰å…³é”®ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠæ—¶ã€æ›´å‡†ç¡®åœ°ç†è§£ç”¨æˆ·è¡Œä¸º&lt;/p&gt;</summary>
    
    
    
    
    <category term="æŠ€æœ¯æ–¹æ¡ˆ" scheme="https://www.yzhu.name/tags/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://www.yzhu.name/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Sharding-JDBC(ShardingSphere)SQLç›‘æ§å®è·µ</title>
    <link href="https://www.yzhu.name/2023/11/25/ShardingSphere-JDBC-SQL-Metrics/"/>
    <id>https://www.yzhu.name/2023/11/25/ShardingSphere-JDBC-SQL-Metrics/</id>
    <published>2023-11-25T07:54:41.000Z</published>
    <updated>2025-11-11T03:53:15.775Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æˆ‘ä»¬è¿›è¡Œäº†ä¸€ä¸ªé¡¹ç›®çš„é‡æ„ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦ç›®æ ‡æ˜¯å‡å°‘æ•°æ®åº“è®¿é—®çš„è´Ÿè½½ã€‚ç”±äºæ ¸å¿ƒæ•°æ®åº“è¢«å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®ï¼Œå¹¶ä¸”æ•°æ®åº“æœåŠ¡å™¨åªèƒ½å¯¹æ•´ä½“æ•°æ®åº“æµé‡è¿›è¡Œç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºç«¯ç›‘æ§ä¸åŒåº”ç”¨ç¨‹åºçš„SQLè¯·æ±‚ï¼Œå¹¶å°†å…¶ä¸ç°æœ‰çš„æŒ‡æ ‡é›†æˆåœ¨ä¸€èµ·<span id="more"></span>ã€‚</p><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>æˆ‘ä»¬çš„éœ€æ±‚æ˜¯ç›‘æ§åº”ç”¨ç¨‹åºå¯¹æ•°æ®åº“çš„SQLæ‰§è¡Œæƒ…å†µï¼Œå¹¶å°†å…¶ä¸ç°æœ‰çš„æŒ‡æ ‡é›†æˆã€‚æˆ‘ä»¬å¸Œæœ›ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼ˆä½†ä¸é™äºï¼‰ï¼š</p><ul><li>SQLè¯­å¥çš„æ‰§è¡Œæ—¶é—´</li><li>SQLè¯­å¥çš„æ‰§è¡Œæ¬¡æ•°</li><li>SQLè¯­å¥çš„æ‰§è¡Œç»“æœ</li><li>SQLè¯­å¥çš„ä¸»åº“å’Œå¤‡åº“è·¯ç”±</li></ul><h2 id="æ–¹æ¡ˆè®¾è®¡"><a href="#æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡"></a>æ–¹æ¡ˆè®¾è®¡</h2><p>æˆ‘ä»¬ç°æœ‰æ•°æ®åº“ç›¸å…³æŠ€æœ¯æ ˆåŒ…æ‹¬MySql, Sharding-JDBC,HikariDataSourceå’ŒMyBatiesï¼›åœ¨æ–¹æ¡ˆè®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬è€ƒè™‘äº†ä»¥ä¸‹ä¸‰ç§æ–¹æ¡ˆï¼š</p><h4 id="ShardingSphereçš„metrics"><a href="#ShardingSphereçš„metrics" class="headerlink" title="ShardingSphereçš„metrics"></a>ShardingSphereçš„metrics</h4><p> ShardingSphereçš„agentä¾›äº†SQLç›‘æ§çš„åŠŸèƒ½ï¼Œå…·ä½“å¯å‚è€ƒ<a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/observability/">ShardingSphereçš„å¯è§‚æµ‹æ€§</a>ç„¶è€Œï¼Œè¯¥ä»£ç†ä¼šæš´éœ²ä¸€ä¸ªç‹¬ç«‹çš„ç›‘æ§æŒ‡æ ‡é¡µé¢ï¼Œæ— æ³•ç›´æ¥é›†æˆåˆ°æˆ‘ä»¬ç°æœ‰çš„ç›‘æ§æŒ‡æ ‡é¡µé¢ä¸­ã€‚æˆ‘ä»¬éœ€è¦å•ç‹¬é‡‡é›†ShardingSphereä»£ç†çš„ç›‘æ§æŒ‡æ ‡ï¼Œå¹¶å°†å…¶ä¸ç°æœ‰æŒ‡æ ‡è¿›è¡Œæ•´åˆï¼Œè¿™å¢åŠ äº†ä¸€å®šçš„å¤æ‚æ€§ï¼Œå› æ­¤æˆ‘ä»¬æ”¾å¼ƒäº†è¯¥æ–¹æ¡ˆã€‚</p><h4 id="Mybatiesçš„æ‹¦æˆªå™¨"><a href="#Mybatiesçš„æ‹¦æˆªå™¨" class="headerlink" title="Mybatiesçš„æ‹¦æˆªå™¨"></a>Mybatiesçš„æ‹¦æˆªå™¨</h4><p> ä½¿ç”¨MyBatisçš„æ‹¦æˆªå™¨å®ç°SQLç›‘æ§éå¸¸ç®€å•ï¼Œåªéœ€å®ç°<code>org.apache.ibatis.plugin.Interceptor</code>æ¥å£å³å¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Intercepts(&#123;</span><br><span class="line">    @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span><br><span class="line">    @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class,RowBounds.class, ResultHandler.class, CacheKey.class, BoundSql.class&#125;),</span><br><span class="line">    @Signature(type = Executor.class, method = &quot;update&quot;, args = &#123;MappedStatement.class, Object.class&#125;)&#125;)</span><br><span class="line">public class SqlMetricsInterceptor implements Interceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">        MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0];</span><br><span class="line">        SqlCommandType sqlCommandType = mappedStatement.getSqlCommandType();</span><br><span class="line">        /** ä¸ŠæŠ¥sql metrics**/</span><br><span class="line">        return invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object plugin(Object target) &#123;</span><br><span class="line">        if (target instanceof Executor) &#123;</span><br><span class="line">            return Plugin.wrap(target, this);</span><br><span class="line">        &#125;</span><br><span class="line">        return target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setProperties(Properties properties) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  åœ¨å®¹å™¨å¯åŠ¨åï¼Œæˆ‘ä»¬å°†è¯¥æ‹¦æˆªå™¨æ³¨å…¥åˆ°MyBatisçš„org.apache.ibatis.session.SqlSessionFactoryä¸­ï¼š<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> @Autowired</span><br><span class="line">private ObjectProvider&lt;Interceptor&gt; interceptorsProvider;</span><br><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">private ObjectProvider&lt;SqlSessionFactory&gt; sqlSessionFactories;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void afterPropertiesSet() throws Exception &#123;</span><br><span class="line">    for (SqlSessionFactory factory : sqlSessionFactories) &#123;</span><br><span class="line">        for (Interceptor interceptor : interceptorsProvider) &#123;</span><br><span class="line">            factory.getConfiguration().addInterceptor(interceptor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰çš„ç›‘æ§æŒ‡æ ‡é¡µé¢ä¸­çœ‹åˆ°é‡‡é›†åˆ°çš„ä¸SQLç›¸å…³çš„ç›‘æ§æŒ‡æ ‡ã€‚ä½†æ˜¯ï¼Œè¯¥æ–¹æ¡ˆæ— æ³•åŒºåˆ†ä¸»åº“å’Œå¤‡åº“çš„SQLã€‚</p><h4 id="JDBC-Statement"><a href="#JDBC-Statement" class="headerlink" title="JDBC Statement"></a>JDBC Statement</h4><p>  æˆ‘ä»¬çŸ¥é“ï¼Œæœ€ç»ˆçš„SQLæ‰§è¡Œæ˜¯é€šè¿‡JDBCçš„Statementå®Œæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨JDBCçš„Statementæ‰§è¡ŒSQLçš„åœ°æ–¹ä¸ŠæŠ¥ç›‘æ§æŒ‡æ ‡ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰Statementæ¥æ‰§è¡ŒSQLï¼Œå¹¶åŒæ—¶ä¸ŠæŠ¥SQLçš„ç›‘æ§æŒ‡æ ‡ã€‚ä»¥ä¸‹æ˜¯ç±»å…³ç³»å›¾ç¤ºä¾‹ï¼š<br>   <img src="/2023/11/25/ShardingSphere-JDBC-SQL-Metrics/ShardingSphere-JDBC-SQL-Metrics-class.png"></p><p>   åœ¨<code>DalStatement</code>å’Œ<code>PreparedStatement</code> é‡è½½<code>executeQuery</code>å’Œ<code>executeUpdate</code> æ–¹æ³•å¢åŠ ç›¸å…³ç›‘æ§æŒ‡æ ‡ï¼Œå…·ä½“ä»£ç å¯å‚è€ƒ<a href="https://github.com/yinghuzhu/ydal-spring-boot-starter">ydal-spring-boot-starter</a></p><p>   è¿™æ ·å¯ä»¥è¾“å‡ºç±»ä¼¼å¦‚ä¸‹çš„metricsä¸ŠæŠ¥åˆ°prometheus<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql_execute_time_seconds_count&#123;route=&quot;slave&quot;,datasource=&quot;order&quot;,type=&quot;select&quot;,&#125; 82.0</span><br><span class="line">sql_execute_time_seconds_sum&#123;route=&quot;slave&quot;,datasource=&quot;order&quot;,type=&quot;select&quot;,&#125; 12.373654891</span><br><span class="line">sql_execute_time_seconds_count&#123;route=&quot;master&quot;,datasource=&quot;order&quot;,type=&quot;select&quot;,&#125; 14.0</span><br><span class="line">sql_execute_time_seconds_sum&#123;route=&quot;master&quot;,datasource=&quot;order&quot;,type=&quot;select&quot;,&#125; 167.934782891</span><br><span class="line">sql_execute_time_seconds_count&#123;route=&quot;master&quot;,datasource=&quot;order&quot;,type=&quot;update&quot;,&#125; 1.0</span><br><span class="line">sql_execute_time_seconds_sum&#123;route=&quot;master&quot;,datasource=&quot;order&quot;,type=&quot;update&quot;,&#125; 0.493257718</span><br></pre></td></tr></table></figure><br>   é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰çš„ç›‘æ§æŒ‡æ ‡é¡µé¢ä¸­æŸ¥çœ‹é‡‡é›†åˆ°çš„SQLç›‘æ§æŒ‡æ ‡ï¼Œå¹¶åŒºåˆ†ä¸»åº“å’Œå¤‡åº“çš„SQLã€‚ è¯¦ç»†ä»£ç ï¼š<a href="https://github.com/yinghuzhu/ydal-spring-boot-starter">https://github.com/yinghuzhu/ydal-spring-boot-starter</a> </p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æœ¬æ¬¡SQLç›‘æ§çš„å®è·µï¼Œæˆ‘ä»¬æˆåŠŸåœ°é›†æˆäº†SQLç›‘æ§åŠŸèƒ½åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶å°†å…¶ä¸ç°æœ‰çš„æŒ‡æ ‡é›†æˆåœ¨ä¸€èµ·ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°äº†è§£åº”ç”¨ç¨‹åºå¯¹æ•°æ®åº“çš„è®¿é—®æƒ…å†µï¼Œå¹¶åŠæ—¶å‘ç°æ½œåœ¨çš„æ€§èƒ½é—®é¢˜å’Œç“¶é¢ˆã€‚æˆ‘ä»¬é€‰æ‹©äº†è‡ªå®šä¹‰çš„JDBC Statementæ¥å®ç°SQLç›‘æ§ï¼Œå¹¶é€šè¿‡ä¸ŠæŠ¥ç›‘æ§æŒ‡æ ‡çš„æ–¹å¼å°†å…¶é›†æˆåˆ°ç°æœ‰çš„ç›‘æ§ç³»ç»Ÿä¸­ã€‚è¿™ç§æ–¹æ¡ˆç®€å•ä¸”æœ‰æ•ˆï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹SQLæ‰§è¡Œè¿›è¡Œç²¾ç¡®ç›‘æ§ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–å’Œè°ƒæ•´ã€‚å°½ç®¡æˆ‘ä»¬åœ¨æœ¬æ¬¡å®è·µä¸­å–å¾—äº†æˆåŠŸï¼Œä½†æˆ‘ä»¬ä¹Ÿæ„è¯†åˆ°SQLç›‘æ§ä»…ä»…æ˜¯æ€§èƒ½ä¼˜åŒ–å’Œæ•°æ®åº“è®¿é—®ç®¡ç†çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æœªæ¥çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢æ›´å¤šçš„æ•°æ®åº“è®¿é—®ä¼˜åŒ–æŠ€æœ¯ï¼Œå¹¶è¿›ä¸€æ­¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘æˆ‘ä»¬è¿›è¡Œäº†ä¸€ä¸ªé¡¹ç›®çš„é‡æ„ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦ç›®æ ‡æ˜¯å‡å°‘æ•°æ®åº“è®¿é—®çš„è´Ÿè½½ã€‚ç”±äºæ ¸å¿ƒæ•°æ®åº“è¢«å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®ï¼Œå¹¶ä¸”æ•°æ®åº“æœåŠ¡å™¨åªèƒ½å¯¹æ•´ä½“æ•°æ®åº“æµé‡è¿›è¡Œç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºç«¯ç›‘æ§ä¸åŒåº”ç”¨ç¨‹åºçš„SQLè¯·æ±‚ï¼Œå¹¶å°†å…¶ä¸ç°æœ‰çš„æŒ‡æ ‡é›†æˆåœ¨ä¸€èµ·&lt;/p&gt;</summary>
    
    
    
    
    <category term="ç›‘æ§" scheme="https://www.yzhu.name/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>Data Memcachedé›†ç¾¤è¿ç§»è‡³Redisé›†ç¾¤</title>
    <link href="https://www.yzhu.name/2023/09/09/Data-Memcached-To-Redis/"/>
    <id>https://www.yzhu.name/2023/09/09/Data-Memcached-To-Redis/</id>
    <published>2023-09-09T03:38:05.000Z</published>
    <updated>2025-11-11T03:53:15.766Z</updated>
    
    <content type="html"><![CDATA[<p>éšç€ä¸šåŠ¡è§„æ¨¡çš„å¢é•¿ï¼Œæˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿé¢ä¸´æ‰©å±•æ€§å’Œè¿ç»´æ•ˆç‡çš„æŒ‘æˆ˜ã€‚è¿‘æœŸæˆ‘ä»¬å›¢é˜Ÿå°†ç¼“å­˜ç³»ç»Ÿä»Memcachedè¿ç§»åˆ°Redisé›†ç¾¤ã€‚<span id="more"></span></p><h2 id="é¡¹ç›®èƒŒæ™¯ä¸è¿ç§»åŠ¨æœº"><a href="#é¡¹ç›®èƒŒæ™¯ä¸è¿ç§»åŠ¨æœº" class="headerlink" title="é¡¹ç›®èƒŒæ™¯ä¸è¿ç§»åŠ¨æœº"></a>é¡¹ç›®èƒŒæ™¯ä¸è¿ç§»åŠ¨æœº</h2><p>æˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿæœ€åˆåŸºäºMemcachedï¼Œæ€§èƒ½è¡¨ç°ç¨³å®šï¼Œä½†éšç€ä¸šåŠ¡å‘å±•ï¼ŒMemcachedçš„å±€é™æ€§é€æ¸æš´éœ²ï¼š</p><ul><li><strong>æ‰©å±•æ€§å—é™</strong>ï¼šMemcachedé›†ç¾¤ä¸æ”¯æŒè‡ªåŠ¨åˆ†ç‰‡ï¼Œæ‰©å®¹å’Œç¼©å®¹éœ€å®¢æˆ·ç«¯æ‰‹åŠ¨å®ç°ï¼Œæ“ä½œç¹çä¸”è¿ç»´æˆæœ¬é«˜ï¼Œéš¾ä»¥åº”å¯¹æµé‡å¿«é€Ÿå¢é•¿ã€‚</li><li><strong>ç›‘æ§èƒ½åŠ›è–„å¼±</strong>ï¼šMemcachedæä¾›çš„æŒ‡æ ‡æœ‰é™ï¼ˆä»…å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ç­‰ï¼‰ï¼Œæ•…éšœæ’æŸ¥å’Œå‘Šè­¦ä¸ä¾¿ï¼Œå½±å“é—®é¢˜å®šä½æ•ˆç‡ã€‚</li><li><strong>æ•°æ®ç±»å‹å•ä¸€</strong>ï¼šä»…æ”¯æŒé”®å€¼å¯¹ï¼Œå¤æ‚ä¸šåŠ¡éœ€æ±‚éœ€é¢å¤–å¼€å‘æ”¯æŒï¼Œæ•ˆç‡ä½ä¸‹ã€‚</li></ul><p>è¿™äº›é—®é¢˜ä¿ƒä½¿æˆ‘ä»¬å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆï¼Œæœ€ç»ˆé€‰æ‹©äº†Redisé›†ç¾¤ã€‚è¿ç§»çš„ç›®æ ‡ä¸æ˜¯æå‡æ€§èƒ½ï¼Œè€Œæ˜¯è§£å†³æ‰©å±•æ€§å’Œç›‘æ§é—®é¢˜ï¼Œä¸ºæœªæ¥å‘å±•é¢„ç•™ç©ºé—´ã€‚</p><h2 id="æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Redisé›†ç¾¤"><a href="#æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Redisé›†ç¾¤" class="headerlink" title="æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Redisé›†ç¾¤"></a>æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Redisé›†ç¾¤</h2><p>æˆ‘ä»¬ç›´æ¥é€‰æ‹©äº†Redisé›†ç¾¤ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li><strong>æˆç†Ÿåº¦</strong>ï¼šRedisçš„ç¤¾åŒºæ‹¥æœ‰ä¸°å¯Œæ–‡æ¡£å’Œæ´»è·ƒæ”¯æŒï¼Œè€Œä¸”æˆ‘ä»¬å›¢é˜Ÿåœ¨å…¶ä»–é¡¹ç›®ä¸­çš„ä½¿ç”¨å·²éå¸¸æˆç†Ÿã€‚</li><li><strong>åŠŸèƒ½ä¼˜åŠ¿</strong>ï¼šæ”¯æŒè‡ªåŠ¨åˆ†ç‰‡ã€ä¸°å¯Œæ•°æ®ç»“æ„ï¼ˆå¦‚Hashã€Listï¼‰å’Œå†…ç½®ç›‘æ§ï¼Œå¼¥è¡¥Memcachedçš„ä¸è¶³ã€‚</li><li><strong>å›¢é˜Ÿç†Ÿæ‚‰</strong>ï¼šå›¢é˜Ÿå¯¹Redisçš„å¼€å‘å’Œè¿ç»´ç»éªŒä¸°å¯Œï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ã€‚</li></ul><h2 id="è¿ç§»è¿‡ç¨‹"><a href="#è¿ç§»è¿‡ç¨‹" class="headerlink" title="è¿ç§»è¿‡ç¨‹"></a>è¿ç§»è¿‡ç¨‹</h2><p>è¿ç§»åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œç¡®ä¿æ— ä¾µå…¥ä¸”é£é™©å¯æ§ï¼š</p><ol><li><strong>ä»£ç æ”¹é€ </strong>ï¼š<ul><li>é€šè¿‡åº•å±‚SDKé€‚é…Redisé›†ç¾¤ï¼Œå°è£…ç¼“å­˜æ“ä½œæ¥å£ï¼ˆ<code>get</code>ã€<code>set</code>ï¼‰ï¼Œä¸šåŠ¡ä»£ç æ— éœ€æ”¹åŠ¨ã€‚</li><li>é…ç½®åŠ¨æ€åˆ‡æ¢ç¼“å­˜åç«¯ï¼ˆMemcachedæˆ–Redisï¼‰ã€‚</li></ul></li><li><strong>æµ‹è¯•éªŒè¯</strong>ï¼š<ul><li>æ¨¡æ‹Ÿä¸šåŠ¡åœºæ™¯éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§ã€‚</li><li>æµ‹è¯•Redisé›†ç¾¤çš„æ‰©å®¹&#x2F;ç¼©å®¹ï¼Œç¡®ä¿æ— å½±å“ã€‚</li></ul></li><li><strong>ç°åº¦å‘å¸ƒ</strong>ï¼š<ul><li>ä»5%æµé‡å¼€å§‹ï¼Œé€æ­¥å¢è‡³20%ï¼Œè§‚å¯Ÿä¸€å‘¨åå…¨é‡åˆ‡æ¢ã€‚</li><li>æŒ‰ç”¨æˆ·ç»´åº¦åŒºåˆ†æµé‡ï¼Œé¿å…æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li></ul></li><li><strong>æ•°æ®è¿‡æ¸¡</strong>ï¼š<ul><li>æ–°è¯·æ±‚å†™å…¥Redisï¼Œæ—§æ•°æ®åœ¨Memcachedè¿‡æœŸï¼Œæ— éœ€æ˜¾å¼è¿ç§»ã€‚è¿™ç§ç­–ç•¥èƒ½æœ‰æ•ˆé™ä½è¿ç§»å¤æ‚æ€§ã€‚ä½†å¯¹äºæŸäº›å…³é”®ç¼“å­˜æ•°æ®ï¼Œå¯èƒ½éœ€è¦æ›´è°¨æ…çš„è¿ç§»æ–¹æ¡ˆã€‚</li></ul></li><li><strong>ç›‘æ§æ”¯æŒ</strong>ï¼š<ul><li>ä½¿ç”¨Prometheuså’ŒGrafanaï¼Œä»æµ‹è¯•åˆ°å…¨é‡å…¨ç¨‹ç›‘æ§Rediså’Œä¸šåŠ¡æŒ‡æ ‡ã€‚å…³é”®ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬Redisçš„CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€è¿æ¥æ•°ã€å‘½ä¸­ç‡ã€Keyçš„æ•°é‡ï¼Œä»¥åŠä¸šåŠ¡ç›¸å…³çš„é”™è¯¯ç‡ã€è¯·æ±‚é‡ç­‰ã€‚</li></ul></li></ol><h2 id="æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ"></a>æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h2><p>è¿ç§»ä¸­æš´éœ²äº†ä¸‰ä¸ªä¸»è¦æŒ‘æˆ˜ï¼Œæˆ‘ä»¬é€ä¸€è§£å†³ï¼š</p><ol><li><strong>å¤§Keyé—®é¢˜</strong>ï¼š<ul><li><strong>æŒ‘æˆ˜</strong>ï¼šMemcachedèŠ‚ç‚¹å†…å­˜å¤§ï¼Œå¤§Keyä¸æ˜æ˜¾ï¼›Redisé›†ç¾¤åˆ†ç‰‡å†…å­˜å°ï¼Œå¤§Keyå¯¼è‡´è´Ÿè½½ä¸å‡ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå°†å¤§Keyæ‹†åˆ†ä¸ºå¤šä¸ªå°Keyï¼ˆå¦‚<code>user:123</code>æ‹†ä¸º<code>user:123:profile</code>ï¼‰ï¼Œå‡åŒ€åˆ†å¸ƒã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šå†…å­˜ä½¿ç”¨ç‡ä»100%é™è‡³50%ã€‚</li></ul></li><li><strong>çƒ­Keyé—®é¢˜</strong>ï¼š<ul><li><strong>æŒ‘æˆ˜</strong>ï¼šRedisåˆ†ç‰‡é…ç½®ä½ï¼Œçƒ­Keyé«˜é¢‘è®¿é—®å¯¼è‡´QPSæ¿€å¢ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¼•å…¥æœ¬åœ°ç¼“å­˜ï¼ˆTTL 1åˆ†é’Ÿï¼‰ï¼Œå…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼Œä¼˜å…ˆä»æœ¬åœ°è¯»å–ã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šRedisè´Ÿè½½å‡å°‘80%ã€‚</li></ul></li><li><strong>JVMå´©æºƒ</strong>ï¼š<ul><li><strong>æŒ‘æˆ˜</strong>ï¼šåœ¨æµé‡é«˜å³°æ—¶JVMå´©æºƒï¼Œå› ä¸ºç³»ç»Ÿå†…éƒ¨ä½¿ç”¨Redissonä¾èµ–çš„nettyä¸gRPCä¾èµ–çš„nettyç‰ˆæœ¬å†²çªã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå‡çº§Redissonåˆ°æœ€æ–°ç‰ˆã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šå´©æºƒé—®é¢˜æ¶ˆå¤±ã€‚</li></ul></li></ol><h2 id="è¿ç§»æˆæœ"><a href="#è¿ç§»æˆæœ" class="headerlink" title="è¿ç§»æˆæœ"></a>è¿ç§»æˆæœ</h2><ul><li><strong>æ€§èƒ½ä¸ç¨³å®šæ€§</strong>ï¼š<ul><li>è¿ç§»åæ€§èƒ½å’Œç¨³å®šæ€§ä¸MemcachedæŒå¹³ï¼Œæœªè§æå‡ï¼Œå› ç›®æ ‡éæ€§èƒ½ä¼˜åŒ–ã€‚</li><li>å‹æµ‹æ˜¾ç¤ºä¸¤è€…åœ¨20ä¸‡QPSä¸‹è¡¨ç°ç›¸å½“ã€‚</li></ul></li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼š<ul><li>é¡µé¢åŠ è½½æ—¶é—´å’ŒæœåŠ¡ç¨³å®šæ€§æ— å˜åŒ–ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥åé¦ˆã€‚</li></ul></li><li><strong>å®é™…ä»·å€¼</strong>ï¼š<ul><li><strong>æ‰©å±•æ€§</strong>ï¼šRedisé›†ç¾¤æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œè§£å†³äº†Memcachedçš„ç“¶é¢ˆã€‚</li><li><strong>ç›‘æ§æ€§</strong>ï¼šä¸°å¯ŒæŒ‡æ ‡æå‡äº†è¿ç»´æ•ˆç‡ã€‚</li></ul></li></ul><h2 id="ç»éªŒæ•™è®­"><a href="#ç»éªŒæ•™è®­" class="headerlink" title="ç»éªŒæ•™è®­"></a>ç»éªŒæ•™è®­</h2><ol><li><strong>æ— ä¾µå…¥SDK</strong>ï¼šé™ä½é£é™©ï¼Œä¸šåŠ¡ä»£ç ç¨³å®šã€‚</li><li><strong>ç°åº¦å‘å¸ƒ</strong>ï¼šåˆ†é˜¶æ®µåˆ‡æ¢ï¼Œé—®é¢˜å¯æ§ã€‚</li><li><strong>å…³é—­æŒä¹…åŒ–</strong>ï¼šæå‡æ€§èƒ½ï¼Œé€‚é…éœ€æ±‚ã€‚ä¸ºäº†è¿½æ±‚æ›´é«˜çš„è¯»å†™æ€§èƒ½ï¼Œæˆ‘ä»¬é€‰æ‹©å…³é—­äº†Redisçš„æŒä¹…åŒ–åŠŸèƒ½ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æƒè¡¡æ˜¯å¦å¼€å¯æŒä¹…åŒ–ä»¥åŠé€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–ç­–ç•¥ã€‚</li><li><strong>å…¨é¢ç›‘æ§</strong>ï¼šå®æ—¶åé¦ˆï¼Œå¿«é€Ÿå“åº”ã€‚</li><li><strong>èšç„¦æ‰©å±•æ€§</strong>ï¼šæ˜ç¡®ç›®æ ‡ï¼Œé¢„ç•™æ½œåŠ›ã€‚</li></ol><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è¿™æ¬¡è¿ç§»è®©æˆ‘ä»¬ä»Memcachedçš„å±€é™ä¸­è§£è„±ï¼ŒRedisé›†ç¾¤ä¸ºæœªæ¥å¢é•¿å¥ å®šäº†åŸºç¡€ã€‚è™½ç„¶æ€§èƒ½æœªæå‡ï¼Œä½†æ‰©å±•æ€§å’Œç›‘æ§èƒ½åŠ›çš„æ”¹å–„è¾¾åˆ°äº†é¢„æœŸã€‚å…³äºæˆæœ¬æ–¹é¢ï¼Œè¿ç§»åˆ°Redisé›†ç¾¤å¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„æœåŠ¡å™¨æˆæœ¬å¢åŠ ï¼Œä½†è¿ç»´æ•ˆç‡çš„æå‡æœ‰æœ›åœ¨é•¿æœŸé™ä½æ€»ä½“æˆæœ¬ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;éšç€ä¸šåŠ¡è§„æ¨¡çš„å¢é•¿ï¼Œæˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿé¢ä¸´æ‰©å±•æ€§å’Œè¿ç»´æ•ˆç‡çš„æŒ‘æˆ˜ã€‚è¿‘æœŸæˆ‘ä»¬å›¢é˜Ÿå°†ç¼“å­˜ç³»ç»Ÿä»Memcachedè¿ç§»åˆ°Redisé›†ç¾¤ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="æŠ€æœ¯æ–¹æ¡ˆ" scheme="https://www.yzhu.name/tags/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://www.yzhu.name/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç°åº¦å‘å¸ƒè¿‡ç¨‹ä¸­ç¼“å­˜æ•°æ®ä¸€è‡´æ€§é—®é¢˜</title>
    <link href="https://www.yzhu.name/2023/05/13/Gray-Scale-Deployment-Cache-Consistency/"/>
    <id>https://www.yzhu.name/2023/05/13/Gray-Scale-Deployment-Cache-Consistency/</id>
    <published>2023-05-13T12:54:07.000Z</published>
    <updated>2025-11-11T03:53:15.768Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åº¦å‘å¸ƒæ˜¯ä¸€ç§å¸¸è§çš„ä¸Šçº¿ç­–ç•¥ã€‚å¦‚æœç°åº¦å‘å¸ƒæ—¶é—´è¾ƒé•¿ï¼Œä¸”åœ¨ç°åº¦æœŸé—´å„åˆ†ç»„å…±ç”¨ç¼“å­˜ï¼Œé‚£ä¹ˆè¯¥è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé¢ä¸´ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†è®¨è®ºåœ¨ç°åº¦å‘å¸ƒè¿‡ç¨‹ä¸­å¯¼è‡´ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚ <span id="more"></span></p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>é€šå¸¸ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ç°åº¦å‘å¸ƒç­–ç•¥æ¥ç¡®ä¿æ–°åŠŸèƒ½çš„å¹³ç¨³ä¸Šçº¿ã€‚æˆ‘ä»¬å°†ç”¨æˆ·æµé‡åˆ†ä¸ºä¸¤ä¸ªç»„ï¼ˆä¸ºäº†æè¿°ç®€å•ï¼Œå‡è®¾ç°åº¦åªæœ‰ä¸¤ä¸ªåˆ†ç»„ï¼‰ï¼šAç»„å’ŒBç»„ã€‚åœ¨ç°åº¦å‘å¸ƒçš„ç¬¬ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬é€‰æ‹©å°†20%çš„æµé‡åˆ†é…ç»™Bç»„ï¼Œå°†å‰©ä½™çš„80%åˆ†é…ç»™Aç»„ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ–°åŠŸèƒ½åœ¨ä¸€éƒ¨åˆ†ç”¨æˆ·ä¸­è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ï¼ŒåŒæ—¶ä¿æŒå¯¹å¤§å¤šæ•°ç”¨æˆ·çš„ç¨³å®šæ€§ã€‚ç„¶è€Œï¼Œåœ¨ç°åº¦å‘å¸ƒè¿‡ç¨‹ä¸­ç”±äºä»£ç ç‰ˆæœ¬çš„ä¸ä¸€è‡´ï¼Œå¯¼è‡´Aç»„å’ŒBç»„çš„ç¼“å­˜æ•°æ®å‡ºç°äº†ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><p>åœ¨ç°åº¦å‘å¸ƒæœŸé—´å¯èƒ½å‡ºç°ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯å¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼š</p><ol><li><p><strong>ç¼“å­˜å¢åŠ å…ƒç´ ï¼š</strong> åœ¨Bç»„çš„ä»£ç ç‰ˆæœ¬ï¼ˆv2ï¼‰ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªç¼“å­˜å¯¹è±¡çš„å…ƒç´ ï¼Œä½†æ˜¯Aç»„çš„ä»£ç ç‰ˆæœ¬ï¼ˆv1ï¼‰å¹¶æ²¡æœ‰åŒ…å«è¿™ä¸ªå…ƒç´ ã€‚è¿™å¯¼è‡´Aç»„å†™å…¥ç¼“å­˜çš„æ•°æ®ï¼Œåœ¨Bç»„è¯»å–æ—¶æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œå¯¼è‡´æ•°æ®è§£æå¤±è´¥ã€‚</p></li><li><p><strong>è®¡ç®—é€»è¾‘å˜åŒ–ï¼š</strong> ç¼“å­˜å¯¹è±¡çš„å…ƒç´ ï¼ˆe1ï¼‰æ˜¯é€»è¾‘è®¡ç®—å¾—å‡ºçš„ç»“æœï¼Œåœ¨Bç»„çš„ä»£ç ç‰ˆæœ¬ï¼ˆv2ï¼‰ä¸­æˆ‘ä»¬ä¿®æ”¹äº†è¯¥å…ƒç´ è®¡ç®—é€»è¾‘ï¼Œä½†æ˜¯Aç»„çš„ä»£ç ç‰ˆæœ¬ï¼ˆv1ï¼‰ä»æ˜¯æ—§çš„è®¡ç®—é€»è¾‘ï¼›è¿™å¯¼è‡´Aç»„å†™å…¥çš„ç¼“å­˜Bç»„è¯»å‡ºä¸ç¬¦åˆé¢„æœŸï¼Œè€ŒBç»„å†™å…¥çš„ç¼“å­˜Aç»„è¯»å‡ºä¸ç¬¦åˆé¢„æœŸã€‚</p></li></ol><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨é¢å¯¹è¿™ç§ç¼“å­˜æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é‡‡å–äº†ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p><strong>a&#x2F;bç»„ç¼“å­˜éš”ç¦»</strong>ï¼šA&#x2F;Bç»„åˆ†åˆ«è®¿é—®ä¸åŒçš„ç¼“å­˜ï¼Œä¸åŒçš„åˆ†ç»„å¯ä»¥è¿æ¥ä¸åŒçš„ç¼“å­˜æˆ–è€…ä¸åŒçš„åˆ†ç»„ä»¥ä¸åŒçš„keyå‰ç¼€åŒºåˆ†ã€‚ç„¶è€Œå®é™…æƒ…å†µæ˜¯ä»¥ä¸Šé—®é¢˜åªä¼šå‘ç”Ÿåœ¨æä¸ªåˆ«çš„ç¼“å­˜å…ƒç´ ä¸Šã€‚è¿™ç§æ–¹æ¡ˆè™½ç„¶èƒ½è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œä½†ç¼“å­˜æ•°é‡ä¼šéšç€åˆ†ç»„çš„å¢åŠ è€Œæˆå€å¢åŠ ï¼Œé€ æˆèµ„æºçš„ä¸¥é‡æµªè´¹ï¼ŒåŒæ—¶ç¼“å­˜å‘½ä¸­ç‡ä¹Ÿä¼šä¸‹é™ã€‚</p></li><li><p><strong>ååºåˆ—åŒ–å…¼å®¹å¢åŠ çš„å…ƒç´ </strong>ï¼šåŸºæœ¬æ‰€æœ‰çš„åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ç»„ä»¶éƒ½æ”¯æŒè¯¥åŠŸèƒ½ã€‚æ¯”å¦‚JDKè‡ªå¸¦çš„åŠŸèƒ½ç¡®ä¿<code>serialVersionUID</code>ä¿æŒä¸å˜å³å¯ï¼Œæˆ–è€…ä½¿ç”¨protobufã€jsonç­‰åºåˆ—åŒ–ç±»åº“éƒ½å¯ä»¥å®ç°ã€‚è¯¥æ–¹æ³•è™½ç„¶èƒ½è§£å†³Aç»„å†™å…¥Bè¯»å–ååºåˆ—åŒ–å¤±è´¥çš„é—®é¢˜ï¼Œä½†Bç»„ååºåˆ—åŒ–æˆåŠŸä»ç„¶ç¼ºå°‘æ–°å¢åŠ çš„å…ƒç´ ã€‚</p></li><li><p><strong>ä½¿ç”¨æ–°key</strong>ï¼šåœ¨Bç»„ä»£ç ä¸­ä½¿ç”¨æ–°çš„keyï¼Œè¿™æ ·A&#x2F;Bç»„ç¼“å­˜å¯ä»¥å½»åº•éš”ç¦»ã€‚ä½†å¯¹äºæŸäº›åº•å±‚æ•°æ®ç»“æ„ï¼Œå¯èƒ½è¢«ä¸Šå±‚å¾ˆå¤šç¼“å­˜å¼•ç”¨ï¼Œè€Œä¸”æ˜¯é€šè¿‡å¤šçº§å¼•ç”¨ï¼Œå¼€å‘äººå‘˜å®¹æ˜“é—æ¼æŸäº›keyã€‚</p></li><li><p><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šå¤§è‡´æ€è·¯æ˜¯æ¯ä¸ªç¼“å­˜åœ¨keyä¸Šæºå¸¦æœ¬æ¬¡å˜æ›´çš„ç‰ˆæœ¬å·ã€‚å¦‚æœæœ¬æ¬¡å‘å¸ƒç¼“å­˜å…ƒç´ æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ç‰ˆæœ¬å·ä¸å˜ã€‚å…·ä½“å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åœ¨Springå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­è·å–æ‰€æœ‰æ ‡è®°<code>@Cacheable</code>æ³¨è§£çš„æ–¹æ³•ã€‚</li><li>å¯¹æ–¹æ³•è¿”å›å€¼å¯¹è±¡å†…å…ƒç´ æŒ‰ç…§å…ƒç´ ç±»å‹å’Œä¸€å®šçš„ç®—æ³•è®¡ç®—å¯¹è±¡codeå€¼ã€‚å¦‚æœå¯¹è±¡å…ƒç´ å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å¯¹è±¡codeå€¼ä¸€å®šå˜åŒ–ã€‚å¦‚æœæ˜¯å…ƒç´ æ˜¯è‡ªå®šä¹‰å¯¹è±¡éœ€è¦é€’å½’è®¡ç®—ã€‚</li><li>è¯»å†™ç¼“å­˜æ—¶åœ¨ç¼“å­˜keyå¢åŠ codeåç¼€ã€‚</li></ul></li></ol><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æœ€åæˆ‘ä»¬é‡‡ç”¨äº†<strong>ç‰ˆæœ¬æ§åˆ¶</strong>çš„æ–¹æ¡ˆã€‚åœ¨å®æ–½å‰ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯ï¼Œç¡®ä¿ç¼“å­˜çš„ç‰ˆæœ¬æ§åˆ¶é€»è¾‘æ­£ç¡®æ— è¯¯ï¼Œå¹¶åœ¨ç°åº¦å‘å¸ƒæœŸé—´ä¿æŒäº†ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç°åº¦å‘å¸ƒæ˜¯ä¸€ç§å¸¸è§çš„ä¸Šçº¿ç­–ç•¥ã€‚å¦‚æœç°åº¦å‘å¸ƒæ—¶é—´è¾ƒé•¿ï¼Œä¸”åœ¨ç°åº¦æœŸé—´å„åˆ†ç»„å…±ç”¨ç¼“å­˜ï¼Œé‚£ä¹ˆè¯¥è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé¢ä¸´ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†è®¨è®ºåœ¨ç°åº¦å‘å¸ƒè¿‡ç¨‹ä¸­å¯¼è‡´ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="æŠ€æœ¯æ–¹æ¡ˆ" scheme="https://www.yzhu.name/tags/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="ä¸€è‡´æ€§" scheme="https://www.yzhu.name/tags/%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>Session Memcachedé›†ç¾¤è¿ç§»è‡³Redisé›†ç¾¤</title>
    <link href="https://www.yzhu.name/2022/10/22/Session-Memcached-To-Redis/"/>
    <id>https://www.yzhu.name/2022/10/22/Session-Memcached-To-Redis/</id>
    <published>2022-10-22T14:51:20.000Z</published>
    <updated>2025-11-11T03:53:15.775Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h3><p>éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œæˆ‘ä»¬åŸæœ‰çš„ <code>session</code> å­˜å‚¨æ–¹æ¡ˆ  <code>Memcached</code>  é€æ¸æ˜¾éœ²å‡ºä¸€äº›ç“¶é¢ˆï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ã€‚ï¼š</p><ul><li><strong>æ‰©å±•æ€§å—é™</strong>ï¼š<code>Memcached</code> é›†ç¾¤ä¸æ”¯æŒåˆ†ç‰‡ï¼Œè¦åˆ†ç‰‡éœ€è¦åœ¨å®¢æˆ·ç«¯å®ç°åˆ†ç‰‡é€»è¾‘ï¼Œ<strong>æ‰©å®¹å’Œç¼©å®¹æ“ä½œç¹ç</strong>ï¼Œè¿ç»´æˆæœ¬è¾ƒé«˜ï¼Œéš¾ä»¥æ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå¢é•¿çš„éœ€æ±‚<span id="more"></span>ã€‚</li><li><strong>ç›‘æ§èƒ½åŠ›è–„å¼±</strong>ï¼š<code>Memcached</code>  æä¾›çš„<strong>ç›‘æ§æŒ‡æ ‡æœ‰é™</strong>ï¼Œéš¾ä»¥å…¨é¢æŒæ¡é›†ç¾¤è¿è¡ŒçŠ¶æ€ï¼Œ<strong>æ•…éšœæ’æŸ¥å’Œå‘Šè­¦</strong>ä¸å¤Ÿä¾¿æ·ã€‚</li><li><strong>ç¼ºå°‘æŒä¹…åŒ–</strong>ï¼š<code>Memcached</code>  ä½œä¸ºçº¯å†…å­˜ç¼“å­˜ï¼Œ<strong>æ•°æ®æ— æ³•æŒä¹…åŒ–</strong>ï¼Œå­˜åœ¨æ•°æ®ä¸¢å¤±é£é™©ï¼Œè™½ç„¶ <code>session</code> æ•°æ®å¯¹æŒä¹…åŒ–è¦æ±‚ä¸é«˜ï¼Œä½†åœ¨æŸäº›æç«¯æƒ…å†µä¸‹ï¼Œæ•°æ®ä¸¢å¤±ä»å¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒã€‚</li></ul><p>ä¸ºäº†è§£å†³  <code>Memcached</code>  çš„ä¸Šè¿°é—®é¢˜ï¼Œå¹¶æå‡  <code>session</code>  å­˜å‚¨çš„<strong>æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œç›‘æ§èƒ½åŠ›</strong>ï¼Œæˆ‘ä»¬å†³å®šå°†  <code>session</code>  å­˜å‚¨æ–¹æ¡ˆè¿ç§»è‡³  <strong>Redis é›†ç¾¤</strong>ã€‚<code>Redis</code>  é›†ç¾¤åœ¨<strong>é›†ç¾¤åŒ–ã€ç›‘æ§å‘Šè­¦ã€æ•°æ®æŒä¹…åŒ–</strong>ç­‰æ–¹é¢éƒ½å…·å¤‡æ˜¾è‘—ä¼˜åŠ¿ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ»¡è¶³æˆ‘ä»¬ä¸šåŠ¡å‘å±•çš„éœ€æ±‚ã€‚</p><h3 id="è¿ç§»æ–¹æ¡ˆä¸å®æ–½é˜¶æ®µ"><a href="#è¿ç§»æ–¹æ¡ˆä¸å®æ–½é˜¶æ®µ" class="headerlink" title="è¿ç§»æ–¹æ¡ˆä¸å®æ–½é˜¶æ®µ"></a>è¿ç§»æ–¹æ¡ˆä¸å®æ–½é˜¶æ®µ</h3><p>æœ¬æ¬¡  <code>session</code>  è¿ç§»é¡¹ç›®ï¼Œæˆ‘ä»¬é‡‡å–äº†<strong>åˆ†é˜¶æ®µã€å¹³æ»‘è¿ç§»</strong>çš„ç­–ç•¥ï¼Œæœ€å¤§ç¨‹åº¦é™ä½è¿ç§»é£é™©ï¼Œä¿éšœä¸šåŠ¡çš„è¿ç»­æ€§å’Œç¨³å®šæ€§ã€‚æ•´ä¸ªè¿ç§»è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><pre class="mermaid">graph TD    subgraph "ç¬¬ä¸€é˜¶æ®µ"        A1[åº”ç”¨æœåŠ¡] --> |å†™| B1[Memcached]        A1 --> |å†™| C1[Redis]        B1 --> |è¯»| A1    end        subgraph "ç¬¬äºŒé˜¶æ®µ"        A2[åº”ç”¨æœåŠ¡] --> |å†™| B2[Memcached]        A2 --> |å†™| C2[Redis]        C2 --> |è¯»| A2    end        subgraph "ç¬¬ä¸‰é˜¶æ®µ"        A3[åº”ç”¨æœåŠ¡] --> |å†™| C3[Redis]        C3 --> |è¯»| A3        B3[Memcached] -.-> |åœæ­¢å†™å…¥| A3    end</pre><ul><li><p><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŒå†™ Memcached å’Œ Redisï¼Œè¯» Memcached</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šéªŒè¯  <code>Redis</code>  é›†ç¾¤çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œä¸ºåç»­åˆ‡æ¢è¯»å–æµé‡åšå¥½æ•°æ®å‡†å¤‡ã€‚</li><li><strong>ç­–ç•¥</strong>ï¼šåº”ç”¨ç³»ç»ŸåŒæ—¶å‘  <code>Memcached</code>  å’Œ  <code>Redis</code>  é›†ç¾¤å†™å…¥  <code>session</code>  æ•°æ®ï¼Œä½†<strong>åªä»  <code>Memcached</code>  è¯»å–  <code>session</code>  æ•°æ®</strong>ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§ä¿éšœ</strong>ï¼š<strong>åŒå†™æˆåŠŸæ‰ç®—æˆåŠŸ</strong>ï¼Œç¡®ä¿  <code>Memcached</code>  å’Œ  <code>Redis</code>  æ•°æ®ä¸€è‡´æ€§ã€‚ä»»ä½•å†™å…¥å¤±è´¥éƒ½ä¼šè®°å½•è¯¦ç»†æ—¥å¿—å¹¶è§¦å‘å‘Šè­¦ï¼Œæ–¹ä¾¿åç»­æ•°æ®è¡¥å¿ã€‚</li><li><strong>æŒç»­æ—¶é—´</strong>ï¼šä¸ºäº†ä¿è¯  <code>Redis</code>  é›†ç¾¤ä¸­  <code>session</code>  æ•°æ®çš„å®Œæ•´æ€§ï¼ŒåŒå†™é˜¶æ®µæŒç»­ <strong>30 å¤©</strong>ï¼Œè¦†ç›–  <code>session</code>  çš„æœ€é•¿è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿  <code>Redis</code>  é›†ç¾¤æ‹¥æœ‰å…¨é‡  <code>session</code>  æ•°æ®ã€‚</li></ul></li><li><p><strong>ç¬¬äºŒé˜¶æ®µï¼šåŒå†™ Memcached å’Œ Redisï¼Œè¯» Redis</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šå°†è¯»å–æµé‡å¹³æ»‘åˆ‡æ¢åˆ°  <code>Redis</code>  é›†ç¾¤ï¼ŒéªŒè¯  <code>Redis</code>  é›†ç¾¤åœ¨é«˜å¹¶å‘è¯»å–åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚</li><li><strong>ç­–ç•¥</strong>ï¼šåº”ç”¨ç³»ç»Ÿä»ç„¶åŒæ—¶å‘  <code>Memcached</code>  å’Œ  <code>Redis</code>  é›†ç¾¤å†™å…¥  <code>session</code>  æ•°æ®ï¼Œä½†<strong>è¯»å–æ“ä½œåˆ‡æ¢è‡³  <code>Redis</code>  é›†ç¾¤</strong>ã€‚</li><li><strong>å¹³æ»‘åˆ‡æ¢</strong>ï¼šé‡‡ç”¨<strong>ç°åº¦å‘å¸ƒ</strong>ç­–ç•¥ï¼Œé€æ­¥å°†è¯»å–æµé‡ä»  <code>Memcached</code>  åˆ‡æ¢åˆ°  <code>Redis</code>  é›†ç¾¤ï¼Œé™ä½åˆ‡æ¢é£é™©ã€‚</li><li><strong>å›æ»šå‡†å¤‡</strong>ï¼š<strong>ä¿ç•™  <code>Memcached</code>  çš„å†™å…¥</strong>ï¼Œä¸ºåç»­å¯èƒ½çš„å›æ»šæ“ä½œé¢„ç•™æ•°æ®åŸºç¡€ã€‚</li></ul></li><li><p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šåœæ­¢ Memcached å†™å…¥ï¼Œè¯» Redis</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šå®Œå…¨åˆ‡æ¢åˆ°  <code>Redis</code>  é›†ç¾¤ï¼Œåœç”¨  <code>Memcached</code>ã€‚</li><li><strong>ç­–ç•¥</strong>ï¼š<strong>åœæ­¢å‘  <code>Memcached</code>  å†™å…¥  <code>session</code>  æ•°æ®</strong>ï¼Œæ‰€æœ‰è¯»å†™æ“ä½œå‡è½¬å‘  <code>Redis</code>  é›†ç¾¤ã€‚</li><li><strong>é£é™©è¯„ä¼°</strong>ï¼šåœ¨è¿›å…¥ç¬¬ä¸‰é˜¶æ®µå‰ï¼Œè¿›è¡Œå…¨é¢çš„<strong>é£é™©è¯„ä¼°</strong>ï¼Œç¡®è®¤ç³»ç»Ÿè¿è¡Œç¨³å®šï¼Œå„é¡¹ç›‘æ§æŒ‡æ ‡æ­£å¸¸ã€‚ç”±äºç¬¬äºŒé˜¶æ®µå·²ç»éªŒè¯äº†  <code>Redis</code>  é›†ç¾¤çš„è¯»å–èƒ½åŠ›ï¼Œä¸”  <code>Memcached</code>  å†™å…¥æŒç»­è¿è¡Œï¼Œå› æ­¤ç¬¬ä¸‰é˜¶æ®µçš„é£é™©è¾ƒä½ã€‚</li></ul></li></ul><h3 id="å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ"></a>å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨  <code>session</code>  è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦é¢ä¸´ä»¥ä¸‹æŠ€æœ¯æŒ‘æˆ˜ï¼š</p><ul><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåœ¨åŒå†™é˜¶æ®µï¼Œå¦‚ä½•ä¿è¯  <code>Memcached</code>  å’Œ  <code>Redis</code>  çš„æ•°æ®ä¸€è‡´æ€§è‡³å…³é‡è¦ã€‚æˆ‘ä»¬é€šè¿‡<strong>åŒå†™å¼ºä¸€è‡´æ€§ç­–ç•¥</strong>å’Œå®Œå–„çš„<strong>å¼‚å¸¸ç›‘æ§å‘Šè­¦æœºåˆ¶</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li><strong>å¹³æ»‘åˆ‡æ¢</strong>ï¼šå¦‚ä½•å¹³æ»‘åœ°å°†è¯»å–æµé‡ä»  <code>Memcached</code>  åˆ‡æ¢åˆ°  <code>Redis</code>  é›†ç¾¤ï¼Œé¿å…å¯¹ç”¨æˆ·ä½“éªŒé€ æˆå½±å“ã€‚æˆ‘ä»¬é‡‡ç”¨<strong>ç°åº¦å‘å¸ƒ</strong>ç­–ç•¥ï¼Œé€æ­¥åˆ‡æ¢æµé‡ï¼Œå¹¶å¯†åˆ‡ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€‚</li><li><strong>æ€§èƒ½ä¿éšœ</strong>ï¼š<code>Redis</code>  é›†ç¾¤åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œéœ€è¦è¿›è¡Œå……åˆ†çš„éªŒè¯ã€‚æˆ‘ä»¬åœ¨ç¬¬äºŒé˜¶æ®µé€šè¿‡<strong>å…¨é‡æµé‡è¯»å–  <code>Redis</code>  é›†ç¾¤</strong>ï¼ŒéªŒè¯äº†  <code>Redis</code>  é›†ç¾¤çš„æ€§èƒ½è¡¨ç°ã€‚</li><li><strong>ç›‘æ§ä¸å›æ»š</strong>ï¼šå¦‚ä½•å…¨é¢ç›‘æ§è¿ç§»è¿‡ç¨‹ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸ï¼Œå¹¶åˆ¶å®šå®Œå–„çš„å›æ»šæ–¹æ¡ˆï¼Œä¿éšœè¿ç§»è¿‡ç¨‹çš„å®‰å…¨å¯æ§ã€‚åˆ©ç”¨æˆ‘ä»¬<strong>å®Œå–„çš„ç›‘æ§ä½“ç³»</strong>ï¼Œé’ˆå¯¹æ¯ä¸ªé˜¶æ®µåˆ¶å®šäº†è¯¦ç»†çš„<strong>å›æ»šè®¡åˆ’</strong>ã€‚</li></ul><h3 id="æ€§èƒ½ç›‘æ§ä¸å›æ»šæ–¹æ¡ˆ"><a href="#æ€§èƒ½ç›‘æ§ä¸å›æ»šæ–¹æ¡ˆ" class="headerlink" title="æ€§èƒ½ç›‘æ§ä¸å›æ»šæ–¹æ¡ˆ"></a>æ€§èƒ½ç›‘æ§ä¸å›æ»šæ–¹æ¡ˆ</h3><p>ä¸ºäº†ä¿éšœ  <code>session</code>  è¿ç§»é¡¹ç›®çš„å¹³ç¨³è½åœ°ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®Œå–„çš„æ€§èƒ½ç›‘æ§å’Œå›æ»šæ–¹æ¡ˆï¼š</p><h4 id="1-æ€§èƒ½ç›‘æ§"><a href="#1-æ€§èƒ½ç›‘æ§" class="headerlink" title="1. æ€§èƒ½ç›‘æ§"></a>1. æ€§èƒ½ç›‘æ§</h4><p>åœ¨æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹ç›‘æ§ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š</p><ul><li><strong>Redis é›†ç¾¤æ€§èƒ½æŒ‡æ ‡</strong>ï¼š<ul><li><strong>CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡</strong>ï¼šç›‘æ§  <code>Redis</code>  é›†ç¾¤èµ„æºä½¿ç”¨æƒ…å†µï¼Œåˆ¤æ–­é›†ç¾¤æ˜¯å¦è¿‡è½½ã€‚</li><li><strong>è¯·æ±‚å»¶è¿Ÿ</strong>ï¼šç›‘æ§  <code>Redis</code>  è¯·æ±‚å“åº”æ—¶é—´ï¼Œè¯„ä¼°  <code>Redis</code>  é›†ç¾¤æ€§èƒ½æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚</li><li><strong>é”™è¯¯ç‡</strong>ï¼šç›‘æ§  <code>Redis</code>  è¯·æ±‚é”™è¯¯ç‡ï¼ŒåŠæ—¶å‘ç°  <code>Redis</code>  é›†ç¾¤å¼‚å¸¸ã€‚</li><li><strong>å¤§keyå’Œçƒ­key</strong>ï¼šå…³æ³¨  <code>Redis</code>  çš„æµé‡å’ŒCPUå˜åŒ–æ˜¯å¦å‡ºç°<strong>å¤§keyå’Œçƒ­key</strong>ã€‚</li></ul></li><li><strong>Session è¯»å†™æˆåŠŸç‡</strong>ï¼š<ul><li><strong>Redis  <code>session</code>  è¯»å–æˆåŠŸç‡</strong>ï¼šç›‘æ§ä»  <code>Redis</code>  é›†ç¾¤è¯»å–  <code>session</code>  çš„æˆåŠŸç‡ï¼Œç¡®ä¿è¯»å–æ“ä½œæ­£å¸¸ã€‚</li><li><strong>Redis  <code>session</code>  å†™å…¥æˆåŠŸç‡</strong>ï¼šç›‘æ§å‘  <code>Redis</code>  é›†ç¾¤å†™å…¥  <code>session</code>  çš„æˆåŠŸç‡ï¼Œç¡®ä¿å†™å…¥æ“ä½œæ­£å¸¸ã€‚</li><li><strong>Memcached  <code>session</code>  å†™å…¥æˆåŠŸç‡</strong>ï¼šåœ¨åŒå†™é˜¶æ®µï¼Œç›‘æ§å‘  <code>Memcached</code>  å†™å…¥  <code>session</code>  çš„æˆåŠŸç‡ï¼Œç¡®ä¿åŒå†™æ“ä½œæ­£å¸¸ã€‚</li></ul></li><li><strong>åº”ç”¨ç³»ç»Ÿä¸šåŠ¡æŒ‡æ ‡</strong>ï¼š<ul><li><strong>æ¥å£å“åº”æ—¶é—´</strong>ï¼šç›‘æ§åº”ç”¨ç³»ç»Ÿæ¥å£å“åº”æ—¶é—´ï¼Œè¯„ä¼°è¿ç§»å¯¹åº”ç”¨ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚</li><li><strong>é”™è¯¯ç‡</strong>ï¼šç›‘æ§åº”ç”¨ç³»ç»Ÿé”™è¯¯ç‡ï¼Œè¯„ä¼°è¿ç§»æ˜¯å¦å¼•å…¥æ–°çš„é”™è¯¯ã€‚</li><li><strong>ç™»å½•ç”¨æˆ·æŒ‡æ ‡</strong>ï¼šç›‘æ§ç™»å½•ç”¨æˆ·æ•°é‡å˜åŒ–ï¼Œåˆ¤æ–­è¿ç§»æ˜¯å¦å½±å“ç”¨æˆ·ç™»å½•ã€‚</li><li><strong>å„é˜¶æ®µè½¬åŒ–ç‡</strong> (åŠ è´­ï¼Œç”Ÿå•ï¼Œæ”¯ä»˜)ï¼šç›‘æ§ç”¨æˆ·åœ¨å„ä¸ªå…³é”®ä¸šåŠ¡æµç¨‹çš„è½¬åŒ–ç‡ï¼Œè¯„ä¼°è¿ç§»æ˜¯å¦å¯¹ä¸šåŠ¡æŒ‡æ ‡é€ æˆè´Ÿé¢å½±å“ã€‚</li></ul></li></ul><h4 id="2-å›æ»šæ–¹æ¡ˆ"><a href="#2-å›æ»šæ–¹æ¡ˆ" class="headerlink" title="2. å›æ»šæ–¹æ¡ˆ"></a>2. å›æ»šæ–¹æ¡ˆ</h4><ul><li><strong>å›æ»šè§¦å‘</strong>ï¼šå½“ç›‘æ§æŒ‡æ ‡å‡ºç°å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼šåº”ç”¨ç³»ç»Ÿæ¥å£å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ ã€ä¸šåŠ¡æŒ‡æ ‡å‡ºç°æ˜æ˜¾æ³¢åŠ¨ç­‰æƒ…å†µæ—¶ï¼Œç«‹å³è§¦å‘å›æ»šã€‚</li><li><strong>å›æ»šæ­¥éª¤</strong>ï¼š<ol><li><strong>æµé‡åˆ‡æ¢</strong>ï¼šç«‹å³å°†  <code>session</code>  è¯»å–æµé‡<strong>å›é€€åˆ°  <code>Memcached</code></strong>ã€‚ç”±äºç¬¬äºŒé˜¶æ®µæŒç»­ä¿æŒ  <code>Memcached</code>  å†™å…¥ï¼Œ<code>Memcached</code>  ä¸­ä»ç„¶ä¿æœ‰å…¨é‡  <code>session</code>  æ•°æ®ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢å›è¯»ã€‚</li><li><strong>é—®é¢˜æ’æŸ¥</strong>ï¼šå›æ»šåï¼Œç«‹å³æ’æŸ¥  <code>Redis</code>  é›†ç¾¤å¼‚å¸¸åŸå› ï¼Œä¿®å¤é—®é¢˜ã€‚</li><li><strong>é‡æ–°è¿ç§»</strong>ï¼šå¾…é—®é¢˜è§£å†³åï¼Œé‡æ–°è¯„ä¼°å¹¶é€‰æ‹©åˆé€‚çš„æ—¶æœºå†æ¬¡è¿›è¡Œè¿ç§»ã€‚</li></ol></li></ul><p>ç”±äºæˆ‘ä»¬åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»è¿›è¡Œäº†å……åˆ†çš„  <code>Redis</code>  é›†ç¾¤è¯»å–éªŒè¯ï¼Œå¹¶ä¸”åœ¨ç¬¬ä¸‰é˜¶æ®µå‰è¿›è¡Œäº†å…¨é¢çš„é£é™©è¯„ä¼°ï¼Œå› æ­¤å®é™…ä¸Š<strong>å¹¶æœªè§¦å‘å›æ»š</strong>ã€‚  <strong>ç¬¬äºŒé˜¶æ®µä¿ç•™  <code>Memcached</code>  å†™å…¥çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†åº”å¯¹å¯èƒ½çš„å›æ»šåœºæ™¯</strong>ï¼Œä¸ºç³»ç»Ÿæä¾›ä¸€å±‚é¢å¤–çš„å®‰å…¨ä¿éšœã€‚</p><h3 id="é¡¹ç›®æ€»ç»“ä¸æ”¶ç›Š"><a href="#é¡¹ç›®æ€»ç»“ä¸æ”¶ç›Š" class="headerlink" title="é¡¹ç›®æ€»ç»“ä¸æ”¶ç›Š"></a>é¡¹ç›®æ€»ç»“ä¸æ”¶ç›Š</h3><p><code>session</code> ä» <code>Memcached</code> å¹³æ»‘è¿ç§»è‡³ <code>Redis</code> é›†ç¾¤é¡¹ç›®ï¼Œå†æ—¶æ•°æœˆï¼Œæ•´ä¸ªè¿ç§»è¿‡ç¨‹è¾ƒä¸ºé¡ºåˆ©ï¼Œæœ€ç»ˆ<strong>å¹³ç¨³è½åœ°ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡</strong>ã€‚é€šè¿‡æœ¬æ¬¡è¿ç§»ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† <code>Memcached</code> åœ¨<strong>æ‰©å±•æ€§ã€ç›‘æ§èƒ½åŠ›</strong>ç­‰æ–¹é¢çš„ç“¶é¢ˆï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›äº†æ›´å¯é ã€æ›´é«˜æ•ˆçš„ <code>session</code> å­˜å‚¨æ–¹æ¡ˆã€‚</p><p><strong>é¡¹ç›®æ”¶ç›Šæ€»ç»“</strong>ï¼š</p><ul><li><strong>æå‡æ‰©å±•æ€§</strong>ï¼š<code>Redis</code> é›†ç¾¤å…·å¤‡è‰¯å¥½çš„<strong>æ°´å¹³æ‰©å±•èƒ½åŠ›</strong>ï¼Œå¯ä»¥è½»æ¾åº”å¯¹æœªæ¥ <code>session</code> æ•°æ®é‡çš„å¢é•¿ã€‚ç›¸æ¯”åŸæ¥éœ€è¦åœ¨å®¢æˆ·ç«¯å®ç°åˆ†ç‰‡çš„ <code>Memcached</code> æ–¹æ¡ˆï¼Œ<code>Redis</code> é›†ç¾¤çš„æ‰©å®¹å’Œç¼©å®¹æ“ä½œæ›´åŠ ç®€å•ç›´è§‚ï¼Œæå¤§é™ä½äº†è¿ç»´æˆæœ¬ã€‚</li><li><strong>å¢å¼ºç›‘æ§èƒ½åŠ›</strong>ï¼š<code>Redis</code> é›†ç¾¤æä¾›<strong>æ›´ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡</strong>ï¼Œå¹¶èƒ½ä¸ <code>Prometheus</code> ç­‰ç›‘æ§ç³»ç»Ÿæ–¹ä¾¿é›†æˆï¼Œæå‡è¿ç»´æ•ˆç‡ã€‚</li><li><strong>æ€§èƒ½ç¨³å®š</strong>ï¼šè¿ç§»åç³»ç»Ÿæ€§èƒ½ä¸åŸ <code>Memcached</code> æ–¹æ¡ˆåŸºæœ¬æŒå¹³ï¼Œä½†åœ¨è¿ç»´æ€§å’Œå¯æ‰©å±•æ€§æ–¹é¢è·å¾—äº†æ˜¾è‘—æå‡ï¼Œä¸ºæœªæ¥ä¸šåŠ¡å¢é•¿é¢„ç•™äº†å……è¶³çš„æ‰©å±•ç©ºé—´ã€‚</li><li><strong>ä¸ºæœªæ¥ä¼˜åŒ–å¥ å®šåŸºç¡€</strong>ï¼šè¿ç§»è‡³ <code>Redis</code> é›†ç¾¤ï¼Œä¸ºåç»­ <code>session</code> å­˜å‚¨çš„<strong>æ€§èƒ½ä¼˜åŒ–ã€åŠŸèƒ½å¢å¼º</strong>ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨ <code>Redis</code> æ›´ä¸°å¯Œçš„æ•°æ®ç»“æ„å®ç°æ›´å¤æ‚çš„ <code>session</code> ç®¡ç†åŠŸèƒ½ï¼‰å¥ å®šäº†åŸºç¡€ã€‚</li></ul><p>æœ¬æ¬¡  <code>session</code>  è¿ç§»é¡¹ç›®ï¼Œ  <strong>åˆ†é˜¶æ®µå¹³æ»‘è¿ç§»ç­–ç•¥ã€å®Œå–„çš„ç›‘æ§å›æ»šæ–¹æ¡ˆã€ä»¥åŠå¯¹æ•°æ®ä¸€è‡´æ€§çš„é«˜åº¦é‡è§†</strong>ï¼Œæ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®å› ç´ ã€‚  è¿™äº›ç»éªŒä¹Ÿä¸ºæˆ‘ä»¬åç»­è¿›è¡Œç±»ä¼¼çš„å¤§å‹ç³»ç»Ÿè¿ç§»é¡¹ç›®æä¾›äº†å®è´µçš„å‚è€ƒ.</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;é¡¹ç›®èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é¡¹ç›®èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®èƒŒæ™¯&quot;&gt;&lt;/a&gt;é¡¹ç›®èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œæˆ‘ä»¬åŸæœ‰çš„ &lt;code&gt;session&lt;/code&gt; å­˜å‚¨æ–¹æ¡ˆ  &lt;code&gt;Memcached&lt;/code&gt;  é€æ¸æ˜¾éœ²å‡ºä¸€äº›ç“¶é¢ˆï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ã€‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§å—é™&lt;/strong&gt;ï¼š&lt;code&gt;Memcached&lt;/code&gt; é›†ç¾¤ä¸æ”¯æŒåˆ†ç‰‡ï¼Œè¦åˆ†ç‰‡éœ€è¦åœ¨å®¢æˆ·ç«¯å®ç°åˆ†ç‰‡é€»è¾‘ï¼Œ&lt;strong&gt;æ‰©å®¹å’Œç¼©å®¹æ“ä½œç¹ç&lt;/strong&gt;ï¼Œè¿ç»´æˆæœ¬è¾ƒé«˜ï¼Œéš¾ä»¥æ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå¢é•¿çš„éœ€æ±‚&lt;/li&gt;&lt;/ul&gt;</summary>
    
    
    
    
    <category term="æŠ€æœ¯æ–¹æ¡ˆ" scheme="https://www.yzhu.name/tags/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://www.yzhu.name/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://www.yzhu.name/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>RestTemplateä½¿ç”¨Apache HttpClinetè¿æ¥æ± é»˜è®¤å¤§å°å¼•å‘è€—æ—¶ç¬é—´å‡é«˜</title>
    <link href="https://www.yzhu.name/2022/07/30/RestTemplate-HttpClinet-Connect-Pool/"/>
    <id>https://www.yzhu.name/2022/07/30/RestTemplate-HttpClinet-Connect-Pool/</id>
    <published>2022-07-30T05:54:02.000Z</published>
    <updated>2025-11-11T03:53:15.772Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Springé¡¹ç›®ä¸­ï¼ŒRestTemplateç®€åŒ–äº†HTTPè¯·æ±‚å’Œå“åº”çš„å°è£…ï¼Œå¹¶ä¸”æ‰§è¡Œäº†RestfulåŸåˆ™ã€‚åº•å±‚HTTPè¯·æ±‚ç”±<code>HttpURLConnection</code>,<code>Apache HttpComponents</code>å’Œ<code>OkHttp</code>ä¸‰ç§å®ç°ã€‚æœ€è¿‘æˆ‘ä»¬åœ¨ä½¿ç”¨Apache HttpClientä½œä¸ºRestTemplateåº•å±‚å®ç°æ—¶ï¼Œç”±äºä½¿ç”¨ä¸å½“å¯¼è‡´è€—æ—¶ç¬é—´å‡é«˜<span id="more"></span></p><h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p>ä»Šå¤©å¤©æ”¶åˆ°æŠ¥è­¦è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡Açš„æ¥å£TP95ç¬é—´å‡é«˜ï¼Œæ‰“å¼€ç›‘æ§æ£€æŸ¥å‘ç°æµé‡ç¬é—´å‡é«˜æ—¶ï¼Œè€—æ—¶ä¼šç¬é—´å‡é«˜ï¼Œå¦‚å›¾æ‰€ç¤ºï¼›<br><img src="/2022/07/30/RestTemplate-HttpClinet-Connect-Pool/monitor.jpg" alt="å›¾ä¸€"><br>æ‰“å¼€é“¾è·¯è·Ÿè¸ªæŸ¥çœ‹è°ƒç”¨é“¾å…³ç³»ï¼Œå‘ç°è¯¥æ—¶æ¥å£è€—æ—¶å‡ ä¹å…¨éƒ¨è€—è´¹åœ¨è°ƒç”¨ä¸‹æ¸¸æœåŠ¡Bï¼Œå¦‚å›¾æ‰€ç¤ºï¼›æ­£å¸¸æƒ…å†µä¸‹æœåŠ¡Bæ¥å£TP95è€—æ—¶åœ¨500æ¯«ç§’ä»¥å†…<br><img src="/2022/07/30/RestTemplate-HttpClinet-Connect-Pool/opentracing.jpg" alt="å›¾äºŒ"><br>è€Œä¸”è¯¥æœåŠ¡æ¥å£è¿æ¥è¶…æ—¶è®¾ç½®2ç§’ï¼Œè¯»å–è¶…æ—¶è®¾ç½®2ç§’ï¼›æ‰€ä»¥é¢„æœŸå†…è¯¥æ¥å£åœ¨4ç§’å†…åº”è¯¥ç»“æŸã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ç›‘æ§æ£€æŸ¥"><a href="#ç›‘æ§æ£€æŸ¥" class="headerlink" title="ç›‘æ§æ£€æŸ¥"></a>ç›‘æ§æ£€æŸ¥</h4><ol><li>æŸ¥çœ‹æœåŠ¡Bçš„ç›‘æ§å‘ç°æœåŠ¡Bçš„è€—æ—¶ä¸€ç›´å¾ˆç¨³å®šï¼Œå‡ ä¹æ²¡æœ‰æ³¢åŠ¨</li><li>æŸ¥çœ‹æœåŠ¡Cå¯¹æœåŠ¡Bç›¸åŒæ¥å£çš„è°ƒç”¨åœ¨è¯¥æ—¶åˆ»ä¹Ÿå¾ˆç¨³å®š</li><li>æŸ¥çœ‹æœåŠ¡Açš„GCç›‘æ§ï¼Œgcæœ€é•¿è€—æ—¶60msï¼Œä¹Ÿä¸ä¼šå¼•èµ·è¯¥é—®é¢˜ </li><li>æŸ¥çœ‹ç½‘ç»œç›‘æ§ï¼Œä¸€åˆ‡æ­£å¸¸</li></ol><p>é€šè¿‡ç›‘æ§æ•°æ®åŸºæœ¬ç¡®å®šé—®é¢˜ä¸åœ¨æœåŠ¡Bï¼Œå¦å¤–Opså·¥ç¨‹å¸ˆåé¦ˆè¿‘æœŸä¹Ÿæ²¡åšè¿‡ä»»ä½•infrastrucreè°ƒæ•´ï¼›åŸºæœ¬ç¡®å®šé—®é¢˜ä»ç„¶åœ¨æœåŠ¡Aï¼Œæ¥ä¸‹æ¥reviewæœåŠ¡Aè¯·æ±‚æœåŠ¡Bçš„ç›¸å…³ä»£ç </p><h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>æœåŠ¡Aä»£ç ä¸­ç”¨<code>RestTemplate</code>è°ƒç”¨æœåŠ¡Bçš„æ¥å£, <code>RestTemplate</code>çš„Beané‡‡ç”¨é»˜è®¤æ³¨å…¥çš„Builderæ¥ç”Ÿæˆï¼Œè€Œä¸”è®¾ç½®äº†è¿æ¥è¶…æ—¶å’Œè¯»å–è¶…æ—¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public RestTemplate restTemplate(RestTemplateBuilder builder) &#123;</span><br><span class="line">    return builder.setReadTimeout(Duration.ofMillis(readTimeoutConfig)).setConnectTimeout(Duration.ofMillis(connectTimeoutConfig)).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å½¢å¼<code>RestTemplate</code>åº•å±‚å®ç°é‡‡ç”¨äº†<code>Apache HttpComponents</code>ä½œä¸ºHTTPå®¢æˆ·ç«¯ï¼Œ<code>Apache HttpComponents</code>åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šç”¨é»˜è®¤å‚æ•°åˆå§‹åŒ–è¿æ¥æ± ï¼Œæœ€ç»ˆä»£ç ä¼šæ‰§è¡Œåˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public PoolingHttpClientConnectionManager(</span><br><span class="line">    final HttpClientConnectionOperator httpClientConnectionOperator,</span><br><span class="line">    final HttpConnectionFactory&lt;HttpRoute, ManagedHttpClientConnection&gt; connFactory,</span><br><span class="line">    final long timeToLive, final TimeUnit tunit) &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.configData = new ConfigData();</span><br><span class="line">    this.pool = new CPool(new InternalConnectionFactory(</span><br><span class="line">            this.configData, connFactory), 2, 20, timeToLive, tunit);</span><br><span class="line">    this.pool.setValidateAfterInactivity(2000);</span><br><span class="line">    this.connectionOperator = Args.notNull(httpClientConnectionOperator, &quot;HttpClientConnectionOperator&quot;);</span><br><span class="line">    this.isShutDown = new AtomicBoolean(false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç ç¬¬7è¡Œæ„é€ <code>CPool</code>æ—¶ä¼ é€’çš„å¸¸é‡<code>2</code>è¡¨ç¤ºè¿æ¥æ± è¯·æ±‚ç›¸åŒåŸŸåæœ€å¤§è¿æ¥æ•°ï¼Œ<code>20</code>è¡¨ç¤ºè¿æ¥æ± è®¿é—®æ‰€æœ‰åŸŸåçš„æœ€å¤§è¿æ¥æ•° ã€‚</p><p>è‡³æ­¤ï¼Œé—®é¢˜å·²ç„¶æ¸…æ¥šï¼Œå½“zeus-orderè¯·æ±‚é‡ç¬é—´å‡é«˜æ—¶zeus-orderè®¿é—®zeusçš„å¹¶å‘é‡ä¹Ÿç¬é—´å¢å¤§ï¼Œå¦‚æœè¶…è¿‡2ä¸ªå¹¶å‘çš„HTTPè¯·æ±‚åªèƒ½ç­‰å¾…ï¼Œç”±äºæ²¡æœ‰è®¾ç½®ä»è¿æ¥æ± è·å–è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œä¼šæ— é™ç­‰å¾…ï¼Œç›´åˆ°è¿æ¥æ± å†…æœ‰ç©ºé—²çš„HTTPè¿æ¥ç„¶åè·å–è¿æ¥ç»§ç»­å‘å‡ºHTTPè¯·æ±‚ï¼Œè¿™æ ·æ•´ä¸ªè¯·æ±‚è€—æ—¶å°†å¯èƒ½è¶…è¿‡è®¾ç½®çš„HTTPè¶…æ—¶æ—¶é—´</p><h3 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h3><p>åŸºäºä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰çš„HttpClientä¼ é€’ç›¸å…³å‚æ•°å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">    public RestTemplate restTemplate() &#123;</span><br><span class="line">        PoolingHttpClientConnectionManager connectMgr = new PoolingHttpClientConnectionManager() ;</span><br><span class="line">        connectMgr.setDefaultMaxPerRoute(defaultMaxPerRoute);</span><br><span class="line">        connectMgr.setMaxTotal(maxTotal);</span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom()</span><br><span class="line">                .setConnectionManager(connectMgr)</span><br><span class="line">                .build();</span><br><span class="line">        HttpComponentsClientHttpRequestFactory requestFactory =</span><br><span class="line">                new HttpComponentsClientHttpRequestFactory();</span><br><span class="line">        requestFactory.setHttpClient(httpClient);</span><br><span class="line">        requestFactory.setConnectTimeout(connectTimeoutConfig);</span><br><span class="line">        requestFactory.setReadTimeout(readTimeoutConfig);</span><br><span class="line">        requestFactory.setConnectionRequestTimeout(connectRequestTimeoutConfig);</span><br><span class="line">        RestTemplate restTemplate = new RestTemplate(requestFactory);</span><br><span class="line">        return restTemplate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ä¸‰ä¸ªè¶…æ—¶æ—¶é—´ï¼š<br><strong>connectTimeout</strong>:            å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´<br><strong>readTimeout</strong>:               è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´<br><strong>connectionRequestTimeout</strong>:  ä»è¿æ¥æ± è·å–è¿æ¥çš„è¶…æ—¶æ—¶é—´</p><p>ä¿®æ”¹ä»¥åä¸Šçº¿è§‚å¯Ÿä¸€å¤©å³æ—¶å‡ºç°ä¸Šè¿°é—®é¢˜çš„é«˜å³°ç¬é—´ï¼Œè€—æ—¶å§‹ç»ˆä¿æŒå¹³ç¨³ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨Springé¡¹ç›®ä¸­ï¼ŒRestTemplateç®€åŒ–äº†HTTPè¯·æ±‚å’Œå“åº”çš„å°è£…ï¼Œå¹¶ä¸”æ‰§è¡Œäº†RestfulåŸåˆ™ã€‚åº•å±‚HTTPè¯·æ±‚ç”±&lt;code&gt;HttpURLConnection&lt;/code&gt;,&lt;code&gt;Apache HttpComponents&lt;/code&gt;å’Œ&lt;code&gt;OkHttp&lt;/code&gt;ä¸‰ç§å®ç°ã€‚æœ€è¿‘æˆ‘ä»¬åœ¨ä½¿ç”¨Apache HttpClientä½œä¸ºRestTemplateåº•å±‚å®ç°æ—¶ï¼Œç”±äºä½¿ç”¨ä¸å½“å¯¼è‡´è€—æ—¶ç¬é—´å‡é«˜&lt;/p&gt;</summary>
    
    
    
    
    <category term="çº¿ä¸Šé—®é¢˜" scheme="https://www.yzhu.name/tags/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€ç»„ä»¶å‡çº§ç­–ç•¥ä¸å®è·µ</title>
    <link href="https://www.yzhu.name/2022/03/26/Infra-Component-Upgrade/"/>
    <id>https://www.yzhu.name/2022/03/26/Infra-Component-Upgrade/</id>
    <published>2022-03-26T12:35:29.000Z</published>
    <updated>2025-11-11T03:53:15.768Z</updated>
    
    <content type="html"><![CDATA[<p>åŸºç¡€ç»„ä»¶æ˜¯æˆ‘ä»¬ç³»ç»Ÿæ„æˆçš„å…³é”®è¦ç´ ï¼ŒåŒ…æ‹¬ä¸­é—´ä»¶SDKã€åŸºç¡€æ¶æ„ç»„ä»¶ç­‰ã€‚å®ƒä»¬ä¸ºç³»ç»Ÿæä¾›äº†æ ¸å¿ƒåŠŸèƒ½å’ŒåŸºæœ¬æœåŠ¡ï¼Œä¸ºä¸šåŠ¡é€»è¾‘çš„å®ç°æä¾›æ”¯æŒ; è¿‘å‡ å¹´å¤šåšäº†ä¸€äº›åŸºç¡€ç»„ä»¶çš„å‡çº§ï¼Œæœ‰äº›ç»å†äº†è¾ƒé•¿çš„å‡çº§å‘¨æœŸï¼Œä¹Ÿæœ‰çš„ä¸€æ¬¡ä¸Šçº¿ç›´æ¥æˆåŠŸï¼Œè¿˜æœ‰ä¸ªåˆ«ç»„ä»¶å‡çº§å¤±è´¥äº†ï¼Œç›®å‰ä»ç„¶åœ¨å¯»æ‰¾æ”¹è¿›æ–¹æ³•ï¼› <span id="more"></span></p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦åŸºç¡€ç»„ä»¶"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åŸºç¡€ç»„ä»¶" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åŸºç¡€ç»„ä»¶"></a>ä¸ºä»€ä¹ˆéœ€è¦åŸºç¡€ç»„ä»¶</h2><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ç³»ç»Ÿè¦å¼•å…¥åŸºç¡€ç»„ä»¶ï¼Œä½¿ç”¨åŸºç¡€ç»„ä»¶ç”±ä»€ä¹ˆä¼˜åŠ¿,ä»¥ä¸‹æ ¹æ®ä¸ªäººä½“ä¼šåˆ—å‡ºäº†å‡ ç‚¹ï¼š</p><ol><li>æé«˜å¼€å‘æ•ˆç‡ï¼šåŸºç¡€ç»„ä»¶ä¸ºæä¾›äº†å¯é‡ç”¨ã€å¯å®šåˆ¶å’Œå¯æ‰©å±•çš„ç»„ä»¶å’Œåº“ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›ç»„ä»¶ï¼Œå¼€å‘å›¢é˜Ÿèƒ½å¤Ÿå¿«é€Ÿæ­å»ºç³»ç»Ÿï¼Œå¹¶åœ¨ä¸å¿…ä»å¤´å¼€å§‹ç¼–å†™ä»£ç çš„æƒ…å†µä¸‹å®ç°å¸¸è§åŠŸèƒ½ã€‚è¿™å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œç¼©çŸ­äº†äº§å“ä¸Šçº¿æ—¶é—´</li><li>é™ä½å¼€å‘æˆæœ¬ï¼šé€šè¿‡ä½¿ç”¨æˆç†Ÿçš„åŸºç¡€ç»„ä»¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‡å°‘è‡ªä¸»å¼€å‘å’Œç»´æŠ¤çš„å·¥ä½œé‡ã€‚è¿™æ„å‘³ç€å¯ä»¥èŠ‚çœå¼€å‘èµ„æºï¼Œå¹¶å°†ç²¾åŠ›é›†ä¸­åœ¨å¢å€¼ä¸šåŠ¡å’Œåˆ›æ–°ä¸Šã€‚</li><li>ç»Ÿä¸€æ ‡å‡†å’Œè§„èŒƒï¼šåŸºç¡€ç»„ä»¶æœ‰åŠ©äºç¡®ä¿åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨ä¸€è‡´çš„æ ‡å‡†å’Œè§„èŒƒã€‚è¿™ç§ä¸€è‡´æ€§ä½¿å¾—ä¸åŒå›¢é˜Ÿçš„å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´å¥½åœ°ååŒå·¥ä½œï¼Œå¹¶å‡å°‘å› ä¸ºä¸ä¸€è‡´æ€§è€Œå¯¼è‡´çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ç»Ÿä¸€çš„rediså®¢æˆ·ç«¯ç»„ä»¶é™åˆ¶ä¸€äº›å±é™©å‘½ä»¤çš„ä½¿ç”¨ã€‚</li><li>æå‡ç³»ç»Ÿå¯é æ€§å’Œç¨³å®šæ€§ï¼šåŸºç¡€ç»„ä»¶ç»è¿‡ä¸“ä¸šçš„è®¾è®¡å’Œæµ‹è¯•ï¼Œé€šå¸¸å…·æœ‰é«˜åº¦å¯é æ€§å’Œç¨³å®šæ€§ã€‚å®ƒä»¬è¢«å¹¿æ³›ä½¿ç”¨å’ŒéªŒè¯ï¼Œå¯ä»¥å‡å°‘ç³»ç»Ÿä¸­çš„é”™è¯¯å’Œæ•…éšœã€‚è€Œä¸”ï¼Œè¿™äº›ç»„ä»¶é€šå¸¸å…·æœ‰è‡ªåŠ¨åŒ–çš„ç›‘æ§å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°å’Œå¤„ç†æ½œåœ¨çš„é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li><li>è§£å¶ä¸šåŠ¡ç³»ç»Ÿä¸ä¸­é—´ä»¶ï¼Œå¹³å°ä¹‹é—´çš„ä»£ç ï¼šæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œæ–¹ä¾¿ç»´æŠ¤ï¼Œå¼€å‘äººå‘˜èšç„¦åˆ°ä¸šåŠ¡åŠŸèƒ½å¼€å‘ï¼›</li><li>æé«˜ç®¡ç†æ•ˆç‡ï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µå°†æ“ä½œæµç¨‹è§„èŒƒåŒ–</li><li>å®‰å…¨æ€§ï¼šç¡®ä¿ç³»ç»Ÿé‡‡ç”¨å®‰å…¨å¤§ç‰ˆæœ¬</li></ol><h2 id="ä¸ºä»€ä¹ˆè¿›è¡ŒåŸºç¡€ç»„ä»¶å‡çº§"><a href="#ä¸ºä»€ä¹ˆè¿›è¡ŒåŸºç¡€ç»„ä»¶å‡çº§" class="headerlink" title="ä¸ºä»€ä¹ˆè¿›è¡ŒåŸºç¡€ç»„ä»¶å‡çº§"></a>ä¸ºä»€ä¹ˆè¿›è¡ŒåŸºç¡€ç»„ä»¶å‡çº§</h2><ol><li>ä¿®å¤ç»„ä»¶Bug,æé«˜ç³»ç»Ÿç¨³å®šæ€§: éšç€æ—¶é—´çš„æ¨ç§»,åŸºç¡€ç»„ä»¶ä¸­ä¼šæš´éœ²å‡ºå„ç§Bug,è¿™äº›Bugå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–ä¸šåŠ¡å¼‚å¸¸ã€‚å‡çº§ç»„ä»¶å¯ä»¥ä¿®å¤å·²çŸ¥çš„Bug,æé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚</li><li>è·å–æœ€æ–°åŠŸèƒ½ç‰¹æ€§,æ»¡è¶³ä¸šåŠ¡éœ€è¦ï¼šåŸºç¡€ç»„ä»¶æ¨å‡ºæ–°ç‰ˆæœ¬æ—¶,é€šå¸¸ä¼šæä¾›æ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚ä¸šåŠ¡éœ€æ±‚ç¬æ¯ä¸‡å˜,å‡çº§ç»„ä»¶å¯ä»¥è·å¾—æœ€æ–°åŠŸèƒ½æ¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</li><li>æ”¹å–„æ€§èƒ½,æå‡æ•ˆç‡ï¼šæ–°ç‰ˆæœ¬çš„åŸºç¡€ç»„ä»¶é€šå¸¸åœ¨æ€§èƒ½å’Œæ•ˆç‡ä¸Šæœ‰æ”¹è¿›,å¦‚å¢åŠ ç¼“å­˜ã€ä¼˜åŒ–ç®—æ³•ç­‰ã€‚å‡çº§åå¯ä»¥å‡å°‘å“åº”æ—¶é•¿,æå‡ç³»ç»Ÿååé‡ã€‚</li><li>ä¼˜åŒ–èµ„æºåˆ©ç”¨,é™ä½æˆæœ¬ï¼šåŸºç¡€ç»„ä»¶çš„æ–°ç‰ˆæœ¬å¯èƒ½åœ¨èµ„æºè°ƒåº¦å’Œåˆ†é…ä¸Šè¿›è¡Œäº†ä¼˜åŒ–,å¯ä»¥æé«˜èµ„æºåˆ©ç”¨ç‡,é™ä½ç³»ç»Ÿè¿è¥æˆæœ¬ã€‚</li><li>æé«˜å¼€å‘æ•ˆç‡ï¼šæ–°ç‰ˆæœ¬ç»„ä»¶é€šå¸¸ä¼šä¼˜åŒ–APIè®¾è®¡,æé«˜å¼€å‘æ•ˆç‡ã€‚åŒæ—¶ä¿®å¤Bugä¹Ÿå¯ä»¥å‡å°‘å¼€å‘è°ƒè¯•æ—¶é—´ã€‚</li><li>è§£é™¤å¯¹æ—§ç‰ˆçš„ä¾èµ–ï¼šæ—§ç‰ˆæœ¬ç»„ä»¶åœæ­¢ç»´æŠ¤å,å­˜åœ¨å®‰å…¨é£é™©å’Œå…¼å®¹æ€§é—®é¢˜ã€‚å‡çº§å¯ä»¥é¿å…å¯¹æ—§ç‰ˆç»„ä»¶çš„ä¾èµ–ã€‚</li><li>å‡å°‘æŠ€æœ¯å€ºåŠ¡ï¼šä½¿ç”¨äº†è¾ƒæ—§ç‰ˆæœ¬çš„åŸºç¡€ç»„ä»¶ï¼Œå¯èƒ½ä¼šæœ‰æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯ï¼ŒåŒ…æ‹¬å®‰å…¨æ¼æ´ã€æ€§èƒ½ç“¶é¢ˆç­‰ï¼›å‡çº§åŸºç¡€ç»„ä»¶æ˜¯æ§åˆ¶æŠ€æœ¯å€ºåŠ¡çš„é‡è¦æªæ–½ä¹‹ä¸€ï¼Œç§¯å‹çš„æŠ€æœ¯å€ºåŠ¡ä¼šåˆ¶çº¦å…¬å¸å‘å±•</li><li>å¤„ç†å…¼å®¹æ€§é—®é¢˜: éšç€ç³»ç»Ÿçš„å‘å±•å’Œä¸šåŠ¡çš„æ‰©å±•ï¼Œå¯èƒ½éœ€è¦ä¸å…¶ä»–ç³»ç»Ÿè¿›è¡Œé›†æˆå’Œäº¤äº’ï¼Œå‡çº§åŸºç¡€ç»„ä»¶å¯ä»¥æä¾›æ›´å¥½çš„å…¼å®¹æ€§å’Œäº’æ“ä½œæ€§ï¼›</li></ol><h2 id="å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ"><a href="#å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ"></a>å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ</h2><p>åœ¨è¿›è¡ŒåŸºç¡€ç»„ä»¶å‡çº§ä¹‹å‰ï¼Œè¿›è¡Œå……åˆ†çš„å‡†å¤‡å·¥ä½œæ˜¯è‡³å…³é‡è¦çš„ï¼Œè¿™å¯ä»¥å¸®åŠ©ç¡®ä¿å‡çº§è¿‡ç¨‹çš„é¡ºåˆ©è¿›è¡Œå¹¶æœ€å°åŒ–æ½œåœ¨é£é™©ã€‚ä»¥ä¸‹æ˜¯å‡çº§å‰éœ€è¦åšçš„ä¸€äº›å‡†å¤‡å·¥ä½œï¼š</p><ol><li>æ˜ç¡®ç›®æ ‡ï¼š å®šä¹‰å‡çº§çš„å…·ä½“ç›®æ ‡ï¼Œæ˜ç¡®æ‚¨å¸Œæœ›é€šè¿‡å‡çº§å®ç°çš„ä¸šåŠ¡å’ŒæŠ€æœ¯ç›®æ ‡ã€‚äº†è§£å‡çº§æ‰€éœ€çš„åŠŸèƒ½ã€æ€§èƒ½ã€å®‰å…¨æ€§ç­‰éœ€æ±‚ã€‚</li><li>æ”¶é›†ç°æœ‰ä¿¡æ¯ï¼š æ”¶é›†å…³äºå½“å‰ç³»ç»Ÿå’ŒåŸºç¡€ç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€ä¾èµ–å…³ç³»ã€åŠŸèƒ½å’Œæ€§èƒ½ç‰¹å¾ç­‰ã€‚è¿™å°†æœ‰åŠ©äºä¸ºå‡çº§è¿‡ç¨‹åšå‡ºæ›´å‡†ç¡®çš„å†³ç­–ã€‚</li><li>è¯„ä¼°é£é™©å’Œå½±å“ï¼š è¯†åˆ«æ½œåœ¨çš„é£é™©å’Œå½±å“èŒƒå›´ï¼ŒåŒ…æ‹¬ä¸å‡çº§ç›¸å…³çš„åŠŸèƒ½ä¸­æ–­ã€å…¼å®¹æ€§é—®é¢˜ã€æ€§èƒ½ä¸‹é™ç­‰ã€‚è¯„ä¼°è¿™äº›é£é™©çš„ä¸¥é‡ç¨‹åº¦ï¼Œä»¥ä¾¿åˆ¶å®šåº”å¯¹ç­–ç•¥ã€‚</li><li>æ•°æ®ç­–ç•¥ï¼š åœ¨è¿›è¡Œå‡çº§ä¹‹å‰ï¼Œç¡®ä¿å¯¹ç³»ç»Ÿè¿›è¡Œå®Œæ•´çš„å¤‡ä»½ã€‚å¦‚æœå‡çº§ä¸­å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚å¯¹äºæ•°æ®åº“ç­‰æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œå¯ä»¥åˆ›å»ºå¿«ç…§ï¼› </li><li>åˆ¶å®šå‡çº§è®¡åˆ’ï¼š åˆ¶å®šè¯¦ç»†çš„å‡çº§è®¡åˆ’ï¼ŒåŒ…æ‹¬å‡çº§çš„æ­¥éª¤ã€æ—¶é—´è¡¨ã€è´£ä»»äººç­‰ã€‚ç¡®å®šå‡çº§è¿‡ç¨‹ä¸­éœ€è¦æ¶‰åŠçš„å„æ–¹ï¼Œå¹¶ä¸ºä»–ä»¬æä¾›æ¸…æ™°çš„æŒ‡å¯¼ã€‚å¯¹äºè¾ƒå¤§èŒƒå›´å‡çº§å·¥ä½œï¼Œå¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªé‡Œç¨‹ç¢‘ï¼Œå°½å¯èƒ½ä¿è¯æ¯ä¸ªæ­¥éª¤å½±å“èŒƒå›´é™åˆ°æœ€ä½ï¼›</li><li>åˆ¶å®šå›æ»šè®¡åˆ’ï¼š ç¡®å®šå¦‚ä½•è¿˜åŸç³»ç»Ÿåˆ°å‡çº§å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨ç´§æ€¥æƒ…å†µä¸‹è¿›è¡Œå¹²é¢„ã€‚åŸåˆ™ä¸Šå¯¹å‡çº§æ“ä½œçš„æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å¯¹åº”çš„å›æ»šæ­¥éª¤ï¼Œå¦‚æœä¸èƒ½å›æ»šçš„åœºæ™¯ä¸‹å¿…é¡»ç»™å‡ºå¿«é€Ÿè§£å†³çš„æ–¹æ³•ã€‚</li><li>æµ‹è¯•ç¯å¢ƒé¢„æ¼”ï¼š åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå‡çº§çš„æµ‹è¯•é¢„æ¼”ï¼Œä»¥æ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒã€‚æµ‹è¯•ç¯å¢ƒåº”è¯¥å°½å¯èƒ½åœ°ä¸ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼ï¼Œä»¥ä¾¿æ›´å‡†ç¡®åœ°é¢„æµ‹å‡çº§å¯èƒ½çš„å½±å“ã€‚</li><li>æ€§èƒ½å’Œå‹åŠ›æµ‹è¯•ï¼š åœ¨å‹æµ‹ç¯å¢ƒä¸­è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä»¥è¯„ä¼°æ–°ç‰ˆæœ¬åŸºç¡€ç»„ä»¶åœ¨ä¸åŒè´Ÿè½½æ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚è¿™æœ‰åŠ©äºé¢„æµ‹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚</li><li>åˆ¶å®šä¸Šçº¿è®¡åˆ’é€šçŸ¥æ‰€æœ‰ç›¸å…³æ–¹</li><li>ç”¨æˆ·åŸ¹è®­ï¼š å¦‚æœæ–°ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„ç‰¹æ€§æˆ–å˜åŒ–ï¼Œä¸ºå›¢é˜Ÿæˆå‘˜æä¾›åŸ¹è®­ï¼Œç¡®ä¿ä»–ä»¬ç†Ÿæ‚‰å’Œé€‚åº”æ–°ç‰ˆæœ¬ã€‚</li></ol><h2 id="å‡çº§å®è·µ"><a href="#å‡çº§å®è·µ" class="headerlink" title="å‡çº§å®è·µ"></a>å‡çº§å®è·µ</h2><ol><li>ç‰ˆæœ¬é€‰æ‹©ï¼š ä»”ç»†è¯„ä¼°æ–°ç‰ˆæœ¬çš„åŠŸèƒ½ã€æ€§èƒ½å’Œå®‰å…¨ç‰¹æ€§ã€‚é€‰æ‹©ä¸ä¸šåŠ¡éœ€æ±‚æœ€åŒ¹é…çš„ç‰ˆæœ¬ï¼ŒåŒæ—¶è€ƒè™‘å…¶ç¨³å®šæ€§å’Œç”¨æˆ·åé¦ˆ,é‡ç‚¹å…³æ³¨å¼€æºç¤¾åŒºå¯¹issue listã€‚</li><li>å…¼å®¹æ€§æ£€æŸ¥ï¼š æ£€æŸ¥æ–°ç‰ˆæœ¬ä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§ã€‚ç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šç ´åç°æœ‰çš„åŠŸèƒ½å’Œé›†æˆã€‚</li><li>æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼š åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå‡çº§æµ‹è¯•ï¼Œå°½é‡æ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿æµ‹è¯•åˆ°å„ç§å¯èƒ½å½±å“åˆ°çš„åœºæ™¯ã€‚</li><li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š é’ˆå¯¹å…³é”®ä¸šåŠ¡åœºæ™¯å’ŒåŠŸèƒ½ï¼Œåˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚è¿™æœ‰åŠ©äºå¿«é€ŸéªŒè¯æ–°ç‰ˆæœ¬çš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ã€‚</li><li>æ€§èƒ½æµ‹è¯•ï¼š åœ¨å‹æµ‹ç¯å¢ƒä¸­è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä»¥è¯„ä¼°æ–°ç‰ˆæœ¬åœ¨ä¸åŒè´Ÿè½½æ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚è¯†åˆ«æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ã€‚</li><li>æ•°æ®è¿ç§»è®¡åˆ’ï¼š å¦‚æœå‡çº§æ¶‰åŠæ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œåˆ¶å®šæ•°æ®è¿ç§»è®¡åˆ’ã€‚ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li><li>å¤‡ä»½å’Œå›æ»šï¼š åœ¨è¿›è¡Œä»»ä½•å‡çº§æ“ä½œä¹‹å‰ï¼Œç¡®ä¿å¯¹ç³»ç»Ÿè¿›è¡Œå…¨é¢å¤‡ä»½ã€‚åˆ¶å®šå›æ»šè®¡åˆ’ï¼Œä»¥ä¾¿åœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æ—¶èƒ½å¤Ÿè¿…é€Ÿè¿˜åŸã€‚</li><li>ç°åº¦å‘å¸ƒï¼š å¦‚æœæ¡ä»¶è®¸å¯å°½å¯èƒ½é‡‡ç”¨æ¸è¿›å¼å‘å¸ƒç­–ç•¥ï¼Œå°†æ–°ç‰ˆæœ¬é€æ­¥å¼•å…¥ç”Ÿäº§ç¯å¢ƒï¼Œä»¥å‡å°‘é£é™©ã€‚</li><li>ç›‘æ§å’ŒæŠ¥è­¦ï¼š å‡çº§åç•™æ„ç›‘æ§å’ŒæŠ¥è­¦ï¼Œä»¥ä¾¿å®æ—¶ç›‘æ§ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼ŒåŠæ—¶å‘ç°å¹¶å¿«é€Ÿè§£å†³æ½œåœ¨é—®é¢˜ã€‚</li></ol><h2 id="å‡çº§åçš„ç›‘æµ‹ä¸è¿­ä»£"><a href="#å‡çº§åçš„ç›‘æµ‹ä¸è¿­ä»£" class="headerlink" title="å‡çº§åçš„ç›‘æµ‹ä¸è¿­ä»£"></a>å‡çº§åçš„ç›‘æµ‹ä¸è¿­ä»£</h2><ol><li>æ€§èƒ½ç›‘æµ‹ï¼š æŒç»­ç›‘æµ‹ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰ã€‚æ¯”è¾ƒå‡çº§å‰åçš„æ€§èƒ½æ•°æ®ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li><li>ç¨³å®šæ€§ç›‘æµ‹ï¼š ç›‘æµ‹ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œè¯†åˆ«æ˜¯å¦å­˜åœ¨å´©æºƒã€æ­»é”ã€å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚åŠæ—¶å¤„ç†å¹¶è§£å†³è¿™äº›é—®é¢˜ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿä¸ä¼šå› æ­¤è€Œå´©æºƒæˆ–å˜å¾—ä¸ç¨³å®šã€‚</li><li>èµ„æºåˆ©ç”¨ç‡ç›‘æµ‹ï¼š ç›‘æµ‹æœåŠ¡å™¨ã€å†…å­˜ã€CPUã€ç½‘ç»œç­‰èµ„æºçš„åˆ©ç”¨ç‡ã€‚ç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šå¯¼è‡´èµ„æºè€—å°½ã€‚</li><li>é”™è¯¯æ—¥å¿—æŠ¥è­¦ï¼š å…³æ³¨é”™è¯¯æ—¥å¿—æŠ¥è­¦ï¼Œç¡®ä¿å‡çº§åä¸ä¼šå‡ºç°æ›´å¤šé”™è¯¯ï¼Œé˜²æ­¢é—®é¢˜å‡çº§ä¸ºä¸¥é‡æ•…éšœã€‚</li><li>å¿«é€Ÿå“åº”å’Œä¿®å¤ï¼š å¦‚æœå‘ç°äº†ä¸¥é‡é—®é¢˜ï¼Œç¡®ä¿èƒ½å¤Ÿå¿«é€Ÿå“åº”å¹¶è¿›è¡Œä¿®å¤ã€‚çµæ´»åœ°è¿›è¡Œç´§æ€¥å‘å¸ƒï¼Œä»¥è§£å†³å¯èƒ½å½±å“ä¸šåŠ¡çš„é—®é¢˜ã€‚</li><li>æ”¶é›†ç”¨æˆ·çš„åé¦ˆ: äº†è§£ç”¨æˆ·åœ¨ä½¿ç”¨æ–°ç‰ˆæœ¬æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå¸®åŠ©ç”¨æˆ·è§£å†³é—®é¢˜æˆ–åœ¨åœ¨åç»­ç‰ˆæœ¬ä¿®å¤ã€‚</li></ol><h2 id="è®¾è®¡åŸºç¡€ç»„ä»¶çš„æ³¨æ„äº‹é¡¹"><a href="#è®¾è®¡åŸºç¡€ç»„ä»¶çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="è®¾è®¡åŸºç¡€ç»„ä»¶çš„æ³¨æ„äº‹é¡¹"></a>è®¾è®¡åŸºç¡€ç»„ä»¶çš„æ³¨æ„äº‹é¡¹</h2><p>åœ¨è®¾è®¡åŸºç¡€ç»„ä»¶æ—¶ï¼Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹å¯ä»¥è€ƒè™‘ï¼Œä»¥ç¡®ä¿å…¶å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œæ˜“ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>å®šä¹‰æ¸…æ™°çš„æ¥å£ï¼šç¡®ä¿ç»„ä»¶çš„åŠŸèƒ½å’Œæ¥å£å®šä¹‰æ¸…æ™°æ˜ç¡®ã€‚è¿™å°†å¸®åŠ©å…¶ä»–å¼€å‘äººå‘˜ç†è§£å¦‚ä½•æ­£ç¡®ä½¿ç”¨ç»„ä»¶ï¼Œå¹¶å‡å°‘æ½œåœ¨çš„é›†æˆé—®é¢˜ã€‚</li><li>é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼šåŸºç¡€ç»„ä»¶é€šå¸¸æ˜¯ç³»ç»Ÿä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¿…é¡»å…·å¤‡é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚è€ƒè™‘ä½¿ç”¨å†—ä½™ã€è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡ç­‰æœºåˆ¶æ¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li><li>å¯æ‰©å±•æ€§ï¼šè®¾è®¡ç»„ä»¶æ—¶è¦è€ƒè™‘åˆ°ç³»ç»Ÿæœªæ¥çš„æ‰©å±•éœ€æ±‚ã€‚ç¡®ä¿ç»„ä»¶å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œä»¥åº”å¯¹å¢åŠ çš„è´Ÿè½½å’Œæ•°æ®é‡ã€‚</li><li>å®‰å…¨æ€§ï¼šåŸºç¡€ç»„ä»¶é€šå¸¸å¤„ç†æ•æ„Ÿæ•°æ®å’Œå…³é”®ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤å®‰å…¨æ€§æ˜¯è‡³å…³é‡è¦çš„ã€‚å®æ–½é€‚å½“çš„å®‰å…¨æªæ–½ï¼Œå¦‚èº«ä»½éªŒè¯ã€è®¿é—®æ§åˆ¶å’Œæ•°æ®åŠ å¯†ç­‰ï¼Œä»¥ä¿æŠ¤ç»„ä»¶å…å—æ½œåœ¨çš„å¨èƒã€‚</li><li>æ€§èƒ½ä¼˜åŒ–ï¼šç¡®ä¿ç»„ä»¶åœ¨å¤„ç†å¤§é‡è¯·æ±‚å’Œæ•°æ®æ—¶èƒ½å¤Ÿæä¾›è‰¯å¥½çš„æ€§èƒ½è¡¨ç°ã€‚ä½¿ç”¨é«˜æ•ˆçš„ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œå¹¶è¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–ï¼Œä»¥ç¡®ä¿ç»„ä»¶èƒ½å¤Ÿæ»¡è¶³ç³»ç»Ÿçš„æ€§èƒ½éœ€æ±‚ã€‚</li><li>æ–‡æ¡£å’Œæ—¥å¿—è®°å½•ï¼šæä¾›æ¸…æ™°ã€è¯¦ç»†çš„æ–‡æ¡£å’Œæ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿèƒ½å¤Ÿç†è§£ç»„ä»¶çš„å·¥ä½œåŸç†å’Œæ•…éšœæ’æŸ¥æ–¹æ³•ã€‚</li><li>ç›‘æ§å’Œè­¦æŠ¥ï¼šå®æ–½ç›‘æ§å’Œè­¦æŠ¥æœºåˆ¶ï¼Œä»¥åŠæ—¶æ£€æµ‹å’Œå“åº”ç»„ä»¶çš„é—®é¢˜ã€‚ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œå¹¶è®¾ç½®è­¦æŠ¥ä»¥ä¾¿åœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶åŠæ—¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</li><li>ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒç®¡ç†ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ç®¡ç†ç»„ä»¶çš„ä»£ç å’Œé…ç½®ï¼Œç¡®ä¿å¯è¿½æº¯æ€§å’Œå¯é çš„å‘å¸ƒç®¡ç†ã€‚è€ƒè™‘ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹æ¥ç®€åŒ–éƒ¨ç½²å’Œå‡çº§è¿‡ç¨‹ã€‚</li><li>å¯æµ‹è¯•æ€§ï¼šè®¾è®¡ç»„ä»¶æ—¶è¦è€ƒè™‘åˆ°æµ‹è¯•çš„å¯è¡Œæ€§ã€‚æä¾›é€‚å½“çš„æ¥å£å’Œå·¥å…·ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ–¹ä¾¿åœ°ç¼–å†™å’Œè¿è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚</li><li>ä¸å…¶ä»–ç»„ä»¶çš„é›†æˆï¼šå¦‚æœç»„ä»¶éœ€è¦ä¸å…¶ä»–ç»„ä»¶è¿›è¡Œé›†æˆï¼Œè¦ç¡®ä¿æ¥å£å’Œæ•°æ®æ ¼å¼çš„å…¼å®¹æ€§ï¼Œå¹¶è¿›è¡Œå……åˆ†çš„é›†æˆæµ‹è¯•ï¼Œä»¥éªŒè¯ç»„ä»¶çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</li><li>éµå¾ªè§„èŒƒï¼šç»„ä»¶å®ç°éœ€è¦éµå¾ªè¡Œä¸šè®¾è®¡è§„èŒƒå’Œæ ‡å‡†,ä»¥æå‡äº’æ“ä½œæ€§</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸºç¡€ç»„ä»¶æ˜¯æˆ‘ä»¬ç³»ç»Ÿæ„æˆçš„å…³é”®è¦ç´ ï¼ŒåŒ…æ‹¬ä¸­é—´ä»¶SDKã€åŸºç¡€æ¶æ„ç»„ä»¶ç­‰ã€‚å®ƒä»¬ä¸ºç³»ç»Ÿæä¾›äº†æ ¸å¿ƒåŠŸèƒ½å’ŒåŸºæœ¬æœåŠ¡ï¼Œä¸ºä¸šåŠ¡é€»è¾‘çš„å®ç°æä¾›æ”¯æŒ; è¿‘å‡ å¹´å¤šåšäº†ä¸€äº›åŸºç¡€ç»„ä»¶çš„å‡çº§ï¼Œæœ‰äº›ç»å†äº†è¾ƒé•¿çš„å‡çº§å‘¨æœŸï¼Œä¹Ÿæœ‰çš„ä¸€æ¬¡ä¸Šçº¿ç›´æ¥æˆåŠŸï¼Œè¿˜æœ‰ä¸ªåˆ«ç»„ä»¶å‡çº§å¤±è´¥äº†ï¼Œç›®å‰ä»ç„¶åœ¨å¯»æ‰¾æ”¹è¿›æ–¹æ³•ï¼›&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
</feed>
